<head>
    <!-- Other head elements -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>

  
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A blog about tech stuff">
      
      
        <meta name="author" content="matt.pollock@outlook.com (Matthew Pollock)">
      
      
        <link rel="canonical" href="https://blog.pollockweb.com/blog/page/2/">
      
      
      
        <link rel="next" href="../../tags/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../assets/icons/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>Index - cloudlabmp</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-800NGKWBYL"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-800NGKWBYL",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-800NGKWBYL",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-orange" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#index" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
              </button>
            
            
    <div class="announcement-content">
      <p>Welcome to my blog! Connect with me:</p>
      <a href="https://www.linkedin.com/in/matthew-pollock-76831920/" target="_blank" title="LinkedIn">
        <i class="fab fa-linkedin fa-2x"></i>
      </a>
      <a href="https://profile.pollockweb.com" target="_blank" title="profile.pollockweb.com">
        <i class="fas fa-globe fa-2x"></i>
      </a>
      <a href="https://github.com/cloudlabmp" target="_blank" title="GitHub">
        <i class="fab fa-github fa-2x"></i>
      </a><!-- Add more icons as needed -->
    </div>
  
          </div>
          
            <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://cloudlabmp.github.io/project-blog/blog/welcome-to-my-blog/" title="cloudlabmp" class="md-header__button md-logo" aria-label="cloudlabmp" data-md-component="logo">
      
  <img src="../../../assets/icons/logo-48x48.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            cloudlabmp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Index
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-orange" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/cloudlabmp/project-blog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    cloudlabmp/project-blog
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../learn/" class="md-tabs__link">
        
  
    
  
  Learn

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../about/" class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../work/" class="md-tabs__link">
        
  
    
  
  Work

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://cloudlabmp.github.io/project-blog/blog/welcome-to-my-blog/" title="cloudlabmp" class="md-nav__button md-logo" aria-label="cloudlabmp" data-md-component="logo">
      
  <img src="../../../assets/icons/logo-48x48.png" alt="logo">

    </a>
    cloudlabmp
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cloudlabmp/project-blog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    cloudlabmp/project-blog
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tags
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Posts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            Posts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2025/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2025
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/ai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/ai--study-techniques/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AI &amp; Study Techniques
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/ai-integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AI Integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/aws/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/application-insights/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application Insights
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/automation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/azure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/bcdr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BCDR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/blogging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blogging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/cicd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI/CD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/career-development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Career Development
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/cloud-architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/cloud-resume-challenge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud Resume Challenge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/customization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/devops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DevOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/finops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FinOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/gitops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/group-policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Group Policy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/iis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IIS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/iac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IaC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/identity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Identity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/infrastructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infrastructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/intune/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intune
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/learning-projects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learning Projects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/life-update/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Life Update
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/microsoft-certifications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microsoft Certifications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/mkdocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MkDocs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/patch-management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Patch Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/powershell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PowerShell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/regional-settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Regional Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/sql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/scripting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scripting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/self-hosting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Self-Hosting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/serverless/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serverless
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/tech/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tech
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/terraform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terraform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/time-settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/web-hosting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web Hosting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/windows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../learn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learn
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../work/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Work
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cloud-resume-challenge-with-terraform-final-reflections-future-directions" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Resume Challenge with Terraform: Final Reflections &amp; Future Directions 🎯
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Resume Challenge with Terraform: Automating Deployments with GitHub Actions ⚡
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-resume-challenge-with-terraform-building-the-backend-api" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Resume Challenge with Terraform: Building the Backend API 🚀
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-resume-challenge-with-terraform-deploying-the-static-website" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Resume Challenge with Terraform: Deploying the Static Website 🚀
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-resume-challenge-with-terraform-introduction-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Resume Challenge with Terraform: Introduction &amp; Setup 🚀
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-an-iis-based-web-farm-with-azure-application-insights" class="md-nav__link">
    <span class="md-ellipsis">
      📊 Monitoring an IIS-Based Web Farm with Azure Application Insights
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uninstalling-papercut-mf-client-via-intune-a-step-by-step-guide" class="md-nav__link">
    <span class="md-ellipsis">
      📢 Uninstalling PaperCut MF Client via Intune – A Step-by-Step Guide 🚀
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn" class="md-nav__link">
    <span class="md-ellipsis">
      How I Used ChatGPT to Create AZ-400 Exam Prep Notes from MSLearn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions" class="md-nav__link">
    <span class="md-ellipsis">
      GitOps Project: Automating AWS infrastructure deployment with Terraform and GitHub Actions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-your-mkdocs-blog" class="md-nav__link">
    <span class="md-ellipsis">
      Customizing Your MkDocs Blog 🎨
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="index">Index</h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-21 00:00:00+00:00">March 21, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/aws/" class="md-meta__link">AWS</a>, 
              <a href="../../category/terraform/" class="md-meta__link">Terraform</a>, 
              <a href="../../category/devops/" class="md-meta__link">DevOps</a>, 
              <a href="../../category/career-development/" class="md-meta__link">Career Development</a>, 
              <a href="../../category/cloud-resume-challenge/" class="md-meta__link">Cloud Resume Challenge</a></li>
        
        
          
          <li class="md-meta__item">
            
              6 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="cloud-resume-challenge-with-terraform-final-reflections-future-directions"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/">Cloud Resume Challenge with Terraform: Final Reflections &amp; Future Directions 🎯</a></h2>
<h3 id="journey-complete-what-weve-built"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#journey-complete-what-weve-built">Journey Complete: What We've Built 🏗️</a></h3>
<p>Over the course of this blog series, we've successfully completed the Cloud Resume Challenge using Terraform as our infrastructure-as-code tool. Let's recap what we've accomplished:</p>
<ol>
<li><strong>Set up our development environment</strong> with Terraform and AWS credentials</li>
<li><strong>Deployed a static website</strong> using S3, CloudFront, Route 53, and ACM</li>
<li><strong>Built a serverless backend API</strong> with API Gateway, Lambda, and DynamoDB</li>
<li><strong>Implemented CI/CD pipelines</strong> with GitHub Actions for automated deployments</li>
<li><strong>Added security enhancements</strong> like OIDC authentication and least-privilege IAM policies</li>
</ol>
<p>The final architecture we've created looks like this:</p>
<p><img alt="Basic Project Diagram" src="../../crc-aws/CRCArchitecture.png" /></p>
<p>The most valuable aspect of this project is that we've built a <strong>completely automated, production-quality cloud solution</strong>. Every component is defined as code, enabling us to track changes, rollback if needed, and redeploy the entire infrastructure with minimal effort.</p>
<h3 id="key-learnings-from-the-challenge"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#key-learnings-from-the-challenge">Key Learnings from the Challenge 🧠</a></h3>
<h4 id="technical-skills-gained"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#technical-skills-gained">Technical Skills Gained 💻</a></h4>
<p>Throughout this challenge, I've gained significant technical skills:</p>
<ol>
<li><strong>Terraform expertise</strong>: I've moved from basic understanding to writing modular, reusable infrastructure code</li>
<li><strong>AWS service integration</strong>: Learned how multiple AWS services work together to create a cohesive system</li>
<li><strong>CI/CD implementation</strong>: Set up professional GitHub Actions workflows for continuous deployment</li>
<li><strong>Security best practices</strong>: Implemented OIDC, least privilege, encryption, and more</li>
<li><strong>Serverless architecture</strong>: Built and connected serverless components for a scalable, cost-effective solution</li>
</ol>
<h4 id="unexpected-challenges-solutions"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#unexpected-challenges-solutions">Unexpected Challenges &amp; Solutions 🔄</a></h4>
<p>The journey wasn't without obstacles. Here are some challenges I faced and how I overcame them:</p>
<h5 id="1-state-management-complexity"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#1-state-management-complexity">1. State Management Complexity</a></h5>
<p><strong>Challenge</strong>: As the project grew, managing Terraform state became more complex, especially when working across different environments.</p>
<p><strong>Solution</strong>: I restructured the project to use workspaces and remote state with careful output references between modules. This improved state organization and made multi-environment deployments more manageable.</p>
<h5 id="2-cloudfront-cache-invalidation"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#2-cloudfront-cache-invalidation">2. CloudFront Cache Invalidation</a></h5>
<p><strong>Challenge</strong>: Updates to the website weren't immediately visible due to CloudFront caching.</p>
<p><strong>Solution</strong>: Implemented proper cache invalidation in the CI/CD pipeline and set appropriate cache behaviors for different file types.</p>
<h5 id="3-cors-configuration"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#3-cors-configuration">3. CORS Configuration</a></h5>
<p><strong>Challenge</strong>: The frontend JavaScript couldn't connect to the API due to CORS issues.</p>
<p><strong>Solution</strong>: Added comprehensive CORS handling at both the API Gateway and Lambda levels, ensuring proper headers were returned.</p>
<h5 id="4-cicd-authentication-security"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#4-cicd-authentication-security">4. CI/CD Authentication Security</a></h5>
<p><strong>Challenge</strong>: Initially used long-lived AWS credentials in GitHub Secrets, which posed security risks.</p>
<p><strong>Solution</strong>: Replaced with OIDC for keyless authentication between GitHub Actions and AWS, eliminating credential management concerns.</p>
<h3 id="real-world-applications-of-this-project"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#real-world-applications-of-this-project">Real-World Applications of This Project 🌐</a></h3>
<p>The skills demonstrated in this challenge directly translate to real-world cloud engineering roles:</p>
<h4 id="1-infrastructure-as-code-expertise"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#1-infrastructure-as-code-expertise">1. Infrastructure as Code Expertise</a></h4>
<p>The ability to define, version, and automate infrastructure is increasingly essential in modern IT environments. This project showcases expertise with Terraform that can be applied to any cloud provider or on-premises infrastructure.</p>
<h4 id="2-devops-pipeline-creation"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#2-devops-pipeline-creation">2. DevOps Pipeline Creation</a></h4>
<p>Setting up CI/CD workflows that automate testing and deployment demonstrates key DevOps skills that organizations need to accelerate their development cycles.</p>
<h4 id="3-serverless-architecture-design"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#3-serverless-architecture-design">3. Serverless Architecture Design</a></h4>
<p>The backend API implementation shows understanding of event-driven, serverless architecture patterns that are becoming standard for new cloud applications.</p>
<h4 id="4-security-implementation"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#4-security-implementation">4. Security Implementation</a></h4>
<p>The security considerations throughout the project - from IAM roles to OIDC authentication - demonstrate the ability to build secure systems from the ground up.</p>
<h3 id="maintaining-your-cloud-resume"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#maintaining-your-cloud-resume">Maintaining Your Cloud Resume 🔧</a></h3>
<p>Now that your resume is live, here are some tips for maintaining it:</p>
<h4 id="1-regular-updates"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#1-regular-updates">1. Regular Updates</a></h4>
<p>Set a schedule to update both your resume content and the underlying infrastructure. I recommend:</p>
<ul>
<li>Monthly content refreshes to keep your experience and skills current</li>
<li>Quarterly infrastructure reviews to apply security patches and update dependencies</li>
<li>Annual architecture reviews to consider new AWS services or features</li>
</ul>
<h4 id="2-cost-management"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#2-cost-management">2. Cost Management</a></h4>
<p>While this solution is relatively inexpensive, it's good practice to set up AWS Budgets and alerts to monitor costs. My current monthly costs are approximately:</p>
<ul>
<li><strong>S3</strong>: ~$0.10 for storage</li>
<li><strong>CloudFront</strong>: ~$0.50 for data transfer</li>
<li><strong>Route 53</strong>: $0.50 for hosted zone</li>
<li><strong>Lambda</strong>: Free tier covers typical usage</li>
<li><strong>DynamoDB</strong>: Free tier covers typical usage</li>
<li><strong>API Gateway</strong>: ~$1.00 for API calls</li>
<li><strong>Total</strong>: ~$2.10/month</li>
</ul>
<h4 id="3-monitoring-and-alerting"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#3-monitoring-and-alerting">3. Monitoring and Alerting</a></h4>
<p>I've set up CloudWatch alarms for:</p>
<ul>
<li>API errors exceeding normal thresholds</li>
<li>Unusual traffic patterns that might indicate abuse</li>
<li>Lambda function failures</li>
</ul>
<p>Consider adding application performance monitoring tools like AWS X-Ray for deeper insights.</p>
<h3 id="future-enhancements"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#future-enhancements">Future Enhancements 🚀</a></h3>
<p>There are many ways to extend this project further:</p>
<h4 id="1-content-management-system-integration"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#1-content-management-system-integration">1. Content Management System Integration</a></h4>
<p>Add a headless CMS like Contentful or Sanity to make resume updates easier without needing to edit HTML directly:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;contentful_integration&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./modules/contentful&quot;</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">  </span><span class="na">api_key</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">var.contentful_api_key</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">  </span><span class="na">space_id</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">var.contentful_space_id</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">  </span><span class="na">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="p">}</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_function&quot;</span><span class="w"> </span><span class="nv">&quot;content_sync&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-content-sync-${var.environment}&quot;</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">  </span><span class="na">handler</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.handler&quot;</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">  </span><span class="na">runtime</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;nodejs14.x&quot;</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">  </span><span class="na">role</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.content_sync_role.arn</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="w">  </span><span class="nb">environment</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="w">    </span><span class="nb">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="w">      </span><span class="na">CONTENTFUL_API_KEY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.contentful_api_key</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="w">      </span><span class="na">CONTENTFUL_SPACE_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.contentful_space_id</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="w">      </span><span class="na">S3_BUCKET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.frontend.website_bucket_name</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="2-advanced-analytics"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#2-advanced-analytics">2. Advanced Analytics</a></h4>
<p>Implement sophisticated visitor analytics beyond simple counting:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_kinesis_firehose_delivery_stream&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_analytics&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-visitor-analytics-${var.environment}&quot;</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">  </span><span class="na">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;extended_s3&quot;</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">  </span><span class="nb">extended_s3_configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">    </span><span class="na">role_arn</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.firehose_role.arn</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">    </span><span class="na">bucket_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.analytics.arn</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">    </span><span class="nb">processing_configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">      </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">      </span><span class="nb">processors</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w">        </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Lambda&quot;</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w">        </span><span class="nb">parameters</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="w">          </span><span class="na">parameter_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;LambdaArn&quot;</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="w">          </span><span class="na">parameter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.analytics_processor.arn</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="p">}</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_athena_workgroup&quot;</span><span class="w"> </span><span class="nv">&quot;analytics&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-analytics-${var.environment}&quot;</span>
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a>
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="w">  </span><span class="nb">configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a><span class="w">    </span><span class="nb">result_configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-29"><a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="w">      </span><span class="na">output_location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;s3://${aws_s3_bucket.analytics_results.bucket}/results/&quot;</span>
</span><span id="__span-21-30"><a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-31"><a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-21-32"><a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="3-multi-region-deployment"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#3-multi-region-deployment">3. Multi-Region Deployment</a></h4>
<p>Enhance reliability and performance by deploying to multiple AWS regions:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;frontend_us_east_1&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./modules/frontend&quot;</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">  </span><span class="nb">providers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">    </span><span class="na">aws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws.us_east_1</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="c1">  # Configuration for US East region</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="p">}</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;frontend_eu_west_1&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./modules/frontend&quot;</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="w">  </span><span class="nb">providers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="w">    </span><span class="na">aws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws.eu_west_1</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="c1">  # Configuration for EU West region</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="p">}</span>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_health_check&quot;</span><span class="w"> </span><span class="nv">&quot;primary_region&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a><span class="w">  </span><span class="na">fqdn</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="nv">module.frontend_us_east_1.cloudfront_domain_name</span>
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a><span class="w">  </span><span class="na">port</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="m">443</span>
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="w">  </span><span class="na">type</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;HTTPS&quot;</span>
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="w">  </span><span class="na">resource_path</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/&quot;</span>
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a><span class="w">  </span><span class="na">failure_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>
</span><span id="__span-22-27"><a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a><span class="w">  </span><span class="na">request_interval</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">30</span>
</span><span id="__span-22-28"><a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a><span class="p">}</span>
</span><span id="__span-22-29"><a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a>
</span><span id="__span-22-30"><a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_record&quot;</span><span class="w"> </span><span class="nv">&quot;global&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-31"><a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a><span class="w">  </span><span class="na">zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_route53_zone.selected.zone_id</span>
</span><span id="__span-22-32"><a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a><span class="w">  </span><span class="na">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">var.domain_name</span>
</span><span id="__span-22-33"><a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a><span class="w">  </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;CNAME&quot;</span>
</span><span id="__span-22-34"><a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a>
</span><span id="__span-22-35"><a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a><span class="w">  </span><span class="nb">failover_routing_policy</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-36"><a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a><span class="w">    </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PRIMARY&quot;</span>
</span><span id="__span-22-37"><a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-22-38"><a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a>
</span><span id="__span-22-39"><a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a><span class="w">  </span><span class="na">health_check_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_route53_health_check.primary_region.id</span>
</span><span id="__span-22-40"><a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a><span class="w">  </span><span class="na">set_identifier</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;primary&quot;</span>
</span><span id="__span-22-41"><a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a><span class="w">  </span><span class="na">records</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">module.frontend_us_east_1.cloudfront_domain_name</span><span class="p">]</span>
</span><span id="__span-22-42"><a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a><span class="w">  </span><span class="na">ttl</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="m">300</span>
</span><span id="__span-22-43"><a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="4-infrastructure-testing"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#4-infrastructure-testing">4. Infrastructure Testing</a></h4>
<p>Add comprehensive testing using Terratest:</p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">test</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">    </span><span class="s">&quot;testing&quot;</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">    </span><span class="s">&quot;github.com/gruntwork-io/terratest/modules/terraform&quot;</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">    </span><span class="s">&quot;github.com/stretchr/testify/assert&quot;</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="p">)</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">TestResumeFrontend</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">    </span><span class="nx">terraformOptions</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">WithDefaultRetryableErrors</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">        </span><span class="nx">TerraformDir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;../modules/frontend&quot;</span><span class="p">,</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">        </span><span class="nx">Vars</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">            </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">,</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">            </span><span class="s">&quot;domain_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test.example.com&quot;</span><span class="p">,</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">)</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="w">    </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">InitAndApply</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">)</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="w">    </span><span class="c1">// Verify outputs</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="w">    </span><span class="nx">bucketName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Output</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;website_bucket_name&quot;</span><span class="p">)</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">bucketName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;resume-website-test&quot;</span><span class="p">)</span>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="career-impact-personal-growth"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#career-impact-personal-growth">Career Impact &amp; Personal Growth 📈</a></h3>
<p>Completing this challenge has had a significant impact on my career development:</p>
<h4 id="technical-growth"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#technical-growth">Technical Growth</a></h4>
<p>I've moved from basic cloud knowledge to being able to architect and implement complex, multi-service solutions. The hands-on experience with Terraform has been particularly valuable, as it's a highly sought-after skill in the job market.</p>
<h4 id="portfolio-enhancement"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#portfolio-enhancement">Portfolio Enhancement</a></h4>
<p>This project now serves as both my resume and a demonstration of my cloud engineering capabilities. I've included the GitHub repository links on my resume, allowing potential employers to see the code behind the deployment.</p>
<h4 id="community-engagement"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#community-engagement">Community Engagement</a></h4>
<p>Sharing this project through blog posts has connected me with the broader cloud community. The feedback and discussions have been invaluable for refining my approach and learning from others.</p>
<h3 id="final-thoughts"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#final-thoughts">Final Thoughts 💭</a></h3>
<p>The Cloud Resume Challenge has been an invaluable learning experience. By implementing it with Terraform, I've gained practical experience with both AWS services and infrastructure as code - skills that are directly applicable to professional cloud engineering roles.</p>
<p>What makes this challenge particularly powerful is how it combines so many aspects of modern cloud development:</p>
<ul>
<li>Front-end web development</li>
<li>Back-end serverless APIs</li>
<li>Infrastructure as code</li>
<li>CI/CD automation</li>
<li>Security implementation</li>
<li>DNS configuration</li>
<li>Content delivery networks</li>
</ul>
<p>If you're following along with this series, I encourage you to customize and extend the project to showcase your unique skills and interests. The foundational architecture we've built provides a flexible platform that can evolve with your career.</p>
<p>For those just starting their cloud journey, this challenge offers a perfect blend of practical skills in a realistic project that demonstrates end-to-end capabilities. It's far more valuable than isolated tutorials or theoretical knowledge alone.</p>
<p>The cloud engineering field continues to evolve rapidly, but the principles we've applied throughout this project - automation, security, scalability, and operational excellence - remain constants regardless of which specific technologies are in favor.</p>
<h3 id="whats-next"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#whats-next">What's Next? 🔮</a></h3>
<p>While this concludes our Cloud Resume Challenge series, my cloud learning journey continues. Some areas I'm exploring next include:</p>
<ul>
<li>Kubernetes and container orchestration</li>
<li>Infrastructure testing frameworks</li>
<li>Cloud cost optimization</li>
<li>Multi-cloud deployments</li>
<li>Infrastructure security scanning</li>
<li>Service mesh implementations</li>
</ul>
<p>I hope this series has been helpful in your own cloud journey. Feel free to reach out with questions or to share your own implementations of the challenge!</p>
<hr />
<p>This post concludes our Cloud Resume Challenge with Terraform series. Thanks for following along!</p>
<p>Want to see the Cloud Resume Challenge in action? Visit <a href="https://resume.example.com">my resume website</a> and check out the <a href="https://profile.pollockweb.com">GitHub repositories</a> for the complete code.</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Cloud%20Resume%20Challenge%20with%20Terraform%3A%20Final%20Reflections%20%26%20Future%20Directions%0A&amp;url=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-final-reflections--future-directions/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-final-reflections--future-directions/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-20 00:00:00+00:00">March 20, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/aws/" class="md-meta__link">AWS</a>, 
              <a href="../../category/terraform/" class="md-meta__link">Terraform</a>, 
              <a href="../../category/devops/" class="md-meta__link">DevOps</a>, 
              <a href="../../category/cicd/" class="md-meta__link">CI/CD</a>, 
              <a href="../../category/cloud-resume-challenge/" class="md-meta__link">Cloud Resume Challenge</a></li>
        
        
          
          <li class="md-meta__item">
            
              14 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/">Cloud Resume Challenge with Terraform: Automating Deployments with GitHub Actions ⚡</a></h2>
<p>In our <a href="link-to-previous-post">previous posts</a>, we built the frontend and backend components of our cloud resume project. Now it's time to take our implementation to the next level by implementing <strong>continuous integration and deployment (CI/CD)</strong> with GitHub Actions.</p>
<h3 id="why-cicd-is-critical-for-cloud-engineers"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#why-cicd-is-critical-for-cloud-engineers">Why CI/CD Is Critical for Cloud Engineers 🛠️</a></h3>
<p>When I first started this challenge, I manually ran <code>terraform apply</code> every time I made a change. This quickly became tedious and error-prone. As a cloud engineer, I wanted to demonstrate a professional approach to infrastructure management by implementing proper CI/CD pipelines.</p>
<p>Automating deployments offers several key benefits:</p>
<ul>
<li><strong>Consistency</strong>: Every deployment follows the same process</li>
<li><strong>Efficiency</strong>: No more manual steps or waiting around</li>
<li><strong>Safety</strong>: Automated tests catch issues before they reach production</li>
<li><strong>Auditability</strong>: Each change is tracked with a commit and workflow run</li>
</ul>
<p>This approach mirrors how professional cloud teams work and is a crucial skill for any cloud engineer.</p>
<h3 id="cicd-architecture-overview"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#cicd-architecture-overview">CI/CD Architecture Overview 🏗️</a></h3>
<p>Here's a visual representation of our CI/CD pipelines:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a>┌─────────────┐          ┌─────────────────┐          ┌─────────────┐
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a>│             │          │                 │          │             │
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a>│  Developer  ├─────────►│  GitHub Actions ├─────────►│  AWS Cloud  │
</span><span id="__span-110-4"><a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a>│  Workstation│          │                 │          │             │
</span><span id="__span-110-5"><a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a>└─────────────┘          └─────────────────┘          └─────────────┘
</span><span id="__span-110-6"><a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a>       │                          │                          ▲
</span><span id="__span-110-7"><a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a>       │                          │                          │
</span><span id="__span-110-8"><a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a>       ▼                          ▼                          │
</span><span id="__span-110-9"><a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a>┌─────────────┐          ┌─────────────────┐                 │
</span><span id="__span-110-10"><a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a>│             │          │                 │                 │
</span><span id="__span-110-11"><a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a>│   GitHub    │          │  Terraform      │                 │
</span><span id="__span-110-12"><a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a>│ Repositories│          │  Plan &amp; Apply   ├─────────────────┘
</span><span id="__span-110-13"><a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a>│             │          │                 │
</span><span id="__span-110-14"><a id="__codelineno-110-14" name="__codelineno-110-14" href="#__codelineno-110-14"></a>└─────────────┘          └─────────────────┘
</span></code></pre></div>
<p>We'll set up separate workflows for:</p>
<ol>
<li><strong>Frontend deployment</strong>: Updates the S3 website content and invalidates CloudFront</li>
<li><strong>Backend deployment</strong>: Runs Terraform to update our API infrastructure</li>
<li><strong>Smoke tests</strong>: Verifies that both components are working correctly after deployment</li>
</ol>
<h3 id="setting-up-github-repositories"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#setting-up-github-repositories">Setting Up GitHub Repositories 📁</a></h3>
<p>For this challenge, I've created two repositories:</p>
<ul>
<li><code>cloud-resume-frontend</code>: Contains HTML, CSS, JavaScript, and frontend deployment workflows</li>
<li><code>cloud-resume-backend</code>: Contains Terraform configuration, Lambda code, and backend deployment workflows</li>
</ul>
<h4 id="repository-structure"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#repository-structure">Repository Structure</a></h4>
<p>Here's how I've organized my repositories:</p>
<p><strong>Frontend Repository</strong>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a>cloud-resume-frontend/
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a>├── .github/
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a>│   └── workflows/
</span><span id="__span-111-4"><a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a>│       └── deploy.yml
</span><span id="__span-111-5"><a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a>├── website/
</span><span id="__span-111-6"><a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a>│   ├── index.html
</span><span id="__span-111-7"><a id="__codelineno-111-7" name="__codelineno-111-7" href="#__codelineno-111-7"></a>│   ├── styles.css
</span><span id="__span-111-8"><a id="__codelineno-111-8" name="__codelineno-111-8" href="#__codelineno-111-8"></a>│   ├── counter.js
</span><span id="__span-111-9"><a id="__codelineno-111-9" name="__codelineno-111-9" href="#__codelineno-111-9"></a>│   └── error.html
</span><span id="__span-111-10"><a id="__codelineno-111-10" name="__codelineno-111-10" href="#__codelineno-111-10"></a>├── tests/
</span><span id="__span-111-11"><a id="__codelineno-111-11" name="__codelineno-111-11" href="#__codelineno-111-11"></a>│   └── cypress/
</span><span id="__span-111-12"><a id="__codelineno-111-12" name="__codelineno-111-12" href="#__codelineno-111-12"></a>│       └── integration/
</span><span id="__span-111-13"><a id="__codelineno-111-13" name="__codelineno-111-13" href="#__codelineno-111-13"></a>│           └── counter.spec.js
</span><span id="__span-111-14"><a id="__codelineno-111-14" name="__codelineno-111-14" href="#__codelineno-111-14"></a>└── README.md
</span></code></pre></div>
<p><strong>Backend Repository</strong>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a>cloud-resume-backend/
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a>├── .github/
</span><span id="__span-112-3"><a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a>│   └── workflows/
</span><span id="__span-112-4"><a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a>│       └── deploy.yml
</span><span id="__span-112-5"><a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a>├── lambda/
</span><span id="__span-112-6"><a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a>│   └── visitor_counter.py
</span><span id="__span-112-7"><a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a>├── terraform/
</span><span id="__span-112-8"><a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a>│   ├── modules/
</span><span id="__span-112-9"><a id="__codelineno-112-9" name="__codelineno-112-9" href="#__codelineno-112-9"></a>│   │   ├── backend/
</span><span id="__span-112-10"><a id="__codelineno-112-10" name="__codelineno-112-10" href="#__codelineno-112-10"></a>│   │   │   ├── api_gateway.tf
</span><span id="__span-112-11"><a id="__codelineno-112-11" name="__codelineno-112-11" href="#__codelineno-112-11"></a>│   │   │   ├── dynamodb.tf
</span><span id="__span-112-12"><a id="__codelineno-112-12" name="__codelineno-112-12" href="#__codelineno-112-12"></a>│   │   │   ├── lambda.tf
</span><span id="__span-112-13"><a id="__codelineno-112-13" name="__codelineno-112-13" href="#__codelineno-112-13"></a>│   │   │   ├── variables.tf
</span><span id="__span-112-14"><a id="__codelineno-112-14" name="__codelineno-112-14" href="#__codelineno-112-14"></a>│   │   │   └── outputs.tf
</span><span id="__span-112-15"><a id="__codelineno-112-15" name="__codelineno-112-15" href="#__codelineno-112-15"></a>│   ├── environments/
</span><span id="__span-112-16"><a id="__codelineno-112-16" name="__codelineno-112-16" href="#__codelineno-112-16"></a>│   │   ├── dev/
</span><span id="__span-112-17"><a id="__codelineno-112-17" name="__codelineno-112-17" href="#__codelineno-112-17"></a>│   │   │   └── main.tf
</span><span id="__span-112-18"><a id="__codelineno-112-18" name="__codelineno-112-18" href="#__codelineno-112-18"></a>│   │   └── prod/
</span><span id="__span-112-19"><a id="__codelineno-112-19" name="__codelineno-112-19" href="#__codelineno-112-19"></a>│   │       └── main.tf
</span><span id="__span-112-20"><a id="__codelineno-112-20" name="__codelineno-112-20" href="#__codelineno-112-20"></a>│   ├── main.tf
</span><span id="__span-112-21"><a id="__codelineno-112-21" name="__codelineno-112-21" href="#__codelineno-112-21"></a>│   ├── variables.tf
</span><span id="__span-112-22"><a id="__codelineno-112-22" name="__codelineno-112-22" href="#__codelineno-112-22"></a>│   └── outputs.tf
</span><span id="__span-112-23"><a id="__codelineno-112-23" name="__codelineno-112-23" href="#__codelineno-112-23"></a>├── tests/
</span><span id="__span-112-24"><a id="__codelineno-112-24" name="__codelineno-112-24" href="#__codelineno-112-24"></a>│   └── test_visitor_counter.py
</span><span id="__span-112-25"><a id="__codelineno-112-25" name="__codelineno-112-25" href="#__codelineno-112-25"></a>└── README.md
</span></code></pre></div>
<h3 id="securing-aws-authentication-in-github-actions"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#securing-aws-authentication-in-github-actions">Securing AWS Authentication in GitHub Actions 🔒</a></h3>
<p>Before setting up our workflows, we need to address a critical security concern: <strong>how to securely authenticate GitHub Actions with AWS</strong>.</p>
<p>In the past, many tutorials recommended storing AWS access keys as GitHub Secrets. This approach works but has significant security drawbacks:</p>
<ul>
<li>Long-lived credentials are a security risk</li>
<li>Credential rotation is manual and error-prone</li>
<li>Access is typically overly permissive</li>
</ul>
<p>Instead, I'll implement a more secure approach using <strong>OpenID Connect (OIDC)</strong> for keyless authentication between GitHub Actions and AWS.</p>
<h4 id="setting-up-oidc-authentication"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#setting-up-oidc-authentication">Setting Up OIDC Authentication</a></h4>
<p>First, create an IAM OIDC provider for GitHub in your AWS account:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="c1"># oidc-provider.tf</span>
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_openid_connect_provider&quot;</span><span class="w"> </span><span class="nv">&quot;github&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-113-3"><a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="w">  </span><span class="na">url</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://token.actions.githubusercontent.com&quot;</span>
</span><span id="__span-113-4"><a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a><span class="w">  </span><span class="na">client_id_list</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;sts.amazonaws.com&quot;</span><span class="p">]</span>
</span><span id="__span-113-5"><a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a><span class="w">  </span><span class="na">thumbprint_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;6938fd4d98bab03faadb97b34396831e3780aea1&quot;</span><span class="p">]</span>
</span><span id="__span-113-6"><a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then, create an IAM role that GitHub Actions can assume:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="c1"># oidc-role.tf</span>
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role&quot;</span><span class="w"> </span><span class="nv">&quot;github_actions&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-114-3"><a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;github-actions-role&quot;</span>
</span><span id="__span-114-4"><a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a>
</span><span id="__span-114-5"><a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a><span class="w">  </span><span class="na">assume_role_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-114-6"><a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-114-7"><a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-114-8"><a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-114-9"><a id="__codelineno-114-9" name="__codelineno-114-9" href="#__codelineno-114-9"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRoleWithWebIdentity&quot;</span>
</span><span id="__span-114-10"><a id="__codelineno-114-10" name="__codelineno-114-10" href="#__codelineno-114-10"></a><span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-114-11"><a id="__codelineno-114-11" name="__codelineno-114-11" href="#__codelineno-114-11"></a><span class="w">        </span><span class="nb">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-114-12"><a id="__codelineno-114-12" name="__codelineno-114-12" href="#__codelineno-114-12"></a><span class="w">          </span><span class="na">Federated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_openid_connect_provider.github.arn</span>
</span><span id="__span-114-13"><a id="__codelineno-114-13" name="__codelineno-114-13" href="#__codelineno-114-13"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-114-14"><a id="__codelineno-114-14" name="__codelineno-114-14" href="#__codelineno-114-14"></a><span class="w">        </span><span class="nb">Condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-114-15"><a id="__codelineno-114-15" name="__codelineno-114-15" href="#__codelineno-114-15"></a><span class="w">          </span><span class="nb">StringEquals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-114-16"><a id="__codelineno-114-16" name="__codelineno-114-16" href="#__codelineno-114-16"></a><span class="w">            </span><span class="s2">&quot;token.actions.githubusercontent.com:aud&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sts.amazonaws.com&quot;</span>
</span><span id="__span-114-17"><a id="__codelineno-114-17" name="__codelineno-114-17" href="#__codelineno-114-17"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-114-18"><a id="__codelineno-114-18" name="__codelineno-114-18" href="#__codelineno-114-18"></a><span class="w">          </span><span class="nb">StringLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-114-19"><a id="__codelineno-114-19" name="__codelineno-114-19" href="#__codelineno-114-19"></a><span class="w">            </span><span class="s2">&quot;token.actions.githubusercontent.com:sub&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;repo:${var.github_org}/${var.github_repo}:*&quot;</span>
</span><span id="__span-114-20"><a id="__codelineno-114-20" name="__codelineno-114-20" href="#__codelineno-114-20"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-114-21"><a id="__codelineno-114-21" name="__codelineno-114-21" href="#__codelineno-114-21"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-114-22"><a id="__codelineno-114-22" name="__codelineno-114-22" href="#__codelineno-114-22"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-114-23"><a id="__codelineno-114-23" name="__codelineno-114-23" href="#__codelineno-114-23"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-114-24"><a id="__codelineno-114-24" name="__codelineno-114-24" href="#__codelineno-114-24"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-114-25"><a id="__codelineno-114-25" name="__codelineno-114-25" href="#__codelineno-114-25"></a><span class="p">}</span>
</span><span id="__span-114-26"><a id="__codelineno-114-26" name="__codelineno-114-26" href="#__codelineno-114-26"></a>
</span><span id="__span-114-27"><a id="__codelineno-114-27" name="__codelineno-114-27" href="#__codelineno-114-27"></a><span class="c1"># Attach policies to the role</span>
</span><span id="__span-114-28"><a id="__codelineno-114-28" name="__codelineno-114-28" href="#__codelineno-114-28"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role_policy_attachment&quot;</span><span class="w"> </span><span class="nv">&quot;terraform_permissions&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-114-29"><a id="__codelineno-114-29" name="__codelineno-114-29" href="#__codelineno-114-29"></a><span class="w">  </span><span class="na">role</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.github_actions.name</span>
</span><span id="__span-114-30"><a id="__codelineno-114-30" name="__codelineno-114-30" href="#__codelineno-114-30"></a><span class="w">  </span><span class="na">policy_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_policy.terraform_permissions.arn</span>
</span><span id="__span-114-31"><a id="__codelineno-114-31" name="__codelineno-114-31" href="#__codelineno-114-31"></a><span class="p">}</span>
</span><span id="__span-114-32"><a id="__codelineno-114-32" name="__codelineno-114-32" href="#__codelineno-114-32"></a>
</span><span id="__span-114-33"><a id="__codelineno-114-33" name="__codelineno-114-33" href="#__codelineno-114-33"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_policy&quot;</span><span class="w"> </span><span class="nv">&quot;terraform_permissions&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-114-34"><a id="__codelineno-114-34" name="__codelineno-114-34" href="#__codelineno-114-34"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-deployment-policy&quot;</span>
</span><span id="__span-114-35"><a id="__codelineno-114-35" name="__codelineno-114-35" href="#__codelineno-114-35"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Policy for Terraform deployments via GitHub Actions&quot;</span>
</span><span id="__span-114-36"><a id="__codelineno-114-36" name="__codelineno-114-36" href="#__codelineno-114-36"></a>
</span><span id="__span-114-37"><a id="__codelineno-114-37" name="__codelineno-114-37" href="#__codelineno-114-37"></a><span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-114-38"><a id="__codelineno-114-38" name="__codelineno-114-38" href="#__codelineno-114-38"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-114-39"><a id="__codelineno-114-39" name="__codelineno-114-39" href="#__codelineno-114-39"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-114-40"><a id="__codelineno-114-40" name="__codelineno-114-40" href="#__codelineno-114-40"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-114-41"><a id="__codelineno-114-41" name="__codelineno-114-41" href="#__codelineno-114-41"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-114-42"><a id="__codelineno-114-42" name="__codelineno-114-42" href="#__codelineno-114-42"></a><span class="w">          </span><span class="s2">&quot;s3:*&quot;</span><span class="p">,</span>
</span><span id="__span-114-43"><a id="__codelineno-114-43" name="__codelineno-114-43" href="#__codelineno-114-43"></a><span class="w">          </span><span class="s2">&quot;cloudfront:*&quot;</span><span class="p">,</span>
</span><span id="__span-114-44"><a id="__codelineno-114-44" name="__codelineno-114-44" href="#__codelineno-114-44"></a><span class="w">          </span><span class="s2">&quot;route53:*&quot;</span><span class="p">,</span>
</span><span id="__span-114-45"><a id="__codelineno-114-45" name="__codelineno-114-45" href="#__codelineno-114-45"></a><span class="w">          </span><span class="s2">&quot;acm:*&quot;</span><span class="p">,</span>
</span><span id="__span-114-46"><a id="__codelineno-114-46" name="__codelineno-114-46" href="#__codelineno-114-46"></a><span class="w">          </span><span class="s2">&quot;lambda:*&quot;</span><span class="p">,</span>
</span><span id="__span-114-47"><a id="__codelineno-114-47" name="__codelineno-114-47" href="#__codelineno-114-47"></a><span class="w">          </span><span class="s2">&quot;apigateway:*&quot;</span><span class="p">,</span>
</span><span id="__span-114-48"><a id="__codelineno-114-48" name="__codelineno-114-48" href="#__codelineno-114-48"></a><span class="w">          </span><span class="s2">&quot;dynamodb:*&quot;</span><span class="p">,</span>
</span><span id="__span-114-49"><a id="__codelineno-114-49" name="__codelineno-114-49" href="#__codelineno-114-49"></a><span class="w">          </span><span class="s2">&quot;logs:*&quot;</span><span class="p">,</span>
</span><span id="__span-114-50"><a id="__codelineno-114-50" name="__codelineno-114-50" href="#__codelineno-114-50"></a><span class="w">          </span><span class="s2">&quot;iam:GetRole&quot;</span><span class="p">,</span>
</span><span id="__span-114-51"><a id="__codelineno-114-51" name="__codelineno-114-51" href="#__codelineno-114-51"></a><span class="w">          </span><span class="s2">&quot;iam:PassRole&quot;</span><span class="p">,</span>
</span><span id="__span-114-52"><a id="__codelineno-114-52" name="__codelineno-114-52" href="#__codelineno-114-52"></a><span class="w">          </span><span class="s2">&quot;iam:CreateRole&quot;</span><span class="p">,</span>
</span><span id="__span-114-53"><a id="__codelineno-114-53" name="__codelineno-114-53" href="#__codelineno-114-53"></a><span class="w">          </span><span class="s2">&quot;iam:DeleteRole&quot;</span><span class="p">,</span>
</span><span id="__span-114-54"><a id="__codelineno-114-54" name="__codelineno-114-54" href="#__codelineno-114-54"></a><span class="w">          </span><span class="s2">&quot;iam:PutRolePolicy&quot;</span><span class="p">,</span>
</span><span id="__span-114-55"><a id="__codelineno-114-55" name="__codelineno-114-55" href="#__codelineno-114-55"></a><span class="w">          </span><span class="s2">&quot;iam:DeleteRolePolicy&quot;</span><span class="p">,</span>
</span><span id="__span-114-56"><a id="__codelineno-114-56" name="__codelineno-114-56" href="#__codelineno-114-56"></a><span class="w">          </span><span class="s2">&quot;iam:AttachRolePolicy&quot;</span><span class="p">,</span>
</span><span id="__span-114-57"><a id="__codelineno-114-57" name="__codelineno-114-57" href="#__codelineno-114-57"></a><span class="w">          </span><span class="s2">&quot;iam:DetachRolePolicy&quot;</span>
</span><span id="__span-114-58"><a id="__codelineno-114-58" name="__codelineno-114-58" href="#__codelineno-114-58"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-114-59"><a id="__codelineno-114-59" name="__codelineno-114-59" href="#__codelineno-114-59"></a><span class="w">        </span><span class="na">Effect</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-114-60"><a id="__codelineno-114-60" name="__codelineno-114-60" href="#__codelineno-114-60"></a><span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-114-61"><a id="__codelineno-114-61" name="__codelineno-114-61" href="#__codelineno-114-61"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-114-62"><a id="__codelineno-114-62" name="__codelineno-114-62" href="#__codelineno-114-62"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-114-63"><a id="__codelineno-114-63" name="__codelineno-114-63" href="#__codelineno-114-63"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-114-64"><a id="__codelineno-114-64" name="__codelineno-114-64" href="#__codelineno-114-64"></a><span class="p">}</span>
</span></code></pre></div>
<p>For a production environment, I would use more fine-grained permissions, but this policy works for our demonstration.</p>
<h3 id="implementing-frontend-cicd-workflow"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#implementing-frontend-cicd-workflow">Implementing Frontend CI/CD Workflow 🔄</a></h3>
<p>Let's create a GitHub Actions workflow for our frontend repository. Create a file at <code>.github/workflows/deploy.yml</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy Frontend</span>
</span><span id="__span-115-2"><a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a>
</span><span id="__span-115-3"><a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a><span class="nt">on</span><span class="p">:</span>
</span><span id="__span-115-4"><a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a><span class="w">  </span><span class="nt">push</span><span class="p">:</span>
</span><span id="__span-115-5"><a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a><span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
</span><span id="__span-115-6"><a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id="__span-115-7"><a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-115-8"><a id="__codelineno-115-8" name="__codelineno-115-8" href="#__codelineno-115-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;website/**&#39;</span>
</span><span id="__span-115-9"><a id="__codelineno-115-9" name="__codelineno-115-9" href="#__codelineno-115-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;.github/workflows/deploy.yml&#39;</span>
</span><span id="__span-115-10"><a id="__codelineno-115-10" name="__codelineno-115-10" href="#__codelineno-115-10"></a>
</span><span id="__span-115-11"><a id="__codelineno-115-11" name="__codelineno-115-11" href="#__codelineno-115-11"></a><span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span>
</span><span id="__span-115-12"><a id="__codelineno-115-12" name="__codelineno-115-12" href="#__codelineno-115-12"></a>
</span><span id="__span-115-13"><a id="__codelineno-115-13" name="__codelineno-115-13" href="#__codelineno-115-13"></a><span class="nt">permissions</span><span class="p">:</span>
</span><span id="__span-115-14"><a id="__codelineno-115-14" name="__codelineno-115-14" href="#__codelineno-115-14"></a><span class="w">  </span><span class="nt">id-token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id="__span-115-15"><a id="__codelineno-115-15" name="__codelineno-115-15" href="#__codelineno-115-15"></a><span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id="__span-115-16"><a id="__codelineno-115-16" name="__codelineno-115-16" href="#__codelineno-115-16"></a>
</span><span id="__span-115-17"><a id="__codelineno-115-17" name="__codelineno-115-17" href="#__codelineno-115-17"></a><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-115-18"><a id="__codelineno-115-18" name="__codelineno-115-18" href="#__codelineno-115-18"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-115-19"><a id="__codelineno-115-19" name="__codelineno-115-19" href="#__codelineno-115-19"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Deploy</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">S3</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">Invalidate</span><span class="nv"> </span><span class="s">CloudFront&#39;</span>
</span><span id="__span-115-20"><a id="__codelineno-115-20" name="__codelineno-115-20" href="#__codelineno-115-20"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-115-21"><a id="__codelineno-115-21" name="__codelineno-115-21" href="#__codelineno-115-21"></a>
</span><span id="__span-115-22"><a id="__codelineno-115-22" name="__codelineno-115-22" href="#__codelineno-115-22"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-115-23"><a id="__codelineno-115-23" name="__codelineno-115-23" href="#__codelineno-115-23"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-115-24"><a id="__codelineno-115-24" name="__codelineno-115-24" href="#__codelineno-115-24"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-115-25"><a id="__codelineno-115-25" name="__codelineno-115-25" href="#__codelineno-115-25"></a>
</span><span id="__span-115-26"><a id="__codelineno-115-26" name="__codelineno-115-26" href="#__codelineno-115-26"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS Credentials</span>
</span><span id="__span-115-27"><a id="__codelineno-115-27" name="__codelineno-115-27" href="#__codelineno-115-27"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v2</span>
</span><span id="__span-115-28"><a id="__codelineno-115-28" name="__codelineno-115-28" href="#__codelineno-115-28"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-115-29"><a id="__codelineno-115-29" name="__codelineno-115-29" href="#__codelineno-115-29"></a><span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/github-actions-role</span>
</span><span id="__span-115-30"><a id="__codelineno-115-30" name="__codelineno-115-30" href="#__codelineno-115-30"></a><span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
</span><span id="__span-115-31"><a id="__codelineno-115-31" name="__codelineno-115-31" href="#__codelineno-115-31"></a>
</span><span id="__span-115-32"><a id="__codelineno-115-32" name="__codelineno-115-32" href="#__codelineno-115-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to S3</span>
</span><span id="__span-115-33"><a id="__codelineno-115-33" name="__codelineno-115-33" href="#__codelineno-115-33"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-115-34"><a id="__codelineno-115-34" name="__codelineno-115-34" href="#__codelineno-115-34"></a><span class="w">          </span><span class="no">aws s3 sync website/ s3://${{ secrets.S3_BUCKET_NAME }} --delete</span>
</span><span id="__span-115-35"><a id="__codelineno-115-35" name="__codelineno-115-35" href="#__codelineno-115-35"></a>
</span><span id="__span-115-36"><a id="__codelineno-115-36" name="__codelineno-115-36" href="#__codelineno-115-36"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Invalidate CloudFront Cache</span>
</span><span id="__span-115-37"><a id="__codelineno-115-37" name="__codelineno-115-37" href="#__codelineno-115-37"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-115-38"><a id="__codelineno-115-38" name="__codelineno-115-38" href="#__codelineno-115-38"></a><span class="w">          </span><span class="no">aws cloudfront create-invalidation --distribution-id ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }} --paths &quot;/*&quot;</span>
</span><span id="__span-115-39"><a id="__codelineno-115-39" name="__codelineno-115-39" href="#__codelineno-115-39"></a>
</span><span id="__span-115-40"><a id="__codelineno-115-40" name="__codelineno-115-40" href="#__codelineno-115-40"></a><span class="w">  </span><span class="nt">test</span><span class="p">:</span>
</span><span id="__span-115-41"><a id="__codelineno-115-41" name="__codelineno-115-41" href="#__codelineno-115-41"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Run</span><span class="nv"> </span><span class="s">Smoke</span><span class="nv"> </span><span class="s">Tests&#39;</span>
</span><span id="__span-115-42"><a id="__codelineno-115-42" name="__codelineno-115-42" href="#__codelineno-115-42"></a><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id="__span-115-43"><a id="__codelineno-115-43" name="__codelineno-115-43" href="#__codelineno-115-43"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-115-44"><a id="__codelineno-115-44" name="__codelineno-115-44" href="#__codelineno-115-44"></a>
</span><span id="__span-115-45"><a id="__codelineno-115-45" name="__codelineno-115-45" href="#__codelineno-115-45"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-115-46"><a id="__codelineno-115-46" name="__codelineno-115-46" href="#__codelineno-115-46"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-115-47"><a id="__codelineno-115-47" name="__codelineno-115-47" href="#__codelineno-115-47"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-115-48"><a id="__codelineno-115-48" name="__codelineno-115-48" href="#__codelineno-115-48"></a>
</span><span id="__span-115-49"><a id="__codelineno-115-49" name="__codelineno-115-49" href="#__codelineno-115-49"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Cypress</span>
</span><span id="__span-115-50"><a id="__codelineno-115-50" name="__codelineno-115-50" href="#__codelineno-115-50"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cypress-io/github-action@v5</span>
</span><span id="__span-115-51"><a id="__codelineno-115-51" name="__codelineno-115-51" href="#__codelineno-115-51"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-115-52"><a id="__codelineno-115-52" name="__codelineno-115-52" href="#__codelineno-115-52"></a><span class="w">          </span><span class="nt">install-command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm install</span>
</span><span id="__span-115-53"><a id="__codelineno-115-53" name="__codelineno-115-53" href="#__codelineno-115-53"></a>
</span><span id="__span-115-54"><a id="__codelineno-115-54" name="__codelineno-115-54" href="#__codelineno-115-54"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Cypress Tests</span>
</span><span id="__span-115-55"><a id="__codelineno-115-55" name="__codelineno-115-55" href="#__codelineno-115-55"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cypress-io/github-action@v5</span>
</span><span id="__span-115-56"><a id="__codelineno-115-56" name="__codelineno-115-56" href="#__codelineno-115-56"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-115-57"><a id="__codelineno-115-57" name="__codelineno-115-57" href="#__codelineno-115-57"></a><span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npx cypress run</span>
</span><span id="__span-115-58"><a id="__codelineno-115-58" name="__codelineno-115-58" href="#__codelineno-115-58"></a><span class="w">          </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">baseUrl=${{ secrets.WEBSITE_URL }}</span>
</span></code></pre></div>
<p>This workflow:</p>
<ol>
<li>Authenticates using OIDC</li>
<li>Syncs website files to the S3 bucket</li>
<li>Invalidates the CloudFront cache</li>
<li>Runs Cypress tests to verify the site is working</li>
</ol>
<h4 id="creating-a-cypress-test-for-the-frontend"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#creating-a-cypress-test-for-the-frontend">Creating a Cypress Test for the Frontend</a></h4>
<p>Let's create a simple Cypress test to verify that our visitor counter is working. First, create a <code>package.json</code> file in the root of your frontend repository:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="p">{</span>
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cloud-resume-frontend&quot;</span><span class="p">,</span>
</span><span id="__span-116-3"><a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a><span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-116-4"><a id="__codelineno-116-4" name="__codelineno-116-4" href="#__codelineno-116-4"></a><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Frontend for Cloud Resume Challenge&quot;</span><span class="p">,</span>
</span><span id="__span-116-5"><a id="__codelineno-116-5" name="__codelineno-116-5" href="#__codelineno-116-5"></a><span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-116-6"><a id="__codelineno-116-6" name="__codelineno-116-6" href="#__codelineno-116-6"></a><span class="w">    </span><span class="nt">&quot;test&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cypress open&quot;</span><span class="p">,</span>
</span><span id="__span-116-7"><a id="__codelineno-116-7" name="__codelineno-116-7" href="#__codelineno-116-7"></a><span class="w">    </span><span class="nt">&quot;test:ci&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cypress run&quot;</span>
</span><span id="__span-116-8"><a id="__codelineno-116-8" name="__codelineno-116-8" href="#__codelineno-116-8"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-116-9"><a id="__codelineno-116-9" name="__codelineno-116-9" href="#__codelineno-116-9"></a><span class="w">  </span><span class="nt">&quot;devDependencies&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-116-10"><a id="__codelineno-116-10" name="__codelineno-116-10" href="#__codelineno-116-10"></a><span class="w">    </span><span class="nt">&quot;cypress&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^12.0.0&quot;</span>
</span><span id="__span-116-11"><a id="__codelineno-116-11" name="__codelineno-116-11" href="#__codelineno-116-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-116-12"><a id="__codelineno-116-12" name="__codelineno-116-12" href="#__codelineno-116-12"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then create a Cypress test at <code>tests/cypress/integration/counter.spec.js</code>:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Resume Website Tests&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="w">  </span><span class="nx">beforeEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-117-3"><a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a><span class="w">    </span><span class="c1">// Visit the home page before each test</span>
</span><span id="__span-117-4"><a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
</span><span id="__span-117-5"><a id="__codelineno-117-5" name="__codelineno-117-5" href="#__codelineno-117-5"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-117-6"><a id="__codelineno-117-6" name="__codelineno-117-6" href="#__codelineno-117-6"></a>
</span><span id="__span-117-7"><a id="__codelineno-117-7" name="__codelineno-117-7" href="#__codelineno-117-7"></a><span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should load the resume page&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-117-8"><a id="__codelineno-117-8" name="__codelineno-117-8" href="#__codelineno-117-8"></a><span class="w">    </span><span class="c1">// Check that we have a title</span>
</span><span id="__span-117-9"><a id="__codelineno-117-9" name="__codelineno-117-9" href="#__codelineno-117-9"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;be.visible&#39;</span><span class="p">);</span>
</span><span id="__span-117-10"><a id="__codelineno-117-10" name="__codelineno-117-10" href="#__codelineno-117-10"></a>
</span><span id="__span-117-11"><a id="__codelineno-117-11" name="__codelineno-117-11" href="#__codelineno-117-11"></a><span class="w">    </span><span class="c1">// Check that key sections exist</span>
</span><span id="__span-117-12"><a id="__codelineno-117-12" name="__codelineno-117-12" href="#__codelineno-117-12"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;Experience&#39;</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;be.visible&#39;</span><span class="p">);</span>
</span><span id="__span-117-13"><a id="__codelineno-117-13" name="__codelineno-117-13" href="#__codelineno-117-13"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;Education&#39;</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;be.visible&#39;</span><span class="p">);</span>
</span><span id="__span-117-14"><a id="__codelineno-117-14" name="__codelineno-117-14" href="#__codelineno-117-14"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;Skills&#39;</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;be.visible&#39;</span><span class="p">);</span>
</span><span id="__span-117-15"><a id="__codelineno-117-15" name="__codelineno-117-15" href="#__codelineno-117-15"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-117-16"><a id="__codelineno-117-16" name="__codelineno-117-16" href="#__codelineno-117-16"></a>
</span><span id="__span-117-17"><a id="__codelineno-117-17" name="__codelineno-117-17" href="#__codelineno-117-17"></a><span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should load and display the visitor counter&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-117-18"><a id="__codelineno-117-18" name="__codelineno-117-18" href="#__codelineno-117-18"></a><span class="w">    </span><span class="c1">// Check that the counter element exists</span>
</span><span id="__span-117-19"><a id="__codelineno-117-19" name="__codelineno-117-19" href="#__codelineno-117-19"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;#count&#39;</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;exist&#39;</span><span class="p">);</span>
</span><span id="__span-117-20"><a id="__codelineno-117-20" name="__codelineno-117-20" href="#__codelineno-117-20"></a>
</span><span id="__span-117-21"><a id="__codelineno-117-21" name="__codelineno-117-21" href="#__codelineno-117-21"></a><span class="w">    </span><span class="c1">// Wait for the counter to update (should not remain at 0)</span>
</span><span id="__span-117-22"><a id="__codelineno-117-22" name="__codelineno-117-22" href="#__codelineno-117-22"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;#count&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">timeout</span><span class="o">:</span><span class="w"> </span><span class="mf">10000</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-117-23"><a id="__codelineno-117-23" name="__codelineno-117-23" href="#__codelineno-117-23"></a><span class="w">      </span><span class="p">.</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;not.contain&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
</span><span id="__span-117-24"><a id="__codelineno-117-24" name="__codelineno-117-24" href="#__codelineno-117-24"></a><span class="w">      </span><span class="p">.</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;not.contain&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Loading&#39;</span><span class="p">);</span>
</span><span id="__span-117-25"><a id="__codelineno-117-25" name="__codelineno-117-25" href="#__codelineno-117-25"></a>
</span><span id="__span-117-26"><a id="__codelineno-117-26" name="__codelineno-117-26" href="#__codelineno-117-26"></a><span class="w">    </span><span class="c1">// Verify the counter shows a number</span>
</span><span id="__span-117-27"><a id="__codelineno-117-27" name="__codelineno-117-27" href="#__codelineno-117-27"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;#count&#39;</span><span class="p">).</span><span class="nx">invoke</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">)</span>
</span><span id="__span-117-28"><a id="__codelineno-117-28" name="__codelineno-117-28" href="#__codelineno-117-28"></a><span class="w">      </span><span class="p">.</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;be.gt&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-117-29"><a id="__codelineno-117-29" name="__codelineno-117-29" href="#__codelineno-117-29"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-117-30"><a id="__codelineno-117-30" name="__codelineno-117-30" href="#__codelineno-117-30"></a><span class="p">});</span>
</span></code></pre></div>
<h3 id="implementing-backend-cicd-workflow"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#implementing-backend-cicd-workflow">Implementing Backend CI/CD Workflow 🔄</a></h3>
<p>Now, let's create a GitHub Actions workflow for our backend repository. Create a file at <code>.github/workflows/deploy.yml</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy Backend</span>
</span><span id="__span-118-2"><a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a>
</span><span id="__span-118-3"><a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a><span class="nt">on</span><span class="p">:</span>
</span><span id="__span-118-4"><a id="__codelineno-118-4" name="__codelineno-118-4" href="#__codelineno-118-4"></a><span class="w">  </span><span class="nt">push</span><span class="p">:</span>
</span><span id="__span-118-5"><a id="__codelineno-118-5" name="__codelineno-118-5" href="#__codelineno-118-5"></a><span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
</span><span id="__span-118-6"><a id="__codelineno-118-6" name="__codelineno-118-6" href="#__codelineno-118-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id="__span-118-7"><a id="__codelineno-118-7" name="__codelineno-118-7" href="#__codelineno-118-7"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-118-8"><a id="__codelineno-118-8" name="__codelineno-118-8" href="#__codelineno-118-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;lambda/**&#39;</span>
</span><span id="__span-118-9"><a id="__codelineno-118-9" name="__codelineno-118-9" href="#__codelineno-118-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;terraform/**&#39;</span>
</span><span id="__span-118-10"><a id="__codelineno-118-10" name="__codelineno-118-10" href="#__codelineno-118-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;.github/workflows/deploy.yml&#39;</span>
</span><span id="__span-118-11"><a id="__codelineno-118-11" name="__codelineno-118-11" href="#__codelineno-118-11"></a>
</span><span id="__span-118-12"><a id="__codelineno-118-12" name="__codelineno-118-12" href="#__codelineno-118-12"></a><span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
</span><span id="__span-118-13"><a id="__codelineno-118-13" name="__codelineno-118-13" href="#__codelineno-118-13"></a><span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
</span><span id="__span-118-14"><a id="__codelineno-118-14" name="__codelineno-118-14" href="#__codelineno-118-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id="__span-118-15"><a id="__codelineno-118-15" name="__codelineno-118-15" href="#__codelineno-118-15"></a>
</span><span id="__span-118-16"><a id="__codelineno-118-16" name="__codelineno-118-16" href="#__codelineno-118-16"></a><span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span>
</span><span id="__span-118-17"><a id="__codelineno-118-17" name="__codelineno-118-17" href="#__codelineno-118-17"></a>
</span><span id="__span-118-18"><a id="__codelineno-118-18" name="__codelineno-118-18" href="#__codelineno-118-18"></a><span class="nt">permissions</span><span class="p">:</span>
</span><span id="__span-118-19"><a id="__codelineno-118-19" name="__codelineno-118-19" href="#__codelineno-118-19"></a><span class="w">  </span><span class="nt">id-token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id="__span-118-20"><a id="__codelineno-118-20" name="__codelineno-118-20" href="#__codelineno-118-20"></a><span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id="__span-118-21"><a id="__codelineno-118-21" name="__codelineno-118-21" href="#__codelineno-118-21"></a><span class="w">  </span><span class="nt">pull-requests</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id="__span-118-22"><a id="__codelineno-118-22" name="__codelineno-118-22" href="#__codelineno-118-22"></a>
</span><span id="__span-118-23"><a id="__codelineno-118-23" name="__codelineno-118-23" href="#__codelineno-118-23"></a><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-118-24"><a id="__codelineno-118-24" name="__codelineno-118-24" href="#__codelineno-118-24"></a><span class="w">  </span><span class="nt">test</span><span class="p">:</span>
</span><span id="__span-118-25"><a id="__codelineno-118-25" name="__codelineno-118-25" href="#__codelineno-118-25"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Run</span><span class="nv"> </span><span class="s">Python</span><span class="nv"> </span><span class="s">Tests&#39;</span>
</span><span id="__span-118-26"><a id="__codelineno-118-26" name="__codelineno-118-26" href="#__codelineno-118-26"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-118-27"><a id="__codelineno-118-27" name="__codelineno-118-27" href="#__codelineno-118-27"></a>
</span><span id="__span-118-28"><a id="__codelineno-118-28" name="__codelineno-118-28" href="#__codelineno-118-28"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-118-29"><a id="__codelineno-118-29" name="__codelineno-118-29" href="#__codelineno-118-29"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-118-30"><a id="__codelineno-118-30" name="__codelineno-118-30" href="#__codelineno-118-30"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-118-31"><a id="__codelineno-118-31" name="__codelineno-118-31" href="#__codelineno-118-31"></a>
</span><span id="__span-118-32"><a id="__codelineno-118-32" name="__codelineno-118-32" href="#__codelineno-118-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python</span>
</span><span id="__span-118-33"><a id="__codelineno-118-33" name="__codelineno-118-33" href="#__codelineno-118-33"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v4</span>
</span><span id="__span-118-34"><a id="__codelineno-118-34" name="__codelineno-118-34" href="#__codelineno-118-34"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-118-35"><a id="__codelineno-118-35" name="__codelineno-118-35" href="#__codelineno-118-35"></a><span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.9&#39;</span>
</span><span id="__span-118-36"><a id="__codelineno-118-36" name="__codelineno-118-36" href="#__codelineno-118-36"></a>
</span><span id="__span-118-37"><a id="__codelineno-118-37" name="__codelineno-118-37" href="#__codelineno-118-37"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Dependencies</span>
</span><span id="__span-118-38"><a id="__codelineno-118-38" name="__codelineno-118-38" href="#__codelineno-118-38"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-118-39"><a id="__codelineno-118-39" name="__codelineno-118-39" href="#__codelineno-118-39"></a><span class="w">          </span><span class="no">python -m pip install --upgrade pip</span>
</span><span id="__span-118-40"><a id="__codelineno-118-40" name="__codelineno-118-40" href="#__codelineno-118-40"></a><span class="w">          </span><span class="no">pip install pytest boto3 moto</span>
</span><span id="__span-118-41"><a id="__codelineno-118-41" name="__codelineno-118-41" href="#__codelineno-118-41"></a>
</span><span id="__span-118-42"><a id="__codelineno-118-42" name="__codelineno-118-42" href="#__codelineno-118-42"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Tests</span>
</span><span id="__span-118-43"><a id="__codelineno-118-43" name="__codelineno-118-43" href="#__codelineno-118-43"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-118-44"><a id="__codelineno-118-44" name="__codelineno-118-44" href="#__codelineno-118-44"></a><span class="w">          </span><span class="no">python -m pytest tests/</span>
</span><span id="__span-118-45"><a id="__codelineno-118-45" name="__codelineno-118-45" href="#__codelineno-118-45"></a>
</span><span id="__span-118-46"><a id="__codelineno-118-46" name="__codelineno-118-46" href="#__codelineno-118-46"></a><span class="w">  </span><span class="nt">validate</span><span class="p">:</span>
</span><span id="__span-118-47"><a id="__codelineno-118-47" name="__codelineno-118-47" href="#__codelineno-118-47"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Validate</span><span class="nv"> </span><span class="s">Terraform&#39;</span>
</span><span id="__span-118-48"><a id="__codelineno-118-48" name="__codelineno-118-48" href="#__codelineno-118-48"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-118-49"><a id="__codelineno-118-49" name="__codelineno-118-49" href="#__codelineno-118-49"></a><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
</span><span id="__span-118-50"><a id="__codelineno-118-50" name="__codelineno-118-50" href="#__codelineno-118-50"></a>
</span><span id="__span-118-51"><a id="__codelineno-118-51" name="__codelineno-118-51" href="#__codelineno-118-51"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-118-52"><a id="__codelineno-118-52" name="__codelineno-118-52" href="#__codelineno-118-52"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-118-53"><a id="__codelineno-118-53" name="__codelineno-118-53" href="#__codelineno-118-53"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-118-54"><a id="__codelineno-118-54" name="__codelineno-118-54" href="#__codelineno-118-54"></a>
</span><span id="__span-118-55"><a id="__codelineno-118-55" name="__codelineno-118-55" href="#__codelineno-118-55"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
</span><span id="__span-118-56"><a id="__codelineno-118-56" name="__codelineno-118-56" href="#__codelineno-118-56"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v2</span>
</span><span id="__span-118-57"><a id="__codelineno-118-57" name="__codelineno-118-57" href="#__codelineno-118-57"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-118-58"><a id="__codelineno-118-58" name="__codelineno-118-58" href="#__codelineno-118-58"></a><span class="w">          </span><span class="nt">terraform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2.0</span>
</span><span id="__span-118-59"><a id="__codelineno-118-59" name="__codelineno-118-59" href="#__codelineno-118-59"></a>
</span><span id="__span-118-60"><a id="__codelineno-118-60" name="__codelineno-118-60" href="#__codelineno-118-60"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Format</span>
</span><span id="__span-118-61"><a id="__codelineno-118-61" name="__codelineno-118-61" href="#__codelineno-118-61"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-118-62"><a id="__codelineno-118-62" name="__codelineno-118-62" href="#__codelineno-118-62"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform fmt -check</span>
</span><span id="__span-118-63"><a id="__codelineno-118-63" name="__codelineno-118-63" href="#__codelineno-118-63"></a>
</span><span id="__span-118-64"><a id="__codelineno-118-64" name="__codelineno-118-64" href="#__codelineno-118-64"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
</span><span id="__span-118-65"><a id="__codelineno-118-65" name="__codelineno-118-65" href="#__codelineno-118-65"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-118-66"><a id="__codelineno-118-66" name="__codelineno-118-66" href="#__codelineno-118-66"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform init -backend=false</span>
</span><span id="__span-118-67"><a id="__codelineno-118-67" name="__codelineno-118-67" href="#__codelineno-118-67"></a>
</span><span id="__span-118-68"><a id="__codelineno-118-68" name="__codelineno-118-68" href="#__codelineno-118-68"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Validate</span>
</span><span id="__span-118-69"><a id="__codelineno-118-69" name="__codelineno-118-69" href="#__codelineno-118-69"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-118-70"><a id="__codelineno-118-70" name="__codelineno-118-70" href="#__codelineno-118-70"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform validate</span>
</span><span id="__span-118-71"><a id="__codelineno-118-71" name="__codelineno-118-71" href="#__codelineno-118-71"></a>
</span><span id="__span-118-72"><a id="__codelineno-118-72" name="__codelineno-118-72" href="#__codelineno-118-72"></a><span class="w">  </span><span class="nt">plan</span><span class="p">:</span>
</span><span id="__span-118-73"><a id="__codelineno-118-73" name="__codelineno-118-73" href="#__codelineno-118-73"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Terraform</span><span class="nv"> </span><span class="s">Plan&#39;</span>
</span><span id="__span-118-74"><a id="__codelineno-118-74" name="__codelineno-118-74" href="#__codelineno-118-74"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-118-75"><a id="__codelineno-118-75" name="__codelineno-118-75" href="#__codelineno-118-75"></a><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validate</span>
</span><span id="__span-118-76"><a id="__codelineno-118-76" name="__codelineno-118-76" href="#__codelineno-118-76"></a><span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.event_name == &#39;pull_request&#39; || github.event_name == &#39;push&#39; || github.event_name == &#39;workflow_dispatch&#39;</span>
</span><span id="__span-118-77"><a id="__codelineno-118-77" name="__codelineno-118-77" href="#__codelineno-118-77"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
</span><span id="__span-118-78"><a id="__codelineno-118-78" name="__codelineno-118-78" href="#__codelineno-118-78"></a>
</span><span id="__span-118-79"><a id="__codelineno-118-79" name="__codelineno-118-79" href="#__codelineno-118-79"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-118-80"><a id="__codelineno-118-80" name="__codelineno-118-80" href="#__codelineno-118-80"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-118-81"><a id="__codelineno-118-81" name="__codelineno-118-81" href="#__codelineno-118-81"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-118-82"><a id="__codelineno-118-82" name="__codelineno-118-82" href="#__codelineno-118-82"></a>
</span><span id="__span-118-83"><a id="__codelineno-118-83" name="__codelineno-118-83" href="#__codelineno-118-83"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS Credentials</span>
</span><span id="__span-118-84"><a id="__codelineno-118-84" name="__codelineno-118-84" href="#__codelineno-118-84"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v2</span>
</span><span id="__span-118-85"><a id="__codelineno-118-85" name="__codelineno-118-85" href="#__codelineno-118-85"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-118-86"><a id="__codelineno-118-86" name="__codelineno-118-86" href="#__codelineno-118-86"></a><span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/github-actions-role</span>
</span><span id="__span-118-87"><a id="__codelineno-118-87" name="__codelineno-118-87" href="#__codelineno-118-87"></a><span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
</span><span id="__span-118-88"><a id="__codelineno-118-88" name="__codelineno-118-88" href="#__codelineno-118-88"></a>
</span><span id="__span-118-89"><a id="__codelineno-118-89" name="__codelineno-118-89" href="#__codelineno-118-89"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
</span><span id="__span-118-90"><a id="__codelineno-118-90" name="__codelineno-118-90" href="#__codelineno-118-90"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v2</span>
</span><span id="__span-118-91"><a id="__codelineno-118-91" name="__codelineno-118-91" href="#__codelineno-118-91"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-118-92"><a id="__codelineno-118-92" name="__codelineno-118-92" href="#__codelineno-118-92"></a><span class="w">          </span><span class="nt">terraform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2.0</span>
</span><span id="__span-118-93"><a id="__codelineno-118-93" name="__codelineno-118-93" href="#__codelineno-118-93"></a>
</span><span id="__span-118-94"><a id="__codelineno-118-94" name="__codelineno-118-94" href="#__codelineno-118-94"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
</span><span id="__span-118-95"><a id="__codelineno-118-95" name="__codelineno-118-95" href="#__codelineno-118-95"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-118-96"><a id="__codelineno-118-96" name="__codelineno-118-96" href="#__codelineno-118-96"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform init -backend-config=&quot;bucket=${{ secrets.TF_STATE_BUCKET }}&quot; -backend-config=&quot;key=${{ secrets.TF_STATE_KEY }}&quot; -backend-config=&quot;region=us-east-1&quot;</span>
</span><span id="__span-118-97"><a id="__codelineno-118-97" name="__codelineno-118-97" href="#__codelineno-118-97"></a>
</span><span id="__span-118-98"><a id="__codelineno-118-98" name="__codelineno-118-98" href="#__codelineno-118-98"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Plan</span>
</span><span id="__span-118-99"><a id="__codelineno-118-99" name="__codelineno-118-99" href="#__codelineno-118-99"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-118-100"><a id="__codelineno-118-100" name="__codelineno-118-100" href="#__codelineno-118-100"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform plan -var=&quot;environment=dev&quot; -var=&quot;domain_name=${{ secrets.DOMAIN_NAME }}&quot; -out=tfplan</span>
</span><span id="__span-118-101"><a id="__codelineno-118-101" name="__codelineno-118-101" href="#__codelineno-118-101"></a>
</span><span id="__span-118-102"><a id="__codelineno-118-102" name="__codelineno-118-102" href="#__codelineno-118-102"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Comment Plan on PR</span>
</span><span id="__span-118-103"><a id="__codelineno-118-103" name="__codelineno-118-103" href="#__codelineno-118-103"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/github-script@v6</span>
</span><span id="__span-118-104"><a id="__codelineno-118-104" name="__codelineno-118-104" href="#__codelineno-118-104"></a><span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.event_name == &#39;pull_request&#39;</span>
</span><span id="__span-118-105"><a id="__codelineno-118-105" name="__codelineno-118-105" href="#__codelineno-118-105"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-118-106"><a id="__codelineno-118-106" name="__codelineno-118-106" href="#__codelineno-118-106"></a><span class="w">          </span><span class="nt">github-token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
</span><span id="__span-118-107"><a id="__codelineno-118-107" name="__codelineno-118-107" href="#__codelineno-118-107"></a><span class="w">          </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-118-108"><a id="__codelineno-118-108" name="__codelineno-118-108" href="#__codelineno-118-108"></a><span class="w">            </span><span class="no">const output = `#### Terraform Format and Style 🖌\`${{ steps.fmt.outcome }}\`</span>
</span><span id="__span-118-109"><a id="__codelineno-118-109" name="__codelineno-118-109" href="#__codelineno-118-109"></a><span class="w">            </span><span class="no">#### Terraform Plan 📖\`${{ steps.plan.outcome }}\`</span>
</span><span id="__span-118-110"><a id="__codelineno-118-110" name="__codelineno-118-110" href="#__codelineno-118-110"></a>
</span><span id="__span-118-111"><a id="__codelineno-118-111" name="__codelineno-118-111" href="#__codelineno-118-111"></a><span class="w">            </span><span class="no">&lt;details&gt;&lt;summary&gt;Show Plan&lt;/summary&gt;</span>
</span><span id="__span-118-112"><a id="__codelineno-118-112" name="__codelineno-118-112" href="#__codelineno-118-112"></a>
</span><span id="__span-118-113"><a id="__codelineno-118-113" name="__codelineno-118-113" href="#__codelineno-118-113"></a><span class="w">            </span><span class="no">\`\`\`terraform</span>
</span><span id="__span-118-114"><a id="__codelineno-118-114" name="__codelineno-118-114" href="#__codelineno-118-114"></a><span class="w">            </span><span class="no">${{ steps.plan.outputs.stdout }}</span>
</span><span id="__span-118-115"><a id="__codelineno-118-115" name="__codelineno-118-115" href="#__codelineno-118-115"></a><span class="w">            </span><span class="no">\`\`\`</span>
</span><span id="__span-118-116"><a id="__codelineno-118-116" name="__codelineno-118-116" href="#__codelineno-118-116"></a>
</span><span id="__span-118-117"><a id="__codelineno-118-117" name="__codelineno-118-117" href="#__codelineno-118-117"></a><span class="w">            </span><span class="no">&lt;/details&gt;`;</span>
</span><span id="__span-118-118"><a id="__codelineno-118-118" name="__codelineno-118-118" href="#__codelineno-118-118"></a><span class="w">            </span><span class="no">github.rest.issues.createComment({</span>
</span><span id="__span-118-119"><a id="__codelineno-118-119" name="__codelineno-118-119" href="#__codelineno-118-119"></a><span class="w">              </span><span class="no">issue_number: context.issue.number,</span>
</span><span id="__span-118-120"><a id="__codelineno-118-120" name="__codelineno-118-120" href="#__codelineno-118-120"></a><span class="w">              </span><span class="no">owner: context.repo.owner,</span>
</span><span id="__span-118-121"><a id="__codelineno-118-121" name="__codelineno-118-121" href="#__codelineno-118-121"></a><span class="w">              </span><span class="no">repo: context.repo.repo,</span>
</span><span id="__span-118-122"><a id="__codelineno-118-122" name="__codelineno-118-122" href="#__codelineno-118-122"></a><span class="w">              </span><span class="no">body: output</span>
</span><span id="__span-118-123"><a id="__codelineno-118-123" name="__codelineno-118-123" href="#__codelineno-118-123"></a><span class="w">            </span><span class="no">})</span>
</span><span id="__span-118-124"><a id="__codelineno-118-124" name="__codelineno-118-124" href="#__codelineno-118-124"></a>
</span><span id="__span-118-125"><a id="__codelineno-118-125" name="__codelineno-118-125" href="#__codelineno-118-125"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload Plan Artifact</span>
</span><span id="__span-118-126"><a id="__codelineno-118-126" name="__codelineno-118-126" href="#__codelineno-118-126"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/upload-artifact@v3</span>
</span><span id="__span-118-127"><a id="__codelineno-118-127" name="__codelineno-118-127" href="#__codelineno-118-127"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-118-128"><a id="__codelineno-118-128" name="__codelineno-118-128" href="#__codelineno-118-128"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tfplan</span>
</span><span id="__span-118-129"><a id="__codelineno-118-129" name="__codelineno-118-129" href="#__codelineno-118-129"></a><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/tfplan</span>
</span><span id="__span-118-130"><a id="__codelineno-118-130" name="__codelineno-118-130" href="#__codelineno-118-130"></a>
</span><span id="__span-118-131"><a id="__codelineno-118-131" name="__codelineno-118-131" href="#__codelineno-118-131"></a><span class="w">  </span><span class="nt">apply</span><span class="p">:</span>
</span><span id="__span-118-132"><a id="__codelineno-118-132" name="__codelineno-118-132" href="#__codelineno-118-132"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Terraform</span><span class="nv"> </span><span class="s">Apply&#39;</span>
</span><span id="__span-118-133"><a id="__codelineno-118-133" name="__codelineno-118-133" href="#__codelineno-118-133"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-118-134"><a id="__codelineno-118-134" name="__codelineno-118-134" href="#__codelineno-118-134"></a><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plan</span>
</span><span id="__span-118-135"><a id="__codelineno-118-135" name="__codelineno-118-135" href="#__codelineno-118-135"></a><span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.event_name == &#39;push&#39; &amp;&amp; github.ref == &#39;refs/heads/main&#39; || github.event_name == &#39;workflow_dispatch&#39;</span>
</span><span id="__span-118-136"><a id="__codelineno-118-136" name="__codelineno-118-136" href="#__codelineno-118-136"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
</span><span id="__span-118-137"><a id="__codelineno-118-137" name="__codelineno-118-137" href="#__codelineno-118-137"></a>
</span><span id="__span-118-138"><a id="__codelineno-118-138" name="__codelineno-118-138" href="#__codelineno-118-138"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-118-139"><a id="__codelineno-118-139" name="__codelineno-118-139" href="#__codelineno-118-139"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-118-140"><a id="__codelineno-118-140" name="__codelineno-118-140" href="#__codelineno-118-140"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-118-141"><a id="__codelineno-118-141" name="__codelineno-118-141" href="#__codelineno-118-141"></a>
</span><span id="__span-118-142"><a id="__codelineno-118-142" name="__codelineno-118-142" href="#__codelineno-118-142"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS Credentials</span>
</span><span id="__span-118-143"><a id="__codelineno-118-143" name="__codelineno-118-143" href="#__codelineno-118-143"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v2</span>
</span><span id="__span-118-144"><a id="__codelineno-118-144" name="__codelineno-118-144" href="#__codelineno-118-144"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-118-145"><a id="__codelineno-118-145" name="__codelineno-118-145" href="#__codelineno-118-145"></a><span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/github-actions-role</span>
</span><span id="__span-118-146"><a id="__codelineno-118-146" name="__codelineno-118-146" href="#__codelineno-118-146"></a><span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
</span><span id="__span-118-147"><a id="__codelineno-118-147" name="__codelineno-118-147" href="#__codelineno-118-147"></a>
</span><span id="__span-118-148"><a id="__codelineno-118-148" name="__codelineno-118-148" href="#__codelineno-118-148"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
</span><span id="__span-118-149"><a id="__codelineno-118-149" name="__codelineno-118-149" href="#__codelineno-118-149"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v2</span>
</span><span id="__span-118-150"><a id="__codelineno-118-150" name="__codelineno-118-150" href="#__codelineno-118-150"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-118-151"><a id="__codelineno-118-151" name="__codelineno-118-151" href="#__codelineno-118-151"></a><span class="w">          </span><span class="nt">terraform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2.0</span>
</span><span id="__span-118-152"><a id="__codelineno-118-152" name="__codelineno-118-152" href="#__codelineno-118-152"></a>
</span><span id="__span-118-153"><a id="__codelineno-118-153" name="__codelineno-118-153" href="#__codelineno-118-153"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
</span><span id="__span-118-154"><a id="__codelineno-118-154" name="__codelineno-118-154" href="#__codelineno-118-154"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-118-155"><a id="__codelineno-118-155" name="__codelineno-118-155" href="#__codelineno-118-155"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform init -backend-config=&quot;bucket=${{ secrets.TF_STATE_BUCKET }}&quot; -backend-config=&quot;key=${{ secrets.TF_STATE_KEY }}&quot; -backend-config=&quot;region=us-east-1&quot;</span>
</span><span id="__span-118-156"><a id="__codelineno-118-156" name="__codelineno-118-156" href="#__codelineno-118-156"></a>
</span><span id="__span-118-157"><a id="__codelineno-118-157" name="__codelineno-118-157" href="#__codelineno-118-157"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Download Plan Artifact</span>
</span><span id="__span-118-158"><a id="__codelineno-118-158" name="__codelineno-118-158" href="#__codelineno-118-158"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/download-artifact@v3</span>
</span><span id="__span-118-159"><a id="__codelineno-118-159" name="__codelineno-118-159" href="#__codelineno-118-159"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-118-160"><a id="__codelineno-118-160" name="__codelineno-118-160" href="#__codelineno-118-160"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tfplan</span>
</span><span id="__span-118-161"><a id="__codelineno-118-161" name="__codelineno-118-161" href="#__codelineno-118-161"></a><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-118-162"><a id="__codelineno-118-162" name="__codelineno-118-162" href="#__codelineno-118-162"></a>
</span><span id="__span-118-163"><a id="__codelineno-118-163" name="__codelineno-118-163" href="#__codelineno-118-163"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Apply</span>
</span><span id="__span-118-164"><a id="__codelineno-118-164" name="__codelineno-118-164" href="#__codelineno-118-164"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-118-165"><a id="__codelineno-118-165" name="__codelineno-118-165" href="#__codelineno-118-165"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform apply -auto-approve tfplan</span>
</span><span id="__span-118-166"><a id="__codelineno-118-166" name="__codelineno-118-166" href="#__codelineno-118-166"></a>
</span><span id="__span-118-167"><a id="__codelineno-118-167" name="__codelineno-118-167" href="#__codelineno-118-167"></a><span class="w">  </span><span class="nt">test-api</span><span class="p">:</span>
</span><span id="__span-118-168"><a id="__codelineno-118-168" name="__codelineno-118-168" href="#__codelineno-118-168"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Test</span><span class="nv"> </span><span class="s">API</span><span class="nv"> </span><span class="s">Deployment&#39;</span>
</span><span id="__span-118-169"><a id="__codelineno-118-169" name="__codelineno-118-169" href="#__codelineno-118-169"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-118-170"><a id="__codelineno-118-170" name="__codelineno-118-170" href="#__codelineno-118-170"></a><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apply</span>
</span><span id="__span-118-171"><a id="__codelineno-118-171" name="__codelineno-118-171" href="#__codelineno-118-171"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
</span><span id="__span-118-172"><a id="__codelineno-118-172" name="__codelineno-118-172" href="#__codelineno-118-172"></a>
</span><span id="__span-118-173"><a id="__codelineno-118-173" name="__codelineno-118-173" href="#__codelineno-118-173"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-118-174"><a id="__codelineno-118-174" name="__codelineno-118-174" href="#__codelineno-118-174"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-118-175"><a id="__codelineno-118-175" name="__codelineno-118-175" href="#__codelineno-118-175"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-118-176"><a id="__codelineno-118-176" name="__codelineno-118-176" href="#__codelineno-118-176"></a>
</span><span id="__span-118-177"><a id="__codelineno-118-177" name="__codelineno-118-177" href="#__codelineno-118-177"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS Credentials</span>
</span><span id="__span-118-178"><a id="__codelineno-118-178" name="__codelineno-118-178" href="#__codelineno-118-178"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v2</span>
</span><span id="__span-118-179"><a id="__codelineno-118-179" name="__codelineno-118-179" href="#__codelineno-118-179"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-118-180"><a id="__codelineno-118-180" name="__codelineno-118-180" href="#__codelineno-118-180"></a><span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/github-actions-role</span>
</span><span id="__span-118-181"><a id="__codelineno-118-181" name="__codelineno-118-181" href="#__codelineno-118-181"></a><span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
</span><span id="__span-118-182"><a id="__codelineno-118-182" name="__codelineno-118-182" href="#__codelineno-118-182"></a>
</span><span id="__span-118-183"><a id="__codelineno-118-183" name="__codelineno-118-183" href="#__codelineno-118-183"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Fetch API Endpoint</span>
</span><span id="__span-118-184"><a id="__codelineno-118-184" name="__codelineno-118-184" href="#__codelineno-118-184"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-118-185"><a id="__codelineno-118-185" name="__codelineno-118-185" href="#__codelineno-118-185"></a><span class="w">          </span><span class="no">API_ENDPOINT=$(aws cloudformation describe-stacks --stack-name resume-backend-dev --query &quot;Stacks[0].Outputs[?OutputKey==&#39;ApiEndpoint&#39;].OutputValue&quot; --output text)</span>
</span><span id="__span-118-186"><a id="__codelineno-118-186" name="__codelineno-118-186" href="#__codelineno-118-186"></a><span class="w">          </span><span class="no">echo &quot;API_ENDPOINT=$API_ENDPOINT&quot; &gt;&gt; $GITHUB_ENV</span>
</span><span id="__span-118-187"><a id="__codelineno-118-187" name="__codelineno-118-187" href="#__codelineno-118-187"></a>
</span><span id="__span-118-188"><a id="__codelineno-118-188" name="__codelineno-118-188" href="#__codelineno-118-188"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test API Response</span>
</span><span id="__span-118-189"><a id="__codelineno-118-189" name="__codelineno-118-189" href="#__codelineno-118-189"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-118-190"><a id="__codelineno-118-190" name="__codelineno-118-190" href="#__codelineno-118-190"></a><span class="w">          </span><span class="no">response=$(curl -s &quot;$API_ENDPOINT/count&quot;)</span>
</span><span id="__span-118-191"><a id="__codelineno-118-191" name="__codelineno-118-191" href="#__codelineno-118-191"></a><span class="w">          </span><span class="no">echo &quot;API Response: $response&quot;</span>
</span><span id="__span-118-192"><a id="__codelineno-118-192" name="__codelineno-118-192" href="#__codelineno-118-192"></a>
</span><span id="__span-118-193"><a id="__codelineno-118-193" name="__codelineno-118-193" href="#__codelineno-118-193"></a><span class="w">          </span><span class="no"># Check if the response contains a count field</span>
</span><span id="__span-118-194"><a id="__codelineno-118-194" name="__codelineno-118-194" href="#__codelineno-118-194"></a><span class="w">          </span><span class="no">echo $response | grep -q &#39;&quot;count&quot;:&#39;</span>
</span><span id="__span-118-195"><a id="__codelineno-118-195" name="__codelineno-118-195" href="#__codelineno-118-195"></a><span class="w">          </span><span class="no">if [ $? -eq 0 ]; then</span>
</span><span id="__span-118-196"><a id="__codelineno-118-196" name="__codelineno-118-196" href="#__codelineno-118-196"></a><span class="w">            </span><span class="no">echo &quot;API test successful&quot;</span>
</span><span id="__span-118-197"><a id="__codelineno-118-197" name="__codelineno-118-197" href="#__codelineno-118-197"></a><span class="w">          </span><span class="no">else</span>
</span><span id="__span-118-198"><a id="__codelineno-118-198" name="__codelineno-118-198" href="#__codelineno-118-198"></a><span class="w">            </span><span class="no">echo &quot;API test failed&quot;</span>
</span><span id="__span-118-199"><a id="__codelineno-118-199" name="__codelineno-118-199" href="#__codelineno-118-199"></a><span class="w">            </span><span class="no">exit 1</span>
</span><span id="__span-118-200"><a id="__codelineno-118-200" name="__codelineno-118-200" href="#__codelineno-118-200"></a><span class="w">          </span><span class="no">fi</span>
</span></code></pre></div>
<p>This workflow is more complex and includes:</p>
<ol>
<li>Running Python tests for the Lambda function</li>
<li>Validating Terraform syntax and formatting</li>
<li>Planning Terraform changes (with PR comments for review)</li>
<li>Applying Terraform changes to the environment</li>
<li>Testing the deployed API to ensure it's functioning</li>
</ol>
<h3 id="implementing-multi-environment-deployments"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#implementing-multi-environment-deployments">Implementing Multi-Environment Deployments 🌍</a></h3>
<p>One of the most valuable CI/CD patterns is deploying to multiple environments. Let's modify our backend workflow to support both development and production environments:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="c1"># Additional job for production deployment after dev is successful</span>
</span><span id="__span-119-2"><a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a><span class="w">  </span><span class="nt">promote-to-prod</span><span class="p">:</span>
</span><span id="__span-119-3"><a id="__codelineno-119-3" name="__codelineno-119-3" href="#__codelineno-119-3"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Promote</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Production&#39;</span>
</span><span id="__span-119-4"><a id="__codelineno-119-4" name="__codelineno-119-4" href="#__codelineno-119-4"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-119-5"><a id="__codelineno-119-5" name="__codelineno-119-5" href="#__codelineno-119-5"></a><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-api</span>
</span><span id="__span-119-6"><a id="__codelineno-119-6" name="__codelineno-119-6" href="#__codelineno-119-6"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-119-7"><a id="__codelineno-119-7" name="__codelineno-119-7" href="#__codelineno-119-7"></a><span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.event_name == &#39;workflow_dispatch&#39;</span>
</span><span id="__span-119-8"><a id="__codelineno-119-8" name="__codelineno-119-8" href="#__codelineno-119-8"></a>
</span><span id="__span-119-9"><a id="__codelineno-119-9" name="__codelineno-119-9" href="#__codelineno-119-9"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-119-10"><a id="__codelineno-119-10" name="__codelineno-119-10" href="#__codelineno-119-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-119-11"><a id="__codelineno-119-11" name="__codelineno-119-11" href="#__codelineno-119-11"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-119-12"><a id="__codelineno-119-12" name="__codelineno-119-12" href="#__codelineno-119-12"></a>
</span><span id="__span-119-13"><a id="__codelineno-119-13" name="__codelineno-119-13" href="#__codelineno-119-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS Credentials</span>
</span><span id="__span-119-14"><a id="__codelineno-119-14" name="__codelineno-119-14" href="#__codelineno-119-14"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v2</span>
</span><span id="__span-119-15"><a id="__codelineno-119-15" name="__codelineno-119-15" href="#__codelineno-119-15"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-119-16"><a id="__codelineno-119-16" name="__codelineno-119-16" href="#__codelineno-119-16"></a><span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/github-actions-role</span>
</span><span id="__span-119-17"><a id="__codelineno-119-17" name="__codelineno-119-17" href="#__codelineno-119-17"></a><span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
</span><span id="__span-119-18"><a id="__codelineno-119-18" name="__codelineno-119-18" href="#__codelineno-119-18"></a>
</span><span id="__span-119-19"><a id="__codelineno-119-19" name="__codelineno-119-19" href="#__codelineno-119-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
</span><span id="__span-119-20"><a id="__codelineno-119-20" name="__codelineno-119-20" href="#__codelineno-119-20"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v2</span>
</span><span id="__span-119-21"><a id="__codelineno-119-21" name="__codelineno-119-21" href="#__codelineno-119-21"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-119-22"><a id="__codelineno-119-22" name="__codelineno-119-22" href="#__codelineno-119-22"></a><span class="w">          </span><span class="nt">terraform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2.0</span>
</span><span id="__span-119-23"><a id="__codelineno-119-23" name="__codelineno-119-23" href="#__codelineno-119-23"></a>
</span><span id="__span-119-24"><a id="__codelineno-119-24" name="__codelineno-119-24" href="#__codelineno-119-24"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
</span><span id="__span-119-25"><a id="__codelineno-119-25" name="__codelineno-119-25" href="#__codelineno-119-25"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/environments/prod</span>
</span><span id="__span-119-26"><a id="__codelineno-119-26" name="__codelineno-119-26" href="#__codelineno-119-26"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform init -backend-config=&quot;bucket=${{ secrets.TF_STATE_BUCKET }}&quot; -backend-config=&quot;key=${{ secrets.TF_STATE_KEY_PROD }}&quot; -backend-config=&quot;region=us-east-1&quot;</span>
</span><span id="__span-119-27"><a id="__codelineno-119-27" name="__codelineno-119-27" href="#__codelineno-119-27"></a>
</span><span id="__span-119-28"><a id="__codelineno-119-28" name="__codelineno-119-28" href="#__codelineno-119-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Plan</span>
</span><span id="__span-119-29"><a id="__codelineno-119-29" name="__codelineno-119-29" href="#__codelineno-119-29"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/environments/prod</span>
</span><span id="__span-119-30"><a id="__codelineno-119-30" name="__codelineno-119-30" href="#__codelineno-119-30"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform plan -var=&quot;environment=prod&quot; -var=&quot;domain_name=${{ secrets.DOMAIN_NAME_PROD }}&quot; -out=tfplan</span>
</span><span id="__span-119-31"><a id="__codelineno-119-31" name="__codelineno-119-31" href="#__codelineno-119-31"></a>
</span><span id="__span-119-32"><a id="__codelineno-119-32" name="__codelineno-119-32" href="#__codelineno-119-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Apply</span>
</span><span id="__span-119-33"><a id="__codelineno-119-33" name="__codelineno-119-33" href="#__codelineno-119-33"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/environments/prod</span>
</span><span id="__span-119-34"><a id="__codelineno-119-34" name="__codelineno-119-34" href="#__codelineno-119-34"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform apply -auto-approve tfplan</span>
</span><span id="__span-119-35"><a id="__codelineno-119-35" name="__codelineno-119-35" href="#__codelineno-119-35"></a>
</span><span id="__span-119-36"><a id="__codelineno-119-36" name="__codelineno-119-36" href="#__codelineno-119-36"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test Production API</span>
</span><span id="__span-119-37"><a id="__codelineno-119-37" name="__codelineno-119-37" href="#__codelineno-119-37"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-119-38"><a id="__codelineno-119-38" name="__codelineno-119-38" href="#__codelineno-119-38"></a><span class="w">          </span><span class="no">API_ENDPOINT=$(aws cloudformation describe-stacks --stack-name resume-backend-prod --query &quot;Stacks[0].Outputs[?OutputKey==&#39;ApiEndpoint&#39;].OutputValue&quot; --output text)</span>
</span><span id="__span-119-39"><a id="__codelineno-119-39" name="__codelineno-119-39" href="#__codelineno-119-39"></a><span class="w">          </span><span class="no">response=$(curl -s &quot;$API_ENDPOINT/count&quot;)</span>
</span><span id="__span-119-40"><a id="__codelineno-119-40" name="__codelineno-119-40" href="#__codelineno-119-40"></a><span class="w">          </span><span class="no">echo &quot;API Response: $response&quot;</span>
</span><span id="__span-119-41"><a id="__codelineno-119-41" name="__codelineno-119-41" href="#__codelineno-119-41"></a>
</span><span id="__span-119-42"><a id="__codelineno-119-42" name="__codelineno-119-42" href="#__codelineno-119-42"></a><span class="w">          </span><span class="no"># Check if the response contains a count field</span>
</span><span id="__span-119-43"><a id="__codelineno-119-43" name="__codelineno-119-43" href="#__codelineno-119-43"></a><span class="w">          </span><span class="no">echo $response | grep -q &#39;&quot;count&quot;:&#39;</span>
</span><span id="__span-119-44"><a id="__codelineno-119-44" name="__codelineno-119-44" href="#__codelineno-119-44"></a><span class="w">          </span><span class="no">if [ $? -eq 0 ]; then</span>
</span><span id="__span-119-45"><a id="__codelineno-119-45" name="__codelineno-119-45" href="#__codelineno-119-45"></a><span class="w">            </span><span class="no">echo &quot;Production API test successful&quot;</span>
</span><span id="__span-119-46"><a id="__codelineno-119-46" name="__codelineno-119-46" href="#__codelineno-119-46"></a><span class="w">          </span><span class="no">else</span>
</span><span id="__span-119-47"><a id="__codelineno-119-47" name="__codelineno-119-47" href="#__codelineno-119-47"></a><span class="w">            </span><span class="no">echo &quot;Production API test failed&quot;</span>
</span><span id="__span-119-48"><a id="__codelineno-119-48" name="__codelineno-119-48" href="#__codelineno-119-48"></a><span class="w">            </span><span class="no">exit 1</span>
</span><span id="__span-119-49"><a id="__codelineno-119-49" name="__codelineno-119-49" href="#__codelineno-119-49"></a><span class="w">          </span><span class="no">fi</span>
</span></code></pre></div>
<h4 id="terraform-structure-for-multiple-environments"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#terraform-structure-for-multiple-environments">Terraform Structure for Multiple Environments</a></h4>
<p>To support multiple environments, I've reorganized my Terraform configuration:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a>terraform/
</span><span id="__span-120-2"><a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a>├── modules/
</span><span id="__span-120-3"><a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a>│   ├── backend/
</span><span id="__span-120-4"><a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a>│   │   ├── api_gateway.tf
</span><span id="__span-120-5"><a id="__codelineno-120-5" name="__codelineno-120-5" href="#__codelineno-120-5"></a>│   │   ├── dynamodb.tf
</span><span id="__span-120-6"><a id="__codelineno-120-6" name="__codelineno-120-6" href="#__codelineno-120-6"></a>│   │   ├── lambda.tf
</span><span id="__span-120-7"><a id="__codelineno-120-7" name="__codelineno-120-7" href="#__codelineno-120-7"></a>│   │   ├── variables.tf
</span><span id="__span-120-8"><a id="__codelineno-120-8" name="__codelineno-120-8" href="#__codelineno-120-8"></a>│   │   └── outputs.tf
</span><span id="__span-120-9"><a id="__codelineno-120-9" name="__codelineno-120-9" href="#__codelineno-120-9"></a>├── environments/
</span><span id="__span-120-10"><a id="__codelineno-120-10" name="__codelineno-120-10" href="#__codelineno-120-10"></a>│   ├── dev/
</span><span id="__span-120-11"><a id="__codelineno-120-11" name="__codelineno-120-11" href="#__codelineno-120-11"></a>│   │   ├── main.tf
</span><span id="__span-120-12"><a id="__codelineno-120-12" name="__codelineno-120-12" href="#__codelineno-120-12"></a>│   │   ├── variables.tf
</span><span id="__span-120-13"><a id="__codelineno-120-13" name="__codelineno-120-13" href="#__codelineno-120-13"></a>│   │   └── outputs.tf
</span><span id="__span-120-14"><a id="__codelineno-120-14" name="__codelineno-120-14" href="#__codelineno-120-14"></a>│   └── prod/
</span><span id="__span-120-15"><a id="__codelineno-120-15" name="__codelineno-120-15" href="#__codelineno-120-15"></a>│       ├── main.tf
</span><span id="__span-120-16"><a id="__codelineno-120-16" name="__codelineno-120-16" href="#__codelineno-120-16"></a>│       ├── variables.tf
</span><span id="__span-120-17"><a id="__codelineno-120-17" name="__codelineno-120-17" href="#__codelineno-120-17"></a>│       └── outputs.tf
</span></code></pre></div>
<p>Each environment directory contains its own Terraform configuration that references the shared modules.</p>
<h3 id="implementing-github-security-best-practices"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#implementing-github-security-best-practices">Implementing GitHub Security Best Practices 🔒</a></h3>
<p>To enhance the security of our CI/CD pipelines, I've implemented several additional measures:</p>
<h4 id="1-supply-chain-security-with-dependabot"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#1-supply-chain-security-with-dependabot">1. Supply Chain Security with Dependabot</a></h4>
<p>Create a file at <code>.github/dependabot.yml</code> in both repositories:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-121-2"><a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a><span class="nt">updates</span><span class="p">:</span>
</span><span id="__span-121-3"><a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">package-ecosystem</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;github-actions&quot;</span>
</span><span id="__span-121-4"><a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a><span class="w">    </span><span class="nt">directory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
</span><span id="__span-121-5"><a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a><span class="w">    </span><span class="nt">schedule</span><span class="p">:</span>
</span><span id="__span-121-6"><a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;weekly&quot;</span>
</span><span id="__span-121-7"><a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a><span class="w">    </span><span class="nt">open-pull-requests-limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span><span id="__span-121-8"><a id="__codelineno-121-8" name="__codelineno-121-8" href="#__codelineno-121-8"></a>
</span><span id="__span-121-9"><a id="__codelineno-121-9" name="__codelineno-121-9" href="#__codelineno-121-9"></a><span class="w">  </span><span class="c1"># For frontend</span>
</span><span id="__span-121-10"><a id="__codelineno-121-10" name="__codelineno-121-10" href="#__codelineno-121-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">package-ecosystem</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;npm&quot;</span>
</span><span id="__span-121-11"><a id="__codelineno-121-11" name="__codelineno-121-11" href="#__codelineno-121-11"></a><span class="w">    </span><span class="nt">directory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
</span><span id="__span-121-12"><a id="__codelineno-121-12" name="__codelineno-121-12" href="#__codelineno-121-12"></a><span class="w">    </span><span class="nt">schedule</span><span class="p">:</span>
</span><span id="__span-121-13"><a id="__codelineno-121-13" name="__codelineno-121-13" href="#__codelineno-121-13"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;weekly&quot;</span>
</span><span id="__span-121-14"><a id="__codelineno-121-14" name="__codelineno-121-14" href="#__codelineno-121-14"></a><span class="w">    </span><span class="nt">open-pull-requests-limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span><span id="__span-121-15"><a id="__codelineno-121-15" name="__codelineno-121-15" href="#__codelineno-121-15"></a>
</span><span id="__span-121-16"><a id="__codelineno-121-16" name="__codelineno-121-16" href="#__codelineno-121-16"></a><span class="w">  </span><span class="c1"># For backend</span>
</span><span id="__span-121-17"><a id="__codelineno-121-17" name="__codelineno-121-17" href="#__codelineno-121-17"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">package-ecosystem</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pip&quot;</span>
</span><span id="__span-121-18"><a id="__codelineno-121-18" name="__codelineno-121-18" href="#__codelineno-121-18"></a><span class="w">    </span><span class="nt">directory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
</span><span id="__span-121-19"><a id="__codelineno-121-19" name="__codelineno-121-19" href="#__codelineno-121-19"></a><span class="w">    </span><span class="nt">schedule</span><span class="p">:</span>
</span><span id="__span-121-20"><a id="__codelineno-121-20" name="__codelineno-121-20" href="#__codelineno-121-20"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;weekly&quot;</span>
</span><span id="__span-121-21"><a id="__codelineno-121-21" name="__codelineno-121-21" href="#__codelineno-121-21"></a><span class="w">    </span><span class="nt">open-pull-requests-limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span></code></pre></div>
<p>This configuration automatically updates dependencies and identifies security vulnerabilities.</p>
<h4 id="2-code-scanning-with-codeql"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#2-code-scanning-with-codeql">2. Code Scanning with CodeQL</a></h4>
<p>Create a file at <code>.github/workflows/codeql.yml</code> in the backend repository:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CodeQL&quot;</span>
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a>
</span><span id="__span-122-3"><a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a><span class="nt">on</span><span class="p">:</span>
</span><span id="__span-122-4"><a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a><span class="w">  </span><span class="nt">push</span><span class="p">:</span>
</span><span id="__span-122-5"><a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">main</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span><span id="__span-122-6"><a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a><span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
</span><span id="__span-122-7"><a id="__codelineno-122-7" name="__codelineno-122-7" href="#__codelineno-122-7"></a><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">main</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span><span id="__span-122-8"><a id="__codelineno-122-8" name="__codelineno-122-8" href="#__codelineno-122-8"></a><span class="w">  </span><span class="nt">schedule</span><span class="p">:</span>
</span><span id="__span-122-9"><a id="__codelineno-122-9" name="__codelineno-122-9" href="#__codelineno-122-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cron</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">0&#39;</span><span class="w">  </span><span class="c1"># Run weekly</span>
</span><span id="__span-122-10"><a id="__codelineno-122-10" name="__codelineno-122-10" href="#__codelineno-122-10"></a>
</span><span id="__span-122-11"><a id="__codelineno-122-11" name="__codelineno-122-11" href="#__codelineno-122-11"></a><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-122-12"><a id="__codelineno-122-12" name="__codelineno-122-12" href="#__codelineno-122-12"></a><span class="w">  </span><span class="nt">analyze</span><span class="p">:</span>
</span><span id="__span-122-13"><a id="__codelineno-122-13" name="__codelineno-122-13" href="#__codelineno-122-13"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Analyze</span>
</span><span id="__span-122-14"><a id="__codelineno-122-14" name="__codelineno-122-14" href="#__codelineno-122-14"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-122-15"><a id="__codelineno-122-15" name="__codelineno-122-15" href="#__codelineno-122-15"></a><span class="w">    </span><span class="nt">permissions</span><span class="p">:</span>
</span><span id="__span-122-16"><a id="__codelineno-122-16" name="__codelineno-122-16" href="#__codelineno-122-16"></a><span class="w">      </span><span class="nt">actions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id="__span-122-17"><a id="__codelineno-122-17" name="__codelineno-122-17" href="#__codelineno-122-17"></a><span class="w">      </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id="__span-122-18"><a id="__codelineno-122-18" name="__codelineno-122-18" href="#__codelineno-122-18"></a><span class="w">      </span><span class="nt">security-events</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id="__span-122-19"><a id="__codelineno-122-19" name="__codelineno-122-19" href="#__codelineno-122-19"></a>
</span><span id="__span-122-20"><a id="__codelineno-122-20" name="__codelineno-122-20" href="#__codelineno-122-20"></a><span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
</span><span id="__span-122-21"><a id="__codelineno-122-21" name="__codelineno-122-21" href="#__codelineno-122-21"></a><span class="w">      </span><span class="nt">fail-fast</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-122-22"><a id="__codelineno-122-22" name="__codelineno-122-22" href="#__codelineno-122-22"></a><span class="w">      </span><span class="nt">matrix</span><span class="p">:</span>
</span><span id="__span-122-23"><a id="__codelineno-122-23" name="__codelineno-122-23" href="#__codelineno-122-23"></a><span class="w">        </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&#39;python&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;javascript&#39;</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span><span id="__span-122-24"><a id="__codelineno-122-24" name="__codelineno-122-24" href="#__codelineno-122-24"></a>
</span><span id="__span-122-25"><a id="__codelineno-122-25" name="__codelineno-122-25" href="#__codelineno-122-25"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-122-26"><a id="__codelineno-122-26" name="__codelineno-122-26" href="#__codelineno-122-26"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout repository</span>
</span><span id="__span-122-27"><a id="__codelineno-122-27" name="__codelineno-122-27" href="#__codelineno-122-27"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-122-28"><a id="__codelineno-122-28" name="__codelineno-122-28" href="#__codelineno-122-28"></a>
</span><span id="__span-122-29"><a id="__codelineno-122-29" name="__codelineno-122-29" href="#__codelineno-122-29"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Initialize CodeQL</span>
</span><span id="__span-122-30"><a id="__codelineno-122-30" name="__codelineno-122-30" href="#__codelineno-122-30"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github/codeql-action/init@v2</span>
</span><span id="__span-122-31"><a id="__codelineno-122-31" name="__codelineno-122-31" href="#__codelineno-122-31"></a><span class="w">      </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-122-32"><a id="__codelineno-122-32" name="__codelineno-122-32" href="#__codelineno-122-32"></a><span class="w">        </span><span class="nt">languages</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.language }}</span>
</span><span id="__span-122-33"><a id="__codelineno-122-33" name="__codelineno-122-33" href="#__codelineno-122-33"></a>
</span><span id="__span-122-34"><a id="__codelineno-122-34" name="__codelineno-122-34" href="#__codelineno-122-34"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Perform CodeQL Analysis</span>
</span><span id="__span-122-35"><a id="__codelineno-122-35" name="__codelineno-122-35" href="#__codelineno-122-35"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github/codeql-action/analyze@v2</span>
</span></code></pre></div>
<p>This workflow scans our code for security vulnerabilities and coding problems.</p>
<h4 id="3-branch-protection-rules"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#3-branch-protection-rules">3. Branch Protection Rules</a></h4>
<p>I've set up branch protection rules for the <code>main</code> branch in both repositories:</p>
<ul>
<li>Require pull request reviews before merging</li>
<li>Require status checks to pass before merging</li>
<li>Require signed commits</li>
<li>Do not allow bypassing the above settings</li>
</ul>
<h3 id="adding-verification-tests-to-the-workflow"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#adding-verification-tests-to-the-workflow">Adding Verification Tests to the Workflow 🧪</a></h3>
<p>In addition to unit tests, I've added end-to-end integration tests to verify that the frontend and backend work together correctly:</p>
<h4 id="1-frontend-backend-integration-test"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#1-frontend-backend-integration-test">1. Frontend-Backend Integration Test</a></h4>
<p>Create a file at <code>tests/integration-test.js</code> in the frontend repository:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">axios</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;axios&#39;</span><span class="p">);</span>
</span><span id="__span-123-2"><a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">assert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;assert&#39;</span><span class="p">);</span>
</span><span id="__span-123-3"><a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a>
</span><span id="__span-123-4"><a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a><span class="c1">// URLs to test - these should be passed as environment variables</span>
</span><span id="__span-123-5"><a id="__codelineno-123-5" name="__codelineno-123-5" href="#__codelineno-123-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">WEBSITE_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">WEBSITE_URL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;https://resume.yourdomain.com&#39;</span><span class="p">;</span>
</span><span id="__span-123-6"><a id="__codelineno-123-6" name="__codelineno-123-6" href="#__codelineno-123-6"></a><span class="kd">const</span><span class="w"> </span><span class="nx">API_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">API_URL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;https://api.yourdomain.com/count&#39;</span><span class="p">;</span>
</span><span id="__span-123-7"><a id="__codelineno-123-7" name="__codelineno-123-7" href="#__codelineno-123-7"></a>
</span><span id="__span-123-8"><a id="__codelineno-123-8" name="__codelineno-123-8" href="#__codelineno-123-8"></a><span class="c1">// Test that the API returns a valid response</span>
</span><span id="__span-123-9"><a id="__codelineno-123-9" name="__codelineno-123-9" href="#__codelineno-123-9"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">testAPI</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-123-10"><a id="__codelineno-123-10" name="__codelineno-123-10" href="#__codelineno-123-10"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-123-11"><a id="__codelineno-123-11" name="__codelineno-123-11" href="#__codelineno-123-11"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Testing API at </span><span class="si">${</span><span class="nx">API_URL</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-123-12"><a id="__codelineno-123-12" name="__codelineno-123-12" href="#__codelineno-123-12"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">API_URL</span><span class="p">);</span>
</span><span id="__span-123-13"><a id="__codelineno-123-13" name="__codelineno-123-13" href="#__codelineno-123-13"></a>
</span><span id="__span-123-14"><a id="__codelineno-123-14" name="__codelineno-123-14" href="#__codelineno-123-14"></a><span class="w">    </span><span class="c1">// Verify the API response contains a count</span>
</span><span id="__span-123-15"><a id="__codelineno-123-15" name="__codelineno-123-15" href="#__codelineno-123-15"></a><span class="w">    </span><span class="nx">assert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="sb">`API returned status </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-123-16"><a id="__codelineno-123-16" name="__codelineno-123-16" href="#__codelineno-123-16"></a><span class="w">    </span><span class="nx">assert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;API response missing count field&#39;</span><span class="p">);</span>
</span><span id="__span-123-17"><a id="__codelineno-123-17" name="__codelineno-123-17" href="#__codelineno-123-17"></a><span class="w">    </span><span class="nx">assert</span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Count is not a number&#39;</span><span class="p">);</span>
</span><span id="__span-123-18"><a id="__codelineno-123-18" name="__codelineno-123-18" href="#__codelineno-123-18"></a>
</span><span id="__span-123-19"><a id="__codelineno-123-19" name="__codelineno-123-19" href="#__codelineno-123-19"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`API test successful. Count: </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">count</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-123-20"><a id="__codelineno-123-20" name="__codelineno-123-20" href="#__codelineno-123-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-123-21"><a id="__codelineno-123-21" name="__codelineno-123-21" href="#__codelineno-123-21"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-123-22"><a id="__codelineno-123-22" name="__codelineno-123-22" href="#__codelineno-123-22"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;API test failed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span><span id="__span-123-23"><a id="__codelineno-123-23" name="__codelineno-123-23" href="#__codelineno-123-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-123-24"><a id="__codelineno-123-24" name="__codelineno-123-24" href="#__codelineno-123-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-123-25"><a id="__codelineno-123-25" name="__codelineno-123-25" href="#__codelineno-123-25"></a><span class="p">}</span>
</span><span id="__span-123-26"><a id="__codelineno-123-26" name="__codelineno-123-26" href="#__codelineno-123-26"></a>
</span><span id="__span-123-27"><a id="__codelineno-123-27" name="__codelineno-123-27" href="#__codelineno-123-27"></a><span class="c1">// Test that the website loads and contains necessary elements</span>
</span><span id="__span-123-28"><a id="__codelineno-123-28" name="__codelineno-123-28" href="#__codelineno-123-28"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">testWebsite</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-123-29"><a id="__codelineno-123-29" name="__codelineno-123-29" href="#__codelineno-123-29"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-123-30"><a id="__codelineno-123-30" name="__codelineno-123-30" href="#__codelineno-123-30"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Testing website at </span><span class="si">${</span><span class="nx">WEBSITE_URL</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-123-31"><a id="__codelineno-123-31" name="__codelineno-123-31" href="#__codelineno-123-31"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">WEBSITE_URL</span><span class="p">);</span>
</span><span id="__span-123-32"><a id="__codelineno-123-32" name="__codelineno-123-32" href="#__codelineno-123-32"></a>
</span><span id="__span-123-33"><a id="__codelineno-123-33" name="__codelineno-123-33" href="#__codelineno-123-33"></a><span class="w">    </span><span class="c1">// Verify the website loads</span>
</span><span id="__span-123-34"><a id="__codelineno-123-34" name="__codelineno-123-34" href="#__codelineno-123-34"></a><span class="w">    </span><span class="nx">assert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="sb">`Website returned status </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-123-35"><a id="__codelineno-123-35" name="__codelineno-123-35" href="#__codelineno-123-35"></a>
</span><span id="__span-123-36"><a id="__codelineno-123-36" name="__codelineno-123-36" href="#__codelineno-123-36"></a><span class="w">    </span><span class="c1">// Check that the page contains some expected content</span>
</span><span id="__span-123-37"><a id="__codelineno-123-37" name="__codelineno-123-37" href="#__codelineno-123-37"></a><span class="w">    </span><span class="nx">assert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;&lt;html&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Response is not HTML&#39;</span><span class="p">);</span>
</span><span id="__span-123-38"><a id="__codelineno-123-38" name="__codelineno-123-38" href="#__codelineno-123-38"></a><span class="w">    </span><span class="nx">assert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;id=&quot;count&quot;&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Counter element not found&#39;</span><span class="p">);</span>
</span><span id="__span-123-39"><a id="__codelineno-123-39" name="__codelineno-123-39" href="#__codelineno-123-39"></a>
</span><span id="__span-123-40"><a id="__codelineno-123-40" name="__codelineno-123-40" href="#__codelineno-123-40"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Website test successful&#39;</span><span class="p">);</span>
</span><span id="__span-123-41"><a id="__codelineno-123-41" name="__codelineno-123-41" href="#__codelineno-123-41"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-123-42"><a id="__codelineno-123-42" name="__codelineno-123-42" href="#__codelineno-123-42"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-123-43"><a id="__codelineno-123-43" name="__codelineno-123-43" href="#__codelineno-123-43"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Website test failed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span><span id="__span-123-44"><a id="__codelineno-123-44" name="__codelineno-123-44" href="#__codelineno-123-44"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-123-45"><a id="__codelineno-123-45" name="__codelineno-123-45" href="#__codelineno-123-45"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-123-46"><a id="__codelineno-123-46" name="__codelineno-123-46" href="#__codelineno-123-46"></a><span class="p">}</span>
</span><span id="__span-123-47"><a id="__codelineno-123-47" name="__codelineno-123-47" href="#__codelineno-123-47"></a>
</span><span id="__span-123-48"><a id="__codelineno-123-48" name="__codelineno-123-48" href="#__codelineno-123-48"></a><span class="c1">// Run all tests</span>
</span><span id="__span-123-49"><a id="__codelineno-123-49" name="__codelineno-123-49" href="#__codelineno-123-49"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">runTests</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-123-50"><a id="__codelineno-123-50" name="__codelineno-123-50" href="#__codelineno-123-50"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">apiResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">testAPI</span><span class="p">();</span>
</span><span id="__span-123-51"><a id="__codelineno-123-51" name="__codelineno-123-51" href="#__codelineno-123-51"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">websiteResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">testWebsite</span><span class="p">();</span>
</span><span id="__span-123-52"><a id="__codelineno-123-52" name="__codelineno-123-52" href="#__codelineno-123-52"></a>
</span><span id="__span-123-53"><a id="__codelineno-123-53" name="__codelineno-123-53" href="#__codelineno-123-53"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">apiResult</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">websiteResult</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-123-54"><a id="__codelineno-123-54" name="__codelineno-123-54" href="#__codelineno-123-54"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;All integration tests passed!&#39;</span><span class="p">);</span>
</span><span id="__span-123-55"><a id="__codelineno-123-55" name="__codelineno-123-55" href="#__codelineno-123-55"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-123-56"><a id="__codelineno-123-56" name="__codelineno-123-56" href="#__codelineno-123-56"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-123-57"><a id="__codelineno-123-57" name="__codelineno-123-57" href="#__codelineno-123-57"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Some integration tests failed&#39;</span><span class="p">);</span>
</span><span id="__span-123-58"><a id="__codelineno-123-58" name="__codelineno-123-58" href="#__codelineno-123-58"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-123-59"><a id="__codelineno-123-59" name="__codelineno-123-59" href="#__codelineno-123-59"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-123-60"><a id="__codelineno-123-60" name="__codelineno-123-60" href="#__codelineno-123-60"></a><span class="p">}</span>
</span><span id="__span-123-61"><a id="__codelineno-123-61" name="__codelineno-123-61" href="#__codelineno-123-61"></a>
</span><span id="__span-123-62"><a id="__codelineno-123-62" name="__codelineno-123-62" href="#__codelineno-123-62"></a><span class="c1">// Run the tests</span>
</span><span id="__span-123-63"><a id="__codelineno-123-63" name="__codelineno-123-63" href="#__codelineno-123-63"></a><span class="nx">runTests</span><span class="p">();</span>
</span></code></pre></div>
<p>Then add a step to the workflow:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Integration Tests</span>
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-124-3"><a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a><span class="w">    </span><span class="no">npm install axios</span>
</span><span id="__span-124-4"><a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a><span class="w">    </span><span class="no">node tests/integration-test.js</span>
</span><span id="__span-124-5"><a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a><span class="w">  </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-124-6"><a id="__codelineno-124-6" name="__codelineno-124-6" href="#__codelineno-124-6"></a><span class="w">    </span><span class="nt">WEBSITE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.WEBSITE_URL }}</span>
</span><span id="__span-124-7"><a id="__codelineno-124-7" name="__codelineno-124-7" href="#__codelineno-124-7"></a><span class="w">    </span><span class="nt">API_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.API_URL }}</span>
</span></code></pre></div>
<h3 id="implementing-secure-github-action-secrets"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#implementing-secure-github-action-secrets">Implementing Secure GitHub Action Secrets 🔐</a></h3>
<p>For our GitHub Actions workflows, I've set up the following repository secrets:</p>
<ul>
<li><code>AWS_ACCOUNT_ID</code>: The AWS account ID used for OIDC authentication</li>
<li><code>S3_BUCKET_NAME</code>: The name of the S3 bucket for the website</li>
<li><code>CLOUDFRONT_DISTRIBUTION_ID</code>: The ID of the CloudFront distribution</li>
<li><code>WEBSITE_URL</code>: The URL of the deployed website</li>
<li><code>API_URL</code>: The URL of the deployed API</li>
<li><code>TF_STATE_BUCKET</code>: The bucket for Terraform state</li>
<li><code>TF_STATE_KEY</code>: The key for Terraform state (dev)</li>
<li><code>TF_STATE_KEY_PROD</code>: The key for Terraform state (prod)</li>
<li><code>DOMAIN_NAME</code>: The domain name for the dev environment</li>
<li><code>DOMAIN_NAME_PROD</code>: The domain name for the prod environment</li>
</ul>
<p>These secrets are protected by GitHub and only exposed to authorized workflow runs.</p>
<h3 id="managing-manual-approvals-for-production-deployments"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#managing-manual-approvals-for-production-deployments">Managing Manual Approvals for Production Deployments 🚦</a></h3>
<p>For production deployments, I've added a manual approval step using GitHub Environments:</p>
<ol>
<li>Go to your repository settings</li>
<li>Navigate to Environments</li>
<li>Create a new environment called "production"</li>
<li>Enable "Required reviewers" and add yourself</li>
<li>Configure "Deployment branches" to limit deployments to specific branches</li>
</ol>
<p>Now, production deployments will require explicit approval from an authorized reviewer.</p>
<h3 id="monitoring-deployment-status-and-notifications"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#monitoring-deployment-status-and-notifications">Monitoring Deployment Status and Notifications 📊</a></h3>
<p>To stay informed about deployment status, I've added notifications to the workflow:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Notify Deployment Success</span>
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a><span class="w">  </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">success()</span>
</span><span id="__span-125-3"><a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="w">  </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rtCamp/action-slack-notify@v2</span>
</span><span id="__span-125-4"><a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a><span class="w">  </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-125-5"><a id="__codelineno-125-5" name="__codelineno-125-5" href="#__codelineno-125-5"></a><span class="w">    </span><span class="nt">SLACK_WEBHOOK</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SLACK_WEBHOOK }}</span>
</span><span id="__span-125-6"><a id="__codelineno-125-6" name="__codelineno-125-6" href="#__codelineno-125-6"></a><span class="w">    </span><span class="nt">SLACK_TITLE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment Successful</span>
</span><span id="__span-125-7"><a id="__codelineno-125-7" name="__codelineno-125-7" href="#__codelineno-125-7"></a><span class="w">    </span><span class="nt">SLACK_MESSAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;✅</span><span class="nv"> </span><span class="s">Deployment</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">${{</span><span class="nv"> </span><span class="s">github.workflow</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">was</span><span class="nv"> </span><span class="s">successful!&quot;</span>
</span><span id="__span-125-8"><a id="__codelineno-125-8" name="__codelineno-125-8" href="#__codelineno-125-8"></a><span class="w">    </span><span class="nt">SLACK_COLOR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">good</span>
</span><span id="__span-125-9"><a id="__codelineno-125-9" name="__codelineno-125-9" href="#__codelineno-125-9"></a>
</span><span id="__span-125-10"><a id="__codelineno-125-10" name="__codelineno-125-10" href="#__codelineno-125-10"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Notify Deployment Failure</span>
</span><span id="__span-125-11"><a id="__codelineno-125-11" name="__codelineno-125-11" href="#__codelineno-125-11"></a><span class="w">  </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">failure()</span>
</span><span id="__span-125-12"><a id="__codelineno-125-12" name="__codelineno-125-12" href="#__codelineno-125-12"></a><span class="w">  </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rtCamp/action-slack-notify@v2</span>
</span><span id="__span-125-13"><a id="__codelineno-125-13" name="__codelineno-125-13" href="#__codelineno-125-13"></a><span class="w">  </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-125-14"><a id="__codelineno-125-14" name="__codelineno-125-14" href="#__codelineno-125-14"></a><span class="w">    </span><span class="nt">SLACK_WEBHOOK</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SLACK_WEBHOOK }}</span>
</span><span id="__span-125-15"><a id="__codelineno-125-15" name="__codelineno-125-15" href="#__codelineno-125-15"></a><span class="w">    </span><span class="nt">SLACK_TITLE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment Failed</span>
</span><span id="__span-125-16"><a id="__codelineno-125-16" name="__codelineno-125-16" href="#__codelineno-125-16"></a><span class="w">    </span><span class="nt">SLACK_MESSAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;❌</span><span class="nv"> </span><span class="s">Deployment</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">${{</span><span class="nv"> </span><span class="s">github.workflow</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">failed!&quot;</span>
</span><span id="__span-125-17"><a id="__codelineno-125-17" name="__codelineno-125-17" href="#__codelineno-125-17"></a><span class="w">    </span><span class="nt">SLACK_COLOR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">danger</span>
</span></code></pre></div>
<p>This sends notifications to a Slack channel when deployments succeed or fail.</p>
<h3 id="implementing-additional-security-for-aws-cloudfront"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#implementing-additional-security-for-aws-cloudfront">Implementing Additional Security for AWS CloudFront 🔒</a></h3>
<p>To enhance the security of our CloudFront distribution, I've added a custom response headers policy:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudfront_response_headers_policy&quot;</span><span class="w"> </span><span class="nv">&quot;security_headers&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;security-headers-policy&quot;</span>
</span><span id="__span-126-3"><a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a>
</span><span id="__span-126-4"><a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a><span class="w">  </span><span class="nb">security_headers_config</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-126-5"><a id="__codelineno-126-5" name="__codelineno-126-5" href="#__codelineno-126-5"></a><span class="w">    </span><span class="nb">content_security_policy</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-126-6"><a id="__codelineno-126-6" name="__codelineno-126-6" href="#__codelineno-126-6"></a><span class="w">      </span><span class="na">content_security_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;default-src &#39;self&#39;; img-src &#39;self&#39;; script-src &#39;self&#39;; style-src &#39;self&#39;; object-src &#39;none&#39;;&quot;</span>
</span><span id="__span-126-7"><a id="__codelineno-126-7" name="__codelineno-126-7" href="#__codelineno-126-7"></a><span class="w">      </span><span class="na">override</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-126-8"><a id="__codelineno-126-8" name="__codelineno-126-8" href="#__codelineno-126-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-126-9"><a id="__codelineno-126-9" name="__codelineno-126-9" href="#__codelineno-126-9"></a>
</span><span id="__span-126-10"><a id="__codelineno-126-10" name="__codelineno-126-10" href="#__codelineno-126-10"></a><span class="w">    </span><span class="nb">content_type_options</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-126-11"><a id="__codelineno-126-11" name="__codelineno-126-11" href="#__codelineno-126-11"></a><span class="w">      </span><span class="na">override</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-126-12"><a id="__codelineno-126-12" name="__codelineno-126-12" href="#__codelineno-126-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-126-13"><a id="__codelineno-126-13" name="__codelineno-126-13" href="#__codelineno-126-13"></a>
</span><span id="__span-126-14"><a id="__codelineno-126-14" name="__codelineno-126-14" href="#__codelineno-126-14"></a><span class="w">    </span><span class="nb">frame_options</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-126-15"><a id="__codelineno-126-15" name="__codelineno-126-15" href="#__codelineno-126-15"></a><span class="w">      </span><span class="na">frame_option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DENY&quot;</span>
</span><span id="__span-126-16"><a id="__codelineno-126-16" name="__codelineno-126-16" href="#__codelineno-126-16"></a><span class="w">      </span><span class="na">override</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-126-17"><a id="__codelineno-126-17" name="__codelineno-126-17" href="#__codelineno-126-17"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-126-18"><a id="__codelineno-126-18" name="__codelineno-126-18" href="#__codelineno-126-18"></a>
</span><span id="__span-126-19"><a id="__codelineno-126-19" name="__codelineno-126-19" href="#__codelineno-126-19"></a><span class="w">    </span><span class="nb">referrer_policy</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-126-20"><a id="__codelineno-126-20" name="__codelineno-126-20" href="#__codelineno-126-20"></a><span class="w">      </span><span class="na">referrer_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;same-origin&quot;</span>
</span><span id="__span-126-21"><a id="__codelineno-126-21" name="__codelineno-126-21" href="#__codelineno-126-21"></a><span class="w">      </span><span class="na">override</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-126-22"><a id="__codelineno-126-22" name="__codelineno-126-22" href="#__codelineno-126-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-126-23"><a id="__codelineno-126-23" name="__codelineno-126-23" href="#__codelineno-126-23"></a>
</span><span id="__span-126-24"><a id="__codelineno-126-24" name="__codelineno-126-24" href="#__codelineno-126-24"></a><span class="w">    </span><span class="nb">strict_transport_security</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-126-25"><a id="__codelineno-126-25" name="__codelineno-126-25" href="#__codelineno-126-25"></a><span class="w">      </span><span class="na">access_control_max_age_sec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">31536000</span>
</span><span id="__span-126-26"><a id="__codelineno-126-26" name="__codelineno-126-26" href="#__codelineno-126-26"></a><span class="w">      </span><span class="na">include_subdomains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-126-27"><a id="__codelineno-126-27" name="__codelineno-126-27" href="#__codelineno-126-27"></a><span class="w">      </span><span class="na">preload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-126-28"><a id="__codelineno-126-28" name="__codelineno-126-28" href="#__codelineno-126-28"></a><span class="w">      </span><span class="na">override</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-126-29"><a id="__codelineno-126-29" name="__codelineno-126-29" href="#__codelineno-126-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-126-30"><a id="__codelineno-126-30" name="__codelineno-126-30" href="#__codelineno-126-30"></a>
</span><span id="__span-126-31"><a id="__codelineno-126-31" name="__codelineno-126-31" href="#__codelineno-126-31"></a><span class="w">    </span><span class="nb">xss_protection</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-126-32"><a id="__codelineno-126-32" name="__codelineno-126-32" href="#__codelineno-126-32"></a><span class="w">      </span><span class="na">mode_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-126-33"><a id="__codelineno-126-33" name="__codelineno-126-33" href="#__codelineno-126-33"></a><span class="w">      </span><span class="na">protection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-126-34"><a id="__codelineno-126-34" name="__codelineno-126-34" href="#__codelineno-126-34"></a><span class="w">      </span><span class="na">override</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-126-35"><a id="__codelineno-126-35" name="__codelineno-126-35" href="#__codelineno-126-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-126-36"><a id="__codelineno-126-36" name="__codelineno-126-36" href="#__codelineno-126-36"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-126-37"><a id="__codelineno-126-37" name="__codelineno-126-37" href="#__codelineno-126-37"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then reference this policy in the CloudFront distribution:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudfront_distribution&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="c1">  # ... other configuration ...</span>
</span><span id="__span-127-3"><a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a>
</span><span id="__span-127-4"><a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a><span class="w">  </span><span class="nb">default_cache_behavior</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-127-5"><a id="__codelineno-127-5" name="__codelineno-127-5" href="#__codelineno-127-5"></a><span class="c1">    # ... other configuration ...</span>
</span><span id="__span-127-6"><a id="__codelineno-127-6" name="__codelineno-127-6" href="#__codelineno-127-6"></a><span class="w">    </span><span class="na">response_headers_policy_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_response_headers_policy.security_headers.id</span>
</span><span id="__span-127-7"><a id="__codelineno-127-7" name="__codelineno-127-7" href="#__codelineno-127-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-127-8"><a id="__codelineno-127-8" name="__codelineno-127-8" href="#__codelineno-127-8"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="lessons-learned"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#lessons-learned">Lessons Learned 💡</a></h3>
<p>Implementing CI/CD for this project taught me several valuable lessons:</p>
<ol>
<li>
<p><strong>Start Simple, Then Iterate</strong>: My first workflow was basic - just syncing files to S3. As I gained confidence, I added testing, multiple environments, and security features.</p>
</li>
<li>
<p><strong>Security Is Non-Negotiable</strong>: Using OIDC for authentication instead of long-lived credentials was a game-changer for security. This approach follows AWS best practices and eliminates credential management headaches.</p>
</li>
<li>
<p><strong>Test Everything</strong>: Automated tests at every level (unit, integration, end-to-end) catch issues early. The time invested in writing tests paid off with more reliable deployments.</p>
</li>
<li>
<p><strong>Environment Separation</strong>: Keeping development and production environments separate allowed me to test changes safely before affecting the live site.</p>
</li>
<li>
<p><strong>Infrastructure as Code Works</strong>: Using Terraform to define all infrastructure components made the CI/CD process much more reliable. Everything is tracked, versioned, and repeatable.</p>
</li>
</ol>
<h3 id="my-integration-challenges-and-solutions"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#my-integration-challenges-and-solutions">My Integration Challenges and Solutions 🧩</a></h3>
<p>During implementation, I encountered several challenges:</p>
<ol>
<li>
<p><strong>CORS Issues</strong>: The API and website needed proper CORS configuration to work together. Adding the correct headers in both Lambda and API Gateway fixed this.</p>
</li>
<li>
<p><strong>Environment Variables</strong>: Managing different configurations for dev and prod was tricky. I solved this by using GitHub environment variables and separate Terraform workspaces.</p>
</li>
<li>
<p><strong>Cache Invalidation Delays</strong>: Changes to the website sometimes weren't visible immediately due to CloudFront caching. Adding proper cache invalidation to the workflow fixed this.</p>
</li>
<li>
<p><strong>State Locking</strong>: When multiple workflow runs executed simultaneously, they occasionally conflicted on Terraform state. Using DynamoDB for state locking resolved this issue.</p>
</li>
</ol>
<h3 id="devops-mod-multi-stage-pipeline-with-pull-request-environments"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#devops-mod-multi-stage-pipeline-with-pull-request-environments">DevOps Mod: Multi-Stage Pipeline with Pull Request Environments 🚀</a></h3>
<p>To extend this challenge further, I implemented a feature that creates temporary preview environments for pull requests:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="w">  </span><span class="nt">create_preview</span><span class="p">:</span>
</span><span id="__span-128-2"><a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Create</span><span class="nv"> </span><span class="s">Preview</span><span class="nv"> </span><span class="s">Environment&#39;</span>
</span><span id="__span-128-3"><a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-128-4"><a id="__codelineno-128-4" name="__codelineno-128-4" href="#__codelineno-128-4"></a><span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.event_name == &#39;pull_request&#39;</span>
</span><span id="__span-128-5"><a id="__codelineno-128-5" name="__codelineno-128-5" href="#__codelineno-128-5"></a>
</span><span id="__span-128-6"><a id="__codelineno-128-6" name="__codelineno-128-6" href="#__codelineno-128-6"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-128-7"><a id="__codelineno-128-7" name="__codelineno-128-7" href="#__codelineno-128-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-128-8"><a id="__codelineno-128-8" name="__codelineno-128-8" href="#__codelineno-128-8"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-128-9"><a id="__codelineno-128-9" name="__codelineno-128-9" href="#__codelineno-128-9"></a>
</span><span id="__span-128-10"><a id="__codelineno-128-10" name="__codelineno-128-10" href="#__codelineno-128-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS Credentials</span>
</span><span id="__span-128-11"><a id="__codelineno-128-11" name="__codelineno-128-11" href="#__codelineno-128-11"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v2</span>
</span><span id="__span-128-12"><a id="__codelineno-128-12" name="__codelineno-128-12" href="#__codelineno-128-12"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-128-13"><a id="__codelineno-128-13" name="__codelineno-128-13" href="#__codelineno-128-13"></a><span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/github-actions-role</span>
</span><span id="__span-128-14"><a id="__codelineno-128-14" name="__codelineno-128-14" href="#__codelineno-128-14"></a><span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
</span><span id="__span-128-15"><a id="__codelineno-128-15" name="__codelineno-128-15" href="#__codelineno-128-15"></a>
</span><span id="__span-128-16"><a id="__codelineno-128-16" name="__codelineno-128-16" href="#__codelineno-128-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
</span><span id="__span-128-17"><a id="__codelineno-128-17" name="__codelineno-128-17" href="#__codelineno-128-17"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v2</span>
</span><span id="__span-128-18"><a id="__codelineno-128-18" name="__codelineno-128-18" href="#__codelineno-128-18"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-128-19"><a id="__codelineno-128-19" name="__codelineno-128-19" href="#__codelineno-128-19"></a><span class="w">          </span><span class="nt">terraform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2.0</span>
</span><span id="__span-128-20"><a id="__codelineno-128-20" name="__codelineno-128-20" href="#__codelineno-128-20"></a>
</span><span id="__span-128-21"><a id="__codelineno-128-21" name="__codelineno-128-21" href="#__codelineno-128-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Generate Unique Environment Name</span>
</span><span id="__span-128-22"><a id="__codelineno-128-22" name="__codelineno-128-22" href="#__codelineno-128-22"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-128-23"><a id="__codelineno-128-23" name="__codelineno-128-23" href="#__codelineno-128-23"></a><span class="w">          </span><span class="no">PR_NUMBER=${{ github.event.pull_request.number }}</span>
</span><span id="__span-128-24"><a id="__codelineno-128-24" name="__codelineno-128-24" href="#__codelineno-128-24"></a><span class="w">          </span><span class="no">BRANCH_NAME=$(echo ${{ github.head_ref }} | tr -cd &#39;[:alnum:]&#39; | tr &#39;[:upper:]&#39; &#39;[:lower:]&#39;)</span>
</span><span id="__span-128-25"><a id="__codelineno-128-25" name="__codelineno-128-25" href="#__codelineno-128-25"></a><span class="w">          </span><span class="no">ENV_NAME=&quot;pr-${PR_NUMBER}-${BRANCH_NAME}&quot;</span>
</span><span id="__span-128-26"><a id="__codelineno-128-26" name="__codelineno-128-26" href="#__codelineno-128-26"></a><span class="w">          </span><span class="no">echo &quot;ENV_NAME=${ENV_NAME}&quot; &gt;&gt; $GITHUB_ENV</span>
</span><span id="__span-128-27"><a id="__codelineno-128-27" name="__codelineno-128-27" href="#__codelineno-128-27"></a>
</span><span id="__span-128-28"><a id="__codelineno-128-28" name="__codelineno-128-28" href="#__codelineno-128-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
</span><span id="__span-128-29"><a id="__codelineno-128-29" name="__codelineno-128-29" href="#__codelineno-128-29"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-128-30"><a id="__codelineno-128-30" name="__codelineno-128-30" href="#__codelineno-128-30"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform init -backend-config=&quot;bucket=${{ secrets.TF_STATE_BUCKET }}&quot; -backend-config=&quot;key=preview/${{ env.ENV_NAME }}/terraform.tfstate&quot; -backend-config=&quot;region=us-east-1&quot;</span>
</span><span id="__span-128-31"><a id="__codelineno-128-31" name="__codelineno-128-31" href="#__codelineno-128-31"></a>
</span><span id="__span-128-32"><a id="__codelineno-128-32" name="__codelineno-128-32" href="#__codelineno-128-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Apply</span>
</span><span id="__span-128-33"><a id="__codelineno-128-33" name="__codelineno-128-33" href="#__codelineno-128-33"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-128-34"><a id="__codelineno-128-34" name="__codelineno-128-34" href="#__codelineno-128-34"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-128-35"><a id="__codelineno-128-35" name="__codelineno-128-35" href="#__codelineno-128-35"></a><span class="w">          </span><span class="no">terraform apply -auto-approve \</span>
</span><span id="__span-128-36"><a id="__codelineno-128-36" name="__codelineno-128-36" href="#__codelineno-128-36"></a><span class="w">            </span><span class="no">-var=&quot;environment=${{ env.ENV_NAME }}&quot; \</span>
</span><span id="__span-128-37"><a id="__codelineno-128-37" name="__codelineno-128-37" href="#__codelineno-128-37"></a><span class="w">            </span><span class="no">-var=&quot;domain_name=pr-${{ github.event.pull_request.number }}.${{ secrets.DOMAIN_NAME }}&quot;</span>
</span><span id="__span-128-38"><a id="__codelineno-128-38" name="__codelineno-128-38" href="#__codelineno-128-38"></a>
</span><span id="__span-128-39"><a id="__codelineno-128-39" name="__codelineno-128-39" href="#__codelineno-128-39"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Comment Preview URL</span>
</span><span id="__span-128-40"><a id="__codelineno-128-40" name="__codelineno-128-40" href="#__codelineno-128-40"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/github-script@v6</span>
</span><span id="__span-128-41"><a id="__codelineno-128-41" name="__codelineno-128-41" href="#__codelineno-128-41"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-128-42"><a id="__codelineno-128-42" name="__codelineno-128-42" href="#__codelineno-128-42"></a><span class="w">          </span><span class="nt">github-token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
</span><span id="__span-128-43"><a id="__codelineno-128-43" name="__codelineno-128-43" href="#__codelineno-128-43"></a><span class="w">          </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-128-44"><a id="__codelineno-128-44" name="__codelineno-128-44" href="#__codelineno-128-44"></a><span class="w">            </span><span class="no">const output = `## 🚀 Preview Environment Deployed</span>
</span><span id="__span-128-45"><a id="__codelineno-128-45" name="__codelineno-128-45" href="#__codelineno-128-45"></a>
</span><span id="__span-128-46"><a id="__codelineno-128-46" name="__codelineno-128-46" href="#__codelineno-128-46"></a><span class="w">            </span><span class="no">Preview URL: https://pr-${{ github.event.pull_request.number }}.${{ secrets.DOMAIN_NAME }}</span>
</span><span id="__span-128-47"><a id="__codelineno-128-47" name="__codelineno-128-47" href="#__codelineno-128-47"></a>
</span><span id="__span-128-48"><a id="__codelineno-128-48" name="__codelineno-128-48" href="#__codelineno-128-48"></a><span class="w">            </span><span class="no">API Endpoint: https://api-pr-${{ github.event.pull_request.number }}.${{ secrets.DOMAIN_NAME }}/count</span>
</span><span id="__span-128-49"><a id="__codelineno-128-49" name="__codelineno-128-49" href="#__codelineno-128-49"></a>
</span><span id="__span-128-50"><a id="__codelineno-128-50" name="__codelineno-128-50" href="#__codelineno-128-50"></a><span class="w">            </span><span class="no">This environment will be automatically deleted when the PR is closed.`;</span>
</span><span id="__span-128-51"><a id="__codelineno-128-51" name="__codelineno-128-51" href="#__codelineno-128-51"></a>
</span><span id="__span-128-52"><a id="__codelineno-128-52" name="__codelineno-128-52" href="#__codelineno-128-52"></a><span class="w">            </span><span class="no">github.rest.issues.createComment({</span>
</span><span id="__span-128-53"><a id="__codelineno-128-53" name="__codelineno-128-53" href="#__codelineno-128-53"></a><span class="w">              </span><span class="no">issue_number: context.issue.number,</span>
</span><span id="__span-128-54"><a id="__codelineno-128-54" name="__codelineno-128-54" href="#__codelineno-128-54"></a><span class="w">              </span><span class="no">owner: context.repo.owner,</span>
</span><span id="__span-128-55"><a id="__codelineno-128-55" name="__codelineno-128-55" href="#__codelineno-128-55"></a><span class="w">              </span><span class="no">repo: context.repo.repo,</span>
</span><span id="__span-128-56"><a id="__codelineno-128-56" name="__codelineno-128-56" href="#__codelineno-128-56"></a><span class="w">              </span><span class="no">body: output</span>
</span><span id="__span-128-57"><a id="__codelineno-128-57" name="__codelineno-128-57" href="#__codelineno-128-57"></a><span class="w">            </span><span class="no">})</span>
</span></code></pre></div>
<p>And add a cleanup job to delete the preview environment when the PR is closed:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="w">  </span><span class="nt">cleanup_preview</span><span class="p">:</span>
</span><span id="__span-129-2"><a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Cleanup</span><span class="nv"> </span><span class="s">Preview</span><span class="nv"> </span><span class="s">Environment&#39;</span>
</span><span id="__span-129-3"><a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-129-4"><a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a><span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.event_name == &#39;pull_request&#39; &amp;&amp; github.event.action == &#39;closed&#39;</span>
</span><span id="__span-129-5"><a id="__codelineno-129-5" name="__codelineno-129-5" href="#__codelineno-129-5"></a>
</span><span id="__span-129-6"><a id="__codelineno-129-6" name="__codelineno-129-6" href="#__codelineno-129-6"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-129-7"><a id="__codelineno-129-7" name="__codelineno-129-7" href="#__codelineno-129-7"></a><span class="w">      </span><span class="c1"># Similar to create_preview but with terraform destroy</span>
</span></code></pre></div>
<h3 id="security-mod-implementing-aws-secrets-manager-for-api-keys"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#security-mod-implementing-aws-secrets-manager-for-api-keys">Security Mod: Implementing AWS Secrets Manager for API Keys 🔐</a></h3>
<p>To enhance the security of our API, I added API key authentication using AWS Secrets Manager:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="c1"># Create a secret to store the API key</span>
</span><span id="__span-130-2"><a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_secretsmanager_secret&quot;</span><span class="w"> </span><span class="nv">&quot;api_key&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-130-3"><a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-api-key-${var.environment}&quot;</span>
</span><span id="__span-130-4"><a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;API key for the Resume API&quot;</span>
</span><span id="__span-130-5"><a id="__codelineno-130-5" name="__codelineno-130-5" href="#__codelineno-130-5"></a><span class="p">}</span>
</span><span id="__span-130-6"><a id="__codelineno-130-6" name="__codelineno-130-6" href="#__codelineno-130-6"></a>
</span><span id="__span-130-7"><a id="__codelineno-130-7" name="__codelineno-130-7" href="#__codelineno-130-7"></a><span class="c1"># Generate a random API key</span>
</span><span id="__span-130-8"><a id="__codelineno-130-8" name="__codelineno-130-8" href="#__codelineno-130-8"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;random_password&quot;</span><span class="w"> </span><span class="nv">&quot;api_key&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-130-9"><a id="__codelineno-130-9" name="__codelineno-130-9" href="#__codelineno-130-9"></a><span class="w">  </span><span class="na">length</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">32</span>
</span><span id="__span-130-10"><a id="__codelineno-130-10" name="__codelineno-130-10" href="#__codelineno-130-10"></a><span class="w">  </span><span class="na">special</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-130-11"><a id="__codelineno-130-11" name="__codelineno-130-11" href="#__codelineno-130-11"></a><span class="p">}</span>
</span><span id="__span-130-12"><a id="__codelineno-130-12" name="__codelineno-130-12" href="#__codelineno-130-12"></a>
</span><span id="__span-130-13"><a id="__codelineno-130-13" name="__codelineno-130-13" href="#__codelineno-130-13"></a><span class="c1"># Store the API key in Secrets Manager</span>
</span><span id="__span-130-14"><a id="__codelineno-130-14" name="__codelineno-130-14" href="#__codelineno-130-14"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_secretsmanager_secret_version&quot;</span><span class="w"> </span><span class="nv">&quot;api_key&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-130-15"><a id="__codelineno-130-15" name="__codelineno-130-15" href="#__codelineno-130-15"></a><span class="w">  </span><span class="na">secret_id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_secretsmanager_secret.api_key.id</span>
</span><span id="__span-130-16"><a id="__codelineno-130-16" name="__codelineno-130-16" href="#__codelineno-130-16"></a><span class="w">  </span><span class="na">secret_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">random_password.api_key.result</span>
</span><span id="__span-130-17"><a id="__codelineno-130-17" name="__codelineno-130-17" href="#__codelineno-130-17"></a><span class="p">}</span>
</span><span id="__span-130-18"><a id="__codelineno-130-18" name="__codelineno-130-18" href="#__codelineno-130-18"></a>
</span><span id="__span-130-19"><a id="__codelineno-130-19" name="__codelineno-130-19" href="#__codelineno-130-19"></a><span class="c1"># Add API key to API Gateway</span>
</span><span id="__span-130-20"><a id="__codelineno-130-20" name="__codelineno-130-20" href="#__codelineno-130-20"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_api_key&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-130-21"><a id="__codelineno-130-21" name="__codelineno-130-21" href="#__codelineno-130-21"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;visitor-counter-key-${var.environment}&quot;</span>
</span><span id="__span-130-22"><a id="__codelineno-130-22" name="__codelineno-130-22" href="#__codelineno-130-22"></a><span class="p">}</span>
</span><span id="__span-130-23"><a id="__codelineno-130-23" name="__codelineno-130-23" href="#__codelineno-130-23"></a>
</span><span id="__span-130-24"><a id="__codelineno-130-24" name="__codelineno-130-24" href="#__codelineno-130-24"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_usage_plan&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-130-25"><a id="__codelineno-130-25" name="__codelineno-130-25" href="#__codelineno-130-25"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;visitor-counter-usage-plan-${var.environment}&quot;</span>
</span><span id="__span-130-26"><a id="__codelineno-130-26" name="__codelineno-130-26" href="#__codelineno-130-26"></a>
</span><span id="__span-130-27"><a id="__codelineno-130-27" name="__codelineno-130-27" href="#__codelineno-130-27"></a><span class="w">  </span><span class="nb">api_stages</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-130-28"><a id="__codelineno-130-28" name="__codelineno-130-28" href="#__codelineno-130-28"></a><span class="w">    </span><span class="na">api_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-130-29"><a id="__codelineno-130-29" name="__codelineno-130-29" href="#__codelineno-130-29"></a><span class="w">    </span><span class="na">stage</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.stage_name</span>
</span><span id="__span-130-30"><a id="__codelineno-130-30" name="__codelineno-130-30" href="#__codelineno-130-30"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-130-31"><a id="__codelineno-130-31" name="__codelineno-130-31" href="#__codelineno-130-31"></a>
</span><span id="__span-130-32"><a id="__codelineno-130-32" name="__codelineno-130-32" href="#__codelineno-130-32"></a><span class="w">  </span><span class="nb">quota_settings</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-130-33"><a id="__codelineno-130-33" name="__codelineno-130-33" href="#__codelineno-130-33"></a><span class="w">    </span><span class="na">limit</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span>
</span><span id="__span-130-34"><a id="__codelineno-130-34" name="__codelineno-130-34" href="#__codelineno-130-34"></a><span class="w">    </span><span class="na">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DAY&quot;</span>
</span><span id="__span-130-35"><a id="__codelineno-130-35" name="__codelineno-130-35" href="#__codelineno-130-35"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-130-36"><a id="__codelineno-130-36" name="__codelineno-130-36" href="#__codelineno-130-36"></a>
</span><span id="__span-130-37"><a id="__codelineno-130-37" name="__codelineno-130-37" href="#__codelineno-130-37"></a><span class="w">  </span><span class="nb">throttle_settings</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-130-38"><a id="__codelineno-130-38" name="__codelineno-130-38" href="#__codelineno-130-38"></a><span class="w">    </span><span class="na">burst_limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>
</span><span id="__span-130-39"><a id="__codelineno-130-39" name="__codelineno-130-39" href="#__codelineno-130-39"></a><span class="w">    </span><span class="na">rate_limit</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>
</span><span id="__span-130-40"><a id="__codelineno-130-40" name="__codelineno-130-40" href="#__codelineno-130-40"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-130-41"><a id="__codelineno-130-41" name="__codelineno-130-41" href="#__codelineno-130-41"></a><span class="p">}</span>
</span><span id="__span-130-42"><a id="__codelineno-130-42" name="__codelineno-130-42" href="#__codelineno-130-42"></a>
</span><span id="__span-130-43"><a id="__codelineno-130-43" name="__codelineno-130-43" href="#__codelineno-130-43"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_usage_plan_key&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-130-44"><a id="__codelineno-130-44" name="__codelineno-130-44" href="#__codelineno-130-44"></a><span class="w">  </span><span class="na">key_id</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_api_key.visitor_counter.id</span>
</span><span id="__span-130-45"><a id="__codelineno-130-45" name="__codelineno-130-45" href="#__codelineno-130-45"></a><span class="w">  </span><span class="na">key_type</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;API_KEY&quot;</span>
</span><span id="__span-130-46"><a id="__codelineno-130-46" name="__codelineno-130-46" href="#__codelineno-130-46"></a><span class="w">  </span><span class="na">usage_plan_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_usage_plan.visitor_counter.id</span>
</span><span id="__span-130-47"><a id="__codelineno-130-47" name="__codelineno-130-47" href="#__codelineno-130-47"></a><span class="p">}</span>
</span><span id="__span-130-48"><a id="__codelineno-130-48" name="__codelineno-130-48" href="#__codelineno-130-48"></a>
</span><span id="__span-130-49"><a id="__codelineno-130-49" name="__codelineno-130-49" href="#__codelineno-130-49"></a><span class="c1"># Update the Lambda function to verify the API key</span>
</span><span id="__span-130-50"><a id="__codelineno-130-50" name="__codelineno-130-50" href="#__codelineno-130-50"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_function&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-130-51"><a id="__codelineno-130-51" name="__codelineno-130-51" href="#__codelineno-130-51"></a><span class="c1">  # ... existing configuration ...</span>
</span><span id="__span-130-52"><a id="__codelineno-130-52" name="__codelineno-130-52" href="#__codelineno-130-52"></a>
</span><span id="__span-130-53"><a id="__codelineno-130-53" name="__codelineno-130-53" href="#__codelineno-130-53"></a><span class="w">  </span><span class="nb">environment</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-130-54"><a id="__codelineno-130-54" name="__codelineno-130-54" href="#__codelineno-130-54"></a><span class="w">    </span><span class="nb">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-130-55"><a id="__codelineno-130-55" name="__codelineno-130-55" href="#__codelineno-130-55"></a><span class="w">      </span><span class="na">DYNAMODB_TABLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_dynamodb_table.visitor_counter.name</span>
</span><span id="__span-130-56"><a id="__codelineno-130-56" name="__codelineno-130-56" href="#__codelineno-130-56"></a><span class="w">      </span><span class="na">ALLOWED_ORIGIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.website_domain</span>
</span><span id="__span-130-57"><a id="__codelineno-130-57" name="__codelineno-130-57" href="#__codelineno-130-57"></a><span class="w">      </span><span class="na">API_KEY_SECRET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_secretsmanager_secret.api_key.name</span>
</span><span id="__span-130-58"><a id="__codelineno-130-58" name="__codelineno-130-58" href="#__codelineno-130-58"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-130-59"><a id="__codelineno-130-59" name="__codelineno-130-59" href="#__codelineno-130-59"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-130-60"><a id="__codelineno-130-60" name="__codelineno-130-60" href="#__codelineno-130-60"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then, modify the Lambda function to retrieve and validate the API key:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
</span><span id="__span-131-2"><a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-131-3"><a id="__codelineno-131-3" name="__codelineno-131-3" href="#__codelineno-131-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-131-4"><a id="__codelineno-131-4" name="__codelineno-131-4" href="#__codelineno-131-4"></a>
</span><span id="__span-131-5"><a id="__codelineno-131-5" name="__codelineno-131-5" href="#__codelineno-131-5"></a><span class="c1"># Initialize Secrets Manager client</span>
</span><span id="__span-131-6"><a id="__codelineno-131-6" name="__codelineno-131-6" href="#__codelineno-131-6"></a><span class="n">secretsmanager</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;secretsmanager&#39;</span><span class="p">)</span>
</span><span id="__span-131-7"><a id="__codelineno-131-7" name="__codelineno-131-7" href="#__codelineno-131-7"></a>
</span><span id="__span-131-8"><a id="__codelineno-131-8" name="__codelineno-131-8" href="#__codelineno-131-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_api_key</span><span class="p">():</span>
</span><span id="__span-131-9"><a id="__codelineno-131-9" name="__codelineno-131-9" href="#__codelineno-131-9"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the API key from Secrets Manager&quot;&quot;&quot;</span>
</span><span id="__span-131-10"><a id="__codelineno-131-10" name="__codelineno-131-10" href="#__codelineno-131-10"></a>    <span class="n">secret_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;API_KEY_SECRET&#39;</span><span class="p">]</span>
</span><span id="__span-131-11"><a id="__codelineno-131-11" name="__codelineno-131-11" href="#__codelineno-131-11"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">secretsmanager</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">(</span><span class="n">SecretId</span><span class="o">=</span><span class="n">secret_name</span><span class="p">)</span>
</span><span id="__span-131-12"><a id="__codelineno-131-12" name="__codelineno-131-12" href="#__codelineno-131-12"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;SecretString&#39;</span><span class="p">]</span>
</span><span id="__span-131-13"><a id="__codelineno-131-13" name="__codelineno-131-13" href="#__codelineno-131-13"></a>
</span><span id="__span-131-14"><a id="__codelineno-131-14" name="__codelineno-131-14" href="#__codelineno-131-14"></a><span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</span><span id="__span-131-15"><a id="__codelineno-131-15" name="__codelineno-131-15" href="#__codelineno-131-15"></a>    <span class="c1"># Verify API key</span>
</span><span id="__span-131-16"><a id="__codelineno-131-16" name="__codelineno-131-16" href="#__codelineno-131-16"></a>    <span class="n">api_key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x-api-key&#39;</span><span class="p">)</span>
</span><span id="__span-131-17"><a id="__codelineno-131-17" name="__codelineno-131-17" href="#__codelineno-131-17"></a>    <span class="n">expected_api_key</span> <span class="o">=</span> <span class="n">get_api_key</span><span class="p">()</span>
</span><span id="__span-131-18"><a id="__codelineno-131-18" name="__codelineno-131-18" href="#__codelineno-131-18"></a>
</span><span id="__span-131-19"><a id="__codelineno-131-19" name="__codelineno-131-19" href="#__codelineno-131-19"></a>    <span class="k">if</span> <span class="n">api_key</span> <span class="o">!=</span> <span class="n">expected_api_key</span><span class="p">:</span>
</span><span id="__span-131-20"><a id="__codelineno-131-20" name="__codelineno-131-20" href="#__codelineno-131-20"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-131-21"><a id="__codelineno-131-21" name="__codelineno-131-21" href="#__codelineno-131-21"></a>            <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">403</span><span class="p">,</span>
</span><span id="__span-131-22"><a id="__codelineno-131-22" name="__codelineno-131-22" href="#__codelineno-131-22"></a>            <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-131-23"><a id="__codelineno-131-23" name="__codelineno-131-23" href="#__codelineno-131-23"></a>                <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span>
</span><span id="__span-131-24"><a id="__codelineno-131-24" name="__codelineno-131-24" href="#__codelineno-131-24"></a>            <span class="p">},</span>
</span><span id="__span-131-25"><a id="__codelineno-131-25" name="__codelineno-131-25" href="#__codelineno-131-25"></a>            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="__span-131-26"><a id="__codelineno-131-26" name="__codelineno-131-26" href="#__codelineno-131-26"></a>                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Forbidden&#39;</span><span class="p">,</span>
</span><span id="__span-131-27"><a id="__codelineno-131-27" name="__codelineno-131-27" href="#__codelineno-131-27"></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid API key&#39;</span>
</span><span id="__span-131-28"><a id="__codelineno-131-28" name="__codelineno-131-28" href="#__codelineno-131-28"></a>            <span class="p">})</span>
</span><span id="__span-131-29"><a id="__codelineno-131-29" name="__codelineno-131-29" href="#__codelineno-131-29"></a>        <span class="p">}</span>
</span><span id="__span-131-30"><a id="__codelineno-131-30" name="__codelineno-131-30" href="#__codelineno-131-30"></a>
</span><span id="__span-131-31"><a id="__codelineno-131-31" name="__codelineno-131-31" href="#__codelineno-131-31"></a>    <span class="c1"># Rest of the function...</span>
</span></code></pre></div>
<h3 id="next-steps"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#next-steps">Next Steps ⏭️</a></h3>
<p>With our CI/CD pipelines in place, our Cloud Resume Challenge implementation is complete! In the final post, we'll reflect on the project as a whole, discuss lessons learned, and explore potential future enhancements.</p>
<hr />
<p><strong>Up Next:</strong> [Cloud Resume Challenge with Terraform: Final Thoughts &amp; Lessons Learned] 🔗</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Cloud%20Resume%20Challenge%20with%20Terraform%3A%20Automating%20Deployments%20with%20GitHub%20Actions%0A&amp;url=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-19 00:00:00+00:00">March 19, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/aws/" class="md-meta__link">AWS</a>, 
              <a href="../../category/terraform/" class="md-meta__link">Terraform</a>, 
              <a href="../../category/serverless/" class="md-meta__link">Serverless</a>, 
              <a href="../../category/cloud-resume-challenge/" class="md-meta__link">Cloud Resume Challenge</a></li>
        
        
          
          <li class="md-meta__item">
            
              14 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="cloud-resume-challenge-with-terraform-building-the-backend-api"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/">Cloud Resume Challenge with Terraform: Building the Backend API 🚀</a></h2>
<p>In our <a href="link-to-previous-post">previous post</a>, we set up the frontend infrastructure for our resume website using Terraform. Now it's time to build the backend API that will power our visitor counter.</p>
<h3 id="backend-architecture-overview"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#backend-architecture-overview">Backend Architecture Overview 🏗️</a></h3>
<p>Let's take a look at the serverless architecture we'll be implementing:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>┌─────────────┐     ┌─────────────┐     ┌─────────────┐
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>│             │     │             │     │             │
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>│ API Gateway ├─────► Lambda      ├─────► DynamoDB    │
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>│             │     │             │     │             │
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>└─────────────┘     └─────────────┘     └─────────────┘
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>       │                   │                   │
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>       │                   │                   │
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>       ▼                   ▼                   ▼
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a>┌─────────────┐     ┌─────────────┐     ┌─────────────┐
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a>│             │     │             │     │             │
</span><span id="__span-64-11"><a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a>│ CloudWatch  │     │ CloudWatch  │     │ CloudWatch  │
</span><span id="__span-64-12"><a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a>│   Logs      │     │   Logs      │     │   Logs      │
</span><span id="__span-64-13"><a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a>│             │     │             │     │             │
</span><span id="__span-64-14"><a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a>└─────────────┘     └─────────────┘     └─────────────┘
</span></code></pre></div>
<p>This architecture includes:</p>
<ol>
<li><strong>API Gateway</strong>: Exposes our Lambda function as a REST API</li>
<li><strong>Lambda Function</strong>: Contains the Python code to increment and return the visitor count</li>
<li><strong>DynamoDB</strong>: Stores the visitor count data</li>
<li><strong>CloudWatch</strong>: Monitors and logs activity across all services</li>
</ol>
<h3 id="my-approach-to-dynamodb-design"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#my-approach-to-dynamodb-design">My Approach to DynamoDB Design 💾</a></h3>
<p>Before diving into the Terraform code, I want to share my thought process on DynamoDB table design. When I initially approached this challenge, I had to decide between two approaches:</p>
<ol>
<li><strong>Single-counter approach</strong>: A simple table with just one item for the counter</li>
<li><strong>Visitor log approach</strong>: A more detailed table that logs each visit with timestamps</li>
</ol>
<p>I chose the second approach for a few reasons:</p>
<ul>
<li>It allows for more detailed analytics in the future</li>
<li>It provides a history of visits that can be queried</li>
<li>It demonstrates a more realistic use case for DynamoDB</li>
</ul>
<p>Here's my table design:</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>visit_id</td>
<td>String</td>
<td>Primary key (UUID)</td>
</tr>
<tr>
<td>timestamp</td>
<td>String</td>
<td>ISO8601 timestamp of the visit</td>
</tr>
<tr>
<td>visitor_ip</td>
<td>String</td>
<td>Hashed IP address for privacy</td>
</tr>
<tr>
<td>user_agent</td>
<td>String</td>
<td>Browser/device information</td>
</tr>
<tr>
<td>path</td>
<td>String</td>
<td>Page path visited</td>
</tr>
</tbody>
</table>
<p>This approach gives us flexibility while keeping the solution serverless and cost-effective.</p>
<h3 id="implementing-the-backend-api-with-terraform"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#implementing-the-backend-api-with-terraform">Implementing the Backend API with Terraform 🛠️</a></h3>
<p>Now, let's start implementing our backend infrastructure using Terraform. We'll create modules for each component, starting with DynamoDB.</p>
<h4 id="1-dynamodb-table-for-visitor-counting"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#1-dynamodb-table-for-visitor-counting">1. DynamoDB Table for Visitor Counting 📊</a></h4>
<p>Create a file at <code>modules/backend/dynamodb.tf</code>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_dynamodb_table&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="w">  </span><span class="na">name</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ResumeVisitorCounter-${var.environment}&quot;</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="w">  </span><span class="na">billing_mode</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PAY_PER_REQUEST&quot;</span><span class="c1">  # On-demand capacity for cost savings</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="w">  </span><span class="na">hash_key</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;visit_id&quot;</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="w">  </span><span class="nb">attribute</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="w">    </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;visit_id&quot;</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="w">    </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S&quot;</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="c1">  # Add TTL for automatic data cleanup after 90 days</span>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="w">  </span><span class="nb">ttl</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a><span class="w">    </span><span class="na">attribute_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;expiration_time&quot;</span>
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a><span class="w">    </span><span class="na">enabled</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-65-16"><a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a>
</span><span id="__span-65-17"><a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a><span class="w">  </span><span class="nb">point_in_time_recovery</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-18"><a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a><span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="c1">  # Enable PITR for recovery options</span>
</span><span id="__span-65-19"><a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-65-20"><a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a>
</span><span id="__span-65-21"><a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a><span class="c1">  # Use server-side encryption</span>
</span><span id="__span-65-22"><a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a><span class="w">  </span><span class="nb">server_side_encryption</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-23"><a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a><span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-65-24"><a id="__codelineno-65-24" name="__codelineno-65-24" href="#__codelineno-65-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-65-25"><a id="__codelineno-65-25" name="__codelineno-65-25" href="#__codelineno-65-25"></a>
</span><span id="__span-65-26"><a id="__codelineno-65-26" name="__codelineno-65-26" href="#__codelineno-65-26"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-27"><a id="__codelineno-65-27" name="__codelineno-65-27" href="#__codelineno-65-27"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Visitor Counter&quot;</span>
</span><span id="__span-65-28"><a id="__codelineno-65-28" name="__codelineno-65-28" href="#__codelineno-65-28"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-65-29"><a id="__codelineno-65-29" name="__codelineno-65-29" href="#__codelineno-65-29"></a><span class="w">    </span><span class="na">Project</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cloud Resume Challenge&quot;</span>
</span><span id="__span-65-30"><a id="__codelineno-65-30" name="__codelineno-65-30" href="#__codelineno-65-30"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-65-31"><a id="__codelineno-65-31" name="__codelineno-65-31" href="#__codelineno-65-31"></a><span class="p">}</span>
</span><span id="__span-65-32"><a id="__codelineno-65-32" name="__codelineno-65-32" href="#__codelineno-65-32"></a>
</span><span id="__span-65-33"><a id="__codelineno-65-33" name="__codelineno-65-33" href="#__codelineno-65-33"></a><span class="c1"># Create a GSI for timestamp-based queries</span>
</span><span id="__span-65-34"><a id="__codelineno-65-34" name="__codelineno-65-34" href="#__codelineno-65-34"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_dynamodb_table_item&quot;</span><span class="w"> </span><span class="nv">&quot;counter_init&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-35"><a id="__codelineno-65-35" name="__codelineno-65-35" href="#__codelineno-65-35"></a><span class="w">  </span><span class="na">table_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_dynamodb_table.visitor_counter.name</span>
</span><span id="__span-65-36"><a id="__codelineno-65-36" name="__codelineno-65-36" href="#__codelineno-65-36"></a><span class="w">  </span><span class="na">hash_key</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_dynamodb_table.visitor_counter.hash_key</span>
</span><span id="__span-65-37"><a id="__codelineno-65-37" name="__codelineno-65-37" href="#__codelineno-65-37"></a>
</span><span id="__span-65-38"><a id="__codelineno-65-38" name="__codelineno-65-38" href="#__codelineno-65-38"></a><span class="c1">  # Initialize the counter with a value of 0</span>
</span><span id="__span-65-39"><a id="__codelineno-65-39" name="__codelineno-65-39" href="#__codelineno-65-39"></a><span class="w">  </span><span class="na">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-65-40"><a id="__codelineno-65-40" name="__codelineno-65-40" href="#__codelineno-65-40"></a><span class="w">    </span><span class="s2">&quot;visit_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;S&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;total&quot;</span><span class="p">},</span>
</span><span id="__span-65-41"><a id="__codelineno-65-41" name="__codelineno-65-41" href="#__codelineno-65-41"></a><span class="w">    </span><span class="s2">&quot;count&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;N&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">}</span>
</span><span id="__span-65-42"><a id="__codelineno-65-42" name="__codelineno-65-42" href="#__codelineno-65-42"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-65-43"><a id="__codelineno-65-43" name="__codelineno-65-43" href="#__codelineno-65-43"></a>
</span><span id="__span-65-44"><a id="__codelineno-65-44" name="__codelineno-65-44" href="#__codelineno-65-44"></a><span class="c1">  # Only create this item on initial deployment</span>
</span><span id="__span-65-45"><a id="__codelineno-65-45" name="__codelineno-65-45" href="#__codelineno-65-45"></a><span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-46"><a id="__codelineno-65-46" name="__codelineno-65-46" href="#__codelineno-65-46"></a><span class="w">    </span><span class="na">ignore_changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">item</span><span class="p">]</span>
</span><span id="__span-65-47"><a id="__codelineno-65-47" name="__codelineno-65-47" href="#__codelineno-65-47"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-65-48"><a id="__codelineno-65-48" name="__codelineno-65-48" href="#__codelineno-65-48"></a><span class="p">}</span>
</span></code></pre></div>
<p>I've implemented several enhancements:</p>
<ul>
<li>Point-in-time recovery for data protection</li>
<li>TTL for automatic cleanup of old records</li>
<li>Server-side encryption for security</li>
<li>An initial counter item to ensure we don't have "cold start" issues</li>
</ul>
<h4 id="2-lambda-function-for-the-api-logic"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#2-lambda-function-for-the-api-logic">2. Lambda Function for the API Logic 🏗️</a></h4>
<p>Now, let's create our Lambda function. First, we'll need the Python code. Create a file at <code>modules/backend/lambda/visitor_counter.py</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">botocore.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientError</span>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="c1"># Set up logging</span>
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a>
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a><span class="c1"># Initialize DynamoDB client</span>
</span><span id="__span-66-15"><a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a><span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">)</span>
</span><span id="__span-66-16"><a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a><span class="n">table_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DYNAMODB_TABLE&#39;</span><span class="p">]</span>
</span><span id="__span-66-17"><a id="__codelineno-66-17" name="__codelineno-66-17" href="#__codelineno-66-17"></a><span class="n">table</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
</span><span id="__span-66-18"><a id="__codelineno-66-18" name="__codelineno-66-18" href="#__codelineno-66-18"></a>
</span><span id="__span-66-19"><a id="__codelineno-66-19" name="__codelineno-66-19" href="#__codelineno-66-19"></a><span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</span><span id="__span-66-20"><a id="__codelineno-66-20" name="__codelineno-66-20" href="#__codelineno-66-20"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-66-21"><a id="__codelineno-66-21" name="__codelineno-66-21" href="#__codelineno-66-21"></a><span class="sd">    Lambda handler to process API Gateway requests for visitor counting.</span>
</span><span id="__span-66-22"><a id="__codelineno-66-22" name="__codelineno-66-22" href="#__codelineno-66-22"></a><span class="sd">    Increments the visitor counter and returns the updated count.</span>
</span><span id="__span-66-23"><a id="__codelineno-66-23" name="__codelineno-66-23" href="#__codelineno-66-23"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-66-24"><a id="__codelineno-66-24" name="__codelineno-66-24" href="#__codelineno-66-24"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing event: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-66-25"><a id="__codelineno-66-25" name="__codelineno-66-25" href="#__codelineno-66-25"></a>
</span><span id="__span-66-26"><a id="__codelineno-66-26" name="__codelineno-66-26" href="#__codelineno-66-26"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-66-27"><a id="__codelineno-66-27" name="__codelineno-66-27" href="#__codelineno-66-27"></a>        <span class="c1"># Extract request information</span>
</span><span id="__span-66-28"><a id="__codelineno-66-28" name="__codelineno-66-28" href="#__codelineno-66-28"></a>        <span class="n">request_context</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;requestContext&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-66-29"><a id="__codelineno-66-29" name="__codelineno-66-29" href="#__codelineno-66-29"></a>        <span class="n">http_method</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;httpMethod&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-66-30"><a id="__codelineno-66-30" name="__codelineno-66-30" href="#__codelineno-66-30"></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-66-31"><a id="__codelineno-66-31" name="__codelineno-66-31" href="#__codelineno-66-31"></a>        <span class="n">headers</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-66-32"><a id="__codelineno-66-32" name="__codelineno-66-32" href="#__codelineno-66-32"></a>        <span class="n">ip_address</span> <span class="o">=</span> <span class="n">request_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;identity&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sourceIp&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
</span><span id="__span-66-33"><a id="__codelineno-66-33" name="__codelineno-66-33" href="#__codelineno-66-33"></a>        <span class="n">user_agent</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
</span><span id="__span-66-34"><a id="__codelineno-66-34" name="__codelineno-66-34" href="#__codelineno-66-34"></a>
</span><span id="__span-66-35"><a id="__codelineno-66-35" name="__codelineno-66-35" href="#__codelineno-66-35"></a>        <span class="c1"># Generate a unique visit ID</span>
</span><span id="__span-66-36"><a id="__codelineno-66-36" name="__codelineno-66-36" href="#__codelineno-66-36"></a>        <span class="n">visit_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="__span-66-37"><a id="__codelineno-66-37" name="__codelineno-66-37" href="#__codelineno-66-37"></a>
</span><span id="__span-66-38"><a id="__codelineno-66-38" name="__codelineno-66-38" href="#__codelineno-66-38"></a>        <span class="c1"># Hash the IP address for privacy</span>
</span><span id="__span-66-39"><a id="__codelineno-66-39" name="__codelineno-66-39" href="#__codelineno-66-39"></a>        <span class="n">hashed_ip</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">ip_address</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span><span id="__span-66-40"><a id="__codelineno-66-40" name="__codelineno-66-40" href="#__codelineno-66-40"></a>
</span><span id="__span-66-41"><a id="__codelineno-66-41" name="__codelineno-66-41" href="#__codelineno-66-41"></a>        <span class="c1"># Get current timestamp</span>
</span><span id="__span-66-42"><a id="__codelineno-66-42" name="__codelineno-66-42" href="#__codelineno-66-42"></a>        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="__span-66-43"><a id="__codelineno-66-43" name="__codelineno-66-43" href="#__codelineno-66-43"></a>
</span><span id="__span-66-44"><a id="__codelineno-66-44" name="__codelineno-66-44" href="#__codelineno-66-44"></a>        <span class="c1"># Calculate expiration time (90 days from now)</span>
</span><span id="__span-66-45"><a id="__codelineno-66-45" name="__codelineno-66-45" href="#__codelineno-66-45"></a>        <span class="n">expiration_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
</span><span id="__span-66-46"><a id="__codelineno-66-46" name="__codelineno-66-46" href="#__codelineno-66-46"></a>
</span><span id="__span-66-47"><a id="__codelineno-66-47" name="__codelineno-66-47" href="#__codelineno-66-47"></a>        <span class="c1"># Log the visit</span>
</span><span id="__span-66-48"><a id="__codelineno-66-48" name="__codelineno-66-48" href="#__codelineno-66-48"></a>        <span class="n">table</span><span class="o">.</span><span class="n">put_item</span><span class="p">(</span>
</span><span id="__span-66-49"><a id="__codelineno-66-49" name="__codelineno-66-49" href="#__codelineno-66-49"></a>            <span class="n">Item</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-66-50"><a id="__codelineno-66-50" name="__codelineno-66-50" href="#__codelineno-66-50"></a>                <span class="s1">&#39;visit_id&#39;</span><span class="p">:</span> <span class="n">visit_id</span><span class="p">,</span>
</span><span id="__span-66-51"><a id="__codelineno-66-51" name="__codelineno-66-51" href="#__codelineno-66-51"></a>                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
</span><span id="__span-66-52"><a id="__codelineno-66-52" name="__codelineno-66-52" href="#__codelineno-66-52"></a>                <span class="s1">&#39;visitor_ip&#39;</span><span class="p">:</span> <span class="n">hashed_ip</span><span class="p">,</span>
</span><span id="__span-66-53"><a id="__codelineno-66-53" name="__codelineno-66-53" href="#__codelineno-66-53"></a>                <span class="s1">&#39;user_agent&#39;</span><span class="p">:</span> <span class="n">user_agent</span><span class="p">,</span>
</span><span id="__span-66-54"><a id="__codelineno-66-54" name="__codelineno-66-54" href="#__codelineno-66-54"></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
</span><span id="__span-66-55"><a id="__codelineno-66-55" name="__codelineno-66-55" href="#__codelineno-66-55"></a>                <span class="s1">&#39;expiration_time&#39;</span><span class="p">:</span> <span class="n">expiration_time</span>
</span><span id="__span-66-56"><a id="__codelineno-66-56" name="__codelineno-66-56" href="#__codelineno-66-56"></a>            <span class="p">}</span>
</span><span id="__span-66-57"><a id="__codelineno-66-57" name="__codelineno-66-57" href="#__codelineno-66-57"></a>        <span class="p">)</span>
</span><span id="__span-66-58"><a id="__codelineno-66-58" name="__codelineno-66-58" href="#__codelineno-66-58"></a>
</span><span id="__span-66-59"><a id="__codelineno-66-59" name="__codelineno-66-59" href="#__codelineno-66-59"></a>        <span class="c1"># Update the total counter</span>
</span><span id="__span-66-60"><a id="__codelineno-66-60" name="__codelineno-66-60" href="#__codelineno-66-60"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">update_item</span><span class="p">(</span>
</span><span id="__span-66-61"><a id="__codelineno-66-61" name="__codelineno-66-61" href="#__codelineno-66-61"></a>            <span class="n">Key</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;visit_id&#39;</span><span class="p">:</span> <span class="s1">&#39;total&#39;</span><span class="p">},</span>
</span><span id="__span-66-62"><a id="__codelineno-66-62" name="__codelineno-66-62" href="#__codelineno-66-62"></a>            <span class="n">UpdateExpression</span><span class="o">=</span><span class="s1">&#39;ADD #count :incr&#39;</span><span class="p">,</span>
</span><span id="__span-66-63"><a id="__codelineno-66-63" name="__codelineno-66-63" href="#__codelineno-66-63"></a>            <span class="n">ExpressionAttributeNames</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;#count&#39;</span><span class="p">:</span> <span class="s1">&#39;count&#39;</span><span class="p">},</span>
</span><span id="__span-66-64"><a id="__codelineno-66-64" name="__codelineno-66-64" href="#__codelineno-66-64"></a>            <span class="n">ExpressionAttributeValues</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;:incr&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
</span><span id="__span-66-65"><a id="__codelineno-66-65" name="__codelineno-66-65" href="#__codelineno-66-65"></a>            <span class="n">ReturnValues</span><span class="o">=</span><span class="s1">&#39;UPDATED_NEW&#39;</span>
</span><span id="__span-66-66"><a id="__codelineno-66-66" name="__codelineno-66-66" href="#__codelineno-66-66"></a>        <span class="p">)</span>
</span><span id="__span-66-67"><a id="__codelineno-66-67" name="__codelineno-66-67" href="#__codelineno-66-67"></a>
</span><span id="__span-66-68"><a id="__codelineno-66-68" name="__codelineno-66-68" href="#__codelineno-66-68"></a>        <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;Attributes&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>
</span><span id="__span-66-69"><a id="__codelineno-66-69" name="__codelineno-66-69" href="#__codelineno-66-69"></a>
</span><span id="__span-66-70"><a id="__codelineno-66-70" name="__codelineno-66-70" href="#__codelineno-66-70"></a>        <span class="c1"># Return the response</span>
</span><span id="__span-66-71"><a id="__codelineno-66-71" name="__codelineno-66-71" href="#__codelineno-66-71"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-66-72"><a id="__codelineno-66-72" name="__codelineno-66-72" href="#__codelineno-66-72"></a>            <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
</span><span id="__span-66-73"><a id="__codelineno-66-73" name="__codelineno-66-73" href="#__codelineno-66-73"></a>            <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-66-74"><a id="__codelineno-66-74" name="__codelineno-66-74" href="#__codelineno-66-74"></a>                <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="__span-66-75"><a id="__codelineno-66-75" name="__codelineno-66-75" href="#__codelineno-66-75"></a>                <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ALLOWED_ORIGIN&#39;</span><span class="p">],</span>
</span><span id="__span-66-76"><a id="__codelineno-66-76" name="__codelineno-66-76" href="#__codelineno-66-76"></a>                <span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">:</span> <span class="s1">&#39;GET, OPTIONS&#39;</span><span class="p">,</span>
</span><span id="__span-66-77"><a id="__codelineno-66-77" name="__codelineno-66-77" href="#__codelineno-66-77"></a>                <span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">:</span> <span class="s1">&#39;Content-Type&#39;</span>
</span><span id="__span-66-78"><a id="__codelineno-66-78" name="__codelineno-66-78" href="#__codelineno-66-78"></a>            <span class="p">},</span>
</span><span id="__span-66-79"><a id="__codelineno-66-79" name="__codelineno-66-79" href="#__codelineno-66-79"></a>            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="__span-66-80"><a id="__codelineno-66-80" name="__codelineno-66-80" href="#__codelineno-66-80"></a>                <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
</span><span id="__span-66-81"><a id="__codelineno-66-81" name="__codelineno-66-81" href="#__codelineno-66-81"></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Visitor count updated successfully&#39;</span>
</span><span id="__span-66-82"><a id="__codelineno-66-82" name="__codelineno-66-82" href="#__codelineno-66-82"></a>            <span class="p">})</span>
</span><span id="__span-66-83"><a id="__codelineno-66-83" name="__codelineno-66-83" href="#__codelineno-66-83"></a>        <span class="p">}</span>
</span><span id="__span-66-84"><a id="__codelineno-66-84" name="__codelineno-66-84" href="#__codelineno-66-84"></a>
</span><span id="__span-66-85"><a id="__codelineno-66-85" name="__codelineno-66-85" href="#__codelineno-66-85"></a>    <span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-66-86"><a id="__codelineno-66-86" name="__codelineno-66-86" href="#__codelineno-66-86"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DynamoDB error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-66-87"><a id="__codelineno-66-87" name="__codelineno-66-87" href="#__codelineno-66-87"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-66-88"><a id="__codelineno-66-88" name="__codelineno-66-88" href="#__codelineno-66-88"></a>            <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
</span><span id="__span-66-89"><a id="__codelineno-66-89" name="__codelineno-66-89" href="#__codelineno-66-89"></a>            <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-66-90"><a id="__codelineno-66-90" name="__codelineno-66-90" href="#__codelineno-66-90"></a>                <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="__span-66-91"><a id="__codelineno-66-91" name="__codelineno-66-91" href="#__codelineno-66-91"></a>                <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ALLOWED_ORIGIN&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="__span-66-92"><a id="__codelineno-66-92" name="__codelineno-66-92" href="#__codelineno-66-92"></a>            <span class="p">},</span>
</span><span id="__span-66-93"><a id="__codelineno-66-93" name="__codelineno-66-93" href="#__codelineno-66-93"></a>            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="__span-66-94"><a id="__codelineno-66-94" name="__codelineno-66-94" href="#__codelineno-66-94"></a>                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Database error&#39;</span><span class="p">,</span>
</span><span id="__span-66-95"><a id="__codelineno-66-95" name="__codelineno-66-95" href="#__codelineno-66-95"></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-66-96"><a id="__codelineno-66-96" name="__codelineno-66-96" href="#__codelineno-66-96"></a>            <span class="p">})</span>
</span><span id="__span-66-97"><a id="__codelineno-66-97" name="__codelineno-66-97" href="#__codelineno-66-97"></a>        <span class="p">}</span>
</span><span id="__span-66-98"><a id="__codelineno-66-98" name="__codelineno-66-98" href="#__codelineno-66-98"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-66-99"><a id="__codelineno-66-99" name="__codelineno-66-99" href="#__codelineno-66-99"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;General error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-66-100"><a id="__codelineno-66-100" name="__codelineno-66-100" href="#__codelineno-66-100"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-66-101"><a id="__codelineno-66-101" name="__codelineno-66-101" href="#__codelineno-66-101"></a>            <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
</span><span id="__span-66-102"><a id="__codelineno-66-102" name="__codelineno-66-102" href="#__codelineno-66-102"></a>            <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-66-103"><a id="__codelineno-66-103" name="__codelineno-66-103" href="#__codelineno-66-103"></a>                <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="__span-66-104"><a id="__codelineno-66-104" name="__codelineno-66-104" href="#__codelineno-66-104"></a>                <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ALLOWED_ORIGIN&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="__span-66-105"><a id="__codelineno-66-105" name="__codelineno-66-105" href="#__codelineno-66-105"></a>            <span class="p">},</span>
</span><span id="__span-66-106"><a id="__codelineno-66-106" name="__codelineno-66-106" href="#__codelineno-66-106"></a>            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="__span-66-107"><a id="__codelineno-66-107" name="__codelineno-66-107" href="#__codelineno-66-107"></a>                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Server error&#39;</span><span class="p">,</span>
</span><span id="__span-66-108"><a id="__codelineno-66-108" name="__codelineno-66-108" href="#__codelineno-66-108"></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-66-109"><a id="__codelineno-66-109" name="__codelineno-66-109" href="#__codelineno-66-109"></a>            <span class="p">})</span>
</span><span id="__span-66-110"><a id="__codelineno-66-110" name="__codelineno-66-110" href="#__codelineno-66-110"></a>        <span class="p">}</span>
</span><span id="__span-66-111"><a id="__codelineno-66-111" name="__codelineno-66-111" href="#__codelineno-66-111"></a>
</span><span id="__span-66-112"><a id="__codelineno-66-112" name="__codelineno-66-112" href="#__codelineno-66-112"></a><span class="k">def</span><span class="w"> </span><span class="nf">options_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</span><span id="__span-66-113"><a id="__codelineno-66-113" name="__codelineno-66-113" href="#__codelineno-66-113"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-66-114"><a id="__codelineno-66-114" name="__codelineno-66-114" href="#__codelineno-66-114"></a><span class="sd">    Handler for OPTIONS requests to support CORS</span>
</span><span id="__span-66-115"><a id="__codelineno-66-115" name="__codelineno-66-115" href="#__codelineno-66-115"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-66-116"><a id="__codelineno-66-116" name="__codelineno-66-116" href="#__codelineno-66-116"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-66-117"><a id="__codelineno-66-117" name="__codelineno-66-117" href="#__codelineno-66-117"></a>        <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
</span><span id="__span-66-118"><a id="__codelineno-66-118" name="__codelineno-66-118" href="#__codelineno-66-118"></a>        <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-66-119"><a id="__codelineno-66-119" name="__codelineno-66-119" href="#__codelineno-66-119"></a>            <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ALLOWED_ORIGIN&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">),</span>
</span><span id="__span-66-120"><a id="__codelineno-66-120" name="__codelineno-66-120" href="#__codelineno-66-120"></a>            <span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">:</span> <span class="s1">&#39;GET, OPTIONS&#39;</span><span class="p">,</span>
</span><span id="__span-66-121"><a id="__codelineno-66-121" name="__codelineno-66-121" href="#__codelineno-66-121"></a>            <span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">:</span> <span class="s1">&#39;Content-Type&#39;</span>
</span><span id="__span-66-122"><a id="__codelineno-66-122" name="__codelineno-66-122" href="#__codelineno-66-122"></a>        <span class="p">},</span>
</span><span id="__span-66-123"><a id="__codelineno-66-123" name="__codelineno-66-123" href="#__codelineno-66-123"></a>        <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
</span><span id="__span-66-124"><a id="__codelineno-66-124" name="__codelineno-66-124" href="#__codelineno-66-124"></a>    <span class="p">}</span>
</span></code></pre></div>
<p>Now, let's create the Lambda function using Terraform. Create a file at <code>modules/backend/lambda.tf</code>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="c1"># Archive the Lambda function code</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;archive_file&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_zip&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;zip&quot;</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="w">  </span><span class="na">source_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${path.module}/lambda/visitor_counter.py&quot;</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="w">  </span><span class="na">output_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${path.module}/lambda/visitor_counter.zip&quot;</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="p">}</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="c1"># Create the Lambda function</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_function&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a><span class="w">  </span><span class="na">filename</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.archive_file.lambda_zip.output_path</span>
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a><span class="w">  </span><span class="na">function_name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-visitor-counter-${var.environment}&quot;</span>
</span><span id="__span-67-12"><a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a><span class="w">  </span><span class="na">role</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.lambda_role.arn</span>
</span><span id="__span-67-13"><a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a><span class="w">  </span><span class="na">handler</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;visitor_counter.lambda_handler&quot;</span>
</span><span id="__span-67-14"><a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a><span class="w">  </span><span class="na">source_code_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.archive_file.lambda_zip.output_base64sha256</span>
</span><span id="__span-67-15"><a id="__codelineno-67-15" name="__codelineno-67-15" href="#__codelineno-67-15"></a><span class="w">  </span><span class="na">runtime</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;python3.9&quot;</span>
</span><span id="__span-67-16"><a id="__codelineno-67-16" name="__codelineno-67-16" href="#__codelineno-67-16"></a><span class="w">  </span><span class="na">timeout</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="c1">  # Increased timeout for better error handling</span>
</span><span id="__span-67-17"><a id="__codelineno-67-17" name="__codelineno-67-17" href="#__codelineno-67-17"></a><span class="w">  </span><span class="na">memory_size</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">128</span>
</span><span id="__span-67-18"><a id="__codelineno-67-18" name="__codelineno-67-18" href="#__codelineno-67-18"></a>
</span><span id="__span-67-19"><a id="__codelineno-67-19" name="__codelineno-67-19" href="#__codelineno-67-19"></a><span class="w">  </span><span class="nb">environment</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-20"><a id="__codelineno-67-20" name="__codelineno-67-20" href="#__codelineno-67-20"></a><span class="w">    </span><span class="nb">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-21"><a id="__codelineno-67-21" name="__codelineno-67-21" href="#__codelineno-67-21"></a><span class="w">      </span><span class="na">DYNAMODB_TABLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_dynamodb_table.visitor_counter.name</span>
</span><span id="__span-67-22"><a id="__codelineno-67-22" name="__codelineno-67-22" href="#__codelineno-67-22"></a><span class="w">      </span><span class="na">ALLOWED_ORIGIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.website_domain</span>
</span><span id="__span-67-23"><a id="__codelineno-67-23" name="__codelineno-67-23" href="#__codelineno-67-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-67-24"><a id="__codelineno-67-24" name="__codelineno-67-24" href="#__codelineno-67-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-67-25"><a id="__codelineno-67-25" name="__codelineno-67-25" href="#__codelineno-67-25"></a>
</span><span id="__span-67-26"><a id="__codelineno-67-26" name="__codelineno-67-26" href="#__codelineno-67-26"></a><span class="w">  </span><span class="nb">tracing_config</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-27"><a id="__codelineno-67-27" name="__codelineno-67-27" href="#__codelineno-67-27"></a><span class="w">    </span><span class="na">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Active&quot;</span><span class="c1">  # Enable X-Ray tracing</span>
</span><span id="__span-67-28"><a id="__codelineno-67-28" name="__codelineno-67-28" href="#__codelineno-67-28"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-67-29"><a id="__codelineno-67-29" name="__codelineno-67-29" href="#__codelineno-67-29"></a>
</span><span id="__span-67-30"><a id="__codelineno-67-30" name="__codelineno-67-30" href="#__codelineno-67-30"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-31"><a id="__codelineno-67-31" name="__codelineno-67-31" href="#__codelineno-67-31"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Visitor Counter Lambda&quot;</span>
</span><span id="__span-67-32"><a id="__codelineno-67-32" name="__codelineno-67-32" href="#__codelineno-67-32"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-67-33"><a id="__codelineno-67-33" name="__codelineno-67-33" href="#__codelineno-67-33"></a><span class="w">    </span><span class="na">Project</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cloud Resume Challenge&quot;</span>
</span><span id="__span-67-34"><a id="__codelineno-67-34" name="__codelineno-67-34" href="#__codelineno-67-34"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-67-35"><a id="__codelineno-67-35" name="__codelineno-67-35" href="#__codelineno-67-35"></a><span class="p">}</span>
</span><span id="__span-67-36"><a id="__codelineno-67-36" name="__codelineno-67-36" href="#__codelineno-67-36"></a>
</span><span id="__span-67-37"><a id="__codelineno-67-37" name="__codelineno-67-37" href="#__codelineno-67-37"></a><span class="c1"># Create an IAM role for the Lambda function</span>
</span><span id="__span-67-38"><a id="__codelineno-67-38" name="__codelineno-67-38" href="#__codelineno-67-38"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_role&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-39"><a id="__codelineno-67-39" name="__codelineno-67-39" href="#__codelineno-67-39"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-visitor-counter-lambda-role-${var.environment}&quot;</span>
</span><span id="__span-67-40"><a id="__codelineno-67-40" name="__codelineno-67-40" href="#__codelineno-67-40"></a>
</span><span id="__span-67-41"><a id="__codelineno-67-41" name="__codelineno-67-41" href="#__codelineno-67-41"></a><span class="w">  </span><span class="na">assume_role_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-67-42"><a id="__codelineno-67-42" name="__codelineno-67-42" href="#__codelineno-67-42"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-67-43"><a id="__codelineno-67-43" name="__codelineno-67-43" href="#__codelineno-67-43"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-67-44"><a id="__codelineno-67-44" name="__codelineno-67-44" href="#__codelineno-67-44"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-67-45"><a id="__codelineno-67-45" name="__codelineno-67-45" href="#__codelineno-67-45"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span>
</span><span id="__span-67-46"><a id="__codelineno-67-46" name="__codelineno-67-46" href="#__codelineno-67-46"></a><span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-67-47"><a id="__codelineno-67-47" name="__codelineno-67-47" href="#__codelineno-67-47"></a><span class="w">        </span><span class="nb">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-48"><a id="__codelineno-67-48" name="__codelineno-67-48" href="#__codelineno-67-48"></a><span class="w">          </span><span class="na">Service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda.amazonaws.com&quot;</span>
</span><span id="__span-67-49"><a id="__codelineno-67-49" name="__codelineno-67-49" href="#__codelineno-67-49"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-67-50"><a id="__codelineno-67-50" name="__codelineno-67-50" href="#__codelineno-67-50"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-67-51"><a id="__codelineno-67-51" name="__codelineno-67-51" href="#__codelineno-67-51"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-67-52"><a id="__codelineno-67-52" name="__codelineno-67-52" href="#__codelineno-67-52"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-67-53"><a id="__codelineno-67-53" name="__codelineno-67-53" href="#__codelineno-67-53"></a><span class="p">}</span>
</span><span id="__span-67-54"><a id="__codelineno-67-54" name="__codelineno-67-54" href="#__codelineno-67-54"></a>
</span><span id="__span-67-55"><a id="__codelineno-67-55" name="__codelineno-67-55" href="#__codelineno-67-55"></a><span class="c1"># Create a custom policy for the Lambda function with least privilege</span>
</span><span id="__span-67-56"><a id="__codelineno-67-56" name="__codelineno-67-56" href="#__codelineno-67-56"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_policy&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_policy&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-57"><a id="__codelineno-67-57" name="__codelineno-67-57" href="#__codelineno-67-57"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-visitor-counter-lambda-policy-${var.environment}&quot;</span>
</span><span id="__span-67-58"><a id="__codelineno-67-58" name="__codelineno-67-58" href="#__codelineno-67-58"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;IAM policy for the visitor counter Lambda function&quot;</span>
</span><span id="__span-67-59"><a id="__codelineno-67-59" name="__codelineno-67-59" href="#__codelineno-67-59"></a>
</span><span id="__span-67-60"><a id="__codelineno-67-60" name="__codelineno-67-60" href="#__codelineno-67-60"></a><span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-67-61"><a id="__codelineno-67-61" name="__codelineno-67-61" href="#__codelineno-67-61"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-67-62"><a id="__codelineno-67-62" name="__codelineno-67-62" href="#__codelineno-67-62"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-67-63"><a id="__codelineno-67-63" name="__codelineno-67-63" href="#__codelineno-67-63"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-67-64"><a id="__codelineno-67-64" name="__codelineno-67-64" href="#__codelineno-67-64"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-67-65"><a id="__codelineno-67-65" name="__codelineno-67-65" href="#__codelineno-67-65"></a><span class="w">          </span><span class="s2">&quot;dynamodb:GetItem&quot;</span><span class="p">,</span>
</span><span id="__span-67-66"><a id="__codelineno-67-66" name="__codelineno-67-66" href="#__codelineno-67-66"></a><span class="w">          </span><span class="s2">&quot;dynamodb:PutItem&quot;</span><span class="p">,</span>
</span><span id="__span-67-67"><a id="__codelineno-67-67" name="__codelineno-67-67" href="#__codelineno-67-67"></a><span class="w">          </span><span class="s2">&quot;dynamodb:UpdateItem&quot;</span>
</span><span id="__span-67-68"><a id="__codelineno-67-68" name="__codelineno-67-68" href="#__codelineno-67-68"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-67-69"><a id="__codelineno-67-69" name="__codelineno-67-69" href="#__codelineno-67-69"></a><span class="w">        </span><span class="na">Effect</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-67-70"><a id="__codelineno-67-70" name="__codelineno-67-70" href="#__codelineno-67-70"></a><span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_dynamodb_table.visitor_counter.arn</span>
</span><span id="__span-67-71"><a id="__codelineno-67-71" name="__codelineno-67-71" href="#__codelineno-67-71"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-67-72"><a id="__codelineno-67-72" name="__codelineno-67-72" href="#__codelineno-67-72"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-67-73"><a id="__codelineno-67-73" name="__codelineno-67-73" href="#__codelineno-67-73"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-67-74"><a id="__codelineno-67-74" name="__codelineno-67-74" href="#__codelineno-67-74"></a><span class="w">          </span><span class="s2">&quot;logs:CreateLogGroup&quot;</span><span class="p">,</span>
</span><span id="__span-67-75"><a id="__codelineno-67-75" name="__codelineno-67-75" href="#__codelineno-67-75"></a><span class="w">          </span><span class="s2">&quot;logs:CreateLogStream&quot;</span><span class="p">,</span>
</span><span id="__span-67-76"><a id="__codelineno-67-76" name="__codelineno-67-76" href="#__codelineno-67-76"></a><span class="w">          </span><span class="s2">&quot;logs:PutLogEvents&quot;</span>
</span><span id="__span-67-77"><a id="__codelineno-67-77" name="__codelineno-67-77" href="#__codelineno-67-77"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-67-78"><a id="__codelineno-67-78" name="__codelineno-67-78" href="#__codelineno-67-78"></a><span class="w">        </span><span class="na">Effect</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-67-79"><a id="__codelineno-67-79" name="__codelineno-67-79" href="#__codelineno-67-79"></a><span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;arn:aws:logs:*:*:*&quot;</span>
</span><span id="__span-67-80"><a id="__codelineno-67-80" name="__codelineno-67-80" href="#__codelineno-67-80"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-67-81"><a id="__codelineno-67-81" name="__codelineno-67-81" href="#__codelineno-67-81"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-67-82"><a id="__codelineno-67-82" name="__codelineno-67-82" href="#__codelineno-67-82"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-67-83"><a id="__codelineno-67-83" name="__codelineno-67-83" href="#__codelineno-67-83"></a><span class="w">          </span><span class="s2">&quot;xray:PutTraceSegments&quot;</span><span class="p">,</span>
</span><span id="__span-67-84"><a id="__codelineno-67-84" name="__codelineno-67-84" href="#__codelineno-67-84"></a><span class="w">          </span><span class="s2">&quot;xray:PutTelemetryRecords&quot;</span>
</span><span id="__span-67-85"><a id="__codelineno-67-85" name="__codelineno-67-85" href="#__codelineno-67-85"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-67-86"><a id="__codelineno-67-86" name="__codelineno-67-86" href="#__codelineno-67-86"></a><span class="w">        </span><span class="na">Effect</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-67-87"><a id="__codelineno-67-87" name="__codelineno-67-87" href="#__codelineno-67-87"></a><span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-67-88"><a id="__codelineno-67-88" name="__codelineno-67-88" href="#__codelineno-67-88"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-67-89"><a id="__codelineno-67-89" name="__codelineno-67-89" href="#__codelineno-67-89"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-67-90"><a id="__codelineno-67-90" name="__codelineno-67-90" href="#__codelineno-67-90"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-67-91"><a id="__codelineno-67-91" name="__codelineno-67-91" href="#__codelineno-67-91"></a><span class="p">}</span>
</span><span id="__span-67-92"><a id="__codelineno-67-92" name="__codelineno-67-92" href="#__codelineno-67-92"></a>
</span><span id="__span-67-93"><a id="__codelineno-67-93" name="__codelineno-67-93" href="#__codelineno-67-93"></a><span class="c1"># Attach the policy to the IAM role</span>
</span><span id="__span-67-94"><a id="__codelineno-67-94" name="__codelineno-67-94" href="#__codelineno-67-94"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role_policy_attachment&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_policy_attachment&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-95"><a id="__codelineno-67-95" name="__codelineno-67-95" href="#__codelineno-67-95"></a><span class="w">  </span><span class="na">role</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.lambda_role.name</span>
</span><span id="__span-67-96"><a id="__codelineno-67-96" name="__codelineno-67-96" href="#__codelineno-67-96"></a><span class="w">  </span><span class="na">policy_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_policy.lambda_policy.arn</span>
</span><span id="__span-67-97"><a id="__codelineno-67-97" name="__codelineno-67-97" href="#__codelineno-67-97"></a><span class="p">}</span>
</span><span id="__span-67-98"><a id="__codelineno-67-98" name="__codelineno-67-98" href="#__codelineno-67-98"></a>
</span><span id="__span-67-99"><a id="__codelineno-67-99" name="__codelineno-67-99" href="#__codelineno-67-99"></a><span class="c1"># Create a CloudWatch log group for the Lambda function</span>
</span><span id="__span-67-100"><a id="__codelineno-67-100" name="__codelineno-67-100" href="#__codelineno-67-100"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_log_group&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_log_group&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-101"><a id="__codelineno-67-101" name="__codelineno-67-101" href="#__codelineno-67-101"></a><span class="w">  </span><span class="na">name</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/aws/lambda/${aws_lambda_function.visitor_counter.function_name}&quot;</span>
</span><span id="__span-67-102"><a id="__codelineno-67-102" name="__codelineno-67-102" href="#__codelineno-67-102"></a><span class="w">  </span><span class="na">retention_in_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span>
</span><span id="__span-67-103"><a id="__codelineno-67-103" name="__codelineno-67-103" href="#__codelineno-67-103"></a>
</span><span id="__span-67-104"><a id="__codelineno-67-104" name="__codelineno-67-104" href="#__codelineno-67-104"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-105"><a id="__codelineno-67-105" name="__codelineno-67-105" href="#__codelineno-67-105"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-67-106"><a id="__codelineno-67-106" name="__codelineno-67-106" href="#__codelineno-67-106"></a><span class="w">    </span><span class="na">Project</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cloud Resume Challenge&quot;</span>
</span><span id="__span-67-107"><a id="__codelineno-67-107" name="__codelineno-67-107" href="#__codelineno-67-107"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-67-108"><a id="__codelineno-67-108" name="__codelineno-67-108" href="#__codelineno-67-108"></a><span class="p">}</span>
</span><span id="__span-67-109"><a id="__codelineno-67-109" name="__codelineno-67-109" href="#__codelineno-67-109"></a>
</span><span id="__span-67-110"><a id="__codelineno-67-110" name="__codelineno-67-110" href="#__codelineno-67-110"></a><span class="c1"># Create a Lambda function for handling OPTIONS requests (CORS)</span>
</span><span id="__span-67-111"><a id="__codelineno-67-111" name="__codelineno-67-111" href="#__codelineno-67-111"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_function&quot;</span><span class="w"> </span><span class="nv">&quot;options_handler&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-112"><a id="__codelineno-67-112" name="__codelineno-67-112" href="#__codelineno-67-112"></a><span class="w">  </span><span class="na">filename</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.archive_file.lambda_zip.output_path</span>
</span><span id="__span-67-113"><a id="__codelineno-67-113" name="__codelineno-67-113" href="#__codelineno-67-113"></a><span class="w">  </span><span class="na">function_name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-visitor-counter-options-${var.environment}&quot;</span>
</span><span id="__span-67-114"><a id="__codelineno-67-114" name="__codelineno-67-114" href="#__codelineno-67-114"></a><span class="w">  </span><span class="na">role</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.lambda_role.arn</span>
</span><span id="__span-67-115"><a id="__codelineno-67-115" name="__codelineno-67-115" href="#__codelineno-67-115"></a><span class="w">  </span><span class="na">handler</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;visitor_counter.options_handler&quot;</span>
</span><span id="__span-67-116"><a id="__codelineno-67-116" name="__codelineno-67-116" href="#__codelineno-67-116"></a><span class="w">  </span><span class="na">source_code_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.archive_file.lambda_zip.output_base64sha256</span>
</span><span id="__span-67-117"><a id="__codelineno-67-117" name="__codelineno-67-117" href="#__codelineno-67-117"></a><span class="w">  </span><span class="na">runtime</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;python3.9&quot;</span>
</span><span id="__span-67-118"><a id="__codelineno-67-118" name="__codelineno-67-118" href="#__codelineno-67-118"></a><span class="w">  </span><span class="na">timeout</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>
</span><span id="__span-67-119"><a id="__codelineno-67-119" name="__codelineno-67-119" href="#__codelineno-67-119"></a><span class="w">  </span><span class="na">memory_size</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">128</span>
</span><span id="__span-67-120"><a id="__codelineno-67-120" name="__codelineno-67-120" href="#__codelineno-67-120"></a>
</span><span id="__span-67-121"><a id="__codelineno-67-121" name="__codelineno-67-121" href="#__codelineno-67-121"></a><span class="w">  </span><span class="nb">environment</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-122"><a id="__codelineno-67-122" name="__codelineno-67-122" href="#__codelineno-67-122"></a><span class="w">    </span><span class="nb">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-123"><a id="__codelineno-67-123" name="__codelineno-67-123" href="#__codelineno-67-123"></a><span class="w">      </span><span class="na">ALLOWED_ORIGIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.website_domain</span>
</span><span id="__span-67-124"><a id="__codelineno-67-124" name="__codelineno-67-124" href="#__codelineno-67-124"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-67-125"><a id="__codelineno-67-125" name="__codelineno-67-125" href="#__codelineno-67-125"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-67-126"><a id="__codelineno-67-126" name="__codelineno-67-126" href="#__codelineno-67-126"></a>
</span><span id="__span-67-127"><a id="__codelineno-67-127" name="__codelineno-67-127" href="#__codelineno-67-127"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-128"><a id="__codelineno-67-128" name="__codelineno-67-128" href="#__codelineno-67-128"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Options Handler Lambda&quot;</span>
</span><span id="__span-67-129"><a id="__codelineno-67-129" name="__codelineno-67-129" href="#__codelineno-67-129"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-67-130"><a id="__codelineno-67-130" name="__codelineno-67-130" href="#__codelineno-67-130"></a><span class="w">    </span><span class="na">Project</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cloud Resume Challenge&quot;</span>
</span><span id="__span-67-131"><a id="__codelineno-67-131" name="__codelineno-67-131" href="#__codelineno-67-131"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-67-132"><a id="__codelineno-67-132" name="__codelineno-67-132" href="#__codelineno-67-132"></a><span class="p">}</span>
</span></code></pre></div>
<p>I've implemented several security and operational improvements:</p>
<ul>
<li>Least privilege IAM policies</li>
<li>X-Ray tracing for performance monitoring</li>
<li>Proper CORS handling with a dedicated OPTIONS handler</li>
<li>CloudWatch log group with retention policy</li>
<li>Privacy-enhancing IP address hashing</li>
</ul>
<h4 id="3-api-gateway-for-exposing-the-lambda-function"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#3-api-gateway-for-exposing-the-lambda-function">3. API Gateway for Exposing the Lambda Function 🔗</a></h4>
<p>Create a file at <code>modules/backend/api_gateway.tf</code>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="c1"># Create the API Gateway REST API</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_rest_api&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-visitor-counter-${var.environment}&quot;</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;API for the resume visitor counter&quot;</span>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a>
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="w">  </span><span class="nb">endpoint_configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="w">    </span><span class="na">types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;REGIONAL&quot;</span><span class="p">]</span>
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a>
</span><span id="__span-68-10"><a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-11"><a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Visitor Counter API&quot;</span>
</span><span id="__span-68-12"><a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-68-13"><a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a><span class="w">    </span><span class="na">Project</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cloud Resume Challenge&quot;</span>
</span><span id="__span-68-14"><a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-68-15"><a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a><span class="p">}</span>
</span><span id="__span-68-16"><a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a>
</span><span id="__span-68-17"><a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a><span class="c1"># Create a resource for the API</span>
</span><span id="__span-68-18"><a id="__codelineno-68-18" name="__codelineno-68-18" href="#__codelineno-68-18"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_resource&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-19"><a id="__codelineno-68-19" name="__codelineno-68-19" href="#__codelineno-68-19"></a><span class="w">  </span><span class="na">rest_api_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-68-20"><a id="__codelineno-68-20" name="__codelineno-68-20" href="#__codelineno-68-20"></a><span class="w">  </span><span class="na">parent_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.root_resource_id</span>
</span><span id="__span-68-21"><a id="__codelineno-68-21" name="__codelineno-68-21" href="#__codelineno-68-21"></a><span class="w">  </span><span class="na">path_part</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;count&quot;</span>
</span><span id="__span-68-22"><a id="__codelineno-68-22" name="__codelineno-68-22" href="#__codelineno-68-22"></a><span class="p">}</span>
</span><span id="__span-68-23"><a id="__codelineno-68-23" name="__codelineno-68-23" href="#__codelineno-68-23"></a>
</span><span id="__span-68-24"><a id="__codelineno-68-24" name="__codelineno-68-24" href="#__codelineno-68-24"></a><span class="c1"># Create a GET method for the API</span>
</span><span id="__span-68-25"><a id="__codelineno-68-25" name="__codelineno-68-25" href="#__codelineno-68-25"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_method&quot;</span><span class="w"> </span><span class="nv">&quot;get&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-26"><a id="__codelineno-68-26" name="__codelineno-68-26" href="#__codelineno-68-26"></a><span class="w">  </span><span class="na">rest_api_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-68-27"><a id="__codelineno-68-27" name="__codelineno-68-27" href="#__codelineno-68-27"></a><span class="w">  </span><span class="na">resource_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_resource.visitor_counter.id</span>
</span><span id="__span-68-28"><a id="__codelineno-68-28" name="__codelineno-68-28" href="#__codelineno-68-28"></a><span class="w">  </span><span class="na">http_method</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;GET&quot;</span>
</span><span id="__span-68-29"><a id="__codelineno-68-29" name="__codelineno-68-29" href="#__codelineno-68-29"></a><span class="w">  </span><span class="na">authorization_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;NONE&quot;</span>
</span><span id="__span-68-30"><a id="__codelineno-68-30" name="__codelineno-68-30" href="#__codelineno-68-30"></a>
</span><span id="__span-68-31"><a id="__codelineno-68-31" name="__codelineno-68-31" href="#__codelineno-68-31"></a><span class="c1">  # Add API key requirement if needed</span>
</span><span id="__span-68-32"><a id="__codelineno-68-32" name="__codelineno-68-32" href="#__codelineno-68-32"></a><span class="c1">  # api_key_required = true</span>
</span><span id="__span-68-33"><a id="__codelineno-68-33" name="__codelineno-68-33" href="#__codelineno-68-33"></a><span class="p">}</span>
</span><span id="__span-68-34"><a id="__codelineno-68-34" name="__codelineno-68-34" href="#__codelineno-68-34"></a>
</span><span id="__span-68-35"><a id="__codelineno-68-35" name="__codelineno-68-35" href="#__codelineno-68-35"></a><span class="c1"># Create an OPTIONS method for the API (for CORS)</span>
</span><span id="__span-68-36"><a id="__codelineno-68-36" name="__codelineno-68-36" href="#__codelineno-68-36"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_method&quot;</span><span class="w"> </span><span class="nv">&quot;options&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-37"><a id="__codelineno-68-37" name="__codelineno-68-37" href="#__codelineno-68-37"></a><span class="w">  </span><span class="na">rest_api_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-68-38"><a id="__codelineno-68-38" name="__codelineno-68-38" href="#__codelineno-68-38"></a><span class="w">  </span><span class="na">resource_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_resource.visitor_counter.id</span>
</span><span id="__span-68-39"><a id="__codelineno-68-39" name="__codelineno-68-39" href="#__codelineno-68-39"></a><span class="w">  </span><span class="na">http_method</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;OPTIONS&quot;</span>
</span><span id="__span-68-40"><a id="__codelineno-68-40" name="__codelineno-68-40" href="#__codelineno-68-40"></a><span class="w">  </span><span class="na">authorization_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;NONE&quot;</span>
</span><span id="__span-68-41"><a id="__codelineno-68-41" name="__codelineno-68-41" href="#__codelineno-68-41"></a><span class="p">}</span>
</span><span id="__span-68-42"><a id="__codelineno-68-42" name="__codelineno-68-42" href="#__codelineno-68-42"></a>
</span><span id="__span-68-43"><a id="__codelineno-68-43" name="__codelineno-68-43" href="#__codelineno-68-43"></a><span class="c1"># Set up the GET method integration with Lambda</span>
</span><span id="__span-68-44"><a id="__codelineno-68-44" name="__codelineno-68-44" href="#__codelineno-68-44"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_integration&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_get&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-45"><a id="__codelineno-68-45" name="__codelineno-68-45" href="#__codelineno-68-45"></a><span class="w">  </span><span class="na">rest_api_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-68-46"><a id="__codelineno-68-46" name="__codelineno-68-46" href="#__codelineno-68-46"></a><span class="w">  </span><span class="na">resource_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_resource.visitor_counter.id</span>
</span><span id="__span-68-47"><a id="__codelineno-68-47" name="__codelineno-68-47" href="#__codelineno-68-47"></a><span class="w">  </span><span class="na">http_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_method.get.http_method</span>
</span><span id="__span-68-48"><a id="__codelineno-68-48" name="__codelineno-68-48" href="#__codelineno-68-48"></a>
</span><span id="__span-68-49"><a id="__codelineno-68-49" name="__codelineno-68-49" href="#__codelineno-68-49"></a><span class="w">  </span><span class="na">integration_http_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span>
</span><span id="__span-68-50"><a id="__codelineno-68-50" name="__codelineno-68-50" href="#__codelineno-68-50"></a><span class="w">  </span><span class="na">type</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWS_PROXY&quot;</span>
</span><span id="__span-68-51"><a id="__codelineno-68-51" name="__codelineno-68-51" href="#__codelineno-68-51"></a><span class="w">  </span><span class="na">uri</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.visitor_counter.invoke_arn</span>
</span><span id="__span-68-52"><a id="__codelineno-68-52" name="__codelineno-68-52" href="#__codelineno-68-52"></a><span class="p">}</span>
</span><span id="__span-68-53"><a id="__codelineno-68-53" name="__codelineno-68-53" href="#__codelineno-68-53"></a>
</span><span id="__span-68-54"><a id="__codelineno-68-54" name="__codelineno-68-54" href="#__codelineno-68-54"></a><span class="c1"># Set up the OPTIONS method integration with Lambda</span>
</span><span id="__span-68-55"><a id="__codelineno-68-55" name="__codelineno-68-55" href="#__codelineno-68-55"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_integration&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_options&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-56"><a id="__codelineno-68-56" name="__codelineno-68-56" href="#__codelineno-68-56"></a><span class="w">  </span><span class="na">rest_api_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-68-57"><a id="__codelineno-68-57" name="__codelineno-68-57" href="#__codelineno-68-57"></a><span class="w">  </span><span class="na">resource_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_resource.visitor_counter.id</span>
</span><span id="__span-68-58"><a id="__codelineno-68-58" name="__codelineno-68-58" href="#__codelineno-68-58"></a><span class="w">  </span><span class="na">http_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_method.options.http_method</span>
</span><span id="__span-68-59"><a id="__codelineno-68-59" name="__codelineno-68-59" href="#__codelineno-68-59"></a>
</span><span id="__span-68-60"><a id="__codelineno-68-60" name="__codelineno-68-60" href="#__codelineno-68-60"></a><span class="w">  </span><span class="na">integration_http_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span>
</span><span id="__span-68-61"><a id="__codelineno-68-61" name="__codelineno-68-61" href="#__codelineno-68-61"></a><span class="w">  </span><span class="na">type</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWS_PROXY&quot;</span>
</span><span id="__span-68-62"><a id="__codelineno-68-62" name="__codelineno-68-62" href="#__codelineno-68-62"></a><span class="w">  </span><span class="na">uri</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.options_handler.invoke_arn</span>
</span><span id="__span-68-63"><a id="__codelineno-68-63" name="__codelineno-68-63" href="#__codelineno-68-63"></a><span class="p">}</span>
</span><span id="__span-68-64"><a id="__codelineno-68-64" name="__codelineno-68-64" href="#__codelineno-68-64"></a>
</span><span id="__span-68-65"><a id="__codelineno-68-65" name="__codelineno-68-65" href="#__codelineno-68-65"></a><span class="c1"># Create a deployment for the API</span>
</span><span id="__span-68-66"><a id="__codelineno-68-66" name="__codelineno-68-66" href="#__codelineno-68-66"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_deployment&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-67"><a id="__codelineno-68-67" name="__codelineno-68-67" href="#__codelineno-68-67"></a><span class="w">  </span><span class="na">depends_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-68-68"><a id="__codelineno-68-68" name="__codelineno-68-68" href="#__codelineno-68-68"></a><span class="w">    </span><span class="nv">aws_api_gateway_integration.lambda_get</span><span class="p">,</span>
</span><span id="__span-68-69"><a id="__codelineno-68-69" name="__codelineno-68-69" href="#__codelineno-68-69"></a><span class="w">    </span><span class="nv">aws_api_gateway_integration.lambda_options</span>
</span><span id="__span-68-70"><a id="__codelineno-68-70" name="__codelineno-68-70" href="#__codelineno-68-70"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-68-71"><a id="__codelineno-68-71" name="__codelineno-68-71" href="#__codelineno-68-71"></a>
</span><span id="__span-68-72"><a id="__codelineno-68-72" name="__codelineno-68-72" href="#__codelineno-68-72"></a><span class="w">  </span><span class="na">rest_api_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-68-73"><a id="__codelineno-68-73" name="__codelineno-68-73" href="#__codelineno-68-73"></a><span class="w">  </span><span class="na">stage_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-68-74"><a id="__codelineno-68-74" name="__codelineno-68-74" href="#__codelineno-68-74"></a>
</span><span id="__span-68-75"><a id="__codelineno-68-75" name="__codelineno-68-75" href="#__codelineno-68-75"></a><span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-76"><a id="__codelineno-68-76" name="__codelineno-68-76" href="#__codelineno-68-76"></a><span class="w">    </span><span class="na">create_before_destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-68-77"><a id="__codelineno-68-77" name="__codelineno-68-77" href="#__codelineno-68-77"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-68-78"><a id="__codelineno-68-78" name="__codelineno-68-78" href="#__codelineno-68-78"></a><span class="p">}</span>
</span><span id="__span-68-79"><a id="__codelineno-68-79" name="__codelineno-68-79" href="#__codelineno-68-79"></a>
</span><span id="__span-68-80"><a id="__codelineno-68-80" name="__codelineno-68-80" href="#__codelineno-68-80"></a><span class="c1"># Add permission for API Gateway to invoke the Lambda function</span>
</span><span id="__span-68-81"><a id="__codelineno-68-81" name="__codelineno-68-81" href="#__codelineno-68-81"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_permission&quot;</span><span class="w"> </span><span class="nv">&quot;api_gateway_lambda&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-82"><a id="__codelineno-68-82" name="__codelineno-68-82" href="#__codelineno-68-82"></a><span class="w">  </span><span class="na">statement_id</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AllowAPIGatewayInvoke&quot;</span>
</span><span id="__span-68-83"><a id="__codelineno-68-83" name="__codelineno-68-83" href="#__codelineno-68-83"></a><span class="w">  </span><span class="na">action</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda:InvokeFunction&quot;</span>
</span><span id="__span-68-84"><a id="__codelineno-68-84" name="__codelineno-68-84" href="#__codelineno-68-84"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.visitor_counter.function_name</span>
</span><span id="__span-68-85"><a id="__codelineno-68-85" name="__codelineno-68-85" href="#__codelineno-68-85"></a><span class="w">  </span><span class="na">principal</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;apigateway.amazonaws.com&quot;</span>
</span><span id="__span-68-86"><a id="__codelineno-68-86" name="__codelineno-68-86" href="#__codelineno-68-86"></a>
</span><span id="__span-68-87"><a id="__codelineno-68-87" name="__codelineno-68-87" href="#__codelineno-68-87"></a><span class="c1">  # The /* part allows invocation from any stage, method and resource path</span>
</span><span id="__span-68-88"><a id="__codelineno-68-88" name="__codelineno-68-88" href="#__codelineno-68-88"></a><span class="c1">  # within API Gateway</span>
</span><span id="__span-68-89"><a id="__codelineno-68-89" name="__codelineno-68-89" href="#__codelineno-68-89"></a><span class="w">  </span><span class="na">source_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${aws_api_gateway_rest_api.visitor_counter.execution_arn}/*/${aws_api_gateway_method.get.http_method}${aws_api_gateway_resource.visitor_counter.path}&quot;</span>
</span><span id="__span-68-90"><a id="__codelineno-68-90" name="__codelineno-68-90" href="#__codelineno-68-90"></a><span class="p">}</span>
</span><span id="__span-68-91"><a id="__codelineno-68-91" name="__codelineno-68-91" href="#__codelineno-68-91"></a>
</span><span id="__span-68-92"><a id="__codelineno-68-92" name="__codelineno-68-92" href="#__codelineno-68-92"></a><span class="c1"># Add permission for API Gateway to invoke the OPTIONS Lambda function</span>
</span><span id="__span-68-93"><a id="__codelineno-68-93" name="__codelineno-68-93" href="#__codelineno-68-93"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_permission&quot;</span><span class="w"> </span><span class="nv">&quot;api_gateway_options_lambda&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-94"><a id="__codelineno-68-94" name="__codelineno-68-94" href="#__codelineno-68-94"></a><span class="w">  </span><span class="na">statement_id</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AllowAPIGatewayInvokeOptions&quot;</span>
</span><span id="__span-68-95"><a id="__codelineno-68-95" name="__codelineno-68-95" href="#__codelineno-68-95"></a><span class="w">  </span><span class="na">action</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda:InvokeFunction&quot;</span>
</span><span id="__span-68-96"><a id="__codelineno-68-96" name="__codelineno-68-96" href="#__codelineno-68-96"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.options_handler.function_name</span>
</span><span id="__span-68-97"><a id="__codelineno-68-97" name="__codelineno-68-97" href="#__codelineno-68-97"></a><span class="w">  </span><span class="na">principal</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;apigateway.amazonaws.com&quot;</span>
</span><span id="__span-68-98"><a id="__codelineno-68-98" name="__codelineno-68-98" href="#__codelineno-68-98"></a>
</span><span id="__span-68-99"><a id="__codelineno-68-99" name="__codelineno-68-99" href="#__codelineno-68-99"></a><span class="w">  </span><span class="na">source_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${aws_api_gateway_rest_api.visitor_counter.execution_arn}/*/${aws_api_gateway_method.options.http_method}${aws_api_gateway_resource.visitor_counter.path}&quot;</span>
</span><span id="__span-68-100"><a id="__codelineno-68-100" name="__codelineno-68-100" href="#__codelineno-68-100"></a><span class="p">}</span>
</span><span id="__span-68-101"><a id="__codelineno-68-101" name="__codelineno-68-101" href="#__codelineno-68-101"></a>
</span><span id="__span-68-102"><a id="__codelineno-68-102" name="__codelineno-68-102" href="#__codelineno-68-102"></a><span class="c1"># Enable CloudWatch logging for API Gateway</span>
</span><span id="__span-68-103"><a id="__codelineno-68-103" name="__codelineno-68-103" href="#__codelineno-68-103"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_account&quot;</span><span class="w"> </span><span class="nv">&quot;main&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-104"><a id="__codelineno-68-104" name="__codelineno-68-104" href="#__codelineno-68-104"></a><span class="w">  </span><span class="na">cloudwatch_role_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.api_gateway_cloudwatch.arn</span>
</span><span id="__span-68-105"><a id="__codelineno-68-105" name="__codelineno-68-105" href="#__codelineno-68-105"></a><span class="p">}</span>
</span><span id="__span-68-106"><a id="__codelineno-68-106" name="__codelineno-68-106" href="#__codelineno-68-106"></a>
</span><span id="__span-68-107"><a id="__codelineno-68-107" name="__codelineno-68-107" href="#__codelineno-68-107"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role&quot;</span><span class="w"> </span><span class="nv">&quot;api_gateway_cloudwatch&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-108"><a id="__codelineno-68-108" name="__codelineno-68-108" href="#__codelineno-68-108"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;api-gateway-cloudwatch-role-${var.environment}&quot;</span>
</span><span id="__span-68-109"><a id="__codelineno-68-109" name="__codelineno-68-109" href="#__codelineno-68-109"></a>
</span><span id="__span-68-110"><a id="__codelineno-68-110" name="__codelineno-68-110" href="#__codelineno-68-110"></a><span class="w">  </span><span class="na">assume_role_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-68-111"><a id="__codelineno-68-111" name="__codelineno-68-111" href="#__codelineno-68-111"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-68-112"><a id="__codelineno-68-112" name="__codelineno-68-112" href="#__codelineno-68-112"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-68-113"><a id="__codelineno-68-113" name="__codelineno-68-113" href="#__codelineno-68-113"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-68-114"><a id="__codelineno-68-114" name="__codelineno-68-114" href="#__codelineno-68-114"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span>
</span><span id="__span-68-115"><a id="__codelineno-68-115" name="__codelineno-68-115" href="#__codelineno-68-115"></a><span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-68-116"><a id="__codelineno-68-116" name="__codelineno-68-116" href="#__codelineno-68-116"></a><span class="w">        </span><span class="nb">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-117"><a id="__codelineno-68-117" name="__codelineno-68-117" href="#__codelineno-68-117"></a><span class="w">          </span><span class="na">Service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;apigateway.amazonaws.com&quot;</span>
</span><span id="__span-68-118"><a id="__codelineno-68-118" name="__codelineno-68-118" href="#__codelineno-68-118"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-68-119"><a id="__codelineno-68-119" name="__codelineno-68-119" href="#__codelineno-68-119"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-68-120"><a id="__codelineno-68-120" name="__codelineno-68-120" href="#__codelineno-68-120"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-68-121"><a id="__codelineno-68-121" name="__codelineno-68-121" href="#__codelineno-68-121"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-68-122"><a id="__codelineno-68-122" name="__codelineno-68-122" href="#__codelineno-68-122"></a><span class="p">}</span>
</span><span id="__span-68-123"><a id="__codelineno-68-123" name="__codelineno-68-123" href="#__codelineno-68-123"></a>
</span><span id="__span-68-124"><a id="__codelineno-68-124" name="__codelineno-68-124" href="#__codelineno-68-124"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role_policy_attachment&quot;</span><span class="w"> </span><span class="nv">&quot;api_gateway_cloudwatch&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-125"><a id="__codelineno-68-125" name="__codelineno-68-125" href="#__codelineno-68-125"></a><span class="w">  </span><span class="na">role</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.api_gateway_cloudwatch.name</span>
</span><span id="__span-68-126"><a id="__codelineno-68-126" name="__codelineno-68-126" href="#__codelineno-68-126"></a><span class="w">  </span><span class="na">policy_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;arn:aws:iam::aws:policy/service-role/AmazonAPIGatewayPushToCloudWatchLogs&quot;</span>
</span><span id="__span-68-127"><a id="__codelineno-68-127" name="__codelineno-68-127" href="#__codelineno-68-127"></a><span class="p">}</span>
</span><span id="__span-68-128"><a id="__codelineno-68-128" name="__codelineno-68-128" href="#__codelineno-68-128"></a>
</span><span id="__span-68-129"><a id="__codelineno-68-129" name="__codelineno-68-129" href="#__codelineno-68-129"></a><span class="c1"># Set up method settings for logging and throttling</span>
</span><span id="__span-68-130"><a id="__codelineno-68-130" name="__codelineno-68-130" href="#__codelineno-68-130"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_method_settings&quot;</span><span class="w"> </span><span class="nv">&quot;settings&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-131"><a id="__codelineno-68-131" name="__codelineno-68-131" href="#__codelineno-68-131"></a><span class="w">  </span><span class="na">rest_api_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-68-132"><a id="__codelineno-68-132" name="__codelineno-68-132" href="#__codelineno-68-132"></a><span class="w">  </span><span class="na">stage_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.stage_name</span>
</span><span id="__span-68-133"><a id="__codelineno-68-133" name="__codelineno-68-133" href="#__codelineno-68-133"></a><span class="w">  </span><span class="na">method_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*/*&quot;</span>
</span><span id="__span-68-134"><a id="__codelineno-68-134" name="__codelineno-68-134" href="#__codelineno-68-134"></a>
</span><span id="__span-68-135"><a id="__codelineno-68-135" name="__codelineno-68-135" href="#__codelineno-68-135"></a><span class="w">  </span><span class="nb">settings</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-136"><a id="__codelineno-68-136" name="__codelineno-68-136" href="#__codelineno-68-136"></a><span class="w">    </span><span class="na">metrics_enabled</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-68-137"><a id="__codelineno-68-137" name="__codelineno-68-137" href="#__codelineno-68-137"></a><span class="w">    </span><span class="na">logging_level</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;INFO&quot;</span>
</span><span id="__span-68-138"><a id="__codelineno-68-138" name="__codelineno-68-138" href="#__codelineno-68-138"></a><span class="w">    </span><span class="na">data_trace_enabled</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-68-139"><a id="__codelineno-68-139" name="__codelineno-68-139" href="#__codelineno-68-139"></a><span class="w">    </span><span class="na">throttling_rate_limit</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>
</span><span id="__span-68-140"><a id="__codelineno-68-140" name="__codelineno-68-140" href="#__codelineno-68-140"></a><span class="w">    </span><span class="na">throttling_burst_limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span>
</span><span id="__span-68-141"><a id="__codelineno-68-141" name="__codelineno-68-141" href="#__codelineno-68-141"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-68-142"><a id="__codelineno-68-142" name="__codelineno-68-142" href="#__codelineno-68-142"></a><span class="p">}</span>
</span><span id="__span-68-143"><a id="__codelineno-68-143" name="__codelineno-68-143" href="#__codelineno-68-143"></a>
</span><span id="__span-68-144"><a id="__codelineno-68-144" name="__codelineno-68-144" href="#__codelineno-68-144"></a><span class="c1"># Create a custom domain for the API</span>
</span><span id="__span-68-145"><a id="__codelineno-68-145" name="__codelineno-68-145" href="#__codelineno-68-145"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_domain_name&quot;</span><span class="w"> </span><span class="nv">&quot;api&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-146"><a id="__codelineno-68-146" name="__codelineno-68-146" href="#__codelineno-68-146"></a><span class="w">  </span><span class="na">domain_name</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;api.${var.domain_name}&quot;</span>
</span><span id="__span-68-147"><a id="__codelineno-68-147" name="__codelineno-68-147" href="#__codelineno-68-147"></a><span class="w">  </span><span class="na">regional_certificate_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.certificate_arn</span>
</span><span id="__span-68-148"><a id="__codelineno-68-148" name="__codelineno-68-148" href="#__codelineno-68-148"></a>
</span><span id="__span-68-149"><a id="__codelineno-68-149" name="__codelineno-68-149" href="#__codelineno-68-149"></a><span class="w">  </span><span class="nb">endpoint_configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-150"><a id="__codelineno-68-150" name="__codelineno-68-150" href="#__codelineno-68-150"></a><span class="w">    </span><span class="na">types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;REGIONAL&quot;</span><span class="p">]</span>
</span><span id="__span-68-151"><a id="__codelineno-68-151" name="__codelineno-68-151" href="#__codelineno-68-151"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-68-152"><a id="__codelineno-68-152" name="__codelineno-68-152" href="#__codelineno-68-152"></a>
</span><span id="__span-68-153"><a id="__codelineno-68-153" name="__codelineno-68-153" href="#__codelineno-68-153"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-154"><a id="__codelineno-68-154" name="__codelineno-68-154" href="#__codelineno-68-154"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume API Domain&quot;</span>
</span><span id="__span-68-155"><a id="__codelineno-68-155" name="__codelineno-68-155" href="#__codelineno-68-155"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-68-156"><a id="__codelineno-68-156" name="__codelineno-68-156" href="#__codelineno-68-156"></a><span class="w">    </span><span class="na">Project</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cloud Resume Challenge&quot;</span>
</span><span id="__span-68-157"><a id="__codelineno-68-157" name="__codelineno-68-157" href="#__codelineno-68-157"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-68-158"><a id="__codelineno-68-158" name="__codelineno-68-158" href="#__codelineno-68-158"></a><span class="p">}</span>
</span><span id="__span-68-159"><a id="__codelineno-68-159" name="__codelineno-68-159" href="#__codelineno-68-159"></a>
</span><span id="__span-68-160"><a id="__codelineno-68-160" name="__codelineno-68-160" href="#__codelineno-68-160"></a><span class="c1"># Create a base path mapping for the custom domain</span>
</span><span id="__span-68-161"><a id="__codelineno-68-161" name="__codelineno-68-161" href="#__codelineno-68-161"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_base_path_mapping&quot;</span><span class="w"> </span><span class="nv">&quot;api&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-162"><a id="__codelineno-68-162" name="__codelineno-68-162" href="#__codelineno-68-162"></a><span class="w">  </span><span class="na">api_id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-68-163"><a id="__codelineno-68-163" name="__codelineno-68-163" href="#__codelineno-68-163"></a><span class="w">  </span><span class="na">stage_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.stage_name</span>
</span><span id="__span-68-164"><a id="__codelineno-68-164" name="__codelineno-68-164" href="#__codelineno-68-164"></a><span class="w">  </span><span class="na">domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_domain_name.api.domain_name</span>
</span><span id="__span-68-165"><a id="__codelineno-68-165" name="__codelineno-68-165" href="#__codelineno-68-165"></a><span class="p">}</span>
</span><span id="__span-68-166"><a id="__codelineno-68-166" name="__codelineno-68-166" href="#__codelineno-68-166"></a>
</span><span id="__span-68-167"><a id="__codelineno-68-167" name="__codelineno-68-167" href="#__codelineno-68-167"></a><span class="c1"># Create a Route 53 record for the API domain</span>
</span><span id="__span-68-168"><a id="__codelineno-68-168" name="__codelineno-68-168" href="#__codelineno-68-168"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_record&quot;</span><span class="w"> </span><span class="nv">&quot;api&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-169"><a id="__codelineno-68-169" name="__codelineno-68-169" href="#__codelineno-68-169"></a><span class="w">  </span><span class="na">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_domain_name.api.domain_name</span>
</span><span id="__span-68-170"><a id="__codelineno-68-170" name="__codelineno-68-170" href="#__codelineno-68-170"></a><span class="w">  </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;A&quot;</span>
</span><span id="__span-68-171"><a id="__codelineno-68-171" name="__codelineno-68-171" href="#__codelineno-68-171"></a><span class="w">  </span><span class="na">zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.hosted_zone_id</span>
</span><span id="__span-68-172"><a id="__codelineno-68-172" name="__codelineno-68-172" href="#__codelineno-68-172"></a>
</span><span id="__span-68-173"><a id="__codelineno-68-173" name="__codelineno-68-173" href="#__codelineno-68-173"></a><span class="w">  </span><span class="nb">alias</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-174"><a id="__codelineno-68-174" name="__codelineno-68-174" href="#__codelineno-68-174"></a><span class="w">    </span><span class="na">name</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_domain_name.api.regional_domain_name</span>
</span><span id="__span-68-175"><a id="__codelineno-68-175" name="__codelineno-68-175" href="#__codelineno-68-175"></a><span class="w">    </span><span class="na">zone_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_domain_name.api.regional_zone_id</span>
</span><span id="__span-68-176"><a id="__codelineno-68-176" name="__codelineno-68-176" href="#__codelineno-68-176"></a><span class="w">    </span><span class="na">evaluate_target_health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-68-177"><a id="__codelineno-68-177" name="__codelineno-68-177" href="#__codelineno-68-177"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-68-178"><a id="__codelineno-68-178" name="__codelineno-68-178" href="#__codelineno-68-178"></a><span class="p">}</span>
</span></code></pre></div>
<p>The API Gateway configuration includes several enhancements:</p>
<ul>
<li>CloudWatch logging and metrics</li>
<li>Rate limiting and throttling to prevent abuse</li>
<li>Custom domain for a professional API endpoint</li>
<li>Proper Route 53 DNS configuration</li>
</ul>
<h4 id="4-variables-and-outputs"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#4-variables-and-outputs">4. Variables and Outputs 📝</a></h4>
<p>Create files at <code>modules/backend/variables.tf</code> and <code>modules/backend/outputs.tf</code>:</p>
<p><strong>variables.tf</strong>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;environment&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Deployment environment (e.g., dev, prod)&quot;</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="w">  </span><span class="na">default</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dev&quot;</span>
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="p">}</span>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;website_domain&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Domain of the resume website (for CORS)&quot;</span>
</span><span id="__span-69-9"><a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-69-10"><a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a><span class="p">}</span>
</span><span id="__span-69-11"><a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a>
</span><span id="__span-69-12"><a id="__codelineno-69-12" name="__codelineno-69-12" href="#__codelineno-69-12"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;domain_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-13"><a id="__codelineno-69-13" name="__codelineno-69-13" href="#__codelineno-69-13"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Base domain name for custom API endpoint&quot;</span>
</span><span id="__span-69-14"><a id="__codelineno-69-14" name="__codelineno-69-14" href="#__codelineno-69-14"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-69-15"><a id="__codelineno-69-15" name="__codelineno-69-15" href="#__codelineno-69-15"></a><span class="p">}</span>
</span><span id="__span-69-16"><a id="__codelineno-69-16" name="__codelineno-69-16" href="#__codelineno-69-16"></a>
</span><span id="__span-69-17"><a id="__codelineno-69-17" name="__codelineno-69-17" href="#__codelineno-69-17"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;hosted_zone_id&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-18"><a id="__codelineno-69-18" name="__codelineno-69-18" href="#__codelineno-69-18"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Route 53 hosted zone ID&quot;</span>
</span><span id="__span-69-19"><a id="__codelineno-69-19" name="__codelineno-69-19" href="#__codelineno-69-19"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-69-20"><a id="__codelineno-69-20" name="__codelineno-69-20" href="#__codelineno-69-20"></a><span class="p">}</span>
</span><span id="__span-69-21"><a id="__codelineno-69-21" name="__codelineno-69-21" href="#__codelineno-69-21"></a>
</span><span id="__span-69-22"><a id="__codelineno-69-22" name="__codelineno-69-22" href="#__codelineno-69-22"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;certificate_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-23"><a id="__codelineno-69-23" name="__codelineno-69-23" href="#__codelineno-69-23"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ARN of the ACM certificate for the API domain&quot;</span>
</span><span id="__span-69-24"><a id="__codelineno-69-24" name="__codelineno-69-24" href="#__codelineno-69-24"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-69-25"><a id="__codelineno-69-25" name="__codelineno-69-25" href="#__codelineno-69-25"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>outputs.tf</strong>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;api_endpoint&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Endpoint URL of the API Gateway&quot;</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.invoke_url</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="p">}</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;api_custom_domain&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Custom domain for the API&quot;</span>
</span><span id="__span-70-8"><a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_domain_name.api.domain_name</span>
</span><span id="__span-70-9"><a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a><span class="p">}</span>
</span><span id="__span-70-10"><a id="__codelineno-70-10" name="__codelineno-70-10" href="#__codelineno-70-10"></a>
</span><span id="__span-70-11"><a id="__codelineno-70-11" name="__codelineno-70-11" href="#__codelineno-70-11"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;dynamodb_table_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-12"><a id="__codelineno-70-12" name="__codelineno-70-12" href="#__codelineno-70-12"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Name of the DynamoDB table&quot;</span>
</span><span id="__span-70-13"><a id="__codelineno-70-13" name="__codelineno-70-13" href="#__codelineno-70-13"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_dynamodb_table.visitor_counter.name</span>
</span><span id="__span-70-14"><a id="__codelineno-70-14" name="__codelineno-70-14" href="#__codelineno-70-14"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="5-source-control-for-backend-code"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#5-source-control-for-backend-code">5. Source Control for Backend Code 📚</a></h4>
<p>An important aspect of the Cloud Resume Challenge is using source control. We'll create a GitHub repository for our backend code. Here's how I organize my repository:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>resume-backend/
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>├── .github/
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>│   └── workflows/
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>│       └── deploy.yml  # GitHub Actions workflow (we&#39;ll create this in next post)
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a>├── lambda/
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>│   └── visitor_counter.py
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a>├── terraform/
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a>│   ├── modules/
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a>│   │   ├── backend/
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a>│   │   │   ├── api_gateway.tf
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a>│   │   │   ├── dynamodb.tf
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a>│   │   │   ├── lambda.tf
</span><span id="__span-71-13"><a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a>│   │   │   ├── variables.tf
</span><span id="__span-71-14"><a id="__codelineno-71-14" name="__codelineno-71-14" href="#__codelineno-71-14"></a>│   │   │   └── outputs.tf
</span><span id="__span-71-15"><a id="__codelineno-71-15" name="__codelineno-71-15" href="#__codelineno-71-15"></a>│   ├── main.tf
</span><span id="__span-71-16"><a id="__codelineno-71-16" name="__codelineno-71-16" href="#__codelineno-71-16"></a>│   ├── variables.tf
</span><span id="__span-71-17"><a id="__codelineno-71-17" name="__codelineno-71-17" href="#__codelineno-71-17"></a>│   └── outputs.tf
</span><span id="__span-71-18"><a id="__codelineno-71-18" name="__codelineno-71-18" href="#__codelineno-71-18"></a>├── tests/
</span><span id="__span-71-19"><a id="__codelineno-71-19" name="__codelineno-71-19" href="#__codelineno-71-19"></a>│   └── test_visitor_counter.py  # Python unit tests
</span><span id="__span-71-20"><a id="__codelineno-71-20" name="__codelineno-71-20" href="#__codelineno-71-20"></a>└── README.md
</span></code></pre></div>
<h3 id="implementing-python-tests"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#implementing-python-tests">Implementing Python Tests 🧪</a></h3>
<p>For step 11 of the Cloud Resume Challenge, we need to include tests for our Python code. Create a file at <code>tests/test_visitor_counter.py</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">unittest.mock</span><span class="w"> </span><span class="kn">import</span> <span class="n">patch</span><span class="p">,</span> <span class="n">MagicMock</span>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a>
</span><span id="__span-72-7"><a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a><span class="c1"># Add lambda directory to the path so we can import the function</span>
</span><span id="__span-72-8"><a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">))</span>
</span><span id="__span-72-9"><a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a>
</span><span id="__span-72-10"><a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">visitor_counter</span>
</span><span id="__span-72-11"><a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a>
</span><span id="__span-72-12"><a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a><span class="k">class</span><span class="w"> </span><span class="nc">TestVisitorCounter</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
</span><span id="__span-72-13"><a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test cases for the visitor counter Lambda function.&quot;&quot;&quot;</span>
</span><span id="__span-72-14"><a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a>
</span><span id="__span-72-15"><a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a>    <span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;visitor_counter.table&#39;</span><span class="p">)</span>
</span><span id="__span-72-16"><a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_lambda_handler_success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_table</span><span class="p">):</span>
</span><span id="__span-72-17"><a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test successful execution of the lambda_handler function.&quot;&quot;&quot;</span>
</span><span id="__span-72-18"><a id="__codelineno-72-18" name="__codelineno-72-18" href="#__codelineno-72-18"></a>        <span class="c1"># Mock the DynamoDB responses</span>
</span><span id="__span-72-19"><a id="__codelineno-72-19" name="__codelineno-72-19" href="#__codelineno-72-19"></a>        <span class="n">mock_put_response</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
</span><span id="__span-72-20"><a id="__codelineno-72-20" name="__codelineno-72-20" href="#__codelineno-72-20"></a>        <span class="n">mock_update_response</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-72-21"><a id="__codelineno-72-21" name="__codelineno-72-21" href="#__codelineno-72-21"></a>            <span class="s1">&#39;Attributes&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-72-22"><a id="__codelineno-72-22" name="__codelineno-72-22" href="#__codelineno-72-22"></a>                <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">42</span>
</span><span id="__span-72-23"><a id="__codelineno-72-23" name="__codelineno-72-23" href="#__codelineno-72-23"></a>            <span class="p">}</span>
</span><span id="__span-72-24"><a id="__codelineno-72-24" name="__codelineno-72-24" href="#__codelineno-72-24"></a>        <span class="p">}</span>
</span><span id="__span-72-25"><a id="__codelineno-72-25" name="__codelineno-72-25" href="#__codelineno-72-25"></a>        <span class="n">mock_table</span><span class="o">.</span><span class="n">put_item</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock_put_response</span>
</span><span id="__span-72-26"><a id="__codelineno-72-26" name="__codelineno-72-26" href="#__codelineno-72-26"></a>        <span class="n">mock_table</span><span class="o">.</span><span class="n">update_item</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock_update_response</span>
</span><span id="__span-72-27"><a id="__codelineno-72-27" name="__codelineno-72-27" href="#__codelineno-72-27"></a>
</span><span id="__span-72-28"><a id="__codelineno-72-28" name="__codelineno-72-28" href="#__codelineno-72-28"></a>        <span class="c1"># Set required environment variables</span>
</span><span id="__span-72-29"><a id="__codelineno-72-29" name="__codelineno-72-29" href="#__codelineno-72-29"></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DYNAMODB_TABLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;test-table&#39;</span>
</span><span id="__span-72-30"><a id="__codelineno-72-30" name="__codelineno-72-30" href="#__codelineno-72-30"></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ALLOWED_ORIGIN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://example.com&#39;</span>
</span><span id="__span-72-31"><a id="__codelineno-72-31" name="__codelineno-72-31" href="#__codelineno-72-31"></a>
</span><span id="__span-72-32"><a id="__codelineno-72-32" name="__codelineno-72-32" href="#__codelineno-72-32"></a>        <span class="c1"># Create a test event</span>
</span><span id="__span-72-33"><a id="__codelineno-72-33" name="__codelineno-72-33" href="#__codelineno-72-33"></a>        <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-72-34"><a id="__codelineno-72-34" name="__codelineno-72-34" href="#__codelineno-72-34"></a>            <span class="s1">&#39;httpMethod&#39;</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span><span id="__span-72-35"><a id="__codelineno-72-35" name="__codelineno-72-35" href="#__codelineno-72-35"></a>            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;/count&#39;</span><span class="p">,</span>
</span><span id="__span-72-36"><a id="__codelineno-72-36" name="__codelineno-72-36" href="#__codelineno-72-36"></a>            <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-72-37"><a id="__codelineno-72-37" name="__codelineno-72-37" href="#__codelineno-72-37"></a>                <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;test-agent&#39;</span>
</span><span id="__span-72-38"><a id="__codelineno-72-38" name="__codelineno-72-38" href="#__codelineno-72-38"></a>            <span class="p">},</span>
</span><span id="__span-72-39"><a id="__codelineno-72-39" name="__codelineno-72-39" href="#__codelineno-72-39"></a>            <span class="s1">&#39;requestContext&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-72-40"><a id="__codelineno-72-40" name="__codelineno-72-40" href="#__codelineno-72-40"></a>                <span class="s1">&#39;identity&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-72-41"><a id="__codelineno-72-41" name="__codelineno-72-41" href="#__codelineno-72-41"></a>                    <span class="s1">&#39;sourceIp&#39;</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1&#39;</span>
</span><span id="__span-72-42"><a id="__codelineno-72-42" name="__codelineno-72-42" href="#__codelineno-72-42"></a>                <span class="p">}</span>
</span><span id="__span-72-43"><a id="__codelineno-72-43" name="__codelineno-72-43" href="#__codelineno-72-43"></a>            <span class="p">}</span>
</span><span id="__span-72-44"><a id="__codelineno-72-44" name="__codelineno-72-44" href="#__codelineno-72-44"></a>        <span class="p">}</span>
</span><span id="__span-72-45"><a id="__codelineno-72-45" name="__codelineno-72-45" href="#__codelineno-72-45"></a>
</span><span id="__span-72-46"><a id="__codelineno-72-46" name="__codelineno-72-46" href="#__codelineno-72-46"></a>        <span class="c1"># Call the function</span>
</span><span id="__span-72-47"><a id="__codelineno-72-47" name="__codelineno-72-47" href="#__codelineno-72-47"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">visitor_counter</span><span class="o">.</span><span class="n">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-72-48"><a id="__codelineno-72-48" name="__codelineno-72-48" href="#__codelineno-72-48"></a>
</span><span id="__span-72-49"><a id="__codelineno-72-49" name="__codelineno-72-49" href="#__codelineno-72-49"></a>        <span class="c1"># Assert response is correct</span>
</span><span id="__span-72-50"><a id="__codelineno-72-50" name="__codelineno-72-50" href="#__codelineno-72-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;statusCode&#39;</span><span class="p">],</span> <span class="mi">200</span><span class="p">)</span>
</span><span id="__span-72-51"><a id="__codelineno-72-51" name="__codelineno-72-51" href="#__codelineno-72-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">][</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">],</span> <span class="s1">&#39;application/json&#39;</span><span class="p">)</span>
</span><span id="__span-72-52"><a id="__codelineno-72-52" name="__codelineno-72-52" href="#__codelineno-72-52"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">][</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">],</span> <span class="s1">&#39;https://example.com&#39;</span><span class="p">)</span>
</span><span id="__span-72-53"><a id="__codelineno-72-53" name="__codelineno-72-53" href="#__codelineno-72-53"></a>
</span><span id="__span-72-54"><a id="__codelineno-72-54" name="__codelineno-72-54" href="#__codelineno-72-54"></a>        <span class="c1"># Parse the body and check the count</span>
</span><span id="__span-72-55"><a id="__codelineno-72-55" name="__codelineno-72-55" href="#__codelineno-72-55"></a>        <span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">])</span>
</span><span id="__span-72-56"><a id="__codelineno-72-56" name="__codelineno-72-56" href="#__codelineno-72-56"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">],</span> <span class="mi">42</span><span class="p">)</span>
</span><span id="__span-72-57"><a id="__codelineno-72-57" name="__codelineno-72-57" href="#__codelineno-72-57"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">],</span> <span class="s1">&#39;Visitor count updated successfully&#39;</span><span class="p">)</span>
</span><span id="__span-72-58"><a id="__codelineno-72-58" name="__codelineno-72-58" href="#__codelineno-72-58"></a>
</span><span id="__span-72-59"><a id="__codelineno-72-59" name="__codelineno-72-59" href="#__codelineno-72-59"></a>        <span class="c1"># Verify that DynamoDB was called correctly</span>
</span><span id="__span-72-60"><a id="__codelineno-72-60" name="__codelineno-72-60" href="#__codelineno-72-60"></a>        <span class="n">mock_table</span><span class="o">.</span><span class="n">put_item</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
</span><span id="__span-72-61"><a id="__codelineno-72-61" name="__codelineno-72-61" href="#__codelineno-72-61"></a>        <span class="n">mock_table</span><span class="o">.</span><span class="n">update_item</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span>
</span><span id="__span-72-62"><a id="__codelineno-72-62" name="__codelineno-72-62" href="#__codelineno-72-62"></a>            <span class="n">Key</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;visit_id&#39;</span><span class="p">:</span> <span class="s1">&#39;total&#39;</span><span class="p">},</span>
</span><span id="__span-72-63"><a id="__codelineno-72-63" name="__codelineno-72-63" href="#__codelineno-72-63"></a>            <span class="n">UpdateExpression</span><span class="o">=</span><span class="s1">&#39;ADD #count :incr&#39;</span><span class="p">,</span>
</span><span id="__span-72-64"><a id="__codelineno-72-64" name="__codelineno-72-64" href="#__codelineno-72-64"></a>            <span class="n">ExpressionAttributeNames</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;#count&#39;</span><span class="p">:</span> <span class="s1">&#39;count&#39;</span><span class="p">},</span>
</span><span id="__span-72-65"><a id="__codelineno-72-65" name="__codelineno-72-65" href="#__codelineno-72-65"></a>            <span class="n">ExpressionAttributeValues</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;:incr&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
</span><span id="__span-72-66"><a id="__codelineno-72-66" name="__codelineno-72-66" href="#__codelineno-72-66"></a>            <span class="n">ReturnValues</span><span class="o">=</span><span class="s1">&#39;UPDATED_NEW&#39;</span>
</span><span id="__span-72-67"><a id="__codelineno-72-67" name="__codelineno-72-67" href="#__codelineno-72-67"></a>        <span class="p">)</span>
</span><span id="__span-72-68"><a id="__codelineno-72-68" name="__codelineno-72-68" href="#__codelineno-72-68"></a>
</span><span id="__span-72-69"><a id="__codelineno-72-69" name="__codelineno-72-69" href="#__codelineno-72-69"></a>    <span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;visitor_counter.table&#39;</span><span class="p">)</span>
</span><span id="__span-72-70"><a id="__codelineno-72-70" name="__codelineno-72-70" href="#__codelineno-72-70"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_lambda_handler_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_table</span><span class="p">):</span>
</span><span id="__span-72-71"><a id="__codelineno-72-71" name="__codelineno-72-71" href="#__codelineno-72-71"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test error handling in the lambda_handler function.&quot;&quot;&quot;</span>
</span><span id="__span-72-72"><a id="__codelineno-72-72" name="__codelineno-72-72" href="#__codelineno-72-72"></a>        <span class="c1"># Simulate a DynamoDB error</span>
</span><span id="__span-72-73"><a id="__codelineno-72-73" name="__codelineno-72-73" href="#__codelineno-72-73"></a>        <span class="n">mock_table</span><span class="o">.</span><span class="n">update_item</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Test error&quot;</span><span class="p">)</span>
</span><span id="__span-72-74"><a id="__codelineno-72-74" name="__codelineno-72-74" href="#__codelineno-72-74"></a>
</span><span id="__span-72-75"><a id="__codelineno-72-75" name="__codelineno-72-75" href="#__codelineno-72-75"></a>        <span class="c1"># Set required environment variables</span>
</span><span id="__span-72-76"><a id="__codelineno-72-76" name="__codelineno-72-76" href="#__codelineno-72-76"></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DYNAMODB_TABLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;test-table&#39;</span>
</span><span id="__span-72-77"><a id="__codelineno-72-77" name="__codelineno-72-77" href="#__codelineno-72-77"></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ALLOWED_ORIGIN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://example.com&#39;</span>
</span><span id="__span-72-78"><a id="__codelineno-72-78" name="__codelineno-72-78" href="#__codelineno-72-78"></a>
</span><span id="__span-72-79"><a id="__codelineno-72-79" name="__codelineno-72-79" href="#__codelineno-72-79"></a>        <span class="c1"># Create a test event</span>
</span><span id="__span-72-80"><a id="__codelineno-72-80" name="__codelineno-72-80" href="#__codelineno-72-80"></a>        <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-72-81"><a id="__codelineno-72-81" name="__codelineno-72-81" href="#__codelineno-72-81"></a>            <span class="s1">&#39;httpMethod&#39;</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span><span id="__span-72-82"><a id="__codelineno-72-82" name="__codelineno-72-82" href="#__codelineno-72-82"></a>            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;/count&#39;</span><span class="p">,</span>
</span><span id="__span-72-83"><a id="__codelineno-72-83" name="__codelineno-72-83" href="#__codelineno-72-83"></a>            <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-72-84"><a id="__codelineno-72-84" name="__codelineno-72-84" href="#__codelineno-72-84"></a>                <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;test-agent&#39;</span>
</span><span id="__span-72-85"><a id="__codelineno-72-85" name="__codelineno-72-85" href="#__codelineno-72-85"></a>            <span class="p">},</span>
</span><span id="__span-72-86"><a id="__codelineno-72-86" name="__codelineno-72-86" href="#__codelineno-72-86"></a>            <span class="s1">&#39;requestContext&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-72-87"><a id="__codelineno-72-87" name="__codelineno-72-87" href="#__codelineno-72-87"></a>                <span class="s1">&#39;identity&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-72-88"><a id="__codelineno-72-88" name="__codelineno-72-88" href="#__codelineno-72-88"></a>                    <span class="s1">&#39;sourceIp&#39;</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1&#39;</span>
</span><span id="__span-72-89"><a id="__codelineno-72-89" name="__codelineno-72-89" href="#__codelineno-72-89"></a>                <span class="p">}</span>
</span><span id="__span-72-90"><a id="__codelineno-72-90" name="__codelineno-72-90" href="#__codelineno-72-90"></a>            <span class="p">}</span>
</span><span id="__span-72-91"><a id="__codelineno-72-91" name="__codelineno-72-91" href="#__codelineno-72-91"></a>        <span class="p">}</span>
</span><span id="__span-72-92"><a id="__codelineno-72-92" name="__codelineno-72-92" href="#__codelineno-72-92"></a>
</span><span id="__span-72-93"><a id="__codelineno-72-93" name="__codelineno-72-93" href="#__codelineno-72-93"></a>        <span class="c1"># Call the function</span>
</span><span id="__span-72-94"><a id="__codelineno-72-94" name="__codelineno-72-94" href="#__codelineno-72-94"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">visitor_counter</span><span class="o">.</span><span class="n">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-72-95"><a id="__codelineno-72-95" name="__codelineno-72-95" href="#__codelineno-72-95"></a>
</span><span id="__span-72-96"><a id="__codelineno-72-96" name="__codelineno-72-96" href="#__codelineno-72-96"></a>        <span class="c1"># Assert response indicates an error</span>
</span><span id="__span-72-97"><a id="__codelineno-72-97" name="__codelineno-72-97" href="#__codelineno-72-97"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;statusCode&#39;</span><span class="p">],</span> <span class="mi">500</span><span class="p">)</span>
</span><span id="__span-72-98"><a id="__codelineno-72-98" name="__codelineno-72-98" href="#__codelineno-72-98"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">][</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">],</span> <span class="s1">&#39;application/json&#39;</span><span class="p">)</span>
</span><span id="__span-72-99"><a id="__codelineno-72-99" name="__codelineno-72-99" href="#__codelineno-72-99"></a>
</span><span id="__span-72-100"><a id="__codelineno-72-100" name="__codelineno-72-100" href="#__codelineno-72-100"></a>        <span class="c1"># Parse the body and check the error message</span>
</span><span id="__span-72-101"><a id="__codelineno-72-101" name="__codelineno-72-101" href="#__codelineno-72-101"></a>        <span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">])</span>
</span><span id="__span-72-102"><a id="__codelineno-72-102" name="__codelineno-72-102" href="#__codelineno-72-102"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
</span><span id="__span-72-103"><a id="__codelineno-72-103" name="__codelineno-72-103" href="#__codelineno-72-103"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
</span><span id="__span-72-104"><a id="__codelineno-72-104" name="__codelineno-72-104" href="#__codelineno-72-104"></a>
</span><span id="__span-72-105"><a id="__codelineno-72-105" name="__codelineno-72-105" href="#__codelineno-72-105"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_options_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-72-106"><a id="__codelineno-72-106" name="__codelineno-72-106" href="#__codelineno-72-106"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the OPTIONS handler for CORS support.&quot;&quot;&quot;</span>
</span><span id="__span-72-107"><a id="__codelineno-72-107" name="__codelineno-72-107" href="#__codelineno-72-107"></a>        <span class="c1"># Set required environment variables</span>
</span><span id="__span-72-108"><a id="__codelineno-72-108" name="__codelineno-72-108" href="#__codelineno-72-108"></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ALLOWED_ORIGIN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://example.com&#39;</span>
</span><span id="__span-72-109"><a id="__codelineno-72-109" name="__codelineno-72-109" href="#__codelineno-72-109"></a>
</span><span id="__span-72-110"><a id="__codelineno-72-110" name="__codelineno-72-110" href="#__codelineno-72-110"></a>        <span class="c1"># Create a test event</span>
</span><span id="__span-72-111"><a id="__codelineno-72-111" name="__codelineno-72-111" href="#__codelineno-72-111"></a>        <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-72-112"><a id="__codelineno-72-112" name="__codelineno-72-112" href="#__codelineno-72-112"></a>            <span class="s1">&#39;httpMethod&#39;</span><span class="p">:</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">,</span>
</span><span id="__span-72-113"><a id="__codelineno-72-113" name="__codelineno-72-113" href="#__codelineno-72-113"></a>            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;/count&#39;</span><span class="p">,</span>
</span><span id="__span-72-114"><a id="__codelineno-72-114" name="__codelineno-72-114" href="#__codelineno-72-114"></a>            <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-72-115"><a id="__codelineno-72-115" name="__codelineno-72-115" href="#__codelineno-72-115"></a>                <span class="s1">&#39;Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;https://example.com&#39;</span>
</span><span id="__span-72-116"><a id="__codelineno-72-116" name="__codelineno-72-116" href="#__codelineno-72-116"></a>            <span class="p">}</span>
</span><span id="__span-72-117"><a id="__codelineno-72-117" name="__codelineno-72-117" href="#__codelineno-72-117"></a>        <span class="p">}</span>
</span><span id="__span-72-118"><a id="__codelineno-72-118" name="__codelineno-72-118" href="#__codelineno-72-118"></a>
</span><span id="__span-72-119"><a id="__codelineno-72-119" name="__codelineno-72-119" href="#__codelineno-72-119"></a>        <span class="c1"># Call the function</span>
</span><span id="__span-72-120"><a id="__codelineno-72-120" name="__codelineno-72-120" href="#__codelineno-72-120"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">visitor_counter</span><span class="o">.</span><span class="n">options_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-72-121"><a id="__codelineno-72-121" name="__codelineno-72-121" href="#__codelineno-72-121"></a>
</span><span id="__span-72-122"><a id="__codelineno-72-122" name="__codelineno-72-122" href="#__codelineno-72-122"></a>        <span class="c1"># Assert response is correct for OPTIONS</span>
</span><span id="__span-72-123"><a id="__codelineno-72-123" name="__codelineno-72-123" href="#__codelineno-72-123"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;statusCode&#39;</span><span class="p">],</span> <span class="mi">200</span><span class="p">)</span>
</span><span id="__span-72-124"><a id="__codelineno-72-124" name="__codelineno-72-124" href="#__codelineno-72-124"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">][</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">],</span> <span class="s1">&#39;https://example.com&#39;</span><span class="p">)</span>
</span><span id="__span-72-125"><a id="__codelineno-72-125" name="__codelineno-72-125" href="#__codelineno-72-125"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">][</span><span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">],</span> <span class="s1">&#39;GET, OPTIONS&#39;</span><span class="p">)</span>
</span><span id="__span-72-126"><a id="__codelineno-72-126" name="__codelineno-72-126" href="#__codelineno-72-126"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">][</span><span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">],</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">)</span>
</span><span id="__span-72-127"><a id="__codelineno-72-127" name="__codelineno-72-127" href="#__codelineno-72-127"></a>
</span><span id="__span-72-128"><a id="__codelineno-72-128" name="__codelineno-72-128" href="#__codelineno-72-128"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span id="__span-72-129"><a id="__codelineno-72-129" name="__codelineno-72-129" href="#__codelineno-72-129"></a>    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
<p>This test suite covers:</p>
<ul>
<li>Successful API calls</li>
<li>Error handling</li>
<li>CORS OPTIONS request handling</li>
</ul>
<p>To run these tests, you would use the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>python<span class="w"> </span>-m<span class="w"> </span>unittest<span class="w"> </span>tests/test_visitor_counter.py
</span></code></pre></div>
<h3 id="testing-the-api-manually"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#testing-the-api-manually">Testing the API Manually 🧪</a></h3>
<p>Once you've deployed the API, you can test it manually using tools like cURL or Postman. Here's how to test with cURL:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="c1"># Get the current visitor count</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>https://api.yourdomain.com/count
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="c1"># Test CORS pre-flight request</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a>curl<span class="w"> </span>-X<span class="w"> </span>OPTIONS<span class="w"> </span>https://api.yourdomain.com/count<span class="w"> </span><span class="se">\</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Origin: https://yourdomain.com&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Access-Control-Request-Method: GET&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Access-Control-Request-Headers: Content-Type&quot;</span>
</span></code></pre></div>
<p>For Postman:</p>
<ol>
<li>Create a new GET request to your API endpoint (<code>https://api.yourdomain.com/count</code>)</li>
<li>Send the request and verify you get a 200 response with a JSON body</li>
<li>Create a new OPTIONS request to test CORS</li>
<li>Add headers: <code>Origin: https://yourdomain.com</code>, <code>Access-Control-Request-Method: GET</code></li>
<li>Send the request and verify you get a 200 response with the correct CORS headers</li>
</ol>
<h3 id="setting-up-cloudwatch-monitoring-and-alarms"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#setting-up-cloudwatch-monitoring-and-alarms">Setting Up CloudWatch Monitoring and Alarms ⚠️</a></h3>
<p>Adding monitoring and alerting is a critical part of any production-grade API. Let's add CloudWatch alarms to notify us if something goes wrong:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="c1"># Add to modules/backend/monitoring.tf</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="c1"># Alarm for Lambda errors</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_metric_alarm&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_errors&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="w">  </span><span class="na">alarm_name</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda-visitor-counter-errors-${var.environment}&quot;</span>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="w">  </span><span class="na">comparison_operator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;GreaterThanThreshold&quot;</span>
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="w">  </span><span class="na">evaluation_periods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-75-8"><a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="w">  </span><span class="na">metric_name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Errors&quot;</span>
</span><span id="__span-75-9"><a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a><span class="w">  </span><span class="na">namespace</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWS/Lambda&quot;</span>
</span><span id="__span-75-10"><a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="w">  </span><span class="na">period</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="m">60</span>
</span><span id="__span-75-11"><a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="w">  </span><span class="na">statistic</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Sum&quot;</span>
</span><span id="__span-75-12"><a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a><span class="w">  </span><span class="na">threshold</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-13"><a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a><span class="w">  </span><span class="na">alarm_description</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;This alarm monitors for errors in the visitor counter Lambda function&quot;</span>
</span><span id="__span-75-14"><a id="__codelineno-75-14" name="__codelineno-75-14" href="#__codelineno-75-14"></a>
</span><span id="__span-75-15"><a id="__codelineno-75-15" name="__codelineno-75-15" href="#__codelineno-75-15"></a><span class="w">  </span><span class="nb">dimensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-16"><a id="__codelineno-75-16" name="__codelineno-75-16" href="#__codelineno-75-16"></a><span class="w">    </span><span class="na">FunctionName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.visitor_counter.function_name</span>
</span><span id="__span-75-17"><a id="__codelineno-75-17" name="__codelineno-75-17" href="#__codelineno-75-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-75-18"><a id="__codelineno-75-18" name="__codelineno-75-18" href="#__codelineno-75-18"></a>
</span><span id="__span-75-19"><a id="__codelineno-75-19" name="__codelineno-75-19" href="#__codelineno-75-19"></a><span class="c1">  # Add SNS topic ARN if you want notifications</span>
</span><span id="__span-75-20"><a id="__codelineno-75-20" name="__codelineno-75-20" href="#__codelineno-75-20"></a><span class="c1">  # alarm_actions     = [aws_sns_topic.alerts.arn]</span>
</span><span id="__span-75-21"><a id="__codelineno-75-21" name="__codelineno-75-21" href="#__codelineno-75-21"></a><span class="c1">  # ok_actions        = [aws_sns_topic.alerts.arn]</span>
</span><span id="__span-75-22"><a id="__codelineno-75-22" name="__codelineno-75-22" href="#__codelineno-75-22"></a><span class="p">}</span>
</span><span id="__span-75-23"><a id="__codelineno-75-23" name="__codelineno-75-23" href="#__codelineno-75-23"></a>
</span><span id="__span-75-24"><a id="__codelineno-75-24" name="__codelineno-75-24" href="#__codelineno-75-24"></a><span class="c1"># Alarm for API Gateway 5XX errors</span>
</span><span id="__span-75-25"><a id="__codelineno-75-25" name="__codelineno-75-25" href="#__codelineno-75-25"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_metric_alarm&quot;</span><span class="w"> </span><span class="nv">&quot;api_5xx_errors&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-26"><a id="__codelineno-75-26" name="__codelineno-75-26" href="#__codelineno-75-26"></a><span class="w">  </span><span class="na">alarm_name</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;api-visitor-counter-5xx-errors-${var.environment}&quot;</span>
</span><span id="__span-75-27"><a id="__codelineno-75-27" name="__codelineno-75-27" href="#__codelineno-75-27"></a><span class="w">  </span><span class="na">comparison_operator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;GreaterThanThreshold&quot;</span>
</span><span id="__span-75-28"><a id="__codelineno-75-28" name="__codelineno-75-28" href="#__codelineno-75-28"></a><span class="w">  </span><span class="na">evaluation_periods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-75-29"><a id="__codelineno-75-29" name="__codelineno-75-29" href="#__codelineno-75-29"></a><span class="w">  </span><span class="na">metric_name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;5XXError&quot;</span>
</span><span id="__span-75-30"><a id="__codelineno-75-30" name="__codelineno-75-30" href="#__codelineno-75-30"></a><span class="w">  </span><span class="na">namespace</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWS/ApiGateway&quot;</span>
</span><span id="__span-75-31"><a id="__codelineno-75-31" name="__codelineno-75-31" href="#__codelineno-75-31"></a><span class="w">  </span><span class="na">period</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="m">60</span>
</span><span id="__span-75-32"><a id="__codelineno-75-32" name="__codelineno-75-32" href="#__codelineno-75-32"></a><span class="w">  </span><span class="na">statistic</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Sum&quot;</span>
</span><span id="__span-75-33"><a id="__codelineno-75-33" name="__codelineno-75-33" href="#__codelineno-75-33"></a><span class="w">  </span><span class="na">threshold</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-34"><a id="__codelineno-75-34" name="__codelineno-75-34" href="#__codelineno-75-34"></a><span class="w">  </span><span class="na">alarm_description</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;This alarm monitors for 5XX errors in the visitor counter API&quot;</span>
</span><span id="__span-75-35"><a id="__codelineno-75-35" name="__codelineno-75-35" href="#__codelineno-75-35"></a>
</span><span id="__span-75-36"><a id="__codelineno-75-36" name="__codelineno-75-36" href="#__codelineno-75-36"></a><span class="w">  </span><span class="nb">dimensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-37"><a id="__codelineno-75-37" name="__codelineno-75-37" href="#__codelineno-75-37"></a><span class="w">    </span><span class="na">ApiName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.name</span>
</span><span id="__span-75-38"><a id="__codelineno-75-38" name="__codelineno-75-38" href="#__codelineno-75-38"></a><span class="w">    </span><span class="na">Stage</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.stage_name</span>
</span><span id="__span-75-39"><a id="__codelineno-75-39" name="__codelineno-75-39" href="#__codelineno-75-39"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-75-40"><a id="__codelineno-75-40" name="__codelineno-75-40" href="#__codelineno-75-40"></a>
</span><span id="__span-75-41"><a id="__codelineno-75-41" name="__codelineno-75-41" href="#__codelineno-75-41"></a><span class="c1">  # Add SNS topic ARN if you want notifications</span>
</span><span id="__span-75-42"><a id="__codelineno-75-42" name="__codelineno-75-42" href="#__codelineno-75-42"></a><span class="c1">  # alarm_actions     = [aws_sns_topic.alerts.arn]</span>
</span><span id="__span-75-43"><a id="__codelineno-75-43" name="__codelineno-75-43" href="#__codelineno-75-43"></a><span class="c1">  # ok_actions        = [aws_sns_topic.alerts.arn]</span>
</span><span id="__span-75-44"><a id="__codelineno-75-44" name="__codelineno-75-44" href="#__codelineno-75-44"></a><span class="p">}</span>
</span><span id="__span-75-45"><a id="__codelineno-75-45" name="__codelineno-75-45" href="#__codelineno-75-45"></a>
</span><span id="__span-75-46"><a id="__codelineno-75-46" name="__codelineno-75-46" href="#__codelineno-75-46"></a><span class="c1"># Dashboard for monitoring the API</span>
</span><span id="__span-75-47"><a id="__codelineno-75-47" name="__codelineno-75-47" href="#__codelineno-75-47"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_dashboard&quot;</span><span class="w"> </span><span class="nv">&quot;api_dashboard&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-48"><a id="__codelineno-75-48" name="__codelineno-75-48" href="#__codelineno-75-48"></a><span class="w">  </span><span class="na">dashboard_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;visitor-counter-dashboard-${var.environment}&quot;</span>
</span><span id="__span-75-49"><a id="__codelineno-75-49" name="__codelineno-75-49" href="#__codelineno-75-49"></a>
</span><span id="__span-75-50"><a id="__codelineno-75-50" name="__codelineno-75-50" href="#__codelineno-75-50"></a><span class="w">  </span><span class="na">dashboard_body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-75-51"><a id="__codelineno-75-51" name="__codelineno-75-51" href="#__codelineno-75-51"></a><span class="w">    </span><span class="na">widgets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-75-52"><a id="__codelineno-75-52" name="__codelineno-75-52" href="#__codelineno-75-52"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-75-53"><a id="__codelineno-75-53" name="__codelineno-75-53" href="#__codelineno-75-53"></a><span class="w">        </span><span class="na">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;metric&quot;</span>
</span><span id="__span-75-54"><a id="__codelineno-75-54" name="__codelineno-75-54" href="#__codelineno-75-54"></a><span class="w">        </span><span class="na">x</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-55"><a id="__codelineno-75-55" name="__codelineno-75-55" href="#__codelineno-75-55"></a><span class="w">        </span><span class="na">y</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-56"><a id="__codelineno-75-56" name="__codelineno-75-56" href="#__codelineno-75-56"></a><span class="w">        </span><span class="na">width</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">12</span>
</span><span id="__span-75-57"><a id="__codelineno-75-57" name="__codelineno-75-57" href="#__codelineno-75-57"></a><span class="w">        </span><span class="na">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span>
</span><span id="__span-75-58"><a id="__codelineno-75-58" name="__codelineno-75-58" href="#__codelineno-75-58"></a><span class="w">        </span><span class="nb">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-59"><a id="__codelineno-75-59" name="__codelineno-75-59" href="#__codelineno-75-59"></a><span class="w">          </span><span class="na">metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-75-60"><a id="__codelineno-75-60" name="__codelineno-75-60" href="#__codelineno-75-60"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;AWS/ApiGateway&quot;, &quot;Count&quot;, &quot;ApiName&quot;, aws_api_gateway_rest_api.visitor_counter.name, &quot;Stage&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.stage_name</span><span class="p">]</span>
</span><span id="__span-75-61"><a id="__codelineno-75-61" name="__codelineno-75-61" href="#__codelineno-75-61"></a><span class="w">          </span><span class="p">]</span>
</span><span id="__span-75-62"><a id="__codelineno-75-62" name="__codelineno-75-62" href="#__codelineno-75-62"></a><span class="w">          </span><span class="na">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span>
</span><span id="__span-75-63"><a id="__codelineno-75-63" name="__codelineno-75-63" href="#__codelineno-75-63"></a><span class="w">          </span><span class="na">stat</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Sum&quot;</span>
</span><span id="__span-75-64"><a id="__codelineno-75-64" name="__codelineno-75-64" href="#__codelineno-75-64"></a><span class="w">          </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-75-65"><a id="__codelineno-75-65" name="__codelineno-75-65" href="#__codelineno-75-65"></a><span class="w">          </span><span class="na">title</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;API Requests&quot;</span>
</span><span id="__span-75-66"><a id="__codelineno-75-66" name="__codelineno-75-66" href="#__codelineno-75-66"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-75-67"><a id="__codelineno-75-67" name="__codelineno-75-67" href="#__codelineno-75-67"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-75-68"><a id="__codelineno-75-68" name="__codelineno-75-68" href="#__codelineno-75-68"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-75-69"><a id="__codelineno-75-69" name="__codelineno-75-69" href="#__codelineno-75-69"></a><span class="w">        </span><span class="na">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;metric&quot;</span>
</span><span id="__span-75-70"><a id="__codelineno-75-70" name="__codelineno-75-70" href="#__codelineno-75-70"></a><span class="w">        </span><span class="na">x</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">12</span>
</span><span id="__span-75-71"><a id="__codelineno-75-71" name="__codelineno-75-71" href="#__codelineno-75-71"></a><span class="w">        </span><span class="na">y</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-72"><a id="__codelineno-75-72" name="__codelineno-75-72" href="#__codelineno-75-72"></a><span class="w">        </span><span class="na">width</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">12</span>
</span><span id="__span-75-73"><a id="__codelineno-75-73" name="__codelineno-75-73" href="#__codelineno-75-73"></a><span class="w">        </span><span class="na">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span>
</span><span id="__span-75-74"><a id="__codelineno-75-74" name="__codelineno-75-74" href="#__codelineno-75-74"></a><span class="w">        </span><span class="nb">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-75"><a id="__codelineno-75-75" name="__codelineno-75-75" href="#__codelineno-75-75"></a><span class="w">          </span><span class="na">metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-75-76"><a id="__codelineno-75-76" name="__codelineno-75-76" href="#__codelineno-75-76"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;AWS/ApiGateway&quot;, &quot;4XXError&quot;, &quot;ApiName&quot;, aws_api_gateway_rest_api.visitor_counter.name, &quot;Stage&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.stage_name</span><span class="p">],</span>
</span><span id="__span-75-77"><a id="__codelineno-75-77" name="__codelineno-75-77" href="#__codelineno-75-77"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;AWS/ApiGateway&quot;, &quot;5XXError&quot;, &quot;ApiName&quot;, aws_api_gateway_rest_api.visitor_counter.name, &quot;Stage&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.stage_name</span><span class="p">]</span>
</span><span id="__span-75-78"><a id="__codelineno-75-78" name="__codelineno-75-78" href="#__codelineno-75-78"></a><span class="w">          </span><span class="p">]</span>
</span><span id="__span-75-79"><a id="__codelineno-75-79" name="__codelineno-75-79" href="#__codelineno-75-79"></a><span class="w">          </span><span class="na">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span>
</span><span id="__span-75-80"><a id="__codelineno-75-80" name="__codelineno-75-80" href="#__codelineno-75-80"></a><span class="w">          </span><span class="na">stat</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Sum&quot;</span>
</span><span id="__span-75-81"><a id="__codelineno-75-81" name="__codelineno-75-81" href="#__codelineno-75-81"></a><span class="w">          </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-75-82"><a id="__codelineno-75-82" name="__codelineno-75-82" href="#__codelineno-75-82"></a><span class="w">          </span><span class="na">title</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;API Errors&quot;</span>
</span><span id="__span-75-83"><a id="__codelineno-75-83" name="__codelineno-75-83" href="#__codelineno-75-83"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-75-84"><a id="__codelineno-75-84" name="__codelineno-75-84" href="#__codelineno-75-84"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-75-85"><a id="__codelineno-75-85" name="__codelineno-75-85" href="#__codelineno-75-85"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-75-86"><a id="__codelineno-75-86" name="__codelineno-75-86" href="#__codelineno-75-86"></a><span class="w">        </span><span class="na">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;metric&quot;</span>
</span><span id="__span-75-87"><a id="__codelineno-75-87" name="__codelineno-75-87" href="#__codelineno-75-87"></a><span class="w">        </span><span class="na">x</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-75-88"><a id="__codelineno-75-88" name="__codelineno-75-88" href="#__codelineno-75-88"></a><span class="w">        </span><span class="na">y</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">6</span>
</span><span id="__span-75-89"><a id="__codelineno-75-89" name="__codelineno-75-89" href="#__codelineno-75-89"></a><span class="w">        </span><span class="na">width</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">12</span>
</span><span id="__span-75-90"><a id="__codelineno-75-90" name="__codelineno-75-90" href="#__codelineno-75-90"></a><span class="w">        </span><span class="na">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span>
</span><span id="__span-75-91"><a id="__codelineno-75-91" name="__codelineno-75-91" href="#__codelineno-75-91"></a><span class="w">        </span><span class="nb">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-92"><a id="__codelineno-75-92" name="__codelineno-75-92" href="#__codelineno-75-92"></a><span class="w">          </span><span class="na">metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-75-93"><a id="__codelineno-75-93" name="__codelineno-75-93" href="#__codelineno-75-93"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;AWS/Lambda&quot;, &quot;Invocations&quot;, &quot;FunctionName&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">aws_lambda_function.visitor_counter.function_name</span><span class="p">],</span>
</span><span id="__span-75-94"><a id="__codelineno-75-94" name="__codelineno-75-94" href="#__codelineno-75-94"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;AWS/Lambda&quot;, &quot;Errors&quot;, &quot;FunctionName&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">aws_lambda_function.visitor_counter.function_name</span><span class="p">]</span>
</span><span id="__span-75-95"><a id="__codelineno-75-95" name="__codelineno-75-95" href="#__codelineno-75-95"></a><span class="w">          </span><span class="p">]</span>
</span><span id="__span-75-96"><a id="__codelineno-75-96" name="__codelineno-75-96" href="#__codelineno-75-96"></a><span class="w">          </span><span class="na">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span>
</span><span id="__span-75-97"><a id="__codelineno-75-97" name="__codelineno-75-97" href="#__codelineno-75-97"></a><span class="w">          </span><span class="na">stat</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Sum&quot;</span>
</span><span id="__span-75-98"><a id="__codelineno-75-98" name="__codelineno-75-98" href="#__codelineno-75-98"></a><span class="w">          </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-75-99"><a id="__codelineno-75-99" name="__codelineno-75-99" href="#__codelineno-75-99"></a><span class="w">          </span><span class="na">title</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Lambda Invocations and Errors&quot;</span>
</span><span id="__span-75-100"><a id="__codelineno-75-100" name="__codelineno-75-100" href="#__codelineno-75-100"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-75-101"><a id="__codelineno-75-101" name="__codelineno-75-101" href="#__codelineno-75-101"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-75-102"><a id="__codelineno-75-102" name="__codelineno-75-102" href="#__codelineno-75-102"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-75-103"><a id="__codelineno-75-103" name="__codelineno-75-103" href="#__codelineno-75-103"></a><span class="w">        </span><span class="na">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;metric&quot;</span>
</span><span id="__span-75-104"><a id="__codelineno-75-104" name="__codelineno-75-104" href="#__codelineno-75-104"></a><span class="w">        </span><span class="na">x</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">12</span>
</span><span id="__span-75-105"><a id="__codelineno-75-105" name="__codelineno-75-105" href="#__codelineno-75-105"></a><span class="w">        </span><span class="na">y</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">6</span>
</span><span id="__span-75-106"><a id="__codelineno-75-106" name="__codelineno-75-106" href="#__codelineno-75-106"></a><span class="w">        </span><span class="na">width</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">12</span>
</span><span id="__span-75-107"><a id="__codelineno-75-107" name="__codelineno-75-107" href="#__codelineno-75-107"></a><span class="w">        </span><span class="na">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span>
</span><span id="__span-75-108"><a id="__codelineno-75-108" name="__codelineno-75-108" href="#__codelineno-75-108"></a><span class="w">        </span><span class="nb">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-109"><a id="__codelineno-75-109" name="__codelineno-75-109" href="#__codelineno-75-109"></a><span class="w">          </span><span class="na">metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-75-110"><a id="__codelineno-75-110" name="__codelineno-75-110" href="#__codelineno-75-110"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;AWS/Lambda&quot;, &quot;Duration&quot;, &quot;FunctionName&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">aws_lambda_function.visitor_counter.function_name</span><span class="p">]</span>
</span><span id="__span-75-111"><a id="__codelineno-75-111" name="__codelineno-75-111" href="#__codelineno-75-111"></a><span class="w">          </span><span class="p">]</span>
</span><span id="__span-75-112"><a id="__codelineno-75-112" name="__codelineno-75-112" href="#__codelineno-75-112"></a><span class="w">          </span><span class="na">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span>
</span><span id="__span-75-113"><a id="__codelineno-75-113" name="__codelineno-75-113" href="#__codelineno-75-113"></a><span class="w">          </span><span class="na">stat</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Average&quot;</span>
</span><span id="__span-75-114"><a id="__codelineno-75-114" name="__codelineno-75-114" href="#__codelineno-75-114"></a><span class="w">          </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-75-115"><a id="__codelineno-75-115" name="__codelineno-75-115" href="#__codelineno-75-115"></a><span class="w">          </span><span class="na">title</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Lambda Duration&quot;</span>
</span><span id="__span-75-116"><a id="__codelineno-75-116" name="__codelineno-75-116" href="#__codelineno-75-116"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-75-117"><a id="__codelineno-75-117" name="__codelineno-75-117" href="#__codelineno-75-117"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-75-118"><a id="__codelineno-75-118" name="__codelineno-75-118" href="#__codelineno-75-118"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-75-119"><a id="__codelineno-75-119" name="__codelineno-75-119" href="#__codelineno-75-119"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-75-120"><a id="__codelineno-75-120" name="__codelineno-75-120" href="#__codelineno-75-120"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="debugging-common-api-issues"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#debugging-common-api-issues">Debugging Common API Issues 🐛</a></h3>
<p>During my implementation, I encountered several challenges:</p>
<ol>
<li>
<p><strong>CORS Issues</strong>: The most common problem was with CORS configuration. Make sure your API Gateway and Lambda function both return the proper CORS headers.</p>
</li>
<li>
<p><strong>IAM Permission Errors</strong>: Initially, I gave my Lambda function too many permissions, then too few. The policy shown above represents the minimal set of permissions needed.</p>
</li>
<li>
<p><strong>DynamoDB Initialization</strong>: The counter needs to be initialized with a value. I solved this by adding an item to the table during deployment.</p>
</li>
<li>
<p><strong>API Gateway Integration</strong>: Make sure your Lambda function and API Gateway are correctly integrated. Check for proper resource paths and method settings.</p>
</li>
</ol>
<h3 id="lessons-learned"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#lessons-learned">Lessons Learned 💡</a></h3>
<ol>
<li>
<p><strong>DynamoDB Design</strong>: My initial design was too simple. Adding more fields like timestamp and user-agent provides valuable analytics data.</p>
</li>
<li>
<p><strong>Error Handling</strong>: Robust error handling is critical for serverless applications. Without proper logging, debugging becomes nearly impossible.</p>
</li>
<li>
<p><strong>Testing Strategy</strong>: Writing tests before implementing the Lambda function (test-driven development) helped me think through edge cases and error scenarios.</p>
</li>
<li>
<p><strong>Security Considerations</strong>: Privacy is important. Hashing IP addresses and implementing proper IAM policies ensures we protect user data.</p>
</li>
</ol>
<h3 id="api-security-considerations"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#api-security-considerations">API Security Considerations 🔒</a></h3>
<p>Security was a primary concern when building this API. Here are the key security measures I implemented:</p>
<ol>
<li>
<p><strong>Least Privilege IAM Policies</strong>: The Lambda function has only the minimal permissions needed.</p>
</li>
<li>
<p><strong>Input Validation</strong>: The Lambda function validates and sanitizes all input.</p>
</li>
<li>
<p><strong>Rate Limiting</strong>: API Gateway is configured with throttling to prevent abuse.</p>
</li>
<li>
<p><strong>HTTPS Only</strong>: All API endpoints use HTTPS with modern TLS settings.</p>
</li>
<li>
<p><strong>CORS Configuration</strong>: Only the resume website domain is allowed to make cross-origin requests.</p>
</li>
<li>
<p><strong>Privacy Protection</strong>: IP addresses are hashed to protect visitor privacy.</p>
</li>
</ol>
<p>These measures help protect against common API vulnerabilities like injection attacks, denial of service, and data exposure.</p>
<h3 id="enhancements-and-mods"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#enhancements-and-mods">Enhancements and Mods 🚀</a></h3>
<p>Here are some ways to extend this part of the challenge:</p>
<h4 id="developer-mod-schemas-and-dreamers"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#developer-mod-schemas-and-dreamers">Developer Mod: Schemas and Dreamers</a></h4>
<p>Instead of using DynamoDB, consider implementing a relational database approach:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_db_subnet_group&quot;</span><span class="w"> </span><span class="nv">&quot;database&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="w">  </span><span class="na">name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-database-subnet-group&quot;</span>
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="w">  </span><span class="na">subnet_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.private_subnet_ids</span>
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="p">}</span>
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a>
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_security_group&quot;</span><span class="w"> </span><span class="nv">&quot;database&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-7"><a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-database-sg&quot;</span>
</span><span id="__span-76-8"><a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Security group for the resume database&quot;</span>
</span><span id="__span-76-9"><a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a><span class="w">  </span><span class="na">vpc_id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span>
</span><span id="__span-76-10"><a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a>
</span><span id="__span-76-11"><a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a><span class="w">  </span><span class="nb">ingress</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-12"><a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a><span class="w">    </span><span class="na">from_port</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="m">5432</span>
</span><span id="__span-76-13"><a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a><span class="w">    </span><span class="na">to_port</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="m">5432</span>
</span><span id="__span-76-14"><a id="__codelineno-76-14" name="__codelineno-76-14" href="#__codelineno-76-14"></a><span class="w">    </span><span class="na">protocol</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tcp&quot;</span>
</span><span id="__span-76-15"><a id="__codelineno-76-15" name="__codelineno-76-15" href="#__codelineno-76-15"></a><span class="w">    </span><span class="na">security_groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_security_group.lambda.id</span><span class="p">]</span>
</span><span id="__span-76-16"><a id="__codelineno-76-16" name="__codelineno-76-16" href="#__codelineno-76-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-76-17"><a id="__codelineno-76-17" name="__codelineno-76-17" href="#__codelineno-76-17"></a><span class="p">}</span>
</span><span id="__span-76-18"><a id="__codelineno-76-18" name="__codelineno-76-18" href="#__codelineno-76-18"></a>
</span><span id="__span-76-19"><a id="__codelineno-76-19" name="__codelineno-76-19" href="#__codelineno-76-19"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_db_instance&quot;</span><span class="w"> </span><span class="nv">&quot;postgresql&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-20"><a id="__codelineno-76-20" name="__codelineno-76-20" href="#__codelineno-76-20"></a><span class="w">  </span><span class="na">allocated_storage</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">20</span>
</span><span id="__span-76-21"><a id="__codelineno-76-21" name="__codelineno-76-21" href="#__codelineno-76-21"></a><span class="w">  </span><span class="na">storage_type</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gp2&quot;</span>
</span><span id="__span-76-22"><a id="__codelineno-76-22" name="__codelineno-76-22" href="#__codelineno-76-22"></a><span class="w">  </span><span class="na">engine</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;postgres&quot;</span>
</span><span id="__span-76-23"><a id="__codelineno-76-23" name="__codelineno-76-23" href="#__codelineno-76-23"></a><span class="w">  </span><span class="na">engine_version</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;13.4&quot;</span>
</span><span id="__span-76-24"><a id="__codelineno-76-24" name="__codelineno-76-24" href="#__codelineno-76-24"></a><span class="w">  </span><span class="na">instance_class</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;db.t3.micro&quot;</span>
</span><span id="__span-76-25"><a id="__codelineno-76-25" name="__codelineno-76-25" href="#__codelineno-76-25"></a><span class="w">  </span><span class="na">db_name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resumedb&quot;</span>
</span><span id="__span-76-26"><a id="__codelineno-76-26" name="__codelineno-76-26" href="#__codelineno-76-26"></a><span class="w">  </span><span class="na">username</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;postgres&quot;</span>
</span><span id="__span-76-27"><a id="__codelineno-76-27" name="__codelineno-76-27" href="#__codelineno-76-27"></a><span class="w">  </span><span class="na">password</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="nv">var.db_password</span>
</span><span id="__span-76-28"><a id="__codelineno-76-28" name="__codelineno-76-28" href="#__codelineno-76-28"></a><span class="w">  </span><span class="na">parameter_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;default.postgres13&quot;</span>
</span><span id="__span-76-29"><a id="__codelineno-76-29" name="__codelineno-76-29" href="#__codelineno-76-29"></a><span class="w">  </span><span class="na">db_subnet_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_db_subnet_group.database.name</span>
</span><span id="__span-76-30"><a id="__codelineno-76-30" name="__codelineno-76-30" href="#__codelineno-76-30"></a><span class="w">  </span><span class="na">vpc_security_group_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_security_group.database.id</span><span class="p">]</span>
</span><span id="__span-76-31"><a id="__codelineno-76-31" name="__codelineno-76-31" href="#__codelineno-76-31"></a><span class="w">  </span><span class="na">skip_final_snapshot</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-76-32"><a id="__codelineno-76-32" name="__codelineno-76-32" href="#__codelineno-76-32"></a><span class="w">  </span><span class="na">multi_az</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-76-33"><a id="__codelineno-76-33" name="__codelineno-76-33" href="#__codelineno-76-33"></a>
</span><span id="__span-76-34"><a id="__codelineno-76-34" name="__codelineno-76-34" href="#__codelineno-76-34"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-76-35"><a id="__codelineno-76-35" name="__codelineno-76-35" href="#__codelineno-76-35"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Database&quot;</span>
</span><span id="__span-76-36"><a id="__codelineno-76-36" name="__codelineno-76-36" href="#__codelineno-76-36"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-76-37"><a id="__codelineno-76-37" name="__codelineno-76-37" href="#__codelineno-76-37"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-76-38"><a id="__codelineno-76-38" name="__codelineno-76-38" href="#__codelineno-76-38"></a><span class="p">}</span>
</span></code></pre></div>
<p>This approach introduces interesting networking challenges and requires modifications to your Lambda function to connect to PostgreSQL.</p>
<h4 id="devops-mod-monitor-lizard"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#devops-mod-monitor-lizard">DevOps Mod: Monitor Lizard</a></h4>
<p>Enhance monitoring with X-Ray traces and custom CloudWatch metrics:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="c1"># Add to Lambda function configuration</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="nb">tracing_config</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="w">  </span><span class="na">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Active&quot;</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="p">}</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="c1"># Add X-Ray policy</span>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_policy&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_xray&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda-xray-policy-${var.environment}&quot;</span>
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;IAM policy for X-Ray tracing&quot;</span>
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a>
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a><span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-77-14"><a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-77-15"><a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-77-16"><a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a><span class="w">          </span><span class="s2">&quot;xray:PutTraceSegments&quot;</span><span class="p">,</span>
</span><span id="__span-77-17"><a id="__codelineno-77-17" name="__codelineno-77-17" href="#__codelineno-77-17"></a><span class="w">          </span><span class="s2">&quot;xray:PutTelemetryRecords&quot;</span>
</span><span id="__span-77-18"><a id="__codelineno-77-18" name="__codelineno-77-18" href="#__codelineno-77-18"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-77-19"><a id="__codelineno-77-19" name="__codelineno-77-19" href="#__codelineno-77-19"></a><span class="w">        </span><span class="na">Effect</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-77-20"><a id="__codelineno-77-20" name="__codelineno-77-20" href="#__codelineno-77-20"></a><span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-77-21"><a id="__codelineno-77-21" name="__codelineno-77-21" href="#__codelineno-77-21"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-77-22"><a id="__codelineno-77-22" name="__codelineno-77-22" href="#__codelineno-77-22"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-77-23"><a id="__codelineno-77-23" name="__codelineno-77-23" href="#__codelineno-77-23"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-77-24"><a id="__codelineno-77-24" name="__codelineno-77-24" href="#__codelineno-77-24"></a><span class="p">}</span>
</span><span id="__span-77-25"><a id="__codelineno-77-25" name="__codelineno-77-25" href="#__codelineno-77-25"></a>
</span><span id="__span-77-26"><a id="__codelineno-77-26" name="__codelineno-77-26" href="#__codelineno-77-26"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role_policy_attachment&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_xray&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-77-27"><a id="__codelineno-77-27" name="__codelineno-77-27" href="#__codelineno-77-27"></a><span class="w">  </span><span class="na">role</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.lambda_role.name</span>
</span><span id="__span-77-28"><a id="__codelineno-77-28" name="__codelineno-77-28" href="#__codelineno-77-28"></a><span class="w">  </span><span class="na">policy_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_policy.lambda_xray.arn</span>
</span><span id="__span-77-29"><a id="__codelineno-77-29" name="__codelineno-77-29" href="#__codelineno-77-29"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then modify your Lambda function to emit custom metrics:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aws_xray_sdk.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">xray_recorder</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aws_xray_sdk.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">patch_all</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="c1"># Patch all supported libraries for X-Ray</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="n">patch_all</span><span class="p">()</span>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="n">cloudwatch</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudwatch&#39;</span><span class="p">)</span>
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a>
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="c1"># Inside lambda_handler</span>
</span><span id="__span-78-11"><a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="n">cloudwatch</span><span class="o">.</span><span class="n">put_metric_data</span><span class="p">(</span>
</span><span id="__span-78-12"><a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a>    <span class="n">Namespace</span><span class="o">=</span><span class="s1">&#39;ResumeMetrics&#39;</span><span class="p">,</span>
</span><span id="__span-78-13"><a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a>    <span class="n">MetricData</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-78-14"><a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a>        <span class="p">{</span>
</span><span id="__span-78-15"><a id="__codelineno-78-15" name="__codelineno-78-15" href="#__codelineno-78-15"></a>            <span class="s1">&#39;MetricName&#39;</span><span class="p">:</span> <span class="s1">&#39;VisitorCount&#39;</span><span class="p">,</span>
</span><span id="__span-78-16"><a id="__codelineno-78-16" name="__codelineno-78-16" href="#__codelineno-78-16"></a>            <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
</span><span id="__span-78-17"><a id="__codelineno-78-17" name="__codelineno-78-17" href="#__codelineno-78-17"></a>            <span class="s1">&#39;Unit&#39;</span><span class="p">:</span> <span class="s1">&#39;Count&#39;</span>
</span><span id="__span-78-18"><a id="__codelineno-78-18" name="__codelineno-78-18" href="#__codelineno-78-18"></a>        <span class="p">}</span>
</span><span id="__span-78-19"><a id="__codelineno-78-19" name="__codelineno-78-19" href="#__codelineno-78-19"></a>    <span class="p">]</span>
</span><span id="__span-78-20"><a id="__codelineno-78-20" name="__codelineno-78-20" href="#__codelineno-78-20"></a><span class="p">)</span>
</span></code></pre></div>
<h4 id="security-mod-check-your-privilege"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#security-mod-check-your-privilege">Security Mod: Check Your Privilege</a></h4>
<p>Implement AWS WAF to protect your API from common web attacks:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_wafv2_web_acl&quot;</span><span class="w"> </span><span class="nv">&quot;api&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;api-waf-${var.environment}&quot;</span>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;WAF for the resume API&quot;</span>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="w">  </span><span class="na">scope</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;REGIONAL&quot;</span>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a>
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="w">  </span><span class="nb">default_action</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="w">    </span><span class="nb">allow</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-79-9"><a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a>
</span><span id="__span-79-10"><a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a><span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-11"><a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="w">    </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWSManagedRulesCommonRuleSet&quot;</span>
</span><span id="__span-79-12"><a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a><span class="w">    </span><span class="na">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-79-13"><a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a>
</span><span id="__span-79-14"><a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a><span class="w">    </span><span class="nb">override_action</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-15"><a id="__codelineno-79-15" name="__codelineno-79-15" href="#__codelineno-79-15"></a><span class="w">      </span><span class="nb">none</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-79-16"><a id="__codelineno-79-16" name="__codelineno-79-16" href="#__codelineno-79-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-79-17"><a id="__codelineno-79-17" name="__codelineno-79-17" href="#__codelineno-79-17"></a>
</span><span id="__span-79-18"><a id="__codelineno-79-18" name="__codelineno-79-18" href="#__codelineno-79-18"></a><span class="w">    </span><span class="nb">statement</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-19"><a id="__codelineno-79-19" name="__codelineno-79-19" href="#__codelineno-79-19"></a><span class="w">      </span><span class="nb">managed_rule_group_statement</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-20"><a id="__codelineno-79-20" name="__codelineno-79-20" href="#__codelineno-79-20"></a><span class="w">        </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWSManagedRulesCommonRuleSet&quot;</span>
</span><span id="__span-79-21"><a id="__codelineno-79-21" name="__codelineno-79-21" href="#__codelineno-79-21"></a><span class="w">        </span><span class="na">vendor_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWS&quot;</span>
</span><span id="__span-79-22"><a id="__codelineno-79-22" name="__codelineno-79-22" href="#__codelineno-79-22"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-79-23"><a id="__codelineno-79-23" name="__codelineno-79-23" href="#__codelineno-79-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-79-24"><a id="__codelineno-79-24" name="__codelineno-79-24" href="#__codelineno-79-24"></a>
</span><span id="__span-79-25"><a id="__codelineno-79-25" name="__codelineno-79-25" href="#__codelineno-79-25"></a><span class="w">    </span><span class="nb">visibility_config</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-26"><a id="__codelineno-79-26" name="__codelineno-79-26" href="#__codelineno-79-26"></a><span class="w">      </span><span class="na">cloudwatch_metrics_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-79-27"><a id="__codelineno-79-27" name="__codelineno-79-27" href="#__codelineno-79-27"></a><span class="w">      </span><span class="na">metric_name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWSManagedRulesCommonRuleSetMetric&quot;</span>
</span><span id="__span-79-28"><a id="__codelineno-79-28" name="__codelineno-79-28" href="#__codelineno-79-28"></a><span class="w">      </span><span class="na">sampled_requests_enabled</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-79-29"><a id="__codelineno-79-29" name="__codelineno-79-29" href="#__codelineno-79-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-79-30"><a id="__codelineno-79-30" name="__codelineno-79-30" href="#__codelineno-79-30"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-79-31"><a id="__codelineno-79-31" name="__codelineno-79-31" href="#__codelineno-79-31"></a>
</span><span id="__span-79-32"><a id="__codelineno-79-32" name="__codelineno-79-32" href="#__codelineno-79-32"></a><span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-33"><a id="__codelineno-79-33" name="__codelineno-79-33" href="#__codelineno-79-33"></a><span class="w">    </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;RateLimit&quot;</span>
</span><span id="__span-79-34"><a id="__codelineno-79-34" name="__codelineno-79-34" href="#__codelineno-79-34"></a><span class="w">    </span><span class="na">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-79-35"><a id="__codelineno-79-35" name="__codelineno-79-35" href="#__codelineno-79-35"></a>
</span><span id="__span-79-36"><a id="__codelineno-79-36" name="__codelineno-79-36" href="#__codelineno-79-36"></a><span class="w">    </span><span class="nb">action</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-37"><a id="__codelineno-79-37" name="__codelineno-79-37" href="#__codelineno-79-37"></a><span class="w">      </span><span class="nb">block</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-79-38"><a id="__codelineno-79-38" name="__codelineno-79-38" href="#__codelineno-79-38"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-79-39"><a id="__codelineno-79-39" name="__codelineno-79-39" href="#__codelineno-79-39"></a>
</span><span id="__span-79-40"><a id="__codelineno-79-40" name="__codelineno-79-40" href="#__codelineno-79-40"></a><span class="w">    </span><span class="nb">statement</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-41"><a id="__codelineno-79-41" name="__codelineno-79-41" href="#__codelineno-79-41"></a><span class="w">      </span><span class="nb">rate_based_statement</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-42"><a id="__codelineno-79-42" name="__codelineno-79-42" href="#__codelineno-79-42"></a><span class="w">        </span><span class="na">limit</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>
</span><span id="__span-79-43"><a id="__codelineno-79-43" name="__codelineno-79-43" href="#__codelineno-79-43"></a><span class="w">        </span><span class="na">aggregate_key_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;IP&quot;</span>
</span><span id="__span-79-44"><a id="__codelineno-79-44" name="__codelineno-79-44" href="#__codelineno-79-44"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-79-45"><a id="__codelineno-79-45" name="__codelineno-79-45" href="#__codelineno-79-45"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-79-46"><a id="__codelineno-79-46" name="__codelineno-79-46" href="#__codelineno-79-46"></a>
</span><span id="__span-79-47"><a id="__codelineno-79-47" name="__codelineno-79-47" href="#__codelineno-79-47"></a><span class="w">    </span><span class="nb">visibility_config</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-48"><a id="__codelineno-79-48" name="__codelineno-79-48" href="#__codelineno-79-48"></a><span class="w">      </span><span class="na">cloudwatch_metrics_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-79-49"><a id="__codelineno-79-49" name="__codelineno-79-49" href="#__codelineno-79-49"></a><span class="w">      </span><span class="na">metric_name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;RateLimitMetric&quot;</span>
</span><span id="__span-79-50"><a id="__codelineno-79-50" name="__codelineno-79-50" href="#__codelineno-79-50"></a><span class="w">      </span><span class="na">sampled_requests_enabled</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-79-51"><a id="__codelineno-79-51" name="__codelineno-79-51" href="#__codelineno-79-51"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-79-52"><a id="__codelineno-79-52" name="__codelineno-79-52" href="#__codelineno-79-52"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-79-53"><a id="__codelineno-79-53" name="__codelineno-79-53" href="#__codelineno-79-53"></a>
</span><span id="__span-79-54"><a id="__codelineno-79-54" name="__codelineno-79-54" href="#__codelineno-79-54"></a><span class="w">  </span><span class="nb">visibility_config</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-55"><a id="__codelineno-79-55" name="__codelineno-79-55" href="#__codelineno-79-55"></a><span class="w">    </span><span class="na">cloudwatch_metrics_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-79-56"><a id="__codelineno-79-56" name="__codelineno-79-56" href="#__codelineno-79-56"></a><span class="w">    </span><span class="na">metric_name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;APIWebACLMetric&quot;</span>
</span><span id="__span-79-57"><a id="__codelineno-79-57" name="__codelineno-79-57" href="#__codelineno-79-57"></a><span class="w">    </span><span class="na">sampled_requests_enabled</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-79-58"><a id="__codelineno-79-58" name="__codelineno-79-58" href="#__codelineno-79-58"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-79-59"><a id="__codelineno-79-59" name="__codelineno-79-59" href="#__codelineno-79-59"></a><span class="p">}</span>
</span><span id="__span-79-60"><a id="__codelineno-79-60" name="__codelineno-79-60" href="#__codelineno-79-60"></a>
</span><span id="__span-79-61"><a id="__codelineno-79-61" name="__codelineno-79-61" href="#__codelineno-79-61"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_wafv2_web_acl_association&quot;</span><span class="w"> </span><span class="nv">&quot;api&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-62"><a id="__codelineno-79-62" name="__codelineno-79-62" href="#__codelineno-79-62"></a><span class="w">  </span><span class="na">resource_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_stage.visitor_counter.arn</span>
</span><span id="__span-79-63"><a id="__codelineno-79-63" name="__codelineno-79-63" href="#__codelineno-79-63"></a><span class="w">  </span><span class="na">web_acl_arn</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_wafv2_web_acl.api.arn</span>
</span><span id="__span-79-64"><a id="__codelineno-79-64" name="__codelineno-79-64" href="#__codelineno-79-64"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="next-steps"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-building-the-backend-api/#next-steps">Next Steps ⏭️</a></h3>
<p>With our backend API completed, we're ready to connect it to our frontend in the next post. We'll integrate the JavaScript visitor counter with our API and then automate the deployment process using GitHub Actions.</p>
<p>Stay tuned to see how we bring the full stack together!</p>
<hr />
<p><strong>Up Next:</strong> [Cloud Resume Challenge with Terraform: Automating Deployments with GitHub Actions] 🔗</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Cloud%20Resume%20Challenge%20with%20Terraform%3A%20Building%20the%20Backend%20API%0A&amp;url=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-building-the-backend-api/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-building-the-backend-api/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-18 00:00:00+00:00">March 18, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/aws/" class="md-meta__link">AWS</a>, 
              <a href="../../category/terraform/" class="md-meta__link">Terraform</a>, 
              <a href="../../category/web-hosting/" class="md-meta__link">Web Hosting</a>, 
              <a href="../../category/cloud-resume-challenge/" class="md-meta__link">Cloud Resume Challenge</a></li>
        
        
          
          <li class="md-meta__item">
            
              8 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="cloud-resume-challenge-with-terraform-deploying-the-static-website"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/">Cloud Resume Challenge with Terraform: Deploying the Static Website 🚀</a></h2>
<h3 id="introduction"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#introduction">Introduction 🌍</a></h3>
<p>In the <a href="link-to-previous-post">previous post</a>, we set up our Terraform environment and outlined the architecture for our Cloud Resume Challenge project. Now it's time to start building! In this post, we'll focus on deploying the first component: <strong>the static website</strong> that will host our resume.</p>
<h3 id="frontend-architecture-overview"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#frontend-architecture-overview">Frontend Architecture Overview 🏗️</a></h3>
<p>Let's look at the specific architecture we'll implement for our frontend:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>┌───────────┐     ┌────────────┐     ┌──────────┐     ┌────────────┐
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>│           │     │            │     │          │     │            │
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>│  Route 53 ├─────► CloudFront ├─────►    S3    │     │    ACM     │
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>│           │     │            │     │          │     │ Certificate│
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>└───────────┘     └────────────┘     └──────────┘     └────────────┘
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>      ▲                                    ▲                 │
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>      │                                    │                 │
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>      └────────────────────────────────────┴─────────────────┘
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a>           DNS &amp; Certificate Validation
</span></code></pre></div>
<p>The frontend consists of:</p>
<ol>
<li><strong>S3 Bucket</strong>: Hosts our HTML, CSS, and JavaScript files</li>
<li><strong>CloudFront</strong>: Provides CDN capabilities for global distribution and HTTPS</li>
<li><strong>Route 53</strong>: Manages our custom domain's DNS</li>
<li><strong>ACM</strong>: Provides SSL/TLS certificate for HTTPS</li>
</ol>
<h3 id="my-htmlcss-resume-design-approach"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#my-htmlcss-resume-design-approach">My HTML/CSS Resume Design Approach 🎨</a></h3>
<p>Before diving into Terraform, I spent some time creating my resume in HTML and CSS. Rather than starting from scratch, I decided to use a minimalist approach with a focus on readability.</p>
<p>Here's a snippet of my HTML structure:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Matthew&#39;s Cloud Resume<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a>    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;styles.css&quot;</span><span class="p">&gt;</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a>    <span class="p">&lt;</span><span class="nt">header</span><span class="p">&gt;</span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a>        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Matthew Johnson<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a>        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Cloud Engineer<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a>    <span class="p">&lt;/</span><span class="nt">header</span><span class="p">&gt;</span>
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a>
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a>    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;contact&quot;</span><span class="p">&gt;</span>
</span><span id="__span-65-16"><a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a>        <span class="cm">&lt;!-- Contact information --&gt;</span>
</span><span id="__span-65-17"><a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a>    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span id="__span-65-18"><a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a>
</span><span id="__span-65-19"><a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a>    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;skills&quot;</span><span class="p">&gt;</span>
</span><span id="__span-65-20"><a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a>        <span class="cm">&lt;!-- Skills list --&gt;</span>
</span><span id="__span-65-21"><a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a>    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span id="__span-65-22"><a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a>
</span><span id="__span-65-23"><a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a>    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;experience&quot;</span><span class="p">&gt;</span>
</span><span id="__span-65-24"><a id="__codelineno-65-24" name="__codelineno-65-24" href="#__codelineno-65-24"></a>        <span class="cm">&lt;!-- Work experience --&gt;</span>
</span><span id="__span-65-25"><a id="__codelineno-65-25" name="__codelineno-65-25" href="#__codelineno-65-25"></a>    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span id="__span-65-26"><a id="__codelineno-65-26" name="__codelineno-65-26" href="#__codelineno-65-26"></a>
</span><span id="__span-65-27"><a id="__codelineno-65-27" name="__codelineno-65-27" href="#__codelineno-65-27"></a>    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;education&quot;</span><span class="p">&gt;</span>
</span><span id="__span-65-28"><a id="__codelineno-65-28" name="__codelineno-65-28" href="#__codelineno-65-28"></a>        <span class="cm">&lt;!-- Education history --&gt;</span>
</span><span id="__span-65-29"><a id="__codelineno-65-29" name="__codelineno-65-29" href="#__codelineno-65-29"></a>    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span id="__span-65-30"><a id="__codelineno-65-30" name="__codelineno-65-30" href="#__codelineno-65-30"></a>
</span><span id="__span-65-31"><a id="__codelineno-65-31" name="__codelineno-65-31" href="#__codelineno-65-31"></a>    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;certifications&quot;</span><span class="p">&gt;</span>
</span><span id="__span-65-32"><a id="__codelineno-65-32" name="__codelineno-65-32" href="#__codelineno-65-32"></a>        <span class="cm">&lt;!-- AWS certifications --&gt;</span>
</span><span id="__span-65-33"><a id="__codelineno-65-33" name="__codelineno-65-33" href="#__codelineno-65-33"></a>    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span id="__span-65-34"><a id="__codelineno-65-34" name="__codelineno-65-34" href="#__codelineno-65-34"></a>
</span><span id="__span-65-35"><a id="__codelineno-65-35" name="__codelineno-65-35" href="#__codelineno-65-35"></a>    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;projects&quot;</span><span class="p">&gt;</span>
</span><span id="__span-65-36"><a id="__codelineno-65-36" name="__codelineno-65-36" href="#__codelineno-65-36"></a>        <span class="cm">&lt;!-- Project descriptions including this challenge --&gt;</span>
</span><span id="__span-65-37"><a id="__codelineno-65-37" name="__codelineno-65-37" href="#__codelineno-65-37"></a>    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span id="__span-65-38"><a id="__codelineno-65-38" name="__codelineno-65-38" href="#__codelineno-65-38"></a>
</span><span id="__span-65-39"><a id="__codelineno-65-39" name="__codelineno-65-39" href="#__codelineno-65-39"></a>    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;counter&quot;</span><span class="p">&gt;</span>
</span><span id="__span-65-40"><a id="__codelineno-65-40" name="__codelineno-65-40" href="#__codelineno-65-40"></a>        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>This page has been viewed <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;count&quot;</span><span class="p">&gt;</span>0<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> times.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-65-41"><a id="__codelineno-65-41" name="__codelineno-65-41" href="#__codelineno-65-41"></a>    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span id="__span-65-42"><a id="__codelineno-65-42" name="__codelineno-65-42" href="#__codelineno-65-42"></a>
</span><span id="__span-65-43"><a id="__codelineno-65-43" name="__codelineno-65-43" href="#__codelineno-65-43"></a>    <span class="p">&lt;</span><span class="nt">footer</span><span class="p">&gt;</span>
</span><span id="__span-65-44"><a id="__codelineno-65-44" name="__codelineno-65-44" href="#__codelineno-65-44"></a>        <span class="cm">&lt;!-- Footer content --&gt;</span>
</span><span id="__span-65-45"><a id="__codelineno-65-45" name="__codelineno-65-45" href="#__codelineno-65-45"></a>    <span class="p">&lt;/</span><span class="nt">footer</span><span class="p">&gt;</span>
</span><span id="__span-65-46"><a id="__codelineno-65-46" name="__codelineno-65-46" href="#__codelineno-65-46"></a>
</span><span id="__span-65-47"><a id="__codelineno-65-47" name="__codelineno-65-47" href="#__codelineno-65-47"></a>    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;counter.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-65-48"><a id="__codelineno-65-48" name="__codelineno-65-48" href="#__codelineno-65-48"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-65-49"><a id="__codelineno-65-49" name="__codelineno-65-49" href="#__codelineno-65-49"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>For CSS, I went with a responsive design that works well on both desktop and mobile devices:</p>
<div class="language-css highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="p">:</span><span class="nd">root</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="w">    </span><span class="nv">--primary-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#0066cc</span><span class="p">;</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="w">    </span><span class="nv">--secondary-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#f4f4f4</span><span class="p">;</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="w">    </span><span class="nv">--text-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#333</span><span class="p">;</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="w">    </span><span class="nv">--heading-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#222</span><span class="p">;</span>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="p">}</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a><span class="w">    </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Segoe UI&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">Tahoma</span><span class="p">,</span><span class="w"> </span><span class="n">Geneva</span><span class="p">,</span><span class="w"> </span><span class="n">Verdana</span><span class="p">,</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="w">    </span><span class="k">line-height</span><span class="p">:</span><span class="w"> </span><span class="mf">1.6</span><span class="p">;</span>
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="nv">--text-color</span><span class="p">);</span>
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a><span class="w">    </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">800</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a><span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a><span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">rem</span><span class="p">;</span>
</span><span id="__span-66-15"><a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a><span class="p">}</span>
</span><span id="__span-66-16"><a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a>
</span><span id="__span-66-17"><a id="__codelineno-66-17" name="__codelineno-66-17" href="#__codelineno-66-17"></a><span class="nt">header</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-18"><a id="__codelineno-66-18" name="__codelineno-66-18" href="#__codelineno-66-18"></a><span class="w">    </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
</span><span id="__span-66-19"><a id="__codelineno-66-19" name="__codelineno-66-19" href="#__codelineno-66-19"></a><span class="w">    </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">rem</span><span class="p">;</span>
</span><span id="__span-66-20"><a id="__codelineno-66-20" name="__codelineno-66-20" href="#__codelineno-66-20"></a><span class="p">}</span>
</span><span id="__span-66-21"><a id="__codelineno-66-21" name="__codelineno-66-21" href="#__codelineno-66-21"></a>
</span><span id="__span-66-22"><a id="__codelineno-66-22" name="__codelineno-66-22" href="#__codelineno-66-22"></a><span class="nt">h1</span><span class="o">,</span><span class="w"> </span><span class="nt">h2</span><span class="o">,</span><span class="w"> </span><span class="nt">h3</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-23"><a id="__codelineno-66-23" name="__codelineno-66-23" href="#__codelineno-66-23"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="nv">--heading-color</span><span class="p">);</span>
</span><span id="__span-66-24"><a id="__codelineno-66-24" name="__codelineno-66-24" href="#__codelineno-66-24"></a><span class="p">}</span>
</span><span id="__span-66-25"><a id="__codelineno-66-25" name="__codelineno-66-25" href="#__codelineno-66-25"></a>
</span><span id="__span-66-26"><a id="__codelineno-66-26" name="__codelineno-66-26" href="#__codelineno-66-26"></a><span class="nt">section</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-27"><a id="__codelineno-66-27" name="__codelineno-66-27" href="#__codelineno-66-27"></a><span class="w">    </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">rem</span><span class="p">;</span>
</span><span id="__span-66-28"><a id="__codelineno-66-28" name="__codelineno-66-28" href="#__codelineno-66-28"></a><span class="p">}</span>
</span><span id="__span-66-29"><a id="__codelineno-66-29" name="__codelineno-66-29" href="#__codelineno-66-29"></a>
</span><span id="__span-66-30"><a id="__codelineno-66-30" name="__codelineno-66-30" href="#__codelineno-66-30"></a><span class="c">/* Responsive design */</span>
</span><span id="__span-66-31"><a id="__codelineno-66-31" name="__codelineno-66-31" href="#__codelineno-66-31"></a><span class="p">@</span><span class="k">media</span><span class="w"> </span><span class="o">(</span><span class="nt">max-width</span><span class="o">:</span><span class="w"> </span><span class="nt">600px</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-32"><a id="__codelineno-66-32" name="__codelineno-66-32" href="#__codelineno-66-32"></a><span class="w">    </span><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-33"><a id="__codelineno-66-33" name="__codelineno-66-33" href="#__codelineno-66-33"></a><span class="w">        </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="kt">rem</span><span class="p">;</span>
</span><span id="__span-66-34"><a id="__codelineno-66-34" name="__codelineno-66-34" href="#__codelineno-66-34"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-66-35"><a id="__codelineno-66-35" name="__codelineno-66-35" href="#__codelineno-66-35"></a><span class="p">}</span>
</span></code></pre></div>
<p>These files will be uploaded to our S3 bucket once we've provisioned it with Terraform.</p>
<h3 id="deploying-the-static-website-with-terraform"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#deploying-the-static-website-with-terraform">Deploying the Static Website with Terraform 🌐</a></h3>
<p>Now, let's implement the Terraform code for our frontend infrastructure. We'll create modules for each component, starting with S3.</p>
<h4 id="1-s3-module-for-website-hosting"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#1-s3-module-for-website-hosting">1. S3 Module for Website Hosting 📂</a></h4>
<p>Create a file at <code>modules/frontend/s3.tf</code>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.website_bucket_name</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Website&quot;</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="w">    </span><span class="na">Project</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cloud Resume Challenge&quot;</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a><span class="p">}</span>
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a>
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_website_configuration&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-12"><a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-67-13"><a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a>
</span><span id="__span-67-14"><a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a><span class="w">  </span><span class="nb">index_document</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-15"><a id="__codelineno-67-15" name="__codelineno-67-15" href="#__codelineno-67-15"></a><span class="w">    </span><span class="na">suffix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.html&quot;</span>
</span><span id="__span-67-16"><a id="__codelineno-67-16" name="__codelineno-67-16" href="#__codelineno-67-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-67-17"><a id="__codelineno-67-17" name="__codelineno-67-17" href="#__codelineno-67-17"></a>
</span><span id="__span-67-18"><a id="__codelineno-67-18" name="__codelineno-67-18" href="#__codelineno-67-18"></a><span class="w">  </span><span class="nb">error_document</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-19"><a id="__codelineno-67-19" name="__codelineno-67-19" href="#__codelineno-67-19"></a><span class="w">    </span><span class="na">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;error.html&quot;</span>
</span><span id="__span-67-20"><a id="__codelineno-67-20" name="__codelineno-67-20" href="#__codelineno-67-20"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-67-21"><a id="__codelineno-67-21" name="__codelineno-67-21" href="#__codelineno-67-21"></a><span class="p">}</span>
</span><span id="__span-67-22"><a id="__codelineno-67-22" name="__codelineno-67-22" href="#__codelineno-67-22"></a>
</span><span id="__span-67-23"><a id="__codelineno-67-23" name="__codelineno-67-23" href="#__codelineno-67-23"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_cors_configuration&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-24"><a id="__codelineno-67-24" name="__codelineno-67-24" href="#__codelineno-67-24"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-67-25"><a id="__codelineno-67-25" name="__codelineno-67-25" href="#__codelineno-67-25"></a>
</span><span id="__span-67-26"><a id="__codelineno-67-26" name="__codelineno-67-26" href="#__codelineno-67-26"></a><span class="w">  </span><span class="nb">cors_rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-27"><a id="__codelineno-67-27" name="__codelineno-67-27" href="#__codelineno-67-27"></a><span class="w">    </span><span class="na">allowed_headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span>
</span><span id="__span-67-28"><a id="__codelineno-67-28" name="__codelineno-67-28" href="#__codelineno-67-28"></a><span class="w">    </span><span class="na">allowed_methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;</span><span class="p">]</span>
</span><span id="__span-67-29"><a id="__codelineno-67-29" name="__codelineno-67-29" href="#__codelineno-67-29"></a><span class="w">    </span><span class="na">allowed_origins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span><span class="c1">  # In production, restrict to your domain</span>
</span><span id="__span-67-30"><a id="__codelineno-67-30" name="__codelineno-67-30" href="#__codelineno-67-30"></a><span class="w">    </span><span class="na">expose_headers</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;ETag&quot;</span><span class="p">]</span>
</span><span id="__span-67-31"><a id="__codelineno-67-31" name="__codelineno-67-31" href="#__codelineno-67-31"></a><span class="w">    </span><span class="na">max_age_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3000</span>
</span><span id="__span-67-32"><a id="__codelineno-67-32" name="__codelineno-67-32" href="#__codelineno-67-32"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-67-33"><a id="__codelineno-67-33" name="__codelineno-67-33" href="#__codelineno-67-33"></a><span class="p">}</span>
</span><span id="__span-67-34"><a id="__codelineno-67-34" name="__codelineno-67-34" href="#__codelineno-67-34"></a>
</span><span id="__span-67-35"><a id="__codelineno-67-35" name="__codelineno-67-35" href="#__codelineno-67-35"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_policy&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-36"><a id="__codelineno-67-36" name="__codelineno-67-36" href="#__codelineno-67-36"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-67-37"><a id="__codelineno-67-37" name="__codelineno-67-37" href="#__codelineno-67-37"></a><span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-67-38"><a id="__codelineno-67-38" name="__codelineno-67-38" href="#__codelineno-67-38"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-67-39"><a id="__codelineno-67-39" name="__codelineno-67-39" href="#__codelineno-67-39"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-67-40"><a id="__codelineno-67-40" name="__codelineno-67-40" href="#__codelineno-67-40"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-67-41"><a id="__codelineno-67-41" name="__codelineno-67-41" href="#__codelineno-67-41"></a><span class="w">        </span><span class="na">Sid</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PublicReadGetObject&quot;</span>
</span><span id="__span-67-42"><a id="__codelineno-67-42" name="__codelineno-67-42" href="#__codelineno-67-42"></a><span class="w">        </span><span class="na">Effect</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-67-43"><a id="__codelineno-67-43" name="__codelineno-67-43" href="#__codelineno-67-43"></a><span class="w">        </span><span class="na">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-67-44"><a id="__codelineno-67-44" name="__codelineno-67-44" href="#__codelineno-67-44"></a><span class="w">        </span><span class="na">Action</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;s3:GetObject&quot;</span>
</span><span id="__span-67-45"><a id="__codelineno-67-45" name="__codelineno-67-45" href="#__codelineno-67-45"></a><span class="w">        </span><span class="na">Resource</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${aws_s3_bucket.website.arn}/*&quot;</span>
</span><span id="__span-67-46"><a id="__codelineno-67-46" name="__codelineno-67-46" href="#__codelineno-67-46"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-67-47"><a id="__codelineno-67-47" name="__codelineno-67-47" href="#__codelineno-67-47"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-67-48"><a id="__codelineno-67-48" name="__codelineno-67-48" href="#__codelineno-67-48"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-67-49"><a id="__codelineno-67-49" name="__codelineno-67-49" href="#__codelineno-67-49"></a><span class="p">}</span>
</span><span id="__span-67-50"><a id="__codelineno-67-50" name="__codelineno-67-50" href="#__codelineno-67-50"></a>
</span><span id="__span-67-51"><a id="__codelineno-67-51" name="__codelineno-67-51" href="#__codelineno-67-51"></a><span class="c1"># Enable versioning for rollback capability</span>
</span><span id="__span-67-52"><a id="__codelineno-67-52" name="__codelineno-67-52" href="#__codelineno-67-52"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_versioning&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-53"><a id="__codelineno-67-53" name="__codelineno-67-53" href="#__codelineno-67-53"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-67-54"><a id="__codelineno-67-54" name="__codelineno-67-54" href="#__codelineno-67-54"></a><span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-55"><a id="__codelineno-67-55" name="__codelineno-67-55" href="#__codelineno-67-55"></a><span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Enabled&quot;</span>
</span><span id="__span-67-56"><a id="__codelineno-67-56" name="__codelineno-67-56" href="#__codelineno-67-56"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-67-57"><a id="__codelineno-67-57" name="__codelineno-67-57" href="#__codelineno-67-57"></a><span class="p">}</span>
</span><span id="__span-67-58"><a id="__codelineno-67-58" name="__codelineno-67-58" href="#__codelineno-67-58"></a>
</span><span id="__span-67-59"><a id="__codelineno-67-59" name="__codelineno-67-59" href="#__codelineno-67-59"></a><span class="c1"># Add encryption for security</span>
</span><span id="__span-67-60"><a id="__codelineno-67-60" name="__codelineno-67-60" href="#__codelineno-67-60"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_server_side_encryption_configuration&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-61"><a id="__codelineno-67-61" name="__codelineno-67-61" href="#__codelineno-67-61"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-67-62"><a id="__codelineno-67-62" name="__codelineno-67-62" href="#__codelineno-67-62"></a>
</span><span id="__span-67-63"><a id="__codelineno-67-63" name="__codelineno-67-63" href="#__codelineno-67-63"></a><span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-64"><a id="__codelineno-67-64" name="__codelineno-67-64" href="#__codelineno-67-64"></a><span class="w">    </span><span class="nb">apply_server_side_encryption_by_default</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-67-65"><a id="__codelineno-67-65" name="__codelineno-67-65" href="#__codelineno-67-65"></a><span class="w">      </span><span class="na">sse_algorithm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AES256&quot;</span>
</span><span id="__span-67-66"><a id="__codelineno-67-66" name="__codelineno-67-66" href="#__codelineno-67-66"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-67-67"><a id="__codelineno-67-67" name="__codelineno-67-67" href="#__codelineno-67-67"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-67-68"><a id="__codelineno-67-68" name="__codelineno-67-68" href="#__codelineno-67-68"></a><span class="p">}</span>
</span></code></pre></div>
<p>Notice that I've included CORS configuration, which will be essential later when we integrate with our API. I also added encryption and versioning for better security and disaster recovery.</p>
<h4 id="2-acm-certificate-module"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#2-acm-certificate-module">2. ACM Certificate Module 🔒</a></h4>
<p>Create a file at <code>modules/frontend/acm.tf</code>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_acm_certificate&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="w">  </span><span class="na">domain_name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">var.domain_name</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="w">  </span><span class="na">validation_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DNS&quot;</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="w">  </span><span class="na">subject_alternative_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;www.${var.domain_name}&quot;</span><span class="p">]</span>
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a>
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a><span class="w">    </span><span class="na">create_before_destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-68-10"><a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a>
</span><span id="__span-68-11"><a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-12"><a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Website Certificate&quot;</span>
</span><span id="__span-68-13"><a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-68-14"><a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-68-15"><a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a><span class="p">}</span>
</span><span id="__span-68-16"><a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a>
</span><span id="__span-68-17"><a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_acm_certificate_validation&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-18"><a id="__codelineno-68-18" name="__codelineno-68-18" href="#__codelineno-68-18"></a><span class="w">  </span><span class="na">certificate_arn</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_acm_certificate.website.arn</span>
</span><span id="__span-68-19"><a id="__codelineno-68-19" name="__codelineno-68-19" href="#__codelineno-68-19"></a><span class="w">  </span><span class="na">validation_record_fqdns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="err">for</span><span class="w"> </span><span class="err">record</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="nv">aws_route53_record.certificate_validation</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">record.fqdn</span><span class="p">]</span>
</span><span id="__span-68-20"><a id="__codelineno-68-20" name="__codelineno-68-20" href="#__codelineno-68-20"></a>
</span><span id="__span-68-21"><a id="__codelineno-68-21" name="__codelineno-68-21" href="#__codelineno-68-21"></a><span class="c1">  # Wait for DNS propagation</span>
</span><span id="__span-68-22"><a id="__codelineno-68-22" name="__codelineno-68-22" href="#__codelineno-68-22"></a><span class="w">  </span><span class="nb">timeouts</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-23"><a id="__codelineno-68-23" name="__codelineno-68-23" href="#__codelineno-68-23"></a><span class="w">    </span><span class="na">create</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;30m&quot;</span>
</span><span id="__span-68-24"><a id="__codelineno-68-24" name="__codelineno-68-24" href="#__codelineno-68-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-68-25"><a id="__codelineno-68-25" name="__codelineno-68-25" href="#__codelineno-68-25"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="3-route-53-for-dns-configuration"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#3-route-53-for-dns-configuration">3. Route 53 for DNS Configuration 📡</a></h4>
<p>Create a file at <code>modules/frontend/route53.tf</code>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_route53_zone&quot;</span><span class="w"> </span><span class="nv">&quot;selected&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="w">  </span><span class="na">name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.root_domain_name</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="w">  </span><span class="na">private_zone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="p">}</span>
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_record&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="w">  </span><span class="na">zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_route53_zone.selected.zone_id</span>
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a><span class="w">  </span><span class="na">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">var.domain_name</span>
</span><span id="__span-69-9"><a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a><span class="w">  </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;A&quot;</span>
</span><span id="__span-69-10"><a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a>
</span><span id="__span-69-11"><a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a><span class="w">  </span><span class="nb">alias</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-12"><a id="__codelineno-69-12" name="__codelineno-69-12" href="#__codelineno-69-12"></a><span class="w">    </span><span class="na">name</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.domain_name</span>
</span><span id="__span-69-13"><a id="__codelineno-69-13" name="__codelineno-69-13" href="#__codelineno-69-13"></a><span class="w">    </span><span class="na">zone_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.hosted_zone_id</span>
</span><span id="__span-69-14"><a id="__codelineno-69-14" name="__codelineno-69-14" href="#__codelineno-69-14"></a><span class="w">    </span><span class="na">evaluate_target_health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-69-15"><a id="__codelineno-69-15" name="__codelineno-69-15" href="#__codelineno-69-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-69-16"><a id="__codelineno-69-16" name="__codelineno-69-16" href="#__codelineno-69-16"></a><span class="p">}</span>
</span><span id="__span-69-17"><a id="__codelineno-69-17" name="__codelineno-69-17" href="#__codelineno-69-17"></a>
</span><span id="__span-69-18"><a id="__codelineno-69-18" name="__codelineno-69-18" href="#__codelineno-69-18"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_record&quot;</span><span class="w"> </span><span class="nv">&quot;www&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-19"><a id="__codelineno-69-19" name="__codelineno-69-19" href="#__codelineno-69-19"></a><span class="w">  </span><span class="na">zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_route53_zone.selected.zone_id</span>
</span><span id="__span-69-20"><a id="__codelineno-69-20" name="__codelineno-69-20" href="#__codelineno-69-20"></a><span class="w">  </span><span class="na">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;www.${var.domain_name}&quot;</span>
</span><span id="__span-69-21"><a id="__codelineno-69-21" name="__codelineno-69-21" href="#__codelineno-69-21"></a><span class="w">  </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;A&quot;</span>
</span><span id="__span-69-22"><a id="__codelineno-69-22" name="__codelineno-69-22" href="#__codelineno-69-22"></a>
</span><span id="__span-69-23"><a id="__codelineno-69-23" name="__codelineno-69-23" href="#__codelineno-69-23"></a><span class="w">  </span><span class="nb">alias</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-24"><a id="__codelineno-69-24" name="__codelineno-69-24" href="#__codelineno-69-24"></a><span class="w">    </span><span class="na">name</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.domain_name</span>
</span><span id="__span-69-25"><a id="__codelineno-69-25" name="__codelineno-69-25" href="#__codelineno-69-25"></a><span class="w">    </span><span class="na">zone_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.hosted_zone_id</span>
</span><span id="__span-69-26"><a id="__codelineno-69-26" name="__codelineno-69-26" href="#__codelineno-69-26"></a><span class="w">    </span><span class="na">evaluate_target_health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-69-27"><a id="__codelineno-69-27" name="__codelineno-69-27" href="#__codelineno-69-27"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-69-28"><a id="__codelineno-69-28" name="__codelineno-69-28" href="#__codelineno-69-28"></a><span class="p">}</span>
</span><span id="__span-69-29"><a id="__codelineno-69-29" name="__codelineno-69-29" href="#__codelineno-69-29"></a>
</span><span id="__span-69-30"><a id="__codelineno-69-30" name="__codelineno-69-30" href="#__codelineno-69-30"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_record&quot;</span><span class="w"> </span><span class="nv">&quot;certificate_validation&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-31"><a id="__codelineno-69-31" name="__codelineno-69-31" href="#__codelineno-69-31"></a><span class="w">  </span><span class="nb">for_each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-32"><a id="__codelineno-69-32" name="__codelineno-69-32" href="#__codelineno-69-32"></a><span class="w">    </span><span class="err">for</span><span class="w"> </span><span class="err">dvo</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="nv">aws_acm_certificate.website.domain_validation_options</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">dvo.domain_name</span><span class="w"> </span><span class="p">=</span><span class="err">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-33"><a id="__codelineno-69-33" name="__codelineno-69-33" href="#__codelineno-69-33"></a><span class="w">      </span><span class="na">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">dvo.resource_record_name</span>
</span><span id="__span-69-34"><a id="__codelineno-69-34" name="__codelineno-69-34" href="#__codelineno-69-34"></a><span class="w">      </span><span class="na">record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dvo.resource_record_value</span>
</span><span id="__span-69-35"><a id="__codelineno-69-35" name="__codelineno-69-35" href="#__codelineno-69-35"></a><span class="w">      </span><span class="na">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">dvo.resource_record_type</span>
</span><span id="__span-69-36"><a id="__codelineno-69-36" name="__codelineno-69-36" href="#__codelineno-69-36"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-69-37"><a id="__codelineno-69-37" name="__codelineno-69-37" href="#__codelineno-69-37"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-69-38"><a id="__codelineno-69-38" name="__codelineno-69-38" href="#__codelineno-69-38"></a>
</span><span id="__span-69-39"><a id="__codelineno-69-39" name="__codelineno-69-39" href="#__codelineno-69-39"></a><span class="w">  </span><span class="na">allow_overwrite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-69-40"><a id="__codelineno-69-40" name="__codelineno-69-40" href="#__codelineno-69-40"></a><span class="w">  </span><span class="na">name</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">each.value.name</span>
</span><span id="__span-69-41"><a id="__codelineno-69-41" name="__codelineno-69-41" href="#__codelineno-69-41"></a><span class="w">  </span><span class="na">records</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">each.value.record</span><span class="p">]</span>
</span><span id="__span-69-42"><a id="__codelineno-69-42" name="__codelineno-69-42" href="#__codelineno-69-42"></a><span class="w">  </span><span class="na">ttl</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="m">60</span>
</span><span id="__span-69-43"><a id="__codelineno-69-43" name="__codelineno-69-43" href="#__codelineno-69-43"></a><span class="w">  </span><span class="na">type</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">each.value.type</span>
</span><span id="__span-69-44"><a id="__codelineno-69-44" name="__codelineno-69-44" href="#__codelineno-69-44"></a><span class="w">  </span><span class="na">zone_id</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_route53_zone.selected.zone_id</span>
</span><span id="__span-69-45"><a id="__codelineno-69-45" name="__codelineno-69-45" href="#__codelineno-69-45"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="4-cloudfront-distribution-for-cdn-and-https"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#4-cloudfront-distribution-for-cdn-and-https">4. CloudFront Distribution for CDN and HTTPS 🌍</a></h4>
<p>Create a file at <code>modules/frontend/cloudfront.tf</code>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudfront_distribution&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="w">  </span><span class="nb">origin</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="w">    </span><span class="na">domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.bucket_regional_domain_name</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="w">    </span><span class="na">origin_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S3-${var.website_bucket_name}&quot;</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="w">    </span><span class="nb">s3_origin_config</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="w">      </span><span class="na">origin_access_identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_origin_access_identity.website.cloudfront_access_identity_path</span>
</span><span id="__span-70-8"><a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-70-9"><a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-70-10"><a id="__codelineno-70-10" name="__codelineno-70-10" href="#__codelineno-70-10"></a>
</span><span id="__span-70-11"><a id="__codelineno-70-11" name="__codelineno-70-11" href="#__codelineno-70-11"></a><span class="w">  </span><span class="na">enabled</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-70-12"><a id="__codelineno-70-12" name="__codelineno-70-12" href="#__codelineno-70-12"></a><span class="w">  </span><span class="na">is_ipv6_enabled</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-70-13"><a id="__codelineno-70-13" name="__codelineno-70-13" href="#__codelineno-70-13"></a><span class="w">  </span><span class="na">default_root_object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.html&quot;</span>
</span><span id="__span-70-14"><a id="__codelineno-70-14" name="__codelineno-70-14" href="#__codelineno-70-14"></a><span class="w">  </span><span class="na">aliases</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">var.domain_name</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;www.${var.domain_name}&quot;</span><span class="p">]</span>
</span><span id="__span-70-15"><a id="__codelineno-70-15" name="__codelineno-70-15" href="#__codelineno-70-15"></a><span class="w">  </span><span class="na">price_class</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PriceClass_100&quot;</span>
</span><span id="__span-70-16"><a id="__codelineno-70-16" name="__codelineno-70-16" href="#__codelineno-70-16"></a>
</span><span id="__span-70-17"><a id="__codelineno-70-17" name="__codelineno-70-17" href="#__codelineno-70-17"></a><span class="w">  </span><span class="nb">default_cache_behavior</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-18"><a id="__codelineno-70-18" name="__codelineno-70-18" href="#__codelineno-70-18"></a><span class="w">    </span><span class="na">allowed_methods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;, &quot;OPTIONS&quot;</span><span class="p">]</span>
</span><span id="__span-70-19"><a id="__codelineno-70-19" name="__codelineno-70-19" href="#__codelineno-70-19"></a><span class="w">    </span><span class="na">cached_methods</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;</span><span class="p">]</span>
</span><span id="__span-70-20"><a id="__codelineno-70-20" name="__codelineno-70-20" href="#__codelineno-70-20"></a><span class="w">    </span><span class="na">target_origin_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S3-${var.website_bucket_name}&quot;</span>
</span><span id="__span-70-21"><a id="__codelineno-70-21" name="__codelineno-70-21" href="#__codelineno-70-21"></a>
</span><span id="__span-70-22"><a id="__codelineno-70-22" name="__codelineno-70-22" href="#__codelineno-70-22"></a><span class="w">    </span><span class="nb">forwarded_values</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-23"><a id="__codelineno-70-23" name="__codelineno-70-23" href="#__codelineno-70-23"></a><span class="w">      </span><span class="na">query_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-70-24"><a id="__codelineno-70-24" name="__codelineno-70-24" href="#__codelineno-70-24"></a><span class="w">      </span><span class="nb">cookies</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-25"><a id="__codelineno-70-25" name="__codelineno-70-25" href="#__codelineno-70-25"></a><span class="w">        </span><span class="na">forward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span>
</span><span id="__span-70-26"><a id="__codelineno-70-26" name="__codelineno-70-26" href="#__codelineno-70-26"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-70-27"><a id="__codelineno-70-27" name="__codelineno-70-27" href="#__codelineno-70-27"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-70-28"><a id="__codelineno-70-28" name="__codelineno-70-28" href="#__codelineno-70-28"></a>
</span><span id="__span-70-29"><a id="__codelineno-70-29" name="__codelineno-70-29" href="#__codelineno-70-29"></a><span class="w">    </span><span class="na">viewer_protocol_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;redirect-to-https&quot;</span>
</span><span id="__span-70-30"><a id="__codelineno-70-30" name="__codelineno-70-30" href="#__codelineno-70-30"></a><span class="w">    </span><span class="na">min_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-70-31"><a id="__codelineno-70-31" name="__codelineno-70-31" href="#__codelineno-70-31"></a><span class="w">    </span><span class="na">default_ttl</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="m">3600</span>
</span><span id="__span-70-32"><a id="__codelineno-70-32" name="__codelineno-70-32" href="#__codelineno-70-32"></a><span class="w">    </span><span class="na">max_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">86400</span>
</span><span id="__span-70-33"><a id="__codelineno-70-33" name="__codelineno-70-33" href="#__codelineno-70-33"></a><span class="w">    </span><span class="na">compress</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-70-34"><a id="__codelineno-70-34" name="__codelineno-70-34" href="#__codelineno-70-34"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-70-35"><a id="__codelineno-70-35" name="__codelineno-70-35" href="#__codelineno-70-35"></a>
</span><span id="__span-70-36"><a id="__codelineno-70-36" name="__codelineno-70-36" href="#__codelineno-70-36"></a><span class="c1">  # Cache behaviors for specific patterns</span>
</span><span id="__span-70-37"><a id="__codelineno-70-37" name="__codelineno-70-37" href="#__codelineno-70-37"></a><span class="w">  </span><span class="nb">ordered_cache_behavior</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-38"><a id="__codelineno-70-38" name="__codelineno-70-38" href="#__codelineno-70-38"></a><span class="w">    </span><span class="na">path_pattern</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*.js&quot;</span>
</span><span id="__span-70-39"><a id="__codelineno-70-39" name="__codelineno-70-39" href="#__codelineno-70-39"></a><span class="w">    </span><span class="na">allowed_methods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;, &quot;OPTIONS&quot;</span><span class="p">]</span>
</span><span id="__span-70-40"><a id="__codelineno-70-40" name="__codelineno-70-40" href="#__codelineno-70-40"></a><span class="w">    </span><span class="na">cached_methods</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;</span><span class="p">]</span>
</span><span id="__span-70-41"><a id="__codelineno-70-41" name="__codelineno-70-41" href="#__codelineno-70-41"></a><span class="w">    </span><span class="na">target_origin_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S3-${var.website_bucket_name}&quot;</span>
</span><span id="__span-70-42"><a id="__codelineno-70-42" name="__codelineno-70-42" href="#__codelineno-70-42"></a>
</span><span id="__span-70-43"><a id="__codelineno-70-43" name="__codelineno-70-43" href="#__codelineno-70-43"></a><span class="w">    </span><span class="nb">forwarded_values</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-44"><a id="__codelineno-70-44" name="__codelineno-70-44" href="#__codelineno-70-44"></a><span class="w">      </span><span class="na">query_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-70-45"><a id="__codelineno-70-45" name="__codelineno-70-45" href="#__codelineno-70-45"></a><span class="w">      </span><span class="nb">cookies</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-46"><a id="__codelineno-70-46" name="__codelineno-70-46" href="#__codelineno-70-46"></a><span class="w">        </span><span class="na">forward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span>
</span><span id="__span-70-47"><a id="__codelineno-70-47" name="__codelineno-70-47" href="#__codelineno-70-47"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-70-48"><a id="__codelineno-70-48" name="__codelineno-70-48" href="#__codelineno-70-48"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-70-49"><a id="__codelineno-70-49" name="__codelineno-70-49" href="#__codelineno-70-49"></a>
</span><span id="__span-70-50"><a id="__codelineno-70-50" name="__codelineno-70-50" href="#__codelineno-70-50"></a><span class="w">    </span><span class="na">viewer_protocol_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;redirect-to-https&quot;</span>
</span><span id="__span-70-51"><a id="__codelineno-70-51" name="__codelineno-70-51" href="#__codelineno-70-51"></a><span class="w">    </span><span class="na">min_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-70-52"><a id="__codelineno-70-52" name="__codelineno-70-52" href="#__codelineno-70-52"></a><span class="w">    </span><span class="na">default_ttl</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="m">86400</span>
</span><span id="__span-70-53"><a id="__codelineno-70-53" name="__codelineno-70-53" href="#__codelineno-70-53"></a><span class="w">    </span><span class="na">max_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">31536000</span>
</span><span id="__span-70-54"><a id="__codelineno-70-54" name="__codelineno-70-54" href="#__codelineno-70-54"></a><span class="w">    </span><span class="na">compress</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-70-55"><a id="__codelineno-70-55" name="__codelineno-70-55" href="#__codelineno-70-55"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-70-56"><a id="__codelineno-70-56" name="__codelineno-70-56" href="#__codelineno-70-56"></a>
</span><span id="__span-70-57"><a id="__codelineno-70-57" name="__codelineno-70-57" href="#__codelineno-70-57"></a><span class="w">  </span><span class="nb">ordered_cache_behavior</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-58"><a id="__codelineno-70-58" name="__codelineno-70-58" href="#__codelineno-70-58"></a><span class="w">    </span><span class="na">path_pattern</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*.css&quot;</span>
</span><span id="__span-70-59"><a id="__codelineno-70-59" name="__codelineno-70-59" href="#__codelineno-70-59"></a><span class="w">    </span><span class="na">allowed_methods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;, &quot;OPTIONS&quot;</span><span class="p">]</span>
</span><span id="__span-70-60"><a id="__codelineno-70-60" name="__codelineno-70-60" href="#__codelineno-70-60"></a><span class="w">    </span><span class="na">cached_methods</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;</span><span class="p">]</span>
</span><span id="__span-70-61"><a id="__codelineno-70-61" name="__codelineno-70-61" href="#__codelineno-70-61"></a><span class="w">    </span><span class="na">target_origin_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S3-${var.website_bucket_name}&quot;</span>
</span><span id="__span-70-62"><a id="__codelineno-70-62" name="__codelineno-70-62" href="#__codelineno-70-62"></a>
</span><span id="__span-70-63"><a id="__codelineno-70-63" name="__codelineno-70-63" href="#__codelineno-70-63"></a><span class="w">    </span><span class="nb">forwarded_values</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-64"><a id="__codelineno-70-64" name="__codelineno-70-64" href="#__codelineno-70-64"></a><span class="w">      </span><span class="na">query_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-70-65"><a id="__codelineno-70-65" name="__codelineno-70-65" href="#__codelineno-70-65"></a><span class="w">      </span><span class="nb">cookies</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-66"><a id="__codelineno-70-66" name="__codelineno-70-66" href="#__codelineno-70-66"></a><span class="w">        </span><span class="na">forward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span>
</span><span id="__span-70-67"><a id="__codelineno-70-67" name="__codelineno-70-67" href="#__codelineno-70-67"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-70-68"><a id="__codelineno-70-68" name="__codelineno-70-68" href="#__codelineno-70-68"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-70-69"><a id="__codelineno-70-69" name="__codelineno-70-69" href="#__codelineno-70-69"></a>
</span><span id="__span-70-70"><a id="__codelineno-70-70" name="__codelineno-70-70" href="#__codelineno-70-70"></a><span class="w">    </span><span class="na">viewer_protocol_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;redirect-to-https&quot;</span>
</span><span id="__span-70-71"><a id="__codelineno-70-71" name="__codelineno-70-71" href="#__codelineno-70-71"></a><span class="w">    </span><span class="na">min_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-70-72"><a id="__codelineno-70-72" name="__codelineno-70-72" href="#__codelineno-70-72"></a><span class="w">    </span><span class="na">default_ttl</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="m">86400</span>
</span><span id="__span-70-73"><a id="__codelineno-70-73" name="__codelineno-70-73" href="#__codelineno-70-73"></a><span class="w">    </span><span class="na">max_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">31536000</span>
</span><span id="__span-70-74"><a id="__codelineno-70-74" name="__codelineno-70-74" href="#__codelineno-70-74"></a><span class="w">    </span><span class="na">compress</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-70-75"><a id="__codelineno-70-75" name="__codelineno-70-75" href="#__codelineno-70-75"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-70-76"><a id="__codelineno-70-76" name="__codelineno-70-76" href="#__codelineno-70-76"></a>
</span><span id="__span-70-77"><a id="__codelineno-70-77" name="__codelineno-70-77" href="#__codelineno-70-77"></a><span class="c1">  # Restrict access to North America and Europe</span>
</span><span id="__span-70-78"><a id="__codelineno-70-78" name="__codelineno-70-78" href="#__codelineno-70-78"></a><span class="w">  </span><span class="nb">restrictions</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-79"><a id="__codelineno-70-79" name="__codelineno-70-79" href="#__codelineno-70-79"></a><span class="w">    </span><span class="nb">geo_restriction</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-80"><a id="__codelineno-70-80" name="__codelineno-70-80" href="#__codelineno-70-80"></a><span class="w">      </span><span class="na">restriction_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;whitelist&quot;</span>
</span><span id="__span-70-81"><a id="__codelineno-70-81" name="__codelineno-70-81" href="#__codelineno-70-81"></a><span class="w">      </span><span class="na">locations</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;US&quot;, &quot;CA&quot;, &quot;GB&quot;, &quot;DE&quot;, &quot;FR&quot;, &quot;ES&quot;, &quot;IT&quot;</span><span class="p">]</span>
</span><span id="__span-70-82"><a id="__codelineno-70-82" name="__codelineno-70-82" href="#__codelineno-70-82"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-70-83"><a id="__codelineno-70-83" name="__codelineno-70-83" href="#__codelineno-70-83"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-70-84"><a id="__codelineno-70-84" name="__codelineno-70-84" href="#__codelineno-70-84"></a>
</span><span id="__span-70-85"><a id="__codelineno-70-85" name="__codelineno-70-85" href="#__codelineno-70-85"></a><span class="w">  </span><span class="nb">viewer_certificate</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-86"><a id="__codelineno-70-86" name="__codelineno-70-86" href="#__codelineno-70-86"></a><span class="w">    </span><span class="na">acm_certificate_arn</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_acm_certificate.website.arn</span>
</span><span id="__span-70-87"><a id="__codelineno-70-87" name="__codelineno-70-87" href="#__codelineno-70-87"></a><span class="w">    </span><span class="na">ssl_support_method</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sni-only&quot;</span>
</span><span id="__span-70-88"><a id="__codelineno-70-88" name="__codelineno-70-88" href="#__codelineno-70-88"></a><span class="w">    </span><span class="na">minimum_protocol_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;TLSv1.2_2021&quot;</span>
</span><span id="__span-70-89"><a id="__codelineno-70-89" name="__codelineno-70-89" href="#__codelineno-70-89"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-70-90"><a id="__codelineno-70-90" name="__codelineno-70-90" href="#__codelineno-70-90"></a>
</span><span id="__span-70-91"><a id="__codelineno-70-91" name="__codelineno-70-91" href="#__codelineno-70-91"></a><span class="c1">  # Add custom error response</span>
</span><span id="__span-70-92"><a id="__codelineno-70-92" name="__codelineno-70-92" href="#__codelineno-70-92"></a><span class="w">  </span><span class="nb">custom_error_response</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-93"><a id="__codelineno-70-93" name="__codelineno-70-93" href="#__codelineno-70-93"></a><span class="w">    </span><span class="na">error_code</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="m">404</span>
</span><span id="__span-70-94"><a id="__codelineno-70-94" name="__codelineno-70-94" href="#__codelineno-70-94"></a><span class="w">    </span><span class="na">response_code</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="m">404</span>
</span><span id="__span-70-95"><a id="__codelineno-70-95" name="__codelineno-70-95" href="#__codelineno-70-95"></a><span class="w">    </span><span class="na">response_page_path</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/error.html&quot;</span>
</span><span id="__span-70-96"><a id="__codelineno-70-96" name="__codelineno-70-96" href="#__codelineno-70-96"></a><span class="w">    </span><span class="na">error_caching_min_ttl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>
</span><span id="__span-70-97"><a id="__codelineno-70-97" name="__codelineno-70-97" href="#__codelineno-70-97"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-70-98"><a id="__codelineno-70-98" name="__codelineno-70-98" href="#__codelineno-70-98"></a>
</span><span id="__span-70-99"><a id="__codelineno-70-99" name="__codelineno-70-99" href="#__codelineno-70-99"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-100"><a id="__codelineno-70-100" name="__codelineno-70-100" href="#__codelineno-70-100"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Website CloudFront&quot;</span>
</span><span id="__span-70-101"><a id="__codelineno-70-101" name="__codelineno-70-101" href="#__codelineno-70-101"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-70-102"><a id="__codelineno-70-102" name="__codelineno-70-102" href="#__codelineno-70-102"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-70-103"><a id="__codelineno-70-103" name="__codelineno-70-103" href="#__codelineno-70-103"></a>
</span><span id="__span-70-104"><a id="__codelineno-70-104" name="__codelineno-70-104" href="#__codelineno-70-104"></a><span class="w">  </span><span class="na">depends_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_acm_certificate_validation.website</span><span class="p">]</span>
</span><span id="__span-70-105"><a id="__codelineno-70-105" name="__codelineno-70-105" href="#__codelineno-70-105"></a><span class="p">}</span>
</span><span id="__span-70-106"><a id="__codelineno-70-106" name="__codelineno-70-106" href="#__codelineno-70-106"></a>
</span><span id="__span-70-107"><a id="__codelineno-70-107" name="__codelineno-70-107" href="#__codelineno-70-107"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudfront_origin_access_identity&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-108"><a id="__codelineno-70-108" name="__codelineno-70-108" href="#__codelineno-70-108"></a><span class="w">  </span><span class="na">comment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Access identity for Resume Website CloudFront&quot;</span>
</span><span id="__span-70-109"><a id="__codelineno-70-109" name="__codelineno-70-109" href="#__codelineno-70-109"></a><span class="p">}</span>
</span><span id="__span-70-110"><a id="__codelineno-70-110" name="__codelineno-70-110" href="#__codelineno-70-110"></a>
</span><span id="__span-70-111"><a id="__codelineno-70-111" name="__codelineno-70-111" href="#__codelineno-70-111"></a><span class="c1"># Update S3 bucket policy to allow access from CloudFront</span>
</span><span id="__span-70-112"><a id="__codelineno-70-112" name="__codelineno-70-112" href="#__codelineno-70-112"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_policy&quot;</span><span class="w"> </span><span class="nv">&quot;cloudfront_access&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-113"><a id="__codelineno-70-113" name="__codelineno-70-113" href="#__codelineno-70-113"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-70-114"><a id="__codelineno-70-114" name="__codelineno-70-114" href="#__codelineno-70-114"></a><span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-70-115"><a id="__codelineno-70-115" name="__codelineno-70-115" href="#__codelineno-70-115"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-70-116"><a id="__codelineno-70-116" name="__codelineno-70-116" href="#__codelineno-70-116"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-70-117"><a id="__codelineno-70-117" name="__codelineno-70-117" href="#__codelineno-70-117"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-70-118"><a id="__codelineno-70-118" name="__codelineno-70-118" href="#__codelineno-70-118"></a><span class="w">        </span><span class="na">Sid</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AllowCloudFrontServicePrincipal&quot;</span>
</span><span id="__span-70-119"><a id="__codelineno-70-119" name="__codelineno-70-119" href="#__codelineno-70-119"></a><span class="w">        </span><span class="na">Effect</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-70-120"><a id="__codelineno-70-120" name="__codelineno-70-120" href="#__codelineno-70-120"></a><span class="w">        </span><span class="nb">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-121"><a id="__codelineno-70-121" name="__codelineno-70-121" href="#__codelineno-70-121"></a><span class="w">          </span><span class="na">Service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cloudfront.amazonaws.com&quot;</span>
</span><span id="__span-70-122"><a id="__codelineno-70-122" name="__codelineno-70-122" href="#__codelineno-70-122"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-70-123"><a id="__codelineno-70-123" name="__codelineno-70-123" href="#__codelineno-70-123"></a><span class="w">        </span><span class="na">Action</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;s3:GetObject&quot;</span>
</span><span id="__span-70-124"><a id="__codelineno-70-124" name="__codelineno-70-124" href="#__codelineno-70-124"></a><span class="w">        </span><span class="na">Resource</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${aws_s3_bucket.website.arn}/*&quot;</span>
</span><span id="__span-70-125"><a id="__codelineno-70-125" name="__codelineno-70-125" href="#__codelineno-70-125"></a><span class="w">        </span><span class="nb">Condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-126"><a id="__codelineno-70-126" name="__codelineno-70-126" href="#__codelineno-70-126"></a><span class="w">          </span><span class="nb">StringEquals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-127"><a id="__codelineno-70-127" name="__codelineno-70-127" href="#__codelineno-70-127"></a><span class="w">            </span><span class="s2">&quot;AWS:SourceArn&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.arn</span>
</span><span id="__span-70-128"><a id="__codelineno-70-128" name="__codelineno-70-128" href="#__codelineno-70-128"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-70-129"><a id="__codelineno-70-129" name="__codelineno-70-129" href="#__codelineno-70-129"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-70-130"><a id="__codelineno-70-130" name="__codelineno-70-130" href="#__codelineno-70-130"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-70-131"><a id="__codelineno-70-131" name="__codelineno-70-131" href="#__codelineno-70-131"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-70-132"><a id="__codelineno-70-132" name="__codelineno-70-132" href="#__codelineno-70-132"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-70-133"><a id="__codelineno-70-133" name="__codelineno-70-133" href="#__codelineno-70-133"></a><span class="p">}</span>
</span></code></pre></div>
<p>I've implemented several security enhancements:</p>
<ul>
<li>Using origin access control for CloudFront</li>
<li>Restricting the content to specific geographic regions</li>
<li>Setting TLS to more modern protocols</li>
<li>Creating custom error pages</li>
<li>Adding better cache controls for different file types</li>
</ul>
<h4 id="5-variables-and-outputs"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#5-variables-and-outputs">5. Variables and Outputs 📝</a></h4>
<p>Create files at <code>modules/frontend/variables.tf</code> and <code>modules/frontend/outputs.tf</code>:</p>
<p><strong>variables.tf</strong>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;website_bucket_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Name of the S3 bucket to store website content&quot;</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="p">}</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;domain_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Domain name for the website&quot;</span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="p">}</span>
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a>
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;root_domain_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Root domain name to find Route 53 hosted zone&quot;</span>
</span><span id="__span-71-13"><a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-71-14"><a id="__codelineno-71-14" name="__codelineno-71-14" href="#__codelineno-71-14"></a><span class="p">}</span>
</span><span id="__span-71-15"><a id="__codelineno-71-15" name="__codelineno-71-15" href="#__codelineno-71-15"></a>
</span><span id="__span-71-16"><a id="__codelineno-71-16" name="__codelineno-71-16" href="#__codelineno-71-16"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;environment&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-71-17"><a id="__codelineno-71-17" name="__codelineno-71-17" href="#__codelineno-71-17"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Deployment environment (e.g., dev, prod)&quot;</span>
</span><span id="__span-71-18"><a id="__codelineno-71-18" name="__codelineno-71-18" href="#__codelineno-71-18"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-71-19"><a id="__codelineno-71-19" name="__codelineno-71-19" href="#__codelineno-71-19"></a><span class="w">  </span><span class="na">default</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dev&quot;</span>
</span><span id="__span-71-20"><a id="__codelineno-71-20" name="__codelineno-71-20" href="#__codelineno-71-20"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>outputs.tf</strong>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;website_bucket_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Name of the S3 bucket hosting the website&quot;</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="p">}</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;cloudfront_distribution_id&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-72-7"><a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ID of the CloudFront distribution&quot;</span>
</span><span id="__span-72-8"><a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.id</span>
</span><span id="__span-72-9"><a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a><span class="p">}</span>
</span><span id="__span-72-10"><a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a>
</span><span id="__span-72-11"><a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;website_domain&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-72-12"><a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Domain name of the website&quot;</span>
</span><span id="__span-72-13"><a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">var.domain_name</span>
</span><span id="__span-72-14"><a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a><span class="p">}</span>
</span><span id="__span-72-15"><a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a>
</span><span id="__span-72-16"><a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;cloudfront_domain_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-72-17"><a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;CloudFront domain name&quot;</span>
</span><span id="__span-72-18"><a id="__codelineno-72-18" name="__codelineno-72-18" href="#__codelineno-72-18"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.domain_name</span>
</span><span id="__span-72-19"><a id="__codelineno-72-19" name="__codelineno-72-19" href="#__codelineno-72-19"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="6-main-module-configuration"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#6-main-module-configuration">6. Main Module Configuration 🔄</a></h4>
<p>Now, let's create the main configuration in <code>main.tf</code> that uses our frontend module:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="kr">provider</span><span class="w"> </span><span class="nv">&quot;aws&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="w">  </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="p">}</span>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;frontend&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./modules/frontend&quot;</span>
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a>
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="w">  </span><span class="na">website_bucket_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;my-resume-website-${var.environment}&quot;</span>
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="w">  </span><span class="na">domain_name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.domain_name</span>
</span><span id="__span-73-10"><a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a><span class="w">  </span><span class="na">root_domain_name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">var.root_domain_name</span>
</span><span id="__span-73-11"><a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a><span class="w">  </span><span class="na">environment</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-73-12"><a id="__codelineno-73-12" name="__codelineno-73-12" href="#__codelineno-73-12"></a><span class="p">}</span>
</span></code></pre></div>
<p>In <code>variables.tf</code> at the root level:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;environment&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Deployment environment (e.g., dev, prod)&quot;</span>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="w">  </span><span class="na">default</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dev&quot;</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="p">}</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;domain_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Domain name for the website&quot;</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="p">}</span>
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a>
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;root_domain_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-74-13"><a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Root domain name to find Route 53 hosted zone&quot;</span>
</span><span id="__span-74-14"><a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-74-15"><a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="7-uploading-content-to-s3"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#7-uploading-content-to-s3">7. Uploading Content to S3 📤</a></h4>
<p>We can use Terraform to upload our website files to S3:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="c1"># Add to modules/frontend/s3.tf</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_object&quot;</span><span class="w"> </span><span class="nv">&quot;html&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="w">  </span><span class="na">bucket</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="w">  </span><span class="na">key</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.html&quot;</span>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="w">  </span><span class="na">source</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${path.module}/../../website/index.html&quot;</span>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="w">  </span><span class="na">content_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;text/html&quot;</span>
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="w">  </span><span class="na">etag</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nf">filemd5</span><span class="p">(</span><span class="s2">&quot;${path.module}/../../website/index.html&quot;</span><span class="p">)</span>
</span><span id="__span-75-8"><a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="p">}</span>
</span><span id="__span-75-9"><a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a>
</span><span id="__span-75-10"><a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_object&quot;</span><span class="w"> </span><span class="nv">&quot;css&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-11"><a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="w">  </span><span class="na">bucket</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-75-12"><a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a><span class="w">  </span><span class="na">key</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;styles.css&quot;</span>
</span><span id="__span-75-13"><a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a><span class="w">  </span><span class="na">source</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${path.module}/../../website/styles.css&quot;</span>
</span><span id="__span-75-14"><a id="__codelineno-75-14" name="__codelineno-75-14" href="#__codelineno-75-14"></a><span class="w">  </span><span class="na">content_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;text/css&quot;</span>
</span><span id="__span-75-15"><a id="__codelineno-75-15" name="__codelineno-75-15" href="#__codelineno-75-15"></a><span class="w">  </span><span class="na">etag</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nf">filemd5</span><span class="p">(</span><span class="s2">&quot;${path.module}/../../website/styles.css&quot;</span><span class="p">)</span>
</span><span id="__span-75-16"><a id="__codelineno-75-16" name="__codelineno-75-16" href="#__codelineno-75-16"></a><span class="p">}</span>
</span><span id="__span-75-17"><a id="__codelineno-75-17" name="__codelineno-75-17" href="#__codelineno-75-17"></a>
</span><span id="__span-75-18"><a id="__codelineno-75-18" name="__codelineno-75-18" href="#__codelineno-75-18"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_object&quot;</span><span class="w"> </span><span class="nv">&quot;js&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-19"><a id="__codelineno-75-19" name="__codelineno-75-19" href="#__codelineno-75-19"></a><span class="w">  </span><span class="na">bucket</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-75-20"><a id="__codelineno-75-20" name="__codelineno-75-20" href="#__codelineno-75-20"></a><span class="w">  </span><span class="na">key</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;counter.js&quot;</span>
</span><span id="__span-75-21"><a id="__codelineno-75-21" name="__codelineno-75-21" href="#__codelineno-75-21"></a><span class="w">  </span><span class="na">source</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${path.module}/../../website/counter.js&quot;</span>
</span><span id="__span-75-22"><a id="__codelineno-75-22" name="__codelineno-75-22" href="#__codelineno-75-22"></a><span class="w">  </span><span class="na">content_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/javascript&quot;</span>
</span><span id="__span-75-23"><a id="__codelineno-75-23" name="__codelineno-75-23" href="#__codelineno-75-23"></a><span class="w">  </span><span class="na">etag</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nf">filemd5</span><span class="p">(</span><span class="s2">&quot;${path.module}/../../website/counter.js&quot;</span><span class="p">)</span>
</span><span id="__span-75-24"><a id="__codelineno-75-24" name="__codelineno-75-24" href="#__codelineno-75-24"></a><span class="p">}</span>
</span><span id="__span-75-25"><a id="__codelineno-75-25" name="__codelineno-75-25" href="#__codelineno-75-25"></a>
</span><span id="__span-75-26"><a id="__codelineno-75-26" name="__codelineno-75-26" href="#__codelineno-75-26"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_object&quot;</span><span class="w"> </span><span class="nv">&quot;error_page&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-27"><a id="__codelineno-75-27" name="__codelineno-75-27" href="#__codelineno-75-27"></a><span class="w">  </span><span class="na">bucket</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-75-28"><a id="__codelineno-75-28" name="__codelineno-75-28" href="#__codelineno-75-28"></a><span class="w">  </span><span class="na">key</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;error.html&quot;</span>
</span><span id="__span-75-29"><a id="__codelineno-75-29" name="__codelineno-75-29" href="#__codelineno-75-29"></a><span class="w">  </span><span class="na">source</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${path.module}/../../website/error.html&quot;</span>
</span><span id="__span-75-30"><a id="__codelineno-75-30" name="__codelineno-75-30" href="#__codelineno-75-30"></a><span class="w">  </span><span class="na">content_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;text/html&quot;</span>
</span><span id="__span-75-31"><a id="__codelineno-75-31" name="__codelineno-75-31" href="#__codelineno-75-31"></a><span class="w">  </span><span class="na">etag</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nf">filemd5</span><span class="p">(</span><span class="s2">&quot;${path.module}/../../website/error.html&quot;</span><span class="p">)</span>
</span><span id="__span-75-32"><a id="__codelineno-75-32" name="__codelineno-75-32" href="#__codelineno-75-32"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="testing-your-deployment"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#testing-your-deployment">Testing Your Deployment 🧪</a></h3>
<p>After applying these Terraform configurations, you'll want to test that everything is working correctly:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="c1"># Initialize Terraform</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>terraform<span class="w"> </span>init
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="c1"># Plan the deployment</span>
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a>terraform<span class="w"> </span>plan<span class="w"> </span>-var<span class="o">=</span><span class="s2">&quot;domain_name=resume.yourdomain.com&quot;</span><span class="w"> </span>-var<span class="o">=</span><span class="s2">&quot;root_domain_name=yourdomain.com&quot;</span><span class="w"> </span>-var<span class="o">=</span><span class="s2">&quot;environment=dev&quot;</span>
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a>
</span><span id="__span-76-7"><a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="c1"># Apply the changes</span>
</span><span id="__span-76-8"><a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a>terraform<span class="w"> </span>apply<span class="w"> </span>-var<span class="o">=</span><span class="s2">&quot;domain_name=resume.yourdomain.com&quot;</span><span class="w"> </span>-var<span class="o">=</span><span class="s2">&quot;root_domain_name=yourdomain.com&quot;</span><span class="w"> </span>-var<span class="o">=</span><span class="s2">&quot;environment=dev&quot;</span>
</span></code></pre></div>
<p>Once deployment is complete, verify:</p>
<ol>
<li>Your domain resolves to your CloudFront distribution</li>
<li>HTTPS is working correctly</li>
<li>Your resume appears as expected</li>
<li>The website is accessible from different locations</li>
</ol>
<h3 id="troubleshooting-common-issues"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#troubleshooting-common-issues">Troubleshooting Common Issues ⚠️</a></h3>
<p>During my implementation, I encountered several challenges:</p>
<ol>
<li>
<p><strong>ACM Certificate Validation Delays</strong>: It can take up to 30 minutes for certificate validation to complete. Be patient or use the AWS console to monitor progress.</p>
</li>
<li>
<p><strong>CloudFront Distribution Propagation</strong>: CloudFront changes can take 15-20 minutes to propagate globally. If your site isn't loading correctly, wait and try again.</p>
</li>
<li>
<p><strong>S3 Bucket Policy Conflicts</strong>: If you receive errors about conflicting bucket policies, ensure that you're not applying multiple policies to the same bucket.</p>
</li>
<li>
<p><strong>CORS Configuration</strong>: Without proper CORS headers, your JavaScript won't be able to communicate with your API when we build it in the next post.</p>
</li>
</ol>
<h3 id="cors-configuration-for-api-integration"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#cors-configuration-for-api-integration">CORS Configuration for API Integration 🔄</a></h3>
<p>The Cloud Resume Challenge requires a JavaScript visitor counter that communicates with an API. To prepare for this, I've added CORS configuration to our S3 bucket. When we implement the API in the next post, we'll need to ensure it allows requests from our domain.</p>
<p>Here's the JavaScript snippet we'll use for the counter (to be implemented fully in the next post):</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="c1">// counter.js</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="w">  </span><span class="c1">// We&#39;ll need to fetch from our API</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="w">  </span><span class="c1">// Example: https://api.yourdomain.com/visitor-count</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="w">  </span><span class="c1">// For now, just a placeholder</span>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="w">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">).</span><span class="nx">innerText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Loading...&#39;</span><span class="p">;</span>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a>
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="w">  </span><span class="c1">// This will be implemented fully when we create our API</span>
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a><span class="w">  </span><span class="c1">// fetch(&#39;https://api.yourdomain.com/visitor-count&#39;)</span>
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a><span class="w">  </span><span class="c1">//   .then(response =&gt; response.json())</span>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a><span class="w">  </span><span class="c1">//   .then(data =&gt; {</span>
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a><span class="w">  </span><span class="c1">//     document.getElementById(&#39;count&#39;).innerText = data.count;</span>
</span><span id="__span-77-14"><a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a><span class="w">  </span><span class="c1">//   })</span>
</span><span id="__span-77-15"><a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a><span class="w">  </span><span class="c1">//   .catch(error =&gt; console.error(&#39;Error fetching visitor count:&#39;, error));</span>
</span><span id="__span-77-16"><a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a><span class="p">});</span>
</span></code></pre></div>
<h3 id="lessons-learned"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#lessons-learned">Lessons Learned 💡</a></h3>
<ol>
<li>
<p><strong>Domain Verification</strong>: I initially struggled with ACM certificate validation. The key lesson was to ensure that the Route 53 hosted zone existed before attempting to create validation records.</p>
</li>
<li>
<p><strong>Terraform State Management</strong>: When modifying existing resources, it's important to understand how Terraform tracks state. A single typo can lead to resource recreation rather than updates.</p>
</li>
<li>
<p><strong>Performance Optimization</strong>: Adding specific cache behaviors for CSS and JS files significantly improved page load times. It's worth taking the time to optimize these settings.</p>
</li>
<li>
<p><strong>Security Considerations</strong>: Setting up proper bucket policies and CloudFront origin access identity is critical to prevent direct access to your S3 bucket while still allowing CloudFront to serve content.</p>
</li>
</ol>
<h3 id="enhancements-and-mods"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#enhancements-and-mods">Enhancements and Mods 🚀</a></h3>
<p>Here are some ways to extend this part of the challenge:</p>
<h4 id="developer-mod-static-site-generator"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#developer-mod-static-site-generator">Developer Mod: Static Site Generator</a></h4>
<p>Instead of writing plain HTML/CSS, consider using a static site generator like Hugo or Jekyll:</p>
<ol>
<li>Install Hugo: <code>brew install hugo</code> (on macOS) or equivalent for your OS</li>
<li>Create a new site: <code>hugo new site resume-site</code></li>
<li>Choose a theme or create your own</li>
<li>Generate the site: <code>hugo -D</code></li>
<li>Modify your Terraform to upload the <code>public</code> directory contents to S3</li>
</ol>
<p>This approach gives you templating capabilities, making it easier to update and maintain your resume.</p>
<h4 id="devops-mod-content-invalidation-lambda"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#devops-mod-content-invalidation-lambda">DevOps Mod: Content Invalidation Lambda</a></h4>
<p>Create a Lambda function that automatically invalidates CloudFront cache when new content is uploaded to S3:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_function&quot;</span><span class="w"> </span><span class="nv">&quot;invalidation&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="w">  </span><span class="na">filename</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda_function.zip&quot;</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cloudfront-invalidation&quot;</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="w">  </span><span class="na">role</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.lambda_role.arn</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="w">  </span><span class="na">handler</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.handler&quot;</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="w">  </span><span class="na">runtime</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;nodejs14.x&quot;</span>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="w">  </span><span class="nb">environment</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a><span class="w">    </span><span class="nb">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="w">      </span><span class="na">DISTRIBUTION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.id</span>
</span><span id="__span-78-11"><a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-78-12"><a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-78-13"><a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a><span class="p">}</span>
</span><span id="__span-78-14"><a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a>
</span><span id="__span-78-15"><a id="__codelineno-78-15" name="__codelineno-78-15" href="#__codelineno-78-15"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_notification&quot;</span><span class="w"> </span><span class="nv">&quot;bucket_notification&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-78-16"><a id="__codelineno-78-16" name="__codelineno-78-16" href="#__codelineno-78-16"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-78-17"><a id="__codelineno-78-17" name="__codelineno-78-17" href="#__codelineno-78-17"></a>
</span><span id="__span-78-18"><a id="__codelineno-78-18" name="__codelineno-78-18" href="#__codelineno-78-18"></a><span class="w">  </span><span class="nb">lambda_function</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-78-19"><a id="__codelineno-78-19" name="__codelineno-78-19" href="#__codelineno-78-19"></a><span class="w">    </span><span class="na">lambda_function_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.invalidation.arn</span>
</span><span id="__span-78-20"><a id="__codelineno-78-20" name="__codelineno-78-20" href="#__codelineno-78-20"></a><span class="w">    </span><span class="na">events</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;s3:ObjectCreated:*&quot;, &quot;s3:ObjectRemoved:*&quot;</span><span class="p">]</span>
</span><span id="__span-78-21"><a id="__codelineno-78-21" name="__codelineno-78-21" href="#__codelineno-78-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-78-22"><a id="__codelineno-78-22" name="__codelineno-78-22" href="#__codelineno-78-22"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="security-mod-implement-dnssec"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#security-mod-implement-dnssec">Security Mod: Implement DNSSEC</a></h4>
<p>To prevent DNS spoofing attacks, implement DNSSEC for your domain:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_key_signing_key&quot;</span><span class="w"> </span><span class="nv">&quot;example&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="w">  </span><span class="na">hosted_zone_id</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_route53_zone.selected.id</span>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="w">  </span><span class="na">key_management_service_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_kms_key.dnssec.arn</span>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="w">  </span><span class="na">name</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;example&quot;</span>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="p">}</span>
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a>
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_hosted_zone_dnssec&quot;</span><span class="w"> </span><span class="nv">&quot;example&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a><span class="w">  </span><span class="na">hosted_zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_route53_key_signing_key.example.hosted_zone_id</span>
</span><span id="__span-79-9"><a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a><span class="p">}</span>
</span><span id="__span-79-10"><a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a>
</span><span id="__span-79-11"><a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_kms_key&quot;</span><span class="w"> </span><span class="nv">&quot;dnssec&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-12"><a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a><span class="w">  </span><span class="na">customer_master_key_spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ECC_NIST_P256&quot;</span>
</span><span id="__span-79-13"><a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a><span class="w">  </span><span class="na">deletion_window_in_days</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">7</span>
</span><span id="__span-79-14"><a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a><span class="w">  </span><span class="na">key_usage</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SIGN_VERIFY&quot;</span>
</span><span id="__span-79-15"><a id="__codelineno-79-15" name="__codelineno-79-15" href="#__codelineno-79-15"></a><span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-79-16"><a id="__codelineno-79-16" name="__codelineno-79-16" href="#__codelineno-79-16"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-79-17"><a id="__codelineno-79-17" name="__codelineno-79-17" href="#__codelineno-79-17"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-79-18"><a id="__codelineno-79-18" name="__codelineno-79-18" href="#__codelineno-79-18"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-79-19"><a id="__codelineno-79-19" name="__codelineno-79-19" href="#__codelineno-79-19"></a><span class="w">          </span><span class="s2">&quot;kms:DescribeKey&quot;</span><span class="p">,</span>
</span><span id="__span-79-20"><a id="__codelineno-79-20" name="__codelineno-79-20" href="#__codelineno-79-20"></a><span class="w">          </span><span class="s2">&quot;kms:GetPublicKey&quot;</span><span class="p">,</span>
</span><span id="__span-79-21"><a id="__codelineno-79-21" name="__codelineno-79-21" href="#__codelineno-79-21"></a><span class="w">          </span><span class="s2">&quot;kms:Sign&quot;</span><span class="p">,</span>
</span><span id="__span-79-22"><a id="__codelineno-79-22" name="__codelineno-79-22" href="#__codelineno-79-22"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-79-23"><a id="__codelineno-79-23" name="__codelineno-79-23" href="#__codelineno-79-23"></a><span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-79-24"><a id="__codelineno-79-24" name="__codelineno-79-24" href="#__codelineno-79-24"></a><span class="w">        </span><span class="nb">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-25"><a id="__codelineno-79-25" name="__codelineno-79-25" href="#__codelineno-79-25"></a><span class="w">          </span><span class="na">Service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dnssec-route53.amazonaws.com&quot;</span>
</span><span id="__span-79-26"><a id="__codelineno-79-26" name="__codelineno-79-26" href="#__codelineno-79-26"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-79-27"><a id="__codelineno-79-27" name="__codelineno-79-27" href="#__codelineno-79-27"></a><span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-79-28"><a id="__codelineno-79-28" name="__codelineno-79-28" href="#__codelineno-79-28"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-79-29"><a id="__codelineno-79-29" name="__codelineno-79-29" href="#__codelineno-79-29"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-79-30"><a id="__codelineno-79-30" name="__codelineno-79-30" href="#__codelineno-79-30"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;kms:*&quot;</span><span class="p">,</span>
</span><span id="__span-79-31"><a id="__codelineno-79-31" name="__codelineno-79-31" href="#__codelineno-79-31"></a><span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-79-32"><a id="__codelineno-79-32" name="__codelineno-79-32" href="#__codelineno-79-32"></a><span class="w">        </span><span class="nb">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-33"><a id="__codelineno-79-33" name="__codelineno-79-33" href="#__codelineno-79-33"></a><span class="w">          </span><span class="na">AWS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-79-34"><a id="__codelineno-79-34" name="__codelineno-79-34" href="#__codelineno-79-34"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-79-35"><a id="__codelineno-79-35" name="__codelineno-79-35" href="#__codelineno-79-35"></a><span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-79-36"><a id="__codelineno-79-36" name="__codelineno-79-36" href="#__codelineno-79-36"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-79-37"><a id="__codelineno-79-37" name="__codelineno-79-37" href="#__codelineno-79-37"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-79-38"><a id="__codelineno-79-38" name="__codelineno-79-38" href="#__codelineno-79-38"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-79-39"><a id="__codelineno-79-39" name="__codelineno-79-39" href="#__codelineno-79-39"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-79-40"><a id="__codelineno-79-40" name="__codelineno-79-40" href="#__codelineno-79-40"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="next-steps"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#next-steps">Next Steps ⏭️</a></h3>
<p>With our static website infrastructure in place, we now have a live resume hosted on AWS with a custom domain and HTTPS. In the next post, we'll build the <strong>backend API</strong> using <strong>API Gateway, Lambda, and DynamoDB</strong> to track visitor counts.</p>
<p>Stay tuned to see how we implement the serverless backend and connect it to our frontend!</p>
<hr />
<p><strong>Up Next:</strong> [Cloud Resume Challenge with Terraform: Building the Backend API] 🔗</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Cloud%20Resume%20Challenge%20with%20Terraform%3A%20Deploying%20the%20Static%20Website%0A&amp;url=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-deploying-the-static-website/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-deploying-the-static-website/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-17 00:00:00+00:00">March 17, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/aws/" class="md-meta__link">AWS</a>, 
              <a href="../../category/terraform/" class="md-meta__link">Terraform</a>, 
              <a href="../../category/devops/" class="md-meta__link">DevOps</a>, 
              <a href="../../category/cloud-resume-challenge/" class="md-meta__link">Cloud Resume Challenge</a></li>
        
        
          
          <li class="md-meta__item">
            
              5 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="cloud-resume-challenge-with-terraform-introduction-setup"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/">Cloud Resume Challenge with Terraform: Introduction &amp; Setup 🚀</a></h2>
<h3 id="introduction"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#introduction">Introduction 🌍</a></h3>
<p>The <strong>Cloud Resume Challenge</strong> is a hands-on project designed to build a <strong>real-world cloud application</strong> while showcasing your skills in <strong>AWS, serverless architecture, and automation</strong>. Many implementations of this challenge use AWS SAM or manual setup via the AWS console, but in this series, I will demonstrate how to <strong>build the entire infrastructure using Terraform</strong>. 💡</p>
<h4 id="my-journey-to-terraform"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#my-journey-to-terraform"><strong>My Journey to Terraform</strong> 🧰</a></h4>
<p>When I first discovered the Cloud Resume Challenge, I was immediately intrigued by the hands-on approach to learning cloud technologies. Having some experience with traditional IT but wanting to transition to a more cloud-focused role, I saw this challenge as the perfect opportunity to showcase my skills.</p>
<p>I chose Terraform over AWS SAM or CloudFormation because:</p>
<ol>
<li><strong>Multi-cloud flexibility</strong> - While this challenge focuses on AWS, Terraform skills transfer to Azure, GCP, and other providers</li>
<li><strong>Declarative approach</strong> - I find the HCL syntax more intuitive than YAML for defining infrastructure</li>
<li><strong>Industry adoption</strong> - In my research, I found that Terraform was highly sought after in job postings</li>
<li><strong>Strong community</strong> - The extensive module registry and community support made learning easier</li>
</ol>
<p>This series reflects my personal journey through the challenge, including the obstacles I overcame and the lessons I learned along the way.</p>
<h4 id="why-terraform"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#why-terraform"><strong>Why Terraform?</strong> 🛠️</a></h4>
<p>Terraform allows for <strong>Infrastructure as Code (IaC)</strong>, which:</p>
<ul>
<li><strong>Automates</strong> resource provisioning 🤖</li>
<li><strong>Ensures consistency</strong> across environments ✅</li>
<li><strong>Improves security</strong> by managing configurations centrally 🔒</li>
<li><strong>Enables version control</strong> for infrastructure changes 📝</li>
</ul>
<p>This series assumes <strong>basic knowledge of Terraform</strong> and will focus on <strong>highlighting key Terraform code snippets</strong> rather than full configuration files.</p>
<h3 id="project-overview"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#project-overview">Project Overview 🏗️</a></h3>
<p>Let's visualize the architecture we'll be building throughout this series:</p>
<p><img alt="Basic Project Diagram" src="../../crc-aws/CRCArchitecture.png" /></p>
<h4 id="aws-services-used"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#aws-services-used"><strong>AWS Services Used</strong> ☁️</a></h4>
<p>The project consists of the following AWS components:</p>
<ul>
<li><strong>Frontend:</strong> Static website hosted on <strong>S3</strong> and delivered via <strong>CloudFront</strong>.</li>
<li><strong>Backend API:</strong> API Gateway, Lambda, and DynamoDB to track visitor counts.</li>
<li><strong>Security:</strong> IAM roles, API Gateway security, and <strong>AWS Certificate Manager (ACM)</strong> for HTTPS 🔐.</li>
<li><strong>Automation:</strong> CI/CD with <strong>GitHub Actions</strong> to deploy infrastructure and update website content ⚡.</li>
</ul>
<h4 id="terraform-module-breakdown"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#terraform-module-breakdown"><strong>Terraform Module Breakdown</strong> 🧩</a></h4>
<p>To keep the infrastructure modular and maintainable, we will define Terraform modules for each major component:</p>
<ol>
<li><strong>S3 Module</strong> 📂: Manages the static website hosting.</li>
<li><strong>CloudFront Module</strong> 🌍: Ensures fast delivery and HTTPS encryption.</li>
<li><strong>Route 53 Module</strong> 📡: Handles DNS configuration.</li>
<li><strong>DynamoDB Module</strong> 📊: Stores visitor count data.</li>
<li><strong>Lambda Module</strong> 🏗️: Defines the backend API logic.</li>
<li><strong>API Gateway Module</strong> 🔗: Exposes the Lambda function via a REST API.</li>
<li><strong>ACM Module</strong> 🔒: Provides SSL/TLS certificates for secure communication.</li>
</ol>
<h3 id="setting-up-terraform"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#setting-up-terraform"><strong>Setting Up Terraform</strong> ⚙️</a></h3>
<p>Before deploying any resources, we need to set up <strong>Terraform and backend state management</strong> to store infrastructure changes securely.</p>
<h4 id="1-install-terraform-aws-cli"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#1-install-terraform-aws-cli"><strong>1. Install Terraform &amp; AWS CLI</strong> 🖥️</a></h4>
<p>Ensure you have the necessary tools installed:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># Install Terraform</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://apt.releases.hashicorp.com/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/usr/share/keyrings/hashicorp-archive-keyring.gpg
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/hashicorp.list
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>terraform
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="c1"># Install AWS CLI</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>curl<span class="w"> </span><span class="s2">&quot;https://awscli.amazonaws.com/AWSCLIV2.pkg&quot;</span><span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;AWSCLIV2.pkg&quot;</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>sudo<span class="w"> </span>installer<span class="w"> </span>-pkg<span class="w"> </span>AWSCLIV2.pkg<span class="w"> </span>-target<span class="w"> </span>/
</span></code></pre></div>
<h4 id="2-configure-aws-credentials-securely"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#2-configure-aws-credentials-securely"><strong>2. Configure AWS Credentials Securely</strong> 🔑</a></h4>
<p>Terraform interacts with AWS via credentials. Setting these up securely is crucial to avoid exposing sensitive information.</p>
<h5 id="setting-up-aws-account-structure"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#setting-up-aws-account-structure"><strong>Setting up AWS Account Structure</strong></a></h5>
<p>Following cloud security best practices, I recommend creating a proper AWS account structure:</p>
<ol>
<li><strong>Create a management AWS account</strong> for your organization</li>
<li><strong>Enable Multi-Factor Authentication (MFA)</strong> on the root account</li>
<li><strong>Create separate AWS accounts</strong> for development and production environments</li>
<li><strong>Set up AWS IAM Identity Center (formerly SSO)</strong> for secure access</li>
</ol>
<p>If you're just getting started, you can begin with a simpler setup:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># Configure AWS CLI with a dedicated IAM user (not root account)</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>aws<span class="w"> </span>configure
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="c1"># Test your configuration</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>aws<span class="w"> </span>sts<span class="w"> </span>get-caller-identity
</span></code></pre></div>
<p>Set up <strong>IAM permissions</strong> for Terraform by ensuring your IAM user has the necessary policies for provisioning resources. Start with a least privilege approach and add permissions as needed.</p>
<h4 id="3-set-up-remote-backend-for-terraform-state"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#3-set-up-remote-backend-for-terraform-state"><strong>3. Set Up Remote Backend for Terraform State</strong> 🏢</a></h4>
<p>Using a <strong>remote backend</strong> (such as an <strong>S3 bucket</strong>) prevents local state loss and enables collaboration.</p>
<h5 id="project-directory-structure"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#project-directory-structure"><strong>Project Directory Structure</strong></a></h5>
<p>Here's how I've organized my Terraform project:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>cloud-resume-challenge/
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>├── modules/
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>│   ├── frontend/
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>│   │   ├── main.tf
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>│   │   ├── variables.tf
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>│   │   └── outputs.tf
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>│   ├── backend/
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>│   │   ├── main.tf
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>│   │   ├── variables.tf
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>│   │   └── outputs.tf
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>│   └── networking/
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>│       ├── main.tf
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>│       ├── variables.tf
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>│       └── outputs.tf
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>├── environments/
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>│   ├── dev/
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>│   │   └── main.tf
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>│   └── prod/
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>│       └── main.tf
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>├── terraform.tf (backend config)
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>├── variables.tf
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>├── outputs.tf
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>└── main.tf
</span></code></pre></div>
<h5 id="define-the-backend-in-terraformtf"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#define-the-backend-in-terraformtf"><strong>Define the backend in <code>terraform.tf</code></strong></a></h5>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="nb">terraform</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">  </span><span class="kr">backend</span><span class="w"> </span><span class="nv">&quot;s3&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">    </span><span class="na">bucket</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;my-terraform-state-bucket&quot;</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">    </span><span class="na">key</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cloud-resume/state.tfstate&quot;</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">    </span><span class="na">region</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">    </span><span class="na">encrypt</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">    </span><span class="na">dynamodb_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-lock&quot;</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">  </span><span class="nb">required_providers</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="w">    </span><span class="nb">aws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="w">      </span><span class="na">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hashicorp/aws&quot;</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="w">      </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;~&gt; 4.16&quot;</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="w">  </span><span class="na">required_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&gt;= 1.2.0&quot;</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="p">}</span>
</span></code></pre></div>
<h5 id="create-s3-bucket-and-dynamodb-table-for-backend"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#create-s3-bucket-and-dynamodb-table-for-backend"><strong>Create S3 Bucket and DynamoDB Table for Backend</strong></a></h5>
<p>Before you can use an S3 backend, you need to create the bucket and DynamoDB table. I prefer to do this via Terraform as well, using a separate configuration:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># backend-setup/main.tf</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="kr">provider</span><span class="w"> </span><span class="nv">&quot;aws&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">  </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="p">}</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;terraform_state&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;my-terraform-state-bucket&quot;</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="p">}</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_versioning&quot;</span><span class="w"> </span><span class="nv">&quot;terraform_state&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.terraform_state.id</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Enabled&quot;</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="p">}</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_server_side_encryption_configuration&quot;</span><span class="w"> </span><span class="nv">&quot;terraform_state&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.terraform_state.id</span>
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a><span class="w">    </span><span class="nb">apply_server_side_encryption_by_default</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a><span class="w">      </span><span class="na">sse_algorithm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AES256&quot;</span>
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-28-24"><a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a><span class="p">}</span>
</span><span id="__span-28-25"><a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a>
</span><span id="__span-28-26"><a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_dynamodb_table&quot;</span><span class="w"> </span><span class="nv">&quot;terraform_locks&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-27"><a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a><span class="w">  </span><span class="na">name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-lock&quot;</span>
</span><span id="__span-28-28"><a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a><span class="w">  </span><span class="na">billing_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PAY_PER_REQUEST&quot;</span>
</span><span id="__span-28-29"><a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a><span class="w">  </span><span class="na">hash_key</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;LockID&quot;</span>
</span><span id="__span-28-30"><a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a>
</span><span id="__span-28-31"><a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a><span class="w">  </span><span class="nb">attribute</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-32"><a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a><span class="w">    </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;LockID&quot;</span>
</span><span id="__span-28-33"><a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a><span class="w">    </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S&quot;</span>
</span><span id="__span-28-34"><a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-28-35"><a id="__codelineno-28-35" name="__codelineno-28-35" href="#__codelineno-28-35"></a><span class="p">}</span>
</span></code></pre></div>
<p>Run these commands to set up your backend:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nb">cd</span><span class="w"> </span>backend-setup
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>terraform<span class="w"> </span>init
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>terraform<span class="w"> </span>apply
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="nb">cd</span><span class="w"> </span>..
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>terraform<span class="w"> </span>init<span class="w">  </span><span class="c1"># Initialize with the S3 backend</span>
</span></code></pre></div>
<h3 id="a-note-on-security"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#a-note-on-security"><strong>A Note on Security</strong> 🔒</a></h3>
<p>Throughout this series, I'll be emphasizing security best practices. Some key principles to keep in mind:</p>
<ol>
<li><strong>Never commit AWS credentials</strong> to your repository</li>
<li><strong>Use IAM roles with least privilege</strong> for all resources</li>
<li><strong>Enable encryption</strong> for sensitive data</li>
<li><strong>Implement proper security groups and network ACLs</strong></li>
<li><strong>Regularly rotate credentials and keys</strong></li>
</ol>
<p>These principles will be applied to our infrastructure as we build it in the upcoming posts.</p>
<h3 id="lessons-learned"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#lessons-learned"><strong>Lessons Learned</strong> 💡</a></h3>
<p>In my initial attempts at setting up the Terraform environment, I encountered several challenges:</p>
<ol>
<li>
<p><strong>State file management</strong>: I initially stored state locally, which caused problems when working from different computers. Switching to S3 backend solved this issue.</p>
</li>
<li>
<p><strong>Module organization</strong>: I tried several directory structures before settling on the current one. Organizing by component type rather than AWS service made the most sense for this project.</p>
</li>
<li>
<p><strong>Version constraints</strong>: Not specifying version constraints for providers led to unexpected behavior when Terraform updated. Always specify your provider versions!</p>
</li>
</ol>
<h3 id="next-steps"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#next-steps"><strong>Next Steps</strong> ⏭️</a></h3>
<p>In the next post, we'll build the <strong>static website infrastructure</strong> with <strong>S3, CloudFront, Route 53, and ACM</strong>. We'll create Terraform modules for each component and deploy them together to host our resume.</p>
<h4 id="developer-mod-advanced-terraform-techniques"><a class="toclink" href="../../cloud-resume-challenge-with-terraform-introduction--setup/#developer-mod-advanced-terraform-techniques"><strong>Developer Mod: Advanced Terraform Techniques</strong> 🚀</a></h4>
<p>If you're familiar with Terraform and want to take this challenge further, consider implementing these enhancements:</p>
<ol>
<li>
<p><strong>Terraform Cloud Integration</strong>: Connect your repository to Terraform Cloud for enhanced collaboration and run history.</p>
</li>
<li>
<p><strong>Terratest</strong>: Add infrastructure tests using the Terratest framework to validate your configurations.</p>
</li>
<li>
<p><strong>Custom Terraform Modules</strong>: Create reusable modules and publish them to the Terraform Registry.</p>
</li>
<li>
<p><strong>Terraform Workspaces</strong>: Use workspaces to manage multiple environments (dev, staging, prod) within the same Terraform configuration.</p>
</li>
</ol>
<hr />
<p><strong>Up Next:</strong> [Cloud Resume Challenge with Terraform: Deploying the Static Website] 🔗</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Cloud%20Resume%20Challenge%20with%20Terraform%3A%20Introduction%20%26%20Setup%0A&amp;url=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-introduction--setup/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-introduction--setup/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-12 00:00:00+00:00">March 12, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/azure/" class="md-meta__link">Azure</a>, 
              <a href="../../category/iis/" class="md-meta__link">IIS</a>, 
              <a href="../../category/application-insights/" class="md-meta__link">Application Insights</a></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="monitoring-an-iis-based-web-farm-with-azure-application-insights"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/">📊 Monitoring an IIS-Based Web Farm with Azure Application Insights</a></h2>
<p>In this guide, you'll learn how to:</p>
<p>✅ Set up <strong>Application Insights</strong> on an IIS-based web farm.<br />
✅ Configure <strong>Log Analytics</strong>, <strong>Data Collection Rules</strong>, and <strong>Data Collection Endpoints</strong>.<br />
✅ Use <strong>PowerShell</strong> to install the Application Insights agent.<br />
✅ Monitor <strong>live metrics, failures, performance, and logs</strong> in real-time.  </p>
<p>By the end, you'll have a <strong>fully monitored</strong> IIS-based web farm using Azure! 🎯</p>
<hr />
<h3 id="step-1-enabling-application-insights-on-iis-servers"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#step-1-enabling-application-insights-on-iis-servers">🏗️ <strong>Step 1: Enabling Application Insights on IIS Servers</strong></a></h3>
<p>To effectively monitor your IIS-based application, you need to configure Azure Application Insights and ensure all required components are installed on your Azure VMs.</p>
<h4 id="prerequisites"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#prerequisites">🛠️ <strong>Prerequisites</strong></a></h4>
<p>Before proceeding, ensure you have:</p>
<ul>
<li><strong>An active Azure Subscription</strong> with permissions to create and manage resources.</li>
<li><strong>A Log Analytics Workspace (LAW)</strong> to store collected telemetry data.</li>
<li><strong>Azure Monitor Agent (AMA)</strong> installed on your IIS VMs.</li>
<li><strong>Necessary permissions</strong> to create Data Collection Rules (DCRs) and Data Collection Endpoints (DCEs).</li>
</ul>
<h4 id="create-a-log-analytics-workspace"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#create-a-log-analytics-workspace"><strong>Create a Log Analytics Workspace</strong></a></h4>
<ol>
<li>Go to <strong>Azure Portal</strong> → <strong>Search for "Log Analytics Workspaces"</strong> → <strong>Create</strong>.</li>
<li>Provide the following details:</li>
<li><strong>Subscription</strong>: Select your Azure subscription.</li>
<li><strong>Resource Group</strong>: Choose or create a new one.</li>
<li><strong>Name</strong>: Enter a unique name (e.g., <code>log-corpapp-prod-uksouth</code>).</li>
<li><strong>Region</strong>: Same as your IIS VMs.</li>
<li><strong>Click "Review + Create"</strong> and deploy the workspace.</li>
</ol>
<p>🔗 <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/logs/log-analytics-workspace-overview">Microsoft Learn: Log Analytics Workspace</a></p>
<h4 id="create-a-data-collection-endpoint-dce"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#create-a-data-collection-endpoint-dce"><strong>Create a Data Collection Endpoint (DCE)</strong></a></h4>
<ol>
<li>Navigate to <strong>Monitor</strong> → <strong>Data Collection Endpoints</strong>.</li>
<li>Click <strong>"+ Create"</strong> and provide:</li>
<li><strong>Name</strong>: e.g., <code>dce-corpapp-prod-uksouth</code>.</li>
<li><strong>Subscription &amp; Resource Group</strong>: Same as your IIS VMs.</li>
<li><strong>Region</strong>: Same as Log Analytics Workspace.</li>
<li><strong>Review &amp; create the endpoint</strong>.</li>
</ol>
<p>🔗 <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/data-collection-endpoint-overview">Microsoft Learn: Data Collection Endpoints</a></p>
<h4 id="create-a-data-collection-rule-dcr"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#create-a-data-collection-rule-dcr"><strong>Create a Data Collection Rule (DCR)</strong></a></h4>
<ol>
<li>Go to <strong>Monitor</strong> → <strong>Data Collection Rules</strong> → <strong>+ Create</strong>.</li>
<li>Configure:</li>
<li><strong>Name</strong>: <code>dcr-corpapp-iis-prod-uksouth</code></li>
<li><strong>Subscription &amp; Resource Group</strong>: Same as above.</li>
<li><strong>Region</strong>: Same as DCE &amp; LAW.</li>
<li><strong>Define data sources</strong>:</li>
<li><strong>Windows Event Logs</strong>: Add <code>System</code>, <code>Application</code>, etc.</li>
<li><strong>Log Levels</strong>: Select relevant levels (Error, Warning, Information).</li>
<li><strong>Set Destination</strong>:</li>
<li>Choose <strong>"Log Analytics Workspace"</strong> → Select the previously created workspace.</li>
<li><strong>Associate with IIS VMs</strong> (<code>WEB01</code> - <code>WEB05</code>).</li>
<li><strong>Review &amp; Create the rule</strong>.</li>
</ol>
<p>🔗 <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/agents/data-collection-rule-overview">Microsoft Learn: Data Collection Rules</a></p>
<h4 id="install-the-azure-monitor-agent-ama"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#install-the-azure-monitor-agent-ama"><strong>Install the Azure Monitor Agent (AMA)</strong></a></h4>
<ol>
<li>Navigate to each IIS VM.</li>
<li>Under <strong>"Monitoring"</strong>, select <strong>"Extensions"</strong>.</li>
<li>Click <strong>"+ Add"</strong> → <strong>AzureMonitorWindowsAgent</strong> → Install.</li>
<li>Repeat for all IIS VMs.</li>
</ol>
<p>🔗 <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/agents/azure-monitor-agent-overview">Microsoft Learn: Azure Monitor Agent</a></p>
<h4 id="enable-application-insights"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#enable-application-insights"><strong>Enable Application Insights</strong></a></h4>
<ol>
<li>Navigate to <strong>Azure Portal</strong> → <strong>Search for "Application Insights"</strong>.</li>
<li>Click <strong>"+ Create"</strong> → Provide:</li>
<li><strong>Subscription &amp; Resource Group</strong>: Same as VMs.</li>
<li><strong>Name</strong>: <code>insights-corpapp-prod-uksouth-001</code>.</li>
<li><strong>Region</strong>: Same as your IIS VMs.</li>
<li><strong>Application Type</strong>: <strong>ASP.NET Web Application</strong>.</li>
<li><strong>Click "Review + Create"</strong> and deploy.</li>
</ol>
<p>🔗 <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/app/asp-net">Microsoft Learn: Enable Application Insights</a></p>
<h4 id="install-the-application-insights-agent"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#install-the-application-insights-agent"><strong>Install the Application Insights Agent</strong></a></h4>
<p>Use the following <strong>PowerShell script</strong> to install the agent on all of the IIS servers:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c"># Install the Application Insights Agent</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nv">$instrumentationKey</span> <span class="p">=</span> <span class="s2">&quot;YOUR-INSTRUMENTATION-KEY&quot;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nb">Install-PackageProvider</span> <span class="n">-Name</span> <span class="n">NuGet</span> <span class="n">-Force</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">ApplicationInsightsWebTracking</span> <span class="n">-Force</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="nb">Enable-ApplicationInsightsMonitoring</span> <span class="n">-InstrumentationKey</span> <span class="nv">$instrumentationKey</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="nb">Restart-Service</span> <span class="n">W3SVC</span>
</span></code></pre></div>
<hr />
<h3 id="step-2-using-application-insights-for-monitoring"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#step-2-using-application-insights-for-monitoring">📊 <strong>Step 2: Using Application Insights for Monitoring</strong></a></h3>
<p>With everything set up, it's time to <strong>monitor and analyze</strong> application performance! 🔍</p>
<h4 id="overview-dashboard"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#overview-dashboard"><strong>📌 Overview Dashboard</strong></a></h4>
<ul>
<li>Displays high-level <strong>health metrics</strong>, failed requests, and response times.
📸 <strong><img alt="Insights Overview" src="../../azure-posts/app-insights/BO_Insights_Overview.png" /></strong></li>
</ul>
<h4 id="application-map"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#application-map"><strong>📌 Application Map</strong></a></h4>
<ul>
<li>Shows <strong>dependencies and interactions</strong> between components.
📸 <strong><img alt="Application Map" src="../../azure-posts/app-insights/BO_Insights_ApplicationMap.png" /></strong></li>
</ul>
<h4 id="live-metrics"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#live-metrics"><strong>📌 Live Metrics</strong></a></h4>
<ul>
<li>Monitor <strong>real-time requests, server performance, and failures</strong>.
📸 <strong><img alt="Live Metrics" src="../../azure-posts/app-insights/BO_Insights_LiveMetrics.png" /></strong></li>
</ul>
<h4 id="failures-exceptions"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#failures-exceptions"><strong>📌 Failures &amp; Exceptions</strong></a></h4>
<ul>
<li>Identify and diagnose <strong>failed requests &amp; top exceptions</strong>.
📸 <strong><img alt="Failures &amp; Exceptions" src="../../azure-posts/app-insights/BO_Insights_Failures.png" /></strong></li>
</ul>
<h4 id="performance-monitoring"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#performance-monitoring"><strong>📌 Performance Monitoring</strong></a></h4>
<ul>
<li>Analyze <strong>response times, dependencies &amp; bottlenecks</strong>.
📸 <strong><img alt="Performance Overview" src="../../azure-posts/app-insights/BO_Insights_Performance.png" /></strong></li>
</ul>
<h4 id="logs-queries"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#logs-queries"><strong>📌 Logs &amp; Queries</strong></a></h4>
<ul>
<li>Run <strong>Kusto Query Language (KQL)</strong> queries for deep insights.</li>
</ul>
<p>Example query to find failed requests:</p>
<div class="language-kusto highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">requests</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="n">ago</span><span class="p">(</span><span class="mi">24</span><span class="n">h</span><span class="p">)</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="n">false</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">resultCode</span><span class="p">,</span><span class="w"> </span><span class="n">url</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="n">desc</span>
</span></code></pre></div>
<p>📸 <strong><img alt="Query Results" src="../../azure-posts/app-insights/BO_Insights_Logs.png" /></strong></p>
<hr />
<h4 id="next-steps"><a class="toclink" href="../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#next-steps">✅ <strong>Next Steps</strong></a></h4>
<p>🎯 Continue monitoring logs &amp; alerts for trends.<br />
🎯 Optimize Application Insights sampling to reduce telemetry costs.<br />
🎯 Automate reporting for key performance metrics.  </p>
<p>By following this guide, you'll have a <strong>robust, real-time monitoring setup</strong> for your IIS web farm, ensuring optimal performance and quick issue resolution! 🚀</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Monitoring%20an%20IIS-Based%20Web%20Farm%20with%20Azure%20Application%20Insights%0A&amp;url=https://blog.pollockweb.com/blog/monitoring-an-iis-based-web-farm-with-azure-application-insights/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/monitoring-an-iis-based-web-farm-with-azure-application-insights/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-11 00:00:00+00:00">March 11, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/intune/" class="md-meta__link">Intune</a>, 
              <a href="../../category/automation/" class="md-meta__link">Automation</a>, 
              <a href="../../category/scripting/" class="md-meta__link">Scripting</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="uninstalling-papercut-mf-client-via-intune-a-step-by-step-guide"><a class="toclink" href="../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/">📢 Uninstalling PaperCut MF Client via Intune – A Step-by-Step Guide 🚀</a></h2>
<h3 id="scenario-overview"><a class="toclink" href="../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#scenario-overview"><strong>🔍 Scenario Overview</strong></a></h3>
<p>Managing software across an enterprise can be a headache, especially when it comes to <strong>removing outdated applications</strong>. Recently, I needed to <strong>uninstall the PaperCut MF Client from multiple Windows PCs</strong> in my environment. The challenge? Ensuring a clean removal <strong>without user intervention</strong> and <strong>no leftover files</strong>.</p>
<p>Rather than relying on manual uninstallation, we used <strong>Microsoft Intune</strong> to deploy a <strong>PowerShell script</strong> that handles the removal automatically. This blog post details the full process, from <strong>script development to deployment and testing</strong>.</p>
<hr />
<h3 id="the-goal"><a class="toclink" href="../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#the-goal"><strong>🎯 The Goal</strong></a></h3>
<p>✅ Uninstall the PaperCut MF Client <strong>silently</strong><br />
✅ Ensure <strong>no residual files</strong> are left behind<br />
✅ Deploy the solution <strong>via Intune</strong> as a PowerShell script (NOT as a Win32 app)<br />
✅ Test both <strong>locally</strong> and <strong>remotely</strong> before large-scale deployment  </p>
<hr />
<h3 id="step-1-writing-the-uninstall-script"><a class="toclink" href="../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#step-1-writing-the-uninstall-script"><strong>🛠 Step 1: Writing the Uninstall Script</strong></a></h3>
<p>We first created a <strong>PowerShell script</strong> to:</p>
<ol>
<li><strong>Stop PaperCut-related processes</strong></li>
<li><strong>Run the built-in uninstaller (<code>unins000.exe</code>)</strong> if present</li>
<li><strong>Use MSIEXEC to remove the MSI-based install</strong></li>
<li><strong>Forcefully delete any remaining files and registry entries</strong></li>
</ol>
<h4 id="the-uninstall-script"><a class="toclink" href="../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#the-uninstall-script"><strong>📝 The Uninstall Script</strong></a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c"># Define variables</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nv">$UninstallExePath</span> <span class="p">=</span> <span class="s2">&quot;C:\Program Files (x86)\PaperCut MF Client\unins000.exe&quot;</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="nv">$MsiProductCode</span> <span class="p">=</span> <span class="s2">&quot;{5B4B80DE-34C4-11E9-9CA9-F53BB8A68831}&quot;</span>  <span class="c"># Replace with actual Product Code</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="nv">$LogFile</span> <span class="p">=</span> <span class="s2">&quot;C:\ProgramData\Custom-Intune-Scripts\Papercut-Uninstall.log&quot;</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="nv">$InstallPath</span> <span class="p">=</span> <span class="s2">&quot;C:\Program Files (x86)\PaperCut MF Client&quot;</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="c"># Function to log output</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="k">Function</span> <span class="nb">Write-Log</span> <span class="p">{</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    <span class="k">param</span> <span class="p">(</span><span class="no">[string]</span><span class="nv">$Message</span><span class="p">)</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>    <span class="nv">$TimeStamp</span> <span class="p">=</span> <span class="nb">Get-Date</span> <span class="n">-Format</span> <span class="s2">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    <span class="s2">&quot;$TimeStamp - $Message&quot;</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-FilePath</span> <span class="nv">$LogFile</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="p">}</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="nb">Write-Log</span> <span class="s2">&quot;Starting PaperCut MF Client uninstallation process.&quot;</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="c"># Stop any running PaperCut processes before uninstalling</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="nv">$Processes</span> <span class="p">=</span> <span class="p">@(</span><span class="s2">&quot;pc-client&quot;</span><span class="p">,</span> <span class="s2">&quot;pc-client-java&quot;</span><span class="p">,</span> <span class="s2">&quot;pc-client-local-cache&quot;</span><span class="p">)</span>  <span class="c"># Common PaperCut processes</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$Process</span> <span class="k">in</span> <span class="nv">$Processes</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">Get-Process</span> <span class="n">-Name</span> <span class="nv">$Process</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>        <span class="nb">Write-Log</span> <span class="s2">&quot;Stopping process: $Process&quot;</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>        <span class="nb">Stop-Process</span> <span class="n">-Name</span> <span class="nv">$Process</span> <span class="n">-Force</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>    <span class="p">}</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="p">}</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="c"># Check if unins000.exe exists</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="k">if</span> <span class="p">(</span><span class="nb">Test-Path</span> <span class="nv">$UninstallExePath</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>    <span class="nb">Write-Log</span> <span class="s2">&quot;Found unins000.exe at $UninstallExePath. Initiating uninstallation.&quot;</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>    <span class="nb">Start-Process</span> <span class="n">-FilePath</span> <span class="nv">$UninstallExePath</span> <span class="n">-ArgumentList</span> <span class="s2">&quot;/SILENT&quot;</span> <span class="n">-NoNewWindow</span> <span class="n">-Wait</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>    <span class="nb">Write-Log</span> <span class="s2">&quot;Uninstallation process completed using unins000.exe.&quot;</span>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>    <span class="nb">Write-Log</span> <span class="s2">&quot;unins000.exe not found. Attempting MSI uninstallation using Product Code $MsiProductCode.&quot;</span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>    <span class="nb">Start-Process</span> <span class="n">-FilePath</span> <span class="s2">&quot;msiexec.exe&quot;</span> <span class="n">-ArgumentList</span> <span class="s2">&quot;/x $MsiProductCode /qn /norestart&quot;</span> <span class="n">-NoNewWindow</span> <span class="n">-Wait</span>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="p">}</span>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="c"># Forcefully delete the remaining installation folder</span>
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="k">if</span> <span class="p">(</span><span class="nb">Test-Path</span> <span class="nv">$InstallPath</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>    <span class="nb">Write-Log</span> <span class="s2">&quot;Residual files found at $InstallPath. Attempting to remove forcefully.&quot;</span>
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>    <span class="n">takeown</span> <span class="p">/</span><span class="n">F</span> <span class="s2">&quot;$InstallPath&quot;</span> <span class="p">/</span><span class="nb">R </span><span class="p">/</span><span class="n">D</span> <span class="n">Y</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>    <span class="n">icacls</span> <span class="s2">&quot;$InstallPath&quot;</span> <span class="p">/</span><span class="n">grant</span> <span class="n">Administrators</span><span class="p">:</span><span class="n">F</span> <span class="p">/</span><span class="n">T</span> <span class="p">/</span><span class="n">C</span> <span class="p">/</span><span class="n">Q</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>    <span class="nb">Remove-Item</span> <span class="n">-Path</span> <span class="nv">$InstallPath</span> <span class="n">-Recurse</span> <span class="n">-Force</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>    <span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="p">(</span><span class="nb">Test-Path</span> <span class="nv">$InstallPath</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>        <span class="nb">Write-Log</span> <span class="s2">&quot;SUCCESS: Residual files successfully removed.&quot;</span>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>        <span class="nb">Write-Log</span> <span class="s2">&quot;ERROR: Failed to remove residual files. Manual intervention may be required.&quot;</span>
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>    <span class="p">}</span>
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>    <span class="nb">Write-Log</span> <span class="s2">&quot;No residual files found.&quot;</span>
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a><span class="p">}</span>
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a>
</span><span id="__span-9-50"><a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a><span class="nb">Write-Log</span> <span class="s2">&quot;PaperCut MF Client uninstallation script execution finished.&quot;</span>
</span></code></pre></div>
<hr />
<h3 id="step-2-testing-the-script-locally"><a class="toclink" href="../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#step-2-testing-the-script-locally"><strong>🧪 Step 2: Testing the Script Locally</strong></a></h3>
<p>Before deploying via Intune, it's best to <strong>test locally</strong>:</p>
<ol>
<li><strong>Open PowerShell as Administrator</strong></li>
<li><strong>Run the script manually</strong>:</li>
</ol>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">powershell</span><span class="p">.</span><span class="n">exe</span> <span class="n">-ExecutionPolicy</span> <span class="n">Bypass</span> <span class="o">-File</span> <span class="s2">&quot;C:\Path\To\Script.ps1&quot;</span>
</span></code></pre></div>
<ol>
<li><strong>Verify</strong>:</li>
<li>Check <code>C:\Program Files (x86)\PaperCut MF Client</code> to confirm deletion</li>
<li>Check <code>C:\ProgramData\AXA-Custom-Intune-Scripts\Papercut-Uninstall.log</code> for success logs</li>
</ol>
<hr />
<h3 id="step-3-running-the-script-on-a-remote-pc"><a class="toclink" href="../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#step-3-running-the-script-on-a-remote-pc"><strong>🌍 Step 3: Running the Script on a Remote PC</strong></a></h3>
<p>If you need to test the script remotely before deploying via Intune:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nv">$RemotePC</span> <span class="p">=</span> <span class="s2">&quot;COMPUTER-NAME&quot;</span>  <span class="c"># Change this to the target PC name</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nb">Invoke-Command</span> <span class="n">-ComputerName</span> <span class="nv">$RemotePC</span> <span class="n">-FilePath</span> <span class="s2">&quot;C:\Path\To\Script.ps1&quot;</span> <span class="n">-Credential</span> <span class="p">(</span><span class="nb">Get-Credential</span><span class="p">)</span>
</span></code></pre></div>
<hr />
<h3 id="step-4-deploying-via-intune"><a class="toclink" href="../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#step-4-deploying-via-intune"><strong>📡 Step 4: Deploying via Intune</strong></a></h3>
<p>Instead of packaging the script as a <code>.intunewin</code> file, we will deploy it <strong>as a PowerShell script in Intune</strong>.</p>
<h4 id="steps-to-deploy-in-intune"><a class="toclink" href="../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#steps-to-deploy-in-intune"><strong>🎯 Steps to Deploy in Intune</strong></a></h4>
<ol>
<li><strong>Go to</strong> Microsoft Endpoint Manager admin center (<strong>endpoint.microsoft.com</strong>)</li>
<li>Navigate to <strong>Devices &gt; Scripts</strong></li>
<li>Click <strong>Add &gt; Windows 10 and later</strong></li>
<li><strong>Upload the PowerShell script</strong> (<code>Papercut-Uninstall.ps1</code>)</li>
<li>Configure settings:</li>
<li><strong>Run script using the logged-on credentials?</strong> → <strong>No</strong> (runs as SYSTEM)</li>
<li><strong>Enforce script signature check?</strong> → <strong>No</strong></li>
<li><strong>Run script in 64-bit PowerShell Host?</strong> → <strong>Yes</strong></li>
<li><strong>Assign the script to device groups</strong> (not users)</li>
<li><strong>Monitor deployment logs</strong> in Intune</li>
</ol>
<hr />
<h3 id="final-thoughts"><a class="toclink" href="../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#final-thoughts"><strong>📌 Final Thoughts</strong></a></h3>
<p>By using <strong>Intune and PowerShell</strong>, we successfully automated the <strong>silent uninstallation</strong> of PaperCut MF Client. This approach ensures a <strong>zero-touch removal</strong> with <strong>no residual files</strong>, keeping endpoints clean and manageable. 🚀</p>
<p>Got questions or need enhancements? Drop them in the comments! 😊</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Uninstalling%20PaperCut%20MF%20Client%20via%20Intune%20%E2%80%93%20A%20Step-by-Step%20Guide%0A&amp;url=https://blog.pollockweb.com/blog/uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-09 00:00:00+00:00">March 9, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/devops/" class="md-meta__link">DevOps</a>, 
              <a href="../../category/microsoft-certifications/" class="md-meta__link">Microsoft Certifications</a>, 
              <a href="../../category/ai--study-techniques/" class="md-meta__link">AI &amp; Study Techniques</a></li>
        
        
          
          <li class="md-meta__item">
            
              16 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/">How I Used ChatGPT to Create AZ-400 Exam Prep Notes from MSLearn</a></h2>
<h3 id="tldr-results-first"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#tldr-results-first">🚀 TL;DR - Results First</a></h3>
<p>Using the method detailed in this post, I successfully <strong>passed the AZ-400 exam</strong> while creating a reusable study system. This approach helped me transform <strong>34+ hours of MSLearn content</strong> into structured, searchable revision notes that I could quickly reference during my exam preparation.</p>
<p>Let me walk you through how I developed this system and how you can apply it to your own certification journey.</p>
<h3 id="the-challenge"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#the-challenge">The Challenge</a></h3>
<p>Studying for Microsoft certification exams like <strong>AZ-400</strong> can be overwhelming due to the vast amount of content available. Microsoft Learn alone provides <strong>over 34 hours of recommended reading</strong>, making it difficult to retain everything effectively.</p>
<p>To tackle this challenge, I developed a <strong>structured method</strong> using <strong>MSLearn, third-party exam questions, and ChatGPT</strong> to create a comprehensive <strong>revision guide</strong>. This method helped me <strong>organize knowledge into concise notes, cheat sheets, glossaries, and knowledge checks</strong>, ultimately leading to a successful exam pass!</p>
<p>This guide documents my <strong>step-by-step process</strong> so that you can replicate or adapt it for your own Microsoft exam preparation.</p>
<h3 id="goals-of-this-study-approach"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#goals-of-this-study-approach">🏆 Goals of This Study Approach</a></h3>
<p>My main objectives were:</p>
<ul>
<li>📌 <strong>Summarize each MSLearn module</strong> into easily digestible revision notes.</li>
<li>📌 <strong>Create a structured, searchable reference</strong> for later review.</li>
<li>📌 <strong>Store my notes in GitHub</strong> using Markdown for easy access.</li>
<li>📌 <strong>Use AI (ChatGPT) to extract and summarize key information</strong>.</li>
<li>📌 <strong>Supplement with third-party practice exams</strong> to test my knowledge.</li>
</ul>
<p>This method is <strong>not a quick win</strong> but provides an efficient, <strong>structured, and reusable</strong> way to prepare for any MSLearn-based exam.</p>
<h4 id="mslearn-collections-used"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#mslearn-collections-used">🔹 MSLearn Collections Used</a></h4>
<p>To ensure comprehensive coverage of the exam syllabus, I structured my studies around the <strong>official Microsoft Learn learning paths</strong>. Each path covers a key topic required for AZ-400 certification, including DevOps principles, CI/CD, infrastructure as code, and security best practices. I systematically worked through these collections, summarizing important concepts, capturing key insights, and using ChatGPT to refine the content into structured notes.</p>
<p>Below are the <strong>learning paths</strong> I followed, each linking directly to its respective Microsoft Learn module:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-work-git-for-enterprise-devops/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Development for Enterprise DevOps</a> – Covers Git workflows, branch strategies, and repository management.</li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-implement-ci-azure-pipelines-github-actions/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Implement CI with Azure Pipelines and GitHub Actions</a> – Focuses on automating build and release processes with Azure Pipelines and GitHub Actions.</li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-design-implement-release-strategy/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Design and Implement a Release Strategy</a> – Covers feature flagging, blue-green deployments, and release management.</li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-implement-secure-continuous-deployment/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Implement Secure Continuous Deployment</a> – Discusses security measures for CI/CD pipelines.</li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-manage-infrastructure-as-code-using-azure/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Manage Infrastructure as Code Using Azure</a> – Focuses on managing cloud resources with Terraform, Bicep, and ARM templates.</li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-design-implement-dependency-management-strategy/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Design and Implement a Dependency Management Strategy</a> – Covers artifact management and dependency security.</li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-implement-continuous-feedback/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Implement Continuous Feedback</a> – Discusses monitoring and feedback loops for DevOps processes.</li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-implement-security-validate-code-bases-compliance/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Implement Security and Validate Code Bases for Compliance</a> – Focuses on DevSecOps principles and compliance validation.</li>
</ul>
<p>These resources formed the foundation of my study plan, ensuring alignment with the <strong>official exam objectives</strong>. I used these collections as the basis for my <strong>revision notes, AI-generated summaries, and knowledge checks</strong>.</p>
<hr />
<h3 id="process-overview"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#process-overview">📊 Process Overview</a></h3>
<p>Before diving into the detailed steps, here's an overview of the complete workflow:</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>MSLearn Content → Link Collection → ChatGPT Summarization → GitHub Storage → Practice Testing → Final Review
</span></code></pre></div>
<p>Estimated time investment per module:</p>
<ul>
<li>Manual link collection: ~15 minutes</li>
<li>AI summarization and refinement: ~30-60 minutes</li>
<li>Review and validation: ~30 minutes</li>
<li>Total per module: ~1-1.75 hours (compared to 3-4 hours of traditional study)</li>
</ul>
<p>These estimates are based on my experience after processing several modules. As you'll see in the learning curve section below, your first few modules might take longer as you refine your workflow.</p>
<p>Let's dive into each step of the process in detail.</p>
<hr />
<h3 id="step-1-collecting-and-organizing-mslearn-content"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#step-1-collecting-and-organizing-mslearn-content">📌 Step 1: Collecting and Organizing MSLearn Content</a></h3>
<p>MSLearn provides <strong>structured learning paths</strong>, but I needed a way to track important links and content. Here's how I manually compiled everything:</p>
<h4 id="manual-link-collection-process"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#manual-link-collection-process">🔹 Manual Link Collection Process</a></h4>
<ol>
<li>
<p><strong>Initial Setup</strong>: I created a dedicated folder structure on my computer with sub-folders for each learning path, mirroring the eventual GitHub repository structure.</p>
</li>
<li>
<p><strong>After each lesson</strong>: Captured all relevant <strong>hyperlinks</strong> and stored them in a <code>.txt</code> file within the appropriate folder. This was as simple as copy-pasting links while reading.</p>
</li>
<li>
<p><strong>At the end of each module</strong>: Consolidated all links into the text file and organized them by topic.</p>
</li>
<li>
<p><strong>Mapped content to official exam objectives</strong>: Fed the exam study guide into ChatGPT to check alignment, ensuring I wasn't missing critical areas.</p>
</li>
</ol>
<p>📸 <strong><img alt="Screenshot of collected links in text file" src="../../study-docs/MSLearn-links-example.png" /></strong></p>
<h5 id="before-after-example"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#before-after-example">Before &amp; After Example</a></h5>
<p><strong>Raw MSLearn Content:</strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>Unit Title: Implement branch policies in Azure Repos
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="k">-</span><span class="w"> </span>Configure branch policies
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="k">-</span><span class="w"> </span>Implement pull request approval processes
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="k">-</span><span class="w"> </span>Manage branch policy bypasses
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="k">-</span><span class="w"> </span>Configure auto-complete pull requests
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="k">-</span><span class="w"> </span>Configure branch policy permissions
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="k">-</span><span class="w"> </span>Configure build validation
</span></code></pre></div>
<p><strong>Transformed into Structured Notes:</strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="gu">## Branch Policies in Azure Repos</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>Branch policies help teams protect important branches by:
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="k">-</span><span class="w"> </span>Requiring code reviews before merging
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="k">-</span><span class="w"> </span>Setting minimum number of reviewers (typically 2+)
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="k">-</span><span class="w"> </span>Enforcing build validation to prevent broken code
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="k">-</span><span class="w"> </span>Restricting direct pushes to protected branches
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="gu">### Key Configuration Options:</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>| Policy | Purpose | Real-world Usage |
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>|--------|---------|------------------|
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>| Minimum reviewers | Ensures code quality | Set to 2+ for production code |
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>| Build validation | Prevents broken builds | Configure with main CI pipeline |
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a>| Comment resolution | Tracks issue fixes | Require resolution before merge |
</span></code></pre></div>
<p><strong>Lesson Learned</strong>: Consistent link collection during the learning process is much more efficient than trying to gather everything after completing a module. I developed a habit of copying links as I encountered them, which saved significant time later.</p>
<blockquote>
<p>💡 <em>Future Improvement</em>: Automating this process via a script could save time. A PowerShell or Python script could potentially scrape MSLearn modules for relevant links.</p>
</blockquote>
<hr />
<h3 id="step-2-using-ai-chatgpt-to-summarize-content"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#step-2-using-ai-chatgpt-to-summarize-content">📌 Step 2: Using AI (ChatGPT) to Summarize Content</a></h3>
<p>To turn raw MSLearn material into usable study notes, I <strong>fed collected links into ChatGPT</strong> and asked it to <strong>scrape and summarize key points</strong>.</p>
<p>I used <strong>ChatGPT 4</strong> for this process, as it provided better context handling and more accurate summaries than earlier versions.</p>
<p>The summarization workflow consisted of the following steps:</p>
<p>1️⃣ <strong>Collected MSLearn Links</strong> – Compiled all module-related links into a text file.
2️⃣ <strong>Fed the Links into ChatGPT</strong> – Asked ChatGPT to analyze and summarize key information.
3️⃣ <strong>Refined the Output Iteratively</strong> – Adjusted prompts to enhance clarity and completeness.</p>
<h4 id="crafting-effective-chatgpt-prompts"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#crafting-effective-chatgpt-prompts">🔹 Crafting Effective ChatGPT Prompts</a></h4>
<p>Well-structured prompts were essential for generating <strong>clear and accurate</strong> summaries. Below is an example of my <strong>initial prompt</strong>:</p>
<div class="language-markdown highlight"><span class="filename">prompt - ChatGPT first iteration</span><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>Please create a .md file in the same format as the previous ones and include the following:
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>Summarize key information within each unit, including diagrams, tables, and exercises and labs.
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>List steps performed and order of steps/workflow, where applicable.
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>Use tables primarily for comparing differences between items.
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>Include:
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>Key exam points.
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>Points to remember.
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>Prerequisite information.
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>Include any service limits - maximum minutes per month for a particular tier, difference services available in varying tiers/services/SKUs for example
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>Permissions required for activities.
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>Provide real-world applications, troubleshooting scenarios, and advanced tips.
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>Highlight common pitfalls or mistakes to avoid.
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>Review the canvas and add/remove any relevant information.
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>Use the web to search for supplementary material where necessary, and summarize this information within the notes.
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>Avoid external links—include all relevant information directly in the notes.
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>Ensure all &quot;Learning objectives&quot; in Unit 1 are met by the material included in the output .md file(s)
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>Ensure no content is included that doesn&#39;t have a real-world example or exam related reference included
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>Review the output you have created at the end, and make any further improvements automatically be manually revising the file or implementing your comments.
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>Here is a list of the links contained in this module.
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>Using the parameters outlined above create a comprehensive exam cram resource cheat sheet, that can be used for my AZ-400 exam prep.
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a>The resulting output needs contain material relevant to the AZ-400 study guide:
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a>https://learn.microsoft.com/en-us/credentials/certifications/resources/study-guides/az-400
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a>
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a>Let me know when you are ready for the module links?
</span></code></pre></div>
<p>While this prompt worked initially, I found it had several limitations:</p>
<ul>
<li>It was too lengthy and complex for ChatGPT to consistently follow all instructions</li>
<li>It lacked specific formatting guidance</li>
<li>It didn't emphasize accuracy and relevance enough</li>
</ul>
<h4 id="prompt-evolution"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#prompt-evolution">🔹 Prompt Evolution</a></h4>
<p>I refined the prompt through several iterations to address these issues. The key improvements included:</p>
<ol>
<li><strong>Adding a clear word count limit</strong> (750 words per file) to prevent overly lengthy outputs</li>
<li><strong>Explicitly prohibiting generic statements</strong> like "understand X" and "know how to..."</li>
<li><strong>Requiring concrete examples for each concept</strong> rather than theoretical explanations</li>
<li><strong>Creating a more structured format</strong> with clear section headings and organization</li>
<li><strong>Adding a final validation step</strong> to ensure content aligned with learning objectives</li>
</ol>
<h5 id="initial-results-vs-refined-results"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#initial-results-vs-refined-results">Initial Results vs. Refined Results</a></h5>
<p><strong>First Iteration Output (Excerpt):</strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="gu">## Key Exam Points</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="k">-</span><span class="w"> </span>Understand the different branch policies in Azure Repos
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="k">-</span><span class="w"> </span>Know how to configure pull request approvals
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="k">-</span><span class="w"> </span>Understand branch policy permissions
</span></code></pre></div>
<p><strong>Problems:</strong></p>
<ul>
<li>Too generic with "understand" and "know how" statements</li>
<li>Lacks specific examples and actionable information</li>
<li>No clear formatting structure</li>
</ul>
<p><strong>Refined Output (After Improved Prompt):</strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="gu">## Branch Policies in Azure DevOps</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="gu">### Key Exam Points</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="k">-</span><span class="w"> </span>Branch policies in Azure Repos protect branches by enforcing code review and build validation
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="k">-</span><span class="w"> </span>Required reviewers policy must be configured with minimum count (2+ recommended for production)
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="k">-</span><span class="w"> </span>Build validation policy links CI pipeline to PR process, ensuring code builds successfully
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="k">-</span><span class="w"> </span>Policy bypasses can be granted to specific users or groups (Project Administrators have bypass by default)
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="k">-</span><span class="w"> </span>Branch policies are set at repository level under Branches → [...] → Branch Policies
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="gu">### Common Scenarios</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>When setting up branch policies for a large team:
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="k">1.</span> Configure minimum 2 reviewers for main branch
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="k">2.</span> Enable &quot;Comment resolution&quot; to require addressing feedback
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="k">3.</span> Link build validation to prevent broken builds
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="k">4.</span> Set reset votes when new changes are pushed
</span></code></pre></div>
<h4 id="challenges-solutions"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#challenges-solutions">🔹 Challenges &amp; Solutions</a></h4>
<p>Using AI to generate structured content wasn't always seamless. Here are some <strong>key challenges and how I addressed them</strong>:</p>
<table>
<thead>
<tr>
<th><strong>Challenge</strong></th>
<th><strong>Solution</strong></th>
<th><strong>Example</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ChatGPT lost context in long sessions</td>
<td>Processed module-by-module instead of bulk inputs</td>
<td>Split "Azure Pipelines" module into 3 separate prompts</td>
</tr>
<tr>
<td>Overwrote useful content in iterations</td>
<td>Manually saved outputs before requesting refinements</td>
<td>Created checkpoint files labeled v1, v2, etc.</td>
</tr>
<tr>
<td>Large data inputs led to incomplete summaries</td>
<td>Used <strong>multiple iterations</strong>, focusing on <strong>key areas</strong> of each module</td>
<td>First pass: core concepts; Second pass: examples and scenarios</td>
</tr>
<tr>
<td>Hallucinations on technical details</td>
<td>Cross-validated against official documentation</td>
<td>Corrected service limits and permission details</td>
</tr>
<tr>
<td>Generic "understand X" statements</td>
<td>Explicitly requested specific actionable information</td>
<td>Replaced "Understand CI/CD" with actual pipeline YAML examples</td>
</tr>
</tbody>
</table>
<p>Breaking down content into <strong>smaller chunks</strong> and applying <strong>manual validation</strong> helped ensure better results.</p>
<p><strong>Learning Curve</strong>: My first module took nearly 2 hours to process completely, as I was still figuring out the optimal prompt structure and workflow. By my fifth module, I had reduced this to about 45 minutes through improved prompting and a more streamlined approach.</p>
<hr />
<h4 id="refining-the-output"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#refining-the-output">🔹 Refining the Output</a></h4>
<p>To improve <strong>content accuracy</strong>, I introduced an additional <strong>review prompt</strong>:</p>
<div class="language-markdown highlight"><span class="filename">ChatGPT prompt - second iteration</span><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>Objective:
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>Create a .md file that acts as a comprehensive AZ-400 exam cram resource cheat sheet.
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>Instructions:
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>Act as my Azure DevOps training expert with a focus on preparing me for the AZ-400 exam.
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>The output must adhere to the structure and content requirements outlined below:
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>Content Requirements:
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>Each file should contain no more than 750 words (excluding text that make up hyperlinks)
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>Summarize Key Information:
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>Include summaries for each unit, diagram, table, exercise, and lab where applicable.
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a>Use clear and concise explanations.
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a>List Steps/Workflows:
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a>Summarize steps performed in labs/exercises and the order of steps/workflows where applicable.
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>Use Tables:
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>Create tables primarily for comparing differences between items (examples, but not limited to - features, tiers, SKUs etc ).
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a>Key Exam Points: Highlight crucial information likely to appear in the exam and provide actual examples. 
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a>Do not use generic phrases like &quot;Understand....&quot; and  &quot;Know how to....&quot;. 
</span><span id="__span-33-24"><a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a>I need you to provide the information I need to know for each exam tip.
</span><span id="__span-33-25"><a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a>
</span><span id="__span-33-26"><a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a>Points to Remember: Provide concise, high-priority notes for studying.
</span><span id="__span-33-27"><a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a>
</span><span id="__span-33-28"><a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a>Prerequisite Information: Mention anything needed to understand or implement concepts.
</span><span id="__span-33-29"><a id="__codelineno-33-29" name="__codelineno-33-29" href="#__codelineno-33-29"></a>
</span><span id="__span-33-30"><a id="__codelineno-33-30" name="__codelineno-33-30" href="#__codelineno-33-30"></a>Service Limits: Include tier limitations (e.g., maximum minutes per month), service availability by SKU, etc.
</span><span id="__span-33-31"><a id="__codelineno-33-31" name="__codelineno-33-31" href="#__codelineno-33-31"></a>
</span><span id="__span-33-32"><a id="__codelineno-33-32" name="__codelineno-33-32" href="#__codelineno-33-32"></a>Permissions Required: Specify roles/permissions necessary for activities.
</span><span id="__span-33-33"><a id="__codelineno-33-33" name="__codelineno-33-33" href="#__codelineno-33-33"></a>
</span><span id="__span-33-34"><a id="__codelineno-33-34" name="__codelineno-33-34" href="#__codelineno-33-34"></a>Practical Applications:
</span><span id="__span-33-35"><a id="__codelineno-33-35" name="__codelineno-33-35" href="#__codelineno-33-35"></a>Provide real-world applications, troubleshooting scenarios, and advanced tips.
</span><span id="__span-33-36"><a id="__codelineno-33-36" name="__codelineno-33-36" href="#__codelineno-33-36"></a>Highlight common pitfalls or mistakes to avoid.
</span><span id="__span-33-37"><a id="__codelineno-33-37" name="__codelineno-33-37" href="#__codelineno-33-37"></a>
</span><span id="__span-33-38"><a id="__codelineno-33-38" name="__codelineno-33-38" href="#__codelineno-33-38"></a>Relevance:
</span><span id="__span-33-39"><a id="__codelineno-33-39" name="__codelineno-33-39" href="#__codelineno-33-39"></a>Ensure the output aligns with the Microsoft AZ-400 study guide 
</span><span id="__span-33-40"><a id="__codelineno-33-40" name="__codelineno-33-40" href="#__codelineno-33-40"></a>(https://learn.microsoft.com/en-us/credentials/certifications/resources/study-guides/az-400)
</span><span id="__span-33-41"><a id="__codelineno-33-41" name="__codelineno-33-41" href="#__codelineno-33-41"></a>Exclude any content that lacks real-world examples or exam-related references.
</span><span id="__span-33-42"><a id="__codelineno-33-42" name="__codelineno-33-42" href="#__codelineno-33-42"></a>
</span><span id="__span-33-43"><a id="__codelineno-33-43" name="__codelineno-33-43" href="#__codelineno-33-43"></a>Final Review:
</span><span id="__span-33-44"><a id="__codelineno-33-44" name="__codelineno-33-44" href="#__codelineno-33-44"></a>Evaluate the output to ensure all &quot;Learning Objectives&quot; in Unit 1 are met.
</span><span id="__span-33-45"><a id="__codelineno-33-45" name="__codelineno-33-45" href="#__codelineno-33-45"></a>Automatically revise the file manually if needed to enhance clarity and completeness.
</span><span id="__span-33-46"><a id="__codelineno-33-46" name="__codelineno-33-46" href="#__codelineno-33-46"></a>
</span><span id="__span-33-47"><a id="__codelineno-33-47" name="__codelineno-33-47" href="#__codelineno-33-47"></a>
</span><span id="__span-33-48"><a id="__codelineno-33-48" name="__codelineno-33-48" href="#__codelineno-33-48"></a>Prompt me for a list of URL&#39;s or an existing .md file when you have understood the instructions.
</span></code></pre></div>
<h4 id="iterative-refinement-technique"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#iterative-refinement-technique">🔹 Iterative Refinement Technique</a></h4>
<p>Depending on the results, I would often break the prompt up further, and just use a specific part.
For example, once I was happy with the results of a certain output I would re-enter the "Final Review:
Evaluate the output to ensure all "Learning Objectives" in Unit 1 are met."
Automatically revise the file manually if needed to enhance clarity and completeness." prompt, once or maybe several times until was happy with the finished output.</p>
<p>A typical module would go through 2-3 iterations:</p>
<ol>
<li><strong>Initial generation</strong> - Creates the basic structure and content</li>
<li><strong>Content enhancement</strong> - Adds real-world examples and specifics</li>
<li><strong>Final validation</strong> - Checks against learning objectives and improves clarity</li>
</ol>
<p>For complex topics like Azure Pipelines, I might need 4-5 iterations to fully refine the content.</p>
<h5 id="workflow-integration"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#workflow-integration">Workflow Integration</a></h5>
<p>I integrated this process into my daily study routine by:</p>
<ol>
<li>Reading a module in the morning</li>
<li>Collecting links as I went</li>
<li>Processing with ChatGPT during lunch break or after work</li>
<li>Reviewing and committing to GitHub in the evening</li>
</ol>
<p>This approach allowed me to maintain consistent progress without feeling overwhelmed.</p>
<h5 id="time-saving-tip"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#time-saving-tip">Time-Saving Tip</a></h5>
<p>A full module processing cycle typically took about 30-45 minutes, compared to 2-3 hours of traditional study and note-taking. The time investment was front-loaded, but paid dividends during revision.</p>
<hr />
<h3 id="step-3-integrating-third-party-exam-resources"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#step-3-integrating-third-party-exam-resources">📌 Step 3: Integrating Third-Party Exam Resources</a></h3>
<p>While MSLearn is great for structured content, <strong>real-world practice questions</strong> are crucial for exam success. I incorporated:</p>
<ul>
<li>✅ <strong>MSLearn Official Practice Questions</strong></li>
<li>✅ <strong>Third-Party Providers</strong>: Tutorials Dojo, MeasureUp</li>
<li>✅ <strong>Exam Explanation Links</strong> (to validate answers)</li>
</ul>
<h4 id="how-i-validated-third-party-questions"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#how-i-validated-third-party-questions">🔹 How I Validated Third-Party Questions</a></h4>
<ul>
<li>Checked explanations for <strong>links to MSLearn documentation</strong>.</li>
<li>Manually cross-referenced answers with <strong>official study material</strong>.</li>
<li>Used my GitHub repo's search function to quickly verify concepts.</li>
</ul>
<h4 id="identifying-valuable-practice-questions"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#identifying-valuable-practice-questions">🔹 Identifying Valuable Practice Questions</a></h4>
<p>Not all practice questions are created equal. I prioritized questions that:</p>
<ol>
<li>Included detailed explanations with documentation links</li>
<li>Covered scenarios rather than simple definition recall</li>
<li>Tested practical knowledge rather than obscure facts</li>
<li>Referenced multiple concepts in a single question</li>
</ol>
<p>📸 <strong><img alt="TutorialsDojo example" src="../../study-docs/TD-example.png" title="TutorialsDojo exam question example" /></strong></p>
<h4 id="supplementary-resources-worth-the-investment"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#supplementary-resources-worth-the-investment">🔹 Supplementary Resources Worth The Investment</a></h4>
<p>Based on my experience, these additional resources provided the best value:</p>
<ol>
<li><strong>Tutorials Dojo Practice Exams</strong> - Excellent explanations and documentation links</li>
<li><strong>MeasureUp Official Practice Tests</strong> - Most similar to actual exam format</li>
<li><strong>WhizLabs Labs</strong> - Hands-on practice for key scenarios</li>
</ol>
<p>The combination of AI-summarized MSLearn content and targeted practice questions created a comprehensive exam preparation strategy.</p>
<p><strong>Real-World Application Example</strong>: During a practice exam, I encountered a question about configuring branch policies with required reviewers. Using my GitHub repository's search function, I quickly found the related notes I had created, which included the exact setting location and recommended configuration values. This allowed me to answer correctly and understand the underlying concept, rather than just memorizing an answer.</p>
<hr />
<h3 id="step-4-storing-notes-in-github-for-easy-reference"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#step-4-storing-notes-in-github-for-easy-reference">📌 Step 4: Storing Notes in GitHub for Easy Reference</a></h3>
<p>One key advantage of this method was <strong>storing all notes in a GitHub repository</strong>, allowing easy searchability.</p>
<h4 id="initial-github-repository-setup"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#initial-github-repository-setup">🔹 Initial GitHub Repository Setup</a></h4>
<ol>
<li><strong>Created a new GitHub repository</strong> specifically for my AZ-400 exam notes</li>
<li><strong>Established a folder structure</strong> that mirrored the MSLearn learning paths</li>
<li><strong>Set up a README</strong> with quick navigation links to major sections</li>
<li><strong>Created a consistent file naming convention</strong> (numbered by sequence in the learning path)</li>
</ol>
<h4 id="how-i-structured-my-notes"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#how-i-structured-my-notes">🔹 How I Structured My Notes</a></h4>
<p><strong>(VS Code folder structure represented in Markdown)</strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>📂 AZ-400 - MS LEARN - EXAM NOTES/
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a> ├── 📁 .github/
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a> │
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a> ├── 📁 1. AZ-400 Development for Enterprise DevOps/
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a> │    ├── 1. Introduction to DevOps.md
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a> │    ├── 2. Plan Agile with GitHub Projects and Azure Boards.md
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a> │    ├── 3. Design and implement branch strategies and workflows.md
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a> │    ├── 4. Collaborate with pull requests in Azure Repos.md
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a> │    ├── 5. Explore Git hooks.md
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a> │    ├── 6. Plan foster inner source.md
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a> │    ├── 7. Manage and configure repositories.md
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a> │    ├── 8. Identify technical debt.md
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a> │
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a> ├── 📁 2. AZ-400 Implement CI with Azure Pipelines and GitHub Actions/
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a> │    ├── 1. Explore Azure Pipelines.md
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a> │    ├── 2. Manage Azure Pipeline agents and pools.md
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a> │    ├── 3. Describe pipelines and concurrency.md
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a> │    ├── 4. Design and implement a pipeline strategy.md
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a> │    ├── 5. Integrate with Azure Pipelines.md
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a> │    ├── 6. Introduction to GitHub Actions.md
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a> │    ├── 7. Learn continuous integration with GitHub Actions.md
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a> │    ├── 8. Design Container Build Strategy.md
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a> ├── 📁 3. AZ-400 Design and Implement a Release Strategy/
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a> ├── ...
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a> ├── 📁 4. AZ-400 Implement a Secure Continuous Deployment using Azure Pipelines/
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a> ├── ...
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a> ├── 📁 5. AZ-400 Manage Infrastructure as Code using Azure and DSC/
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a> ├── ...
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a> ├── 📁 6. AZ-400 Design and Implement a Dependency Management Strategy/
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a> ├── ...
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a> ├── 📁 7. AZ-400 Implement Continuous Feedback
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a> ├── ...
</span><span id="__span-34-33"><a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a> ├── 📁 8. AZ-400 Implement Security and Validate Code Bases for Compliance/
</span><span id="__span-34-34"><a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a> ├── ...
</span><span id="__span-34-35"><a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a> ├── 📁 AZ-400 Tutorials Dojo - Exam Notes/
</span><span id="__span-34-36"><a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a> │    ├── Azure DevOps - Terms and Definitions - Pt 1.md
</span><span id="__span-34-37"><a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a> │    ├── Azure DevOps - Terms and Definitions - Pt 2.md
</span><span id="__span-34-38"><a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a> │    ├── Azure DevOps - Terms and Definitions - Pt 3.md
</span></code></pre></div>
<p>📸 <strong><img alt="GitHub repo structure" src="../../study-docs/GitHub-repo-structure.png" title="GitHub Repo structure" /></strong></p>
<h4 id="workflow-for-adding-new-notes"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#workflow-for-adding-new-notes">🔹 Workflow for Adding New Notes</a></h4>
<ol>
<li><strong>Create new markdown file</strong> in the appropriate folder</li>
<li><strong>Paste ChatGPT-generated content</strong> and review for accuracy</li>
<li><strong>Commit changes</strong> with descriptive commit messages (e.g., "Add Azure Pipelines agents notes")</li>
<li><strong>Push to GitHub</strong> to make available for searching during study sessions</li>
</ol>
<p>🔍 <strong>Searching Notes Efficiently</strong></p>
<ul>
<li>Used <strong>GitHub's search function</strong> to quickly find terms (e.g., <code>MendBolt</code>).</li>
<li>This allowed me to <strong>cross-check answers during study sessions</strong>.</li>
</ul>
<h5 id="example-search-workflow"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#example-search-workflow">Example Search Workflow</a></h5>
<ol>
<li>Practice question mentions "Which Azure DevOps deployment strategy minimizes downtime during releases?"</li>
<li>One of the answers mnetions "Blue/Green" deployment</li>
<li>Search repository for "Blue/Green"</li>
<li>Results show multiple matching files.</li>
<li>Quickly identify that "Blue/Green deployment" is the correct answer based on my notes.</li>
<li>Verify with documentation reference that Blue/Green deployments maintain two identical production environments, allowing for instant switching between versions.</li>
</ol>
<p>📸 <strong><img alt="GitHub search in action" src="../../study-docs/GitHub-search.png" title="GitHub repo search example" /></strong></p>
<h4 id="real-world-performance-impact"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#real-world-performance-impact">🔹 Real-World Performance Impact</a></h4>
<p>During practice exams, I could typically locate key information in <strong>under 30 seconds</strong> using this method, compared to several minutes when using traditional notes or searching documentation directly.</p>
<hr />
<h3 id="results-key-takeaways"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#results-key-takeaways">📌 Results &amp; Key Takeaways</a></h3>
<p>🎯 <strong>Outcome:</strong></p>
<ul>
<li>✅ Passed the AZ-400 exam! 🎉</li>
<li>✅ Created a <strong>structured, reusable</strong> study guide.</li>
<li>✅ Used AI efficiently to <strong>save time and condense information</strong>.</li>
<li>✅ Reduced overall study time by approximately 40% compared to traditional methods.</li>
</ul>
<h4 id="time-investment-analysis"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#time-investment-analysis">🔹 Time Investment Analysis</a></h4>
<table>
<thead>
<tr>
<th>Activity</th>
<th>Traditional Approach</th>
<th>AI-Enhanced Approach</th>
<th>Time Savings</th>
</tr>
</thead>
<tbody>
<tr>
<td>Reading MSLearn</td>
<td>34+ hours</td>
<td>8-10 hours</td>
<td>~70%</td>
</tr>
<tr>
<td>Note-taking</td>
<td>10-15 hours</td>
<td>5-7 hours</td>
<td>~50%</td>
</tr>
<tr>
<td>Organization</td>
<td>3-5 hours</td>
<td>2-3 hours</td>
<td>~40%</td>
</tr>
<tr>
<td>Practice &amp; Review</td>
<td>15-20 hours</td>
<td>15-20 hours</td>
<td>0%</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td><strong>62-74 hours</strong></td>
<td><strong>30-40 hours</strong></td>
<td><strong>~45%</strong></td>
</tr>
</tbody>
</table>
<p>These figures are based on my own experience and tracking of study time. Your results may vary depending on your familiarity with the subject matter and the tools involved. The key insight is that the most significant time savings came from condensing the initial reading phase while maintaining or even improving knowledge retention through structured notes.</p>
<h4 id="what-id-do-differently-next-time"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#what-id-do-differently-next-time">🔹 What I'd Do Differently Next Time</a></h4>
<p>🔹 Further <strong>break down</strong> the ChatGPT input process into <strong>smaller steps</strong><br />
🔹 Explore <strong>alternative AI tools</strong> like Claude or Bard to compare summary quality<br />
🔹 Consider <strong>automating link collection</strong> from MSLearn using a simple web scraper<br />
🔹 Create a <strong>standardized template</strong> for each module type from the beginning<br />
🔹 Add more <strong>visual elements</strong> like diagrams to represent complex relationships  </p>
<h4 id="would-i-recommend-this-approach"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#would-i-recommend-this-approach">🔹 Would I Recommend This Approach?</a></h4>
<p>✅ Yes—but only if you're prepared for an <strong>iterative, hands-on</strong> study process.</p>
<p>The greatest benefits were:</p>
<ol>
<li>Structured organization of complex information</li>
<li>Quick searchability during practice tests</li>
<li>Forced engagement with the material (rather than passive reading)</li>
<li>Creation of a reusable resource for future reference</li>
</ol>
<hr />
<h3 id="how-to-get-started-yourself"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#how-to-get-started-yourself">🚀 How to Get Started Yourself</a></h3>
<h4 id="initial-setup-steps"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#initial-setup-steps">Initial Setup Steps</a></h4>
<p>Before diving into the content summarization, take these important setup steps:</p>
<ol>
<li><strong>Create your repository structure</strong>:</li>
<li>Set up a GitHub repository with appropriate folder structure</li>
<li>Create a README.md with navigation links</li>
<li>
<p>Establish a consistent file naming convention</p>
</li>
<li>
<p><strong>Set up a local workflow</strong>:</p>
</li>
<li>Create a folder structure on your computer mirroring your GitHub repo</li>
<li>Establish a system for collecting and storing links as you study</li>
<li>
<p>Set up a template for your ChatGPT prompts</p>
</li>
<li>
<p><strong>Gather your resources</strong>:</p>
</li>
<li>Bookmark all relevant MSLearn collections</li>
<li>Organize them according to the exam objectives</li>
<li>Create a schedule for working through them systematically</li>
</ol>
<h4 id="quick-start-template"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#quick-start-template">Quick Start Template</a></h4>
<p>Here's a simplified prompt template to get you started:</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>I&#39;m studying for the [EXAM CODE] certification. Please help me create concise, exam-focused notes for the following module: [MODULE NAME]
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>For each key concept, please:
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="k">1.</span> Explain it in 1-2 sentences
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="k">2.</span> Provide a real-world example or scenario
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="k">3.</span> Note any configuration options or limitations
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="k">4.</span> Mention if it&#39;s likely to appear on the exam
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>Please format your response in Markdown with clear headings and avoid generic &quot;understand X&quot; statements.
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>Here are the links to the module content:
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>[PASTE LINKS HERE]
</span></code></pre></div>
<h4 id="complete-process"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#complete-process">Complete Process</a></h4>
<p>1️⃣ <strong>Set up a GitHub repo</strong> for your notes.<br />
2️⃣ <strong>Manually collect</strong> MSLearn hyperlinks as you study.<br />
3️⃣ <strong>Use ChatGPT</strong> to summarize module-by-module.<br />
4️⃣ <strong>Validate third-party questions</strong> with official docs.<br />
5️⃣ <strong>Store and search</strong> your notes in GitHub for quick reference.  </p>
<hr />
<h3 id="frequently-asked-questions"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#frequently-asked-questions">❓ Frequently Asked Questions</a></h3>
<p><strong>Q: Is this approach considered cheating?</strong>
A: No. This method enhances learning by actively engaging with the material rather than replacing study. You're creating custom notes by directing AI to extract and organize information you need to know.</p>
<p><strong>Q: How much technical knowledge do I need to implement this approach?</strong>
A: Basic GitHub knowledge and familiarity with markdown formatting are helpful but not essential. The core process can be adapted to use any note-taking system.</p>
<p><strong>Q: Does this work for all Microsoft certification exams?</strong>
A: Yes, this approach works well for any exam with structured MSLearn paths.</p>
<p><strong>Q: How do you handle inaccurate information from AI?</strong>
A: Always verify key technical details against official documentation. When in doubt, trust Microsoft's documentation over AI-generated content.</p>
<p><strong>Q: How long did it take you to become proficient with this workflow?</strong>
A: After completing about 3-4 modules, I had established an efficient workflow. The learning curve is relatively quick if you're already familiar with GitHub and ChatGPT.</p>
<hr />
<h3 id="final-thoughts"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#final-thoughts">💬 Final Thoughts</a></h3>
<p>This method made my <strong>exam prep structured and efficient</strong>, though it required <strong>significant manual effort</strong>. If you're preparing for a Microsoft certification, consider trying this approach!</p>
<p>The combination of <strong>AI-powered summarization</strong>, <strong>structured GitHub storage</strong>, and <strong>focused practice testing</strong> created a powerful study system that both saved time and improved retention.</p>
<p>The most valuable aspect wasn't just passing the exam, but creating a reusable knowledge base that continues to serve as a reference in my professional work. While traditional study methods might help you pass an exam, this approach helps build a lasting resource.</p>
<p>💡 <strong>Have you used AI tools for exam prep? Share your thoughts in the comments!</strong></p>
<hr />
<h3 id="additional-resources"><a class="toclink" href="../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#additional-resources">🔗 Additional Resources</a></h3>
<ul>
<li><a href="https://github.com/cloudlabmp/AZ-400---MS-Learn---Exam-Notes">My GitHub Repository Link</a></li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-work-git-for-enterprise-devops/">Microsoft Learn AZ-400 Path</a></li>
<li><a href="https://learn.microsoft.com/en-us/credentials/certifications/devops-engineer/">Official AZ-400 Exam Page</a></li>
<li><a href="https://docs.github.com/">GitHub Documentation</a></li>
<li><a href="https://help.openai.com/">ChatGPT Documentation</a></li>
</ul>
<p><a class="md-button" href="https://x.com/intent/tweet?text=How%20I%20used%20ChatGPT%20to%20create%20AZ-400%20exam%20prep%20notes%20from%20MSLearn%0A&amp;url=https://blog.pollockweb.com/blog/how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-06 00:00:00+00:00">March 6, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/terraform/" class="md-meta__link">Terraform</a>, 
              <a href="../../category/iac/" class="md-meta__link">IaC</a>, 
              <a href="../../category/gitops/" class="md-meta__link">GitOps</a></li>
        
        
          
          <li class="md-meta__item">
            
              14 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/">GitOps Project: Automating AWS infrastructure deployment with Terraform and GitHub Actions</a></h2>
<h3 id="overview"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#overview">Overview</a></h3>
<p>As infrastructure becomes more complex, ensuring automation, security, and compliance is crucial. This blog post walks through setting up a GitOps pipeline that simplifies AWS infrastructure management using Terraform and GitHub Actions. Whether you're an engineer looking to automate deployments or a security-conscious DevOps professional, this guide provides a structured approach to implementing Infrastructure as Code (IaC) best practices.</p>
<p>This blog post documents my experience with the <a href="https://morethancertified.com/course/gitops-for-terraform-minicamp">MoreThanCertified GitOps Minicamp</a>, where students set up a fully automated GitOps pipeline to manage AWS infrastructure using Terraform and GitHub Actions. The goal is to implement Infrastructure as Code (IaC) best practices, enforce security policies, and automate infrastructure deployment.</p>
<p>This tutorial is meant as an overview "at-a-glance" summary of the steps I took to implement the pipeline from project start, to resource deployment.
The <a href="https://morethancertified.com/course/gitops-for-terraform-minicamp">MoreThanCertified GitOps Minicamp</a>
goes into a lot more detail and covers all the topics in this post in more depth. I would highly recommend checking the course out if you haven't already.</p>
<p>In this tutorial, I will guide you through:</p>
<ul>
<li>
<p>Setting up GitHub Codespaces for development</p>
</li>
<li>
<p>Configuring a Terraform backend in AWS with CloudFormation</p>
</li>
<li>
<p>Deploying AWS resources with Terraform</p>
</li>
<li>
<p>Running security, cost, and policy checks using GitHub Actions</p>
</li>
<li>
<p>Implementing a CI/CD pipeline with GitHub Actions</p>
</li>
</ul>
<h4 id="visualizing-the-pipeline-architecture"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#visualizing-the-pipeline-architecture">Visualizing the Pipeline Architecture</a></h4>
<p>The diagram below illustrates the <strong>end-to-end GitOps workflow</strong>:  </p>
<ul>
<li>GitHub Actions automates security scans, cost checks, and Terraform execution.  </li>
<li>Terraform manages AWS infrastructure, storing state in an S3 backend.  </li>
<li>OpenID Connect (OIDC) ensures secure authentication to AWS.</li>
</ul>
<p><img alt="Basic Project Diagram" src="../../gitops/SimpleDiagram.png" /></p>
<h3 id="setting-up-github-codespaces-for-development"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#setting-up-github-codespaces-for-development">Setting Up GitHub Codespaces for Development</a></h3>
<p>Prerequisites</p>
<ul>
<li>
<p>Previous knowledge and use of Github is assumed.</p>
</li>
<li>
<p>A GitHub repository needs to be created where the Terraform code will be stored.</p>
</li>
<li>
<p>GitHub Codespaces enabled in your repository settings.</p>
</li>
</ul>
<h4 id="enable-codespaces-in-github"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#enable-codespaces-in-github">Enable Codespaces in GitHub</a></h4>
<ol>
<li>
<p>Navigate to <code>Settings &gt; Codespaces</code> in your repository.</p>
</li>
<li>
<p>Ensure that Codespaces is enabled for your repository.</p>
</li>
<li>
<p>Create a new Codespace and open it.</p>
</li>
<li>
<p>The Codespace should open the browser based IDE, in the root of the repo you chose.</p>
</li>
</ol>
<h4 id="configure-development-environment"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#configure-development-environment">Configure Development Environment</a></h4>
<p>Install Terraform in Codespaces</p>
<ul>
<li>Copy, paste, and then run the following in your terminal.</li>
</ul>
<div class="language-sh highlight"><span class="filename">Terraform install script</span><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="c1"># Update package list and install dependencies</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>gnupg<span class="w"> </span>software-properties-common
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="c1"># Add HashiCorp’s GPG key</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a>wget<span class="w"> </span>-O-<span class="w"> </span>https://apt.releases.hashicorp.com/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/usr/share/keyrings/hashicorp-archive-keyring.gpg
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="c1"># Add the Terraform repository</span>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/hashicorp.list
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a>
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="c1"># Update and install Terraform</span>
</span><span id="__span-78-11"><a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>terraform
</span><span id="__span-78-12"><a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a>
</span><span id="__span-78-13"><a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a><span class="c1"># Verify installation</span>
</span><span id="__span-78-14"><a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a>terraform<span class="w"> </span>version
</span></code></pre></div>
<p>Verify Terraform Installation</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>terraform<span class="w"> </span>-version
</span></code></pre></div>
<h4 id="configuring-a-terraform-backend-in-aws-using-cloudformation"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#configuring-a-terraform-backend-in-aws-using-cloudformation">Configuring a Terraform Backend in AWS Using CloudFormation</a></h4>
<p>Deploying an OIDC Role for GitHub Actions</p>
<blockquote>
<p>To allow GitHub Actions to authenticate securely with AWS, we use an OIDC (OpenID Connect) role. This CloudFormation template sets up the necessary IAM role and OIDC provider.</p>
</blockquote>
<p>Add the following code to a new template file <code>cfn &gt; oidc-role.yaml</code></p>
<div class="language-yaml highlight"><span class="filename">oidc-role.yaml</span><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="nt">Parameters</span><span class="p">:</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="w">  </span><span class="nt">Repo</span><span class="p">:</span>
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The GitHub organization/repo for which the OIDC provider is set up</span>
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">String</span><span class="w"> </span>
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a><span class="nt">Resources</span><span class="p">:</span>
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a><span class="w">  </span><span class="nt">MyOIDCProvider</span><span class="p">:</span>
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;AWS::IAM::OIDCProvider&#39;</span>
</span><span id="__span-80-8"><a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span>
</span><span id="__span-80-9"><a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a><span class="w">      </span><span class="nt">Url</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;https://token.actions.githubusercontent.com&#39;</span>
</span><span id="__span-80-10"><a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a><span class="w">      </span><span class="nt">ClientIdList</span><span class="p">:</span>
</span><span id="__span-80-11"><a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sts.amazonaws.com</span>
</span><span id="__span-80-12"><a id="__codelineno-80-12" name="__codelineno-80-12" href="#__codelineno-80-12"></a><span class="w">      </span><span class="nt">ThumbprintList</span><span class="p">:</span>
</span><span id="__span-80-13"><a id="__codelineno-80-13" name="__codelineno-80-13" href="#__codelineno-80-13"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6938fd4d98bab03faadb97b34396831e3780aea1</span>
</span><span id="__span-80-14"><a id="__codelineno-80-14" name="__codelineno-80-14" href="#__codelineno-80-14"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1c58a3a8518e8759bf075b76b750d4f2df264fcd</span>
</span><span id="__span-80-15"><a id="__codelineno-80-15" name="__codelineno-80-15" href="#__codelineno-80-15"></a><span class="w">  </span><span class="nt">gitops2024Role</span><span class="p">:</span>
</span><span id="__span-80-16"><a id="__codelineno-80-16" name="__codelineno-80-16" href="#__codelineno-80-16"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;AWS::IAM::Role&#39;</span>
</span><span id="__span-80-17"><a id="__codelineno-80-17" name="__codelineno-80-17" href="#__codelineno-80-17"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span>
</span><span id="__span-80-18"><a id="__codelineno-80-18" name="__codelineno-80-18" href="#__codelineno-80-18"></a><span class="w">      </span><span class="nt">AssumeRolePolicyDocument</span><span class="p">:</span>
</span><span id="__span-80-19"><a id="__codelineno-80-19" name="__codelineno-80-19" href="#__codelineno-80-19"></a><span class="w">        </span><span class="nt">Version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2012-10-17</span>
</span><span id="__span-80-20"><a id="__codelineno-80-20" name="__codelineno-80-20" href="#__codelineno-80-20"></a><span class="w">        </span><span class="nt">Statement</span><span class="p">:</span>
</span><span id="__span-80-21"><a id="__codelineno-80-21" name="__codelineno-80-21" href="#__codelineno-80-21"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Effect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Allow</span>
</span><span id="__span-80-22"><a id="__codelineno-80-22" name="__codelineno-80-22" href="#__codelineno-80-22"></a><span class="w">            </span><span class="nt">Principal</span><span class="p">:</span>
</span><span id="__span-80-23"><a id="__codelineno-80-23" name="__codelineno-80-23" href="#__codelineno-80-23"></a><span class="w">              </span><span class="nt">Federated</span><span class="p">:</span><span class="w"> </span><span class="kt">!Sub</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
</span><span id="__span-80-24"><a id="__codelineno-80-24" name="__codelineno-80-24" href="#__codelineno-80-24"></a><span class="w">                </span><span class="no">arn:aws:iam::${AWS::AccountId}:oidc-provider/token.actions.githubusercontent.com</span>
</span><span id="__span-80-25"><a id="__codelineno-80-25" name="__codelineno-80-25" href="#__codelineno-80-25"></a><span class="w">            </span><span class="nt">Action</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;sts:AssumeRoleWithWebIdentity&#39;</span>
</span><span id="__span-80-26"><a id="__codelineno-80-26" name="__codelineno-80-26" href="#__codelineno-80-26"></a><span class="w">            </span><span class="nt">Condition</span><span class="p">:</span>
</span><span id="__span-80-27"><a id="__codelineno-80-27" name="__codelineno-80-27" href="#__codelineno-80-27"></a><span class="w">              </span><span class="nt">StringLike</span><span class="p">:</span>
</span><span id="__span-80-28"><a id="__codelineno-80-28" name="__codelineno-80-28" href="#__codelineno-80-28"></a><span class="w">                </span><span class="s">&#39;token.actions.githubusercontent.com:sub&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="kt">!Sub</span><span class="w"> </span><span class="s">&#39;repo:${Repo}:*&#39;</span>
</span><span id="__span-80-29"><a id="__codelineno-80-29" name="__codelineno-80-29" href="#__codelineno-80-29"></a><span class="w">              </span><span class="nt">StringEquals</span><span class="p">:</span>
</span><span id="__span-80-30"><a id="__codelineno-80-30" name="__codelineno-80-30" href="#__codelineno-80-30"></a><span class="w">                </span><span class="s">&#39;token.actions.githubusercontent.com:aud&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sts.amazonaws.com</span>
</span><span id="__span-80-31"><a id="__codelineno-80-31" name="__codelineno-80-31" href="#__codelineno-80-31"></a><span class="w">      </span><span class="nt">ManagedPolicyArns</span><span class="p">:</span>
</span><span id="__span-80-32"><a id="__codelineno-80-32" name="__codelineno-80-32" href="#__codelineno-80-32"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;arn:aws:iam::aws:policy/PowerUserAccess&#39;</span>
</span><span id="__span-80-33"><a id="__codelineno-80-33" name="__codelineno-80-33" href="#__codelineno-80-33"></a><span class="nt">Outputs</span><span class="p">:</span>
</span><span id="__span-80-34"><a id="__codelineno-80-34" name="__codelineno-80-34" href="#__codelineno-80-34"></a><span class="w">  </span><span class="nt">RoleName</span><span class="p">:</span>
</span><span id="__span-80-35"><a id="__codelineno-80-35" name="__codelineno-80-35" href="#__codelineno-80-35"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;The</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">IAM</span><span class="nv"> </span><span class="s">role</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">GitHub</span><span class="nv"> </span><span class="s">Actions&#39;</span>
</span><span id="__span-80-36"><a id="__codelineno-80-36" name="__codelineno-80-36" href="#__codelineno-80-36"></a><span class="w">    </span><span class="nt">Value</span><span class="p">:</span>
</span><span id="__span-80-37"><a id="__codelineno-80-37" name="__codelineno-80-37" href="#__codelineno-80-37"></a><span class="w">      </span><span class="nt">Ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitops2024Role</span>
</span><span id="__span-80-38"><a id="__codelineno-80-38" name="__codelineno-80-38" href="#__codelineno-80-38"></a><span class="w">    </span><span class="nt">Export</span><span class="p">:</span>
</span><span id="__span-80-39"><a id="__codelineno-80-39" name="__codelineno-80-39" href="#__codelineno-80-39"></a><span class="w">      </span><span class="nt">Name</span><span class="p">:</span>
</span><span id="__span-80-40"><a id="__codelineno-80-40" name="__codelineno-80-40" href="#__codelineno-80-40"></a><span class="w">        </span><span class="nt">Fn::Sub</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${AWS::StackName}-RoleName&#39;</span>
</span></code></pre></div>
<h4 id="prerequisites"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#prerequisites">Prerequisites</a></h4>
<ul>
<li>
<p>You must have an AWS account set up in advance.</p>
</li>
<li>
<p>An IAM user with sufficient permissions to create S3 buckets, DynamoDB tables, and IAM roles.</p>
</li>
<li>
<p>A remote Terraform backend ensures state consistency and allows multiple users to collaborate.</p>
</li>
</ul>
<h4 id="why-cloudformation"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#why-cloudformation">Why CloudFormation?</a></h4>
<blockquote>
<p>CloudFormation is used to create the backend infrastructure as a best practice. This ensures automation and easy re-deployment.</p>
</blockquote>
<p><strong>Steps (CodeSpaces)</strong></p>
<p>Add the following code to a new template file <code>cfn &gt; backend-resources.yaml</code></p>
<div class="language-yaml highlight"><span class="filename">backend-resources.yml</span><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="nt">AWSTemplateFormatVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2010-09-09&#39;</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CloudFormation template to create S3 and DynamoDB for Terraform Backend</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="nt">Parameters</span><span class="p">:</span>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="w">  </span><span class="nt">S3BucketName</span><span class="p">:</span>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">String</span>
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The name of the S3 bucket to be created for storing Terraform state files.</span>
</span><span id="__span-81-8"><a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a><span class="w">    </span><span class="nt">Default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitops-tf-backend</span>
</span><span id="__span-81-9"><a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a>
</span><span id="__span-81-10"><a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a><span class="w">  </span><span class="nt">DynamoDBTableName</span><span class="p">:</span>
</span><span id="__span-81-11"><a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">String</span>
</span><span id="__span-81-12"><a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The name of the DynamoDB table to be created for Terraform state locking.</span>
</span><span id="__span-81-13"><a id="__codelineno-81-13" name="__codelineno-81-13" href="#__codelineno-81-13"></a><span class="w">    </span><span class="nt">Default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GitopsTerraformLocks</span>
</span><span id="__span-81-14"><a id="__codelineno-81-14" name="__codelineno-81-14" href="#__codelineno-81-14"></a>
</span><span id="__span-81-15"><a id="__codelineno-81-15" name="__codelineno-81-15" href="#__codelineno-81-15"></a><span class="nt">Resources</span><span class="p">:</span>
</span><span id="__span-81-16"><a id="__codelineno-81-16" name="__codelineno-81-16" href="#__codelineno-81-16"></a><span class="w">  </span><span class="nt">TerraformBackendBucket</span><span class="p">:</span>
</span><span id="__span-81-17"><a id="__codelineno-81-17" name="__codelineno-81-17" href="#__codelineno-81-17"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;AWS::S3::Bucket&#39;</span>
</span><span id="__span-81-18"><a id="__codelineno-81-18" name="__codelineno-81-18" href="#__codelineno-81-18"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span>
</span><span id="__span-81-19"><a id="__codelineno-81-19" name="__codelineno-81-19" href="#__codelineno-81-19"></a><span class="w">      </span><span class="nt">BucketName</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">S3BucketName</span>
</span><span id="__span-81-20"><a id="__codelineno-81-20" name="__codelineno-81-20" href="#__codelineno-81-20"></a><span class="w">      </span><span class="nt">VersioningConfiguration</span><span class="p">:</span>
</span><span id="__span-81-21"><a id="__codelineno-81-21" name="__codelineno-81-21" href="#__codelineno-81-21"></a><span class="w">        </span><span class="nt">Status</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Enabled</span>
</span><span id="__span-81-22"><a id="__codelineno-81-22" name="__codelineno-81-22" href="#__codelineno-81-22"></a>
</span><span id="__span-81-23"><a id="__codelineno-81-23" name="__codelineno-81-23" href="#__codelineno-81-23"></a><span class="w">  </span><span class="nt">TerraformBackendDynamoDBTable</span><span class="p">:</span>
</span><span id="__span-81-24"><a id="__codelineno-81-24" name="__codelineno-81-24" href="#__codelineno-81-24"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;AWS::DynamoDB::Table&#39;</span>
</span><span id="__span-81-25"><a id="__codelineno-81-25" name="__codelineno-81-25" href="#__codelineno-81-25"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span>
</span><span id="__span-81-26"><a id="__codelineno-81-26" name="__codelineno-81-26" href="#__codelineno-81-26"></a><span class="w">      </span><span class="nt">TableName</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DynamoDBTableName</span>
</span><span id="__span-81-27"><a id="__codelineno-81-27" name="__codelineno-81-27" href="#__codelineno-81-27"></a><span class="w">      </span><span class="nt">AttributeDefinitions</span><span class="p">:</span>
</span><span id="__span-81-28"><a id="__codelineno-81-28" name="__codelineno-81-28" href="#__codelineno-81-28"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">AttributeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LockID</span>
</span><span id="__span-81-29"><a id="__codelineno-81-29" name="__codelineno-81-29" href="#__codelineno-81-29"></a><span class="w">          </span><span class="nt">AttributeType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">S</span>
</span><span id="__span-81-30"><a id="__codelineno-81-30" name="__codelineno-81-30" href="#__codelineno-81-30"></a><span class="w">      </span><span class="nt">KeySchema</span><span class="p">:</span>
</span><span id="__span-81-31"><a id="__codelineno-81-31" name="__codelineno-81-31" href="#__codelineno-81-31"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">AttributeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LockID</span>
</span><span id="__span-81-32"><a id="__codelineno-81-32" name="__codelineno-81-32" href="#__codelineno-81-32"></a><span class="w">          </span><span class="nt">KeyType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HASH</span>
</span><span id="__span-81-33"><a id="__codelineno-81-33" name="__codelineno-81-33" href="#__codelineno-81-33"></a><span class="w">      </span><span class="nt">ProvisionedThroughput</span><span class="p">:</span>
</span><span id="__span-81-34"><a id="__codelineno-81-34" name="__codelineno-81-34" href="#__codelineno-81-34"></a><span class="w">        </span><span class="nt">ReadCapacityUnits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id="__span-81-35"><a id="__codelineno-81-35" name="__codelineno-81-35" href="#__codelineno-81-35"></a><span class="w">        </span><span class="nt">WriteCapacityUnits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id="__span-81-36"><a id="__codelineno-81-36" name="__codelineno-81-36" href="#__codelineno-81-36"></a><span class="w">      </span><span class="nt">SSESpecification</span><span class="p">:</span>
</span><span id="__span-81-37"><a id="__codelineno-81-37" name="__codelineno-81-37" href="#__codelineno-81-37"></a><span class="w">        </span><span class="nt">SSEEnabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-81-38"><a id="__codelineno-81-38" name="__codelineno-81-38" href="#__codelineno-81-38"></a>
</span><span id="__span-81-39"><a id="__codelineno-81-39" name="__codelineno-81-39" href="#__codelineno-81-39"></a><span class="nt">Outputs</span><span class="p">:</span>
</span><span id="__span-81-40"><a id="__codelineno-81-40" name="__codelineno-81-40" href="#__codelineno-81-40"></a><span class="w">  </span><span class="nt">TerraformBackendBucketName</span><span class="p">:</span>
</span><span id="__span-81-41"><a id="__codelineno-81-41" name="__codelineno-81-41" href="#__codelineno-81-41"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;S3</span><span class="nv"> </span><span class="s">bucket</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Terraform</span><span class="nv"> </span><span class="s">backend.&quot;</span>
</span><span id="__span-81-42"><a id="__codelineno-81-42" name="__codelineno-81-42" href="#__codelineno-81-42"></a><span class="w">    </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TerraformBackendBucket</span>
</span><span id="__span-81-43"><a id="__codelineno-81-43" name="__codelineno-81-43" href="#__codelineno-81-43"></a><span class="w">    </span><span class="nt">Export</span><span class="p">:</span>
</span><span id="__span-81-44"><a id="__codelineno-81-44" name="__codelineno-81-44" href="#__codelineno-81-44"></a><span class="w">      </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="kt">!Sub</span><span class="w"> </span><span class="s">&quot;${AWS::StackName}-TerraformBackendBucketName&quot;</span>
</span><span id="__span-81-45"><a id="__codelineno-81-45" name="__codelineno-81-45" href="#__codelineno-81-45"></a>
</span><span id="__span-81-46"><a id="__codelineno-81-46" name="__codelineno-81-46" href="#__codelineno-81-46"></a><span class="w">  </span><span class="nt">TerraformBackendDynamoDBTableName</span><span class="p">:</span>
</span><span id="__span-81-47"><a id="__codelineno-81-47" name="__codelineno-81-47" href="#__codelineno-81-47"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DynamoDB</span><span class="nv"> </span><span class="s">table</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Terraform</span><span class="nv"> </span><span class="s">backend.&quot;</span>
</span><span id="__span-81-48"><a id="__codelineno-81-48" name="__codelineno-81-48" href="#__codelineno-81-48"></a><span class="w">    </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TerraformBackendDynamoDBTable</span>
</span><span id="__span-81-49"><a id="__codelineno-81-49" name="__codelineno-81-49" href="#__codelineno-81-49"></a><span class="w">    </span><span class="nt">Export</span><span class="p">:</span>
</span><span id="__span-81-50"><a id="__codelineno-81-50" name="__codelineno-81-50" href="#__codelineno-81-50"></a><span class="w">      </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="kt">!Sub</span><span class="w"> </span><span class="s">&quot;${AWS::StackName}-TerraformBackendDynamoDBTableName&quot;</span>
</span></code></pre></div>
<p><strong>Steps (AWS Console)</strong></p>
<ol>
<li>
<p>Log in to the AWS Management Console and navigate to the CloudFormation service.</p>
</li>
<li>
<p>Click on Create Stack and select With new resources (standard).</p>
</li>
<li>
<p>In the Specify template section, select Upload a template file and upload the backend-resources.yml file.</p>
</li>
<li>
<p>Click Next, enter a Stack name (e.g., <code>TerraformBackend</code>), and proceed.</p>
</li>
<li>
<p>Click Next through the stack options, ensuring the correct IAM permissions are set.</p>
</li>
<li>
<p>Click Create stack and wait for the deployment to complete.</p>
</li>
</ol>
<blockquote>
<p>Once the stack is successfully created, go to Resources in the CloudFormation console to confirm that the S3 bucket and DynamoDB table have been provisioned.</p>
<p>Once the stack is deployed, navigate to the AWS CloudFormation console (<a href="https://console.aws.amazon.com/cloudformation">https://console.aws.amazon.com/cloudformation</a>) and check that:</p>
</blockquote>
<ul>
<li>
<p>Navigate to the AWS IAM Console.</p>
</li>
<li>
<p>The S3 bucket is listed under AWS S3.</p>
</li>
<li>
<p>The DynamoDB table is available in AWS DynamoDB.</p>
</li>
<li>
<p>Check that a new IAM Role (gitops2024Role) has been created.</p>
</li>
<li>
<p>Confirm that an OIDC Provider exists under IAM.</p>
</li>
</ul>
<h4 id="github-actions-workflows-automating-cicd-for-terraform"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#github-actions-workflows-automating-cicd-for-terraform">GitHub Actions Workflows: Automating CI/CD for Terraform</a></h4>
<h5 id="example-mermaid-diagram"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#example-mermaid-diagram"><strong>Example Mermaid Diagram:</strong></a></h5>
<pre class="mermaid"><code>graph TD;
    Developer --&gt;|Push to GitHub| GitHub_Actions;
    GitHub_Actions --&gt;|Run Formatting Checks| TFLint;
    TFLint --&gt;|Run Security Checks| Trivy;
    GitHub_Actions --&gt;|Run Terraform Plan| Terraform_Plan;
    GitHub_Actions --&gt;|Run Cost Analysis| Infracost;
    Terraform_Plan --&gt;|Approval Needed| Manual_Approval;
    Manual_Approval --&gt;|Deploy Resources| Terraform_Apply;
    Terraform_Apply --&gt;|Provision AWS Resources| AWS;
    AWS --&gt;|Destroy if needed| Terraform_Destroy;</code></pre>
<p>📌 <strong>GitHub Actions Workflow Execution Order:</strong></p>
<p>1️⃣ <strong>TFLint &amp; Trivy Security Scan</strong> – Ensures best practices &amp; security compliance<br />
2️⃣ <strong>Terraform Plan</strong> – Generates a preview of infrastructure changes<br />
3️⃣ <strong>OPA Policy Checks &amp; Infracost Analysis</strong> – Ensures compliance &amp; cost awareness<br />
4️⃣ <strong>Terraform Apply (manual trigger)</strong> – Deploys the infrastructure<br />
5️⃣ <strong>Terraform Destroy (manual trigger)</strong> – Cleans up resources when no longer needed  </p>
<p>Trivy Security Scan</p>
<ul>
<li>This workflow scans the Terraform configuration for security vulnerabilities using Trivy.</li>
</ul>
<p>TFLint Code Linter</p>
<ul>
<li>Lints Terraform code for syntax errors and best practices.</li>
</ul>
<p>Terraform Plan</p>
<ul>
<li>Generates a Terraform execution plan and performs OPA policy checks.</li>
</ul>
<p>Infracost Cost Analysis</p>
<ul>
<li>Estimates the cost impact of Terraform changes.</li>
</ul>
<p>Terraform Apply</p>
<ul>
<li>Deploys infrastructure changes to AWS.</li>
</ul>
<p>Terraform Destroy</p>
<ul>
<li>Destroys all infrastructure deployed by Terraform.</li>
</ul>
<blockquote>
<p>Each of these workflows is triggered based on specific events and plays a key role in the CI/CD pipeline. Below is a breakdown of each workflow file, its purpose, how it works, and how it is triggered:</p>
</blockquote>
<h4 id="trivy-security-scan"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#trivy-security-scan">Trivy Security Scan</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Trivy Security Scan</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="nt">on</span><span class="p">:</span>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="w">  </span><span class="nt">push</span><span class="p">:</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a><span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a><span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
</span><span id="__span-82-9"><a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id="__span-82-10"><a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">feature</span>
</span><span id="__span-82-11"><a id="__codelineno-82-11" name="__codelineno-82-11" href="#__codelineno-82-11"></a><span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span>
</span><span id="__span-82-12"><a id="__codelineno-82-12" name="__codelineno-82-12" href="#__codelineno-82-12"></a>
</span><span id="__span-82-13"><a id="__codelineno-82-13" name="__codelineno-82-13" href="#__codelineno-82-13"></a><span class="nt">permissions</span><span class="p">:</span>
</span><span id="__span-82-14"><a id="__codelineno-82-14" name="__codelineno-82-14" href="#__codelineno-82-14"></a><span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id="__span-82-15"><a id="__codelineno-82-15" name="__codelineno-82-15" href="#__codelineno-82-15"></a><span class="w">  </span><span class="nt">pull-requests</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id="__span-82-16"><a id="__codelineno-82-16" name="__codelineno-82-16" href="#__codelineno-82-16"></a>
</span><span id="__span-82-17"><a id="__codelineno-82-17" name="__codelineno-82-17" href="#__codelineno-82-17"></a><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-82-18"><a id="__codelineno-82-18" name="__codelineno-82-18" href="#__codelineno-82-18"></a><span class="w">  </span><span class="nt">security-scan</span><span class="p">:</span>
</span><span id="__span-82-19"><a id="__codelineno-82-19" name="__codelineno-82-19" href="#__codelineno-82-19"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-82-20"><a id="__codelineno-82-20" name="__codelineno-82-20" href="#__codelineno-82-20"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-82-21"><a id="__codelineno-82-21" name="__codelineno-82-21" href="#__codelineno-82-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout repository</span>
</span><span id="__span-82-22"><a id="__codelineno-82-22" name="__codelineno-82-22" href="#__codelineno-82-22"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
</span><span id="__span-82-23"><a id="__codelineno-82-23" name="__codelineno-82-23" href="#__codelineno-82-23"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Trivy</span>
</span><span id="__span-82-24"><a id="__codelineno-82-24" name="__codelineno-82-24" href="#__codelineno-82-24"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aquasecurity/setup-trivy@v0.2.2</span>
</span><span id="__span-82-25"><a id="__codelineno-82-25" name="__codelineno-82-25" href="#__codelineno-82-25"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Trivy Terraform Security Scan</span>
</span><span id="__span-82-26"><a id="__codelineno-82-26" name="__codelineno-82-26" href="#__codelineno-82-26"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-82-27"><a id="__codelineno-82-27" name="__codelineno-82-27" href="#__codelineno-82-27"></a><span class="w">          </span><span class="no">trivy fs --scanners misconfig --severity HIGH,CRITICAL --format table --exit-code 1 --ignorefile .trivyignore ./terraform | tee trivy-report.txt</span>
</span><span id="__span-82-28"><a id="__codelineno-82-28" name="__codelineno-82-28" href="#__codelineno-82-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Display Scan Report</span>
</span><span id="__span-82-29"><a id="__codelineno-82-29" name="__codelineno-82-29" href="#__codelineno-82-29"></a><span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
</span><span id="__span-82-30"><a id="__codelineno-82-30" name="__codelineno-82-30" href="#__codelineno-82-30"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat trivy-report.txt</span>
</span><span id="__span-82-31"><a id="__codelineno-82-31" name="__codelineno-82-31" href="#__codelineno-82-31"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload Scan Report</span>
</span><span id="__span-82-32"><a id="__codelineno-82-32" name="__codelineno-82-32" href="#__codelineno-82-32"></a><span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
</span><span id="__span-82-33"><a id="__codelineno-82-33" name="__codelineno-82-33" href="#__codelineno-82-33"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/upload-artifact@v4</span>
</span><span id="__span-82-34"><a id="__codelineno-82-34" name="__codelineno-82-34" href="#__codelineno-82-34"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-82-35"><a id="__codelineno-82-35" name="__codelineno-82-35" href="#__codelineno-82-35"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tfsec-report</span>
</span><span id="__span-82-36"><a id="__codelineno-82-36" name="__codelineno-82-36" href="#__codelineno-82-36"></a><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">trivy-report.txt</span>
</span><span id="__span-82-37"><a id="__codelineno-82-37" name="__codelineno-82-37" href="#__codelineno-82-37"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Post Scan Results as PR Comment</span>
</span><span id="__span-82-38"><a id="__codelineno-82-38" name="__codelineno-82-38" href="#__codelineno-82-38"></a><span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
</span><span id="__span-82-39"><a id="__codelineno-82-39" name="__codelineno-82-39" href="#__codelineno-82-39"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mshick/add-pr-comment@v2</span>
</span><span id="__span-82-40"><a id="__codelineno-82-40" name="__codelineno-82-40" href="#__codelineno-82-40"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-82-41"><a id="__codelineno-82-41" name="__codelineno-82-41" href="#__codelineno-82-41"></a><span class="w">          </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;🚨</span><span class="nv"> </span><span class="s">**Terraform</span><span class="nv"> </span><span class="s">Security</span><span class="nv"> </span><span class="s">Scan</span><span class="nv"> </span><span class="s">Results**</span><span class="nv"> </span><span class="s">🚨</span>
</span><span id="__span-82-42"><a id="__codelineno-82-42" name="__codelineno-82-42" href="#__codelineno-82-42"></a>
</span><span id="__span-82-43"><a id="__codelineno-82-43" name="__codelineno-82-43" href="#__codelineno-82-43"></a><span class="s">``</span>
</span><span id="__span-82-44"><a id="__codelineno-82-44" name="__codelineno-82-44" href="#__codelineno-82-44"></a><span class="s">$(cat</span><span class="nv"> </span><span class="s">trivy-report.txt)</span>
</span><span id="__span-82-45"><a id="__codelineno-82-45" name="__codelineno-82-45" href="#__codelineno-82-45"></a><span class="s">``</span>
</span><span id="__span-82-46"><a id="__codelineno-82-46" name="__codelineno-82-46" href="#__codelineno-82-46"></a>
</span><span id="__span-82-47"><a id="__codelineno-82-47" name="__codelineno-82-47" href="#__codelineno-82-47"></a><span class="s">📌</span><span class="nv"> </span><span class="s">**Severity</span><span class="nv"> </span><span class="s">Levels:**</span><span class="nv"> </span><span class="s">`HIGH`,</span><span class="nv"> </span><span class="s">`CRITICAL`</span>
</span><span id="__span-82-48"><a id="__codelineno-82-48" name="__codelineno-82-48" href="#__codelineno-82-48"></a><span class="s">🔍</span><span class="nv"> </span><span class="s">**Ignored</span><span class="nv"> </span><span class="s">Findings:**</span><span class="nv"> </span><span class="s">Defined</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">`.trivyignore`</span>
</span><span id="__span-82-49"><a id="__codelineno-82-49" name="__codelineno-82-49" href="#__codelineno-82-49"></a><span class="s">📄</span><span class="nv"> </span><span class="s">**Full</span><span class="nv"> </span><span class="s">Report:**</span><span class="nv"> </span><span class="s">Check</span><span class="nv"> </span><span class="s">[tfsec-report](https://github.com/${{</span><span class="nv"> </span><span class="s">github.repository</span><span class="nv"> </span><span class="s">}}/actions/runs/${{</span><span class="nv"> </span><span class="s">github.run_id</span><span class="nv"> </span><span class="s">}})&quot;</span>
</span><span id="__span-82-50"><a id="__codelineno-82-50" name="__codelineno-82-50" href="#__codelineno-82-50"></a><span class="w">          </span><span class="nt">repo-token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
</span></code></pre></div>
<p><strong>Purpose</strong>: Scans Terraform configuration for security vulnerabilities.</p>
<p><strong>Triggers</strong>: Runs on push to main, pull_request to main or feature branches, and can be triggered manually via workflow_dispatch.</p>
<p><strong>Key Steps</strong>:</p>
<ul>
<li>
<p>Checks out the repository.</p>
</li>
<li>
<p>Installs Trivy security scanner.</p>
</li>
<li>
<p>Runs a scan for HIGH and CRITICAL misconfigurations.</p>
</li>
<li>
<p>Uploads scan results as an artifact and comments on PRs if issues are found.</p>
</li>
</ul>
<h4 id="tflint-code-linter"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#tflint-code-linter">TFLint Code Linter</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Lint</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="nt">on</span><span class="p">:</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="w">  </span><span class="nt">push</span><span class="p">:</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">main</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="w">  </span><span class="nt">tflint</span><span class="p">:</span>
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.os }}</span>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="w">    </span><span class="nt">defaults</span><span class="p">:</span>
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span>
</span><span id="__span-83-12"><a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a><span class="w">            </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-83-13"><a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a>
</span><span id="__span-83-14"><a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a><span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
</span><span id="__span-83-15"><a id="__codelineno-83-15" name="__codelineno-83-15" href="#__codelineno-83-15"></a><span class="w">      </span><span class="nt">matrix</span><span class="p">:</span>
</span><span id="__span-83-16"><a id="__codelineno-83-16" name="__codelineno-83-16" href="#__codelineno-83-16"></a><span class="w">        </span><span class="nt">os</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ubuntu-latest</span><span class="p p-Indicator">]</span>
</span><span id="__span-83-17"><a id="__codelineno-83-17" name="__codelineno-83-17" href="#__codelineno-83-17"></a>
</span><span id="__span-83-18"><a id="__codelineno-83-18" name="__codelineno-83-18" href="#__codelineno-83-18"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-83-19"><a id="__codelineno-83-19" name="__codelineno-83-19" href="#__codelineno-83-19"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
</span><span id="__span-83-20"><a id="__codelineno-83-20" name="__codelineno-83-20" href="#__codelineno-83-20"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout source code</span>
</span><span id="__span-83-21"><a id="__codelineno-83-21" name="__codelineno-83-21" href="#__codelineno-83-21"></a>
</span><span id="__span-83-22"><a id="__codelineno-83-22" name="__codelineno-83-22" href="#__codelineno-83-22"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/cache@v4</span>
</span><span id="__span-83-23"><a id="__codelineno-83-23" name="__codelineno-83-23" href="#__codelineno-83-23"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cache plugin dir</span>
</span><span id="__span-83-24"><a id="__codelineno-83-24" name="__codelineno-83-24" href="#__codelineno-83-24"></a><span class="w">      </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-83-25"><a id="__codelineno-83-25" name="__codelineno-83-25" href="#__codelineno-83-25"></a><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~/.tflint.d/plugins</span>
</span><span id="__span-83-26"><a id="__codelineno-83-26" name="__codelineno-83-26" href="#__codelineno-83-26"></a><span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.os }}-tflint-${{ hashFiles(&#39;.tflint.hcl&#39;) }}</span>
</span><span id="__span-83-27"><a id="__codelineno-83-27" name="__codelineno-83-27" href="#__codelineno-83-27"></a>
</span><span id="__span-83-28"><a id="__codelineno-83-28" name="__codelineno-83-28" href="#__codelineno-83-28"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform-linters/setup-tflint@v4</span>
</span><span id="__span-83-29"><a id="__codelineno-83-29" name="__codelineno-83-29" href="#__codelineno-83-29"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup TFLint</span>
</span><span id="__span-83-30"><a id="__codelineno-83-30" name="__codelineno-83-30" href="#__codelineno-83-30"></a><span class="w">      </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-83-31"><a id="__codelineno-83-31" name="__codelineno-83-31" href="#__codelineno-83-31"></a><span class="w">        </span><span class="nt">tflint_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v0.52.0</span>
</span><span id="__span-83-32"><a id="__codelineno-83-32" name="__codelineno-83-32" href="#__codelineno-83-32"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Show version</span>
</span><span id="__span-83-33"><a id="__codelineno-83-33" name="__codelineno-83-33" href="#__codelineno-83-33"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tflint --version</span>
</span><span id="__span-83-34"><a id="__codelineno-83-34" name="__codelineno-83-34" href="#__codelineno-83-34"></a>
</span><span id="__span-83-35"><a id="__codelineno-83-35" name="__codelineno-83-35" href="#__codelineno-83-35"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Init TFLint</span>
</span><span id="__span-83-36"><a id="__codelineno-83-36" name="__codelineno-83-36" href="#__codelineno-83-36"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tflint --init</span>
</span><span id="__span-83-37"><a id="__codelineno-83-37" name="__codelineno-83-37" href="#__codelineno-83-37"></a><span class="w">      </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-83-38"><a id="__codelineno-83-38" name="__codelineno-83-38" href="#__codelineno-83-38"></a><span class="w">        </span><span class="c1"># https://github.com/terraform-linters/tflint/blob/master/docs/user-guide/plugins.md#avoiding-rate-limiting</span>
</span><span id="__span-83-39"><a id="__codelineno-83-39" name="__codelineno-83-39" href="#__codelineno-83-39"></a><span class="w">        </span><span class="nt">GITHUB_TOKEN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ github.token }}</span>
</span><span id="__span-83-40"><a id="__codelineno-83-40" name="__codelineno-83-40" href="#__codelineno-83-40"></a>
</span><span id="__span-83-41"><a id="__codelineno-83-41" name="__codelineno-83-41" href="#__codelineno-83-41"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run TFLint</span>
</span><span id="__span-83-42"><a id="__codelineno-83-42" name="__codelineno-83-42" href="#__codelineno-83-42"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tflint -f compact</span>
</span></code></pre></div>
<p><strong>Purpose</strong>: Ensures Terraform code follows best practices and is formatted correctly.</p>
<p><strong>Triggers</strong>: Runs on push to main and all pull_request events.</p>
<p><strong>Key Steps</strong>:</p>
<ul>
<li>
<p>Checks out the repository.</p>
</li>
<li>
<p>Caches TFLint plugins to optimize runs.</p>
</li>
<li>
<p>Initializes and runs TFLint to detect formatting and best-practice issues.</p>
</li>
</ul>
<h4 id="terraform-plan"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#terraform-plan">Terraform Plan</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Plan&#39;</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="nt">on</span><span class="p">:</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="w">  </span><span class="nt">push</span><span class="p">:</span>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&#39;main&#39;</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span>
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a>
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a><span class="nt">permissions</span><span class="p">:</span>
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a><span class="w">  </span><span class="nt">id-token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id="__span-84-12"><a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a>
</span><span id="__span-84-13"><a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-84-14"><a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a>
</span><span id="__span-84-15"><a id="__codelineno-84-15" name="__codelineno-84-15" href="#__codelineno-84-15"></a><span class="w">  </span><span class="nt">terraform</span><span class="p">:</span>
</span><span id="__span-84-16"><a id="__codelineno-84-16" name="__codelineno-84-16" href="#__codelineno-84-16"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Terraform&#39;</span>
</span><span id="__span-84-17"><a id="__codelineno-84-17" name="__codelineno-84-17" href="#__codelineno-84-17"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-84-18"><a id="__codelineno-84-18" name="__codelineno-84-18" href="#__codelineno-84-18"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-84-19"><a id="__codelineno-84-19" name="__codelineno-84-19" href="#__codelineno-84-19"></a><span class="w">    </span><span class="nt">defaults</span><span class="p">:</span>
</span><span id="__span-84-20"><a id="__codelineno-84-20" name="__codelineno-84-20" href="#__codelineno-84-20"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span>
</span><span id="__span-84-21"><a id="__codelineno-84-21" name="__codelineno-84-21" href="#__codelineno-84-21"></a><span class="w">        </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bash</span>
</span><span id="__span-84-22"><a id="__codelineno-84-22" name="__codelineno-84-22" href="#__codelineno-84-22"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-84-23"><a id="__codelineno-84-23" name="__codelineno-84-23" href="#__codelineno-84-23"></a><span class="w">    </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-84-24"><a id="__codelineno-84-24" name="__codelineno-84-24" href="#__codelineno-84-24"></a><span class="w">      </span><span class="nt">GH_TOKEN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
</span><span id="__span-84-25"><a id="__codelineno-84-25" name="__codelineno-84-25" href="#__codelineno-84-25"></a>
</span><span id="__span-84-26"><a id="__codelineno-84-26" name="__codelineno-84-26" href="#__codelineno-84-26"></a>
</span><span id="__span-84-27"><a id="__codelineno-84-27" name="__codelineno-84-27" href="#__codelineno-84-27"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-84-28"><a id="__codelineno-84-28" name="__codelineno-84-28" href="#__codelineno-84-28"></a><span class="w">    </span><span class="c1"># Checkout the repository to the GitHub Actions runner</span>
</span><span id="__span-84-29"><a id="__codelineno-84-29" name="__codelineno-84-29" href="#__codelineno-84-29"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout</span>
</span><span id="__span-84-30"><a id="__codelineno-84-30" name="__codelineno-84-30" href="#__codelineno-84-30"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
</span><span id="__span-84-31"><a id="__codelineno-84-31" name="__codelineno-84-31" href="#__codelineno-84-31"></a>
</span><span id="__span-84-32"><a id="__codelineno-84-32" name="__codelineno-84-32" href="#__codelineno-84-32"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS Credentials</span>
</span><span id="__span-84-33"><a id="__codelineno-84-33" name="__codelineno-84-33" href="#__codelineno-84-33"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v4</span>
</span><span id="__span-84-34"><a id="__codelineno-84-34" name="__codelineno-84-34" href="#__codelineno-84-34"></a><span class="w">      </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-84-35"><a id="__codelineno-84-35" name="__codelineno-84-35" href="#__codelineno-84-35"></a><span class="w">        </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.ROLE_TO_ASSUME }}</span>
</span><span id="__span-84-36"><a id="__codelineno-84-36" name="__codelineno-84-36" href="#__codelineno-84-36"></a><span class="w">        </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eu-west-2</span>
</span><span id="__span-84-37"><a id="__codelineno-84-37" name="__codelineno-84-37" href="#__codelineno-84-37"></a>
</span><span id="__span-84-38"><a id="__codelineno-84-38" name="__codelineno-84-38" href="#__codelineno-84-38"></a><span class="w">    </span><span class="c1"># Install the latest version of Terraform CLI and configure the Terraform CLI configuration file with a Terraform Cloud user API token</span>
</span><span id="__span-84-39"><a id="__codelineno-84-39" name="__codelineno-84-39" href="#__codelineno-84-39"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
</span><span id="__span-84-40"><a id="__codelineno-84-40" name="__codelineno-84-40" href="#__codelineno-84-40"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v3</span>
</span><span id="__span-84-41"><a id="__codelineno-84-41" name="__codelineno-84-41" href="#__codelineno-84-41"></a>
</span><span id="__span-84-42"><a id="__codelineno-84-42" name="__codelineno-84-42" href="#__codelineno-84-42"></a><span class="w">    </span><span class="c1"># Initialize a new or existing Terraform working directory by creating initial files, loading any remote state, downloading modules, etc.</span>
</span><span id="__span-84-43"><a id="__codelineno-84-43" name="__codelineno-84-43" href="#__codelineno-84-43"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
</span><span id="__span-84-44"><a id="__codelineno-84-44" name="__codelineno-84-44" href="#__codelineno-84-44"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform init</span>
</span><span id="__span-84-45"><a id="__codelineno-84-45" name="__codelineno-84-45" href="#__codelineno-84-45"></a>
</span><span id="__span-84-46"><a id="__codelineno-84-46" name="__codelineno-84-46" href="#__codelineno-84-46"></a><span class="w">    </span><span class="c1"># Checks that all Terraform configuration files adhere to a canonical format</span>
</span><span id="__span-84-47"><a id="__codelineno-84-47" name="__codelineno-84-47" href="#__codelineno-84-47"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Format</span>
</span><span id="__span-84-48"><a id="__codelineno-84-48" name="__codelineno-84-48" href="#__codelineno-84-48"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform fmt -check</span>
</span><span id="__span-84-49"><a id="__codelineno-84-49" name="__codelineno-84-49" href="#__codelineno-84-49"></a>
</span><span id="__span-84-50"><a id="__codelineno-84-50" name="__codelineno-84-50" href="#__codelineno-84-50"></a><span class="w">    </span><span class="c1"># Terraform Plan</span>
</span><span id="__span-84-51"><a id="__codelineno-84-51" name="__codelineno-84-51" href="#__codelineno-84-51"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Plan</span>
</span><span id="__span-84-52"><a id="__codelineno-84-52" name="__codelineno-84-52" href="#__codelineno-84-52"></a><span class="w">      </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plan</span>
</span><span id="__span-84-53"><a id="__codelineno-84-53" name="__codelineno-84-53" href="#__codelineno-84-53"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-84-54"><a id="__codelineno-84-54" name="__codelineno-84-54" href="#__codelineno-84-54"></a><span class="w">        </span><span class="no">terraform plan -out=plan.tfplan</span>
</span><span id="__span-84-55"><a id="__codelineno-84-55" name="__codelineno-84-55" href="#__codelineno-84-55"></a><span class="w">        </span><span class="no">terraform show -json plan.tfplan &gt; /tmp/plan.json</span>
</span><span id="__span-84-56"><a id="__codelineno-84-56" name="__codelineno-84-56" href="#__codelineno-84-56"></a><span class="w">        </span><span class="no">cat /tmp/plan.json</span>
</span><span id="__span-84-57"><a id="__codelineno-84-57" name="__codelineno-84-57" href="#__codelineno-84-57"></a>
</span><span id="__span-84-58"><a id="__codelineno-84-58" name="__codelineno-84-58" href="#__codelineno-84-58"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup OPA</span>
</span><span id="__span-84-59"><a id="__codelineno-84-59" name="__codelineno-84-59" href="#__codelineno-84-59"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">open-policy-agent/setup-opa@v2</span>
</span><span id="__span-84-60"><a id="__codelineno-84-60" name="__codelineno-84-60" href="#__codelineno-84-60"></a><span class="w">      </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-84-61"><a id="__codelineno-84-61" name="__codelineno-84-61" href="#__codelineno-84-61"></a><span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
</span><span id="__span-84-62"><a id="__codelineno-84-62" name="__codelineno-84-62" href="#__codelineno-84-62"></a>
</span><span id="__span-84-63"><a id="__codelineno-84-63" name="__codelineno-84-63" href="#__codelineno-84-63"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run OPA Tests</span>
</span><span id="__span-84-64"><a id="__codelineno-84-64" name="__codelineno-84-64" href="#__codelineno-84-64"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-84-65"><a id="__codelineno-84-65" name="__codelineno-84-65" href="#__codelineno-84-65"></a><span class="w">        </span><span class="no">opaout=$(opa eval --data ../policies/instance-policy.rego --input /tmp/plan.json &quot;data.terraform.deny&quot; | jq -r &#39;.result[].expressions[].value[]&#39;)</span>
</span><span id="__span-84-66"><a id="__codelineno-84-66" name="__codelineno-84-66" href="#__codelineno-84-66"></a><span class="w">        </span><span class="no">[ -z &quot;$opaout&quot; ] &amp;&amp; exit 0 || echo &quot;$opaout&quot; &amp;&amp; gh pr comment ${{ github.event.pull_request.number }} --body &quot;### $opaout&quot; &amp;&amp; exit 1</span>
</span></code></pre></div>
<p><strong>Purpose</strong>: Generates and evaluates a Terraform execution plan before applying changes.</p>
<p><strong>Triggers</strong>: Runs on push to main, pull_request, and manually via workflow_dispatch.</p>
<p><strong>Key Steps</strong>:</p>
<ul>
<li>
<p>Checks out the repository.</p>
</li>
<li>
<p>Configures AWS credentials using OIDC.</p>
</li>
<li>
<p>Initializes Terraform and runs terraform plan, storing the output for later review.</p>
</li>
<li>
<p>Runs OPA (Open Policy Agent) tests against the Terraform plan to enforce security policies.</p>
</li>
</ul>
<h4 id="infracost-cost-analysis"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#infracost-cost-analysis">Infracost Cost Analysis</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Run</span><span class="nv"> </span><span class="s">Infracost&#39;</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="nt">on</span><span class="p">:</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="w">    </span><span class="nt">types</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">opened</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">synchronize</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">closed</span><span class="p p-Indicator">]</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="w">  </span><span class="nt">infracost-pull-request-checks</span><span class="p">:</span>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Infracost Pull Request Checks</span>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.event_name == &#39;pull_request&#39; &amp;&amp; (github.event.action == &#39;opened&#39; || github.event.action == &#39;synchronize&#39;)</span>
</span><span id="__span-85-9"><a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-85-10"><a id="__codelineno-85-10" name="__codelineno-85-10" href="#__codelineno-85-10"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-85-11"><a id="__codelineno-85-11" name="__codelineno-85-11" href="#__codelineno-85-11"></a><span class="w">    </span><span class="nt">permissions</span><span class="p">:</span>
</span><span id="__span-85-12"><a id="__codelineno-85-12" name="__codelineno-85-12" href="#__codelineno-85-12"></a><span class="w">      </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id="__span-85-13"><a id="__codelineno-85-13" name="__codelineno-85-13" href="#__codelineno-85-13"></a><span class="w">      </span><span class="nt">pull-requests</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span><span class="w"> </span><span class="c1"># Required to post comments</span>
</span><span id="__span-85-14"><a id="__codelineno-85-14" name="__codelineno-85-14" href="#__codelineno-85-14"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-85-15"><a id="__codelineno-85-15" name="__codelineno-85-15" href="#__codelineno-85-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Infracost</span>
</span><span id="__span-85-16"><a id="__codelineno-85-16" name="__codelineno-85-16" href="#__codelineno-85-16"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infracost/actions/setup@v3</span>
</span><span id="__span-85-17"><a id="__codelineno-85-17" name="__codelineno-85-17" href="#__codelineno-85-17"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-85-18"><a id="__codelineno-85-18" name="__codelineno-85-18" href="#__codelineno-85-18"></a><span class="w">          </span><span class="nt">api-key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.INFRACOST_API_KEY }}</span>
</span><span id="__span-85-19"><a id="__codelineno-85-19" name="__codelineno-85-19" href="#__codelineno-85-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout base branch</span>
</span><span id="__span-85-20"><a id="__codelineno-85-20" name="__codelineno-85-20" href="#__codelineno-85-20"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
</span><span id="__span-85-21"><a id="__codelineno-85-21" name="__codelineno-85-21" href="#__codelineno-85-21"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-85-22"><a id="__codelineno-85-22" name="__codelineno-85-22" href="#__codelineno-85-22"></a><span class="w">          </span><span class="nt">ref</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${{</span><span class="nv"> </span><span class="s">github.event.pull_request.base.ref</span><span class="nv"> </span><span class="s">}}&#39;</span>
</span><span id="__span-85-23"><a id="__codelineno-85-23" name="__codelineno-85-23" href="#__codelineno-85-23"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Generate Infracost cost estimate baseline</span>
</span><span id="__span-85-24"><a id="__codelineno-85-24" name="__codelineno-85-24" href="#__codelineno-85-24"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-85-25"><a id="__codelineno-85-25" name="__codelineno-85-25" href="#__codelineno-85-25"></a><span class="w">          </span><span class="no">infracost breakdown --path=. \</span>
</span><span id="__span-85-26"><a id="__codelineno-85-26" name="__codelineno-85-26" href="#__codelineno-85-26"></a><span class="w">                              </span><span class="no">--format=json \</span>
</span><span id="__span-85-27"><a id="__codelineno-85-27" name="__codelineno-85-27" href="#__codelineno-85-27"></a><span class="w">                              </span><span class="no">--out-file=/tmp/infracost-base.json</span>
</span><span id="__span-85-28"><a id="__codelineno-85-28" name="__codelineno-85-28" href="#__codelineno-85-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout PR branch</span>
</span><span id="__span-85-29"><a id="__codelineno-85-29" name="__codelineno-85-29" href="#__codelineno-85-29"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
</span><span id="__span-85-30"><a id="__codelineno-85-30" name="__codelineno-85-30" href="#__codelineno-85-30"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Generate Infracost diff</span>
</span><span id="__span-85-31"><a id="__codelineno-85-31" name="__codelineno-85-31" href="#__codelineno-85-31"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-85-32"><a id="__codelineno-85-32" name="__codelineno-85-32" href="#__codelineno-85-32"></a><span class="w">          </span><span class="no">infracost diff --path=. \</span>
</span><span id="__span-85-33"><a id="__codelineno-85-33" name="__codelineno-85-33" href="#__codelineno-85-33"></a><span class="w">                          </span><span class="no">--format=json \</span>
</span><span id="__span-85-34"><a id="__codelineno-85-34" name="__codelineno-85-34" href="#__codelineno-85-34"></a><span class="w">                          </span><span class="no">--compare-to=/tmp/infracost-base.json \</span>
</span><span id="__span-85-35"><a id="__codelineno-85-35" name="__codelineno-85-35" href="#__codelineno-85-35"></a><span class="w">                          </span><span class="no">--out-file=/tmp/infracost.json</span>
</span><span id="__span-85-36"><a id="__codelineno-85-36" name="__codelineno-85-36" href="#__codelineno-85-36"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Post Infracost comment</span>
</span><span id="__span-85-37"><a id="__codelineno-85-37" name="__codelineno-85-37" href="#__codelineno-85-37"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-85-38"><a id="__codelineno-85-38" name="__codelineno-85-38" href="#__codelineno-85-38"></a><span class="w">            </span><span class="no">infracost comment github --path=/tmp/infracost.json \</span>
</span><span id="__span-85-39"><a id="__codelineno-85-39" name="__codelineno-85-39" href="#__codelineno-85-39"></a><span class="w">                                     </span><span class="no">--repo=$GITHUB_REPOSITORY \</span>
</span><span id="__span-85-40"><a id="__codelineno-85-40" name="__codelineno-85-40" href="#__codelineno-85-40"></a><span class="w">                                     </span><span class="no">--github-token=${{ github.token }} \</span>
</span><span id="__span-85-41"><a id="__codelineno-85-41" name="__codelineno-85-41" href="#__codelineno-85-41"></a><span class="w">                                     </span><span class="no">--pull-request=${{ github.event.pull_request.number }} \</span>
</span><span id="__span-85-42"><a id="__codelineno-85-42" name="__codelineno-85-42" href="#__codelineno-85-42"></a><span class="w">                                     </span><span class="no">--behavior=update \</span>
</span><span id="__span-85-43"><a id="__codelineno-85-43" name="__codelineno-85-43" href="#__codelineno-85-43"></a><span class="w">                                     </span><span class="no">--policy-path ./policies/cost.rego</span>
</span></code></pre></div>
<p><strong>Purpose</strong>: Estimates the cost impact of Terraform changes before they are applied.</p>
<p><strong>Triggers</strong>: Runs on pull_request when a PR is opened, updated, or closed.</p>
<p><strong>Key Steps</strong>:</p>
<ul>
<li>
<p>Sets up Infracost with an API key.</p>
</li>
<li>
<p>Runs cost analysis for the current branch and compares it with the base branch.</p>
</li>
<li>
<p>Posts a cost breakdown as a comment on the PR.</p>
</li>
</ul>
<h5 id="example-output"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#example-output"><strong>Example Output:</strong></a></h5>
<table>
<thead>
<tr>
<th>Name</th>
<th>Quantity</th>
<th>Unit Cost</th>
<th>Monthly Cost</th>
</tr>
</thead>
<tbody>
<tr>
<td>aws_instance.grafana</td>
<td>1</td>
<td>$8.32</td>
<td>$8.32</td>
</tr>
<tr>
<td>aws_s3_bucket.gitops-tf</td>
<td>1</td>
<td>$0.03</td>
<td>$0.03</td>
</tr>
</tbody>
</table>
<h4 id="terraform-apply"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#terraform-apply">Terraform Apply</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Apply&#39;</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="nt">on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">workflow_dispatch</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="nt">permissions</span><span class="p">:</span>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a><span class="w">  </span><span class="nt">id-token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="w">  </span><span class="nt">terraform</span><span class="p">:</span>
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Terraform&#39;</span>
</span><span id="__span-86-13"><a id="__codelineno-86-13" name="__codelineno-86-13" href="#__codelineno-86-13"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-86-14"><a id="__codelineno-86-14" name="__codelineno-86-14" href="#__codelineno-86-14"></a>
</span><span id="__span-86-15"><a id="__codelineno-86-15" name="__codelineno-86-15" href="#__codelineno-86-15"></a><span class="w">    </span><span class="nt">defaults</span><span class="p">:</span>
</span><span id="__span-86-16"><a id="__codelineno-86-16" name="__codelineno-86-16" href="#__codelineno-86-16"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span>
</span><span id="__span-86-17"><a id="__codelineno-86-17" name="__codelineno-86-17" href="#__codelineno-86-17"></a><span class="w">        </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bash</span>
</span><span id="__span-86-18"><a id="__codelineno-86-18" name="__codelineno-86-18" href="#__codelineno-86-18"></a>
</span><span id="__span-86-19"><a id="__codelineno-86-19" name="__codelineno-86-19" href="#__codelineno-86-19"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-86-20"><a id="__codelineno-86-20" name="__codelineno-86-20" href="#__codelineno-86-20"></a>
</span><span id="__span-86-21"><a id="__codelineno-86-21" name="__codelineno-86-21" href="#__codelineno-86-21"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-86-22"><a id="__codelineno-86-22" name="__codelineno-86-22" href="#__codelineno-86-22"></a><span class="w">    </span><span class="c1"># Checkout the repository to the GitHub Actions runner</span>
</span><span id="__span-86-23"><a id="__codelineno-86-23" name="__codelineno-86-23" href="#__codelineno-86-23"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS Credentials</span>
</span><span id="__span-86-24"><a id="__codelineno-86-24" name="__codelineno-86-24" href="#__codelineno-86-24"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v4</span>
</span><span id="__span-86-25"><a id="__codelineno-86-25" name="__codelineno-86-25" href="#__codelineno-86-25"></a><span class="w">      </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-86-26"><a id="__codelineno-86-26" name="__codelineno-86-26" href="#__codelineno-86-26"></a><span class="w">        </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.ROLE_TO_ASSUME }}</span>
</span><span id="__span-86-27"><a id="__codelineno-86-27" name="__codelineno-86-27" href="#__codelineno-86-27"></a><span class="w">        </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eu-west-2</span>
</span><span id="__span-86-28"><a id="__codelineno-86-28" name="__codelineno-86-28" href="#__codelineno-86-28"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout</span>
</span><span id="__span-86-29"><a id="__codelineno-86-29" name="__codelineno-86-29" href="#__codelineno-86-29"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
</span><span id="__span-86-30"><a id="__codelineno-86-30" name="__codelineno-86-30" href="#__codelineno-86-30"></a>
</span><span id="__span-86-31"><a id="__codelineno-86-31" name="__codelineno-86-31" href="#__codelineno-86-31"></a><span class="w">    </span><span class="c1"># Install the latest version of Terraform CLI and configure the Terraform CLI configuration file with a Terraform Cloud user API token</span>
</span><span id="__span-86-32"><a id="__codelineno-86-32" name="__codelineno-86-32" href="#__codelineno-86-32"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
</span><span id="__span-86-33"><a id="__codelineno-86-33" name="__codelineno-86-33" href="#__codelineno-86-33"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v3</span>
</span><span id="__span-86-34"><a id="__codelineno-86-34" name="__codelineno-86-34" href="#__codelineno-86-34"></a>
</span><span id="__span-86-35"><a id="__codelineno-86-35" name="__codelineno-86-35" href="#__codelineno-86-35"></a><span class="w">    </span><span class="c1"># Initialize a new or existing Terraform working directory by creating initial files, loading any remote state, downloading modules, etc.</span>
</span><span id="__span-86-36"><a id="__codelineno-86-36" name="__codelineno-86-36" href="#__codelineno-86-36"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
</span><span id="__span-86-37"><a id="__codelineno-86-37" name="__codelineno-86-37" href="#__codelineno-86-37"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform -chdir=&quot;./terraform&quot; init</span>
</span><span id="__span-86-38"><a id="__codelineno-86-38" name="__codelineno-86-38" href="#__codelineno-86-38"></a>
</span><span id="__span-86-39"><a id="__codelineno-86-39" name="__codelineno-86-39" href="#__codelineno-86-39"></a><span class="w">    </span><span class="c1"># Checks that all Terraform configuration files adhere to a canonical format</span>
</span><span id="__span-86-40"><a id="__codelineno-86-40" name="__codelineno-86-40" href="#__codelineno-86-40"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Format</span>
</span><span id="__span-86-41"><a id="__codelineno-86-41" name="__codelineno-86-41" href="#__codelineno-86-41"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform -chdir=&quot;./terraform&quot; fmt -check</span>
</span><span id="__span-86-42"><a id="__codelineno-86-42" name="__codelineno-86-42" href="#__codelineno-86-42"></a>
</span><span id="__span-86-43"><a id="__codelineno-86-43" name="__codelineno-86-43" href="#__codelineno-86-43"></a><span class="w">    </span><span class="c1"># Generates an execution plan for Terraform</span>
</span><span id="__span-86-44"><a id="__codelineno-86-44" name="__codelineno-86-44" href="#__codelineno-86-44"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Plan</span>
</span><span id="__span-86-45"><a id="__codelineno-86-45" name="__codelineno-86-45" href="#__codelineno-86-45"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform -chdir=&quot;./terraform&quot; plan -input=false</span>
</span><span id="__span-86-46"><a id="__codelineno-86-46" name="__codelineno-86-46" href="#__codelineno-86-46"></a>
</span><span id="__span-86-47"><a id="__codelineno-86-47" name="__codelineno-86-47" href="#__codelineno-86-47"></a><span class="w">    </span><span class="c1"># Apply the Configuration</span>
</span><span id="__span-86-48"><a id="__codelineno-86-48" name="__codelineno-86-48" href="#__codelineno-86-48"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Apply</span>
</span><span id="__span-86-49"><a id="__codelineno-86-49" name="__codelineno-86-49" href="#__codelineno-86-49"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform -chdir=&quot;./terraform&quot; apply -input=false -auto-approve</span>
</span></code></pre></div>
<p><strong>Purpose</strong>: Applies Terraform changes to deploy the infrastructure.</p>
<p><strong>Triggers</strong>: Runs only when manually triggered via workflow_dispatch.</p>
<p><strong>Key Steps</strong>:</p>
<ul>
<li>
<p>Checks out the repository.</p>
</li>
<li>
<p>Configures AWS credentials.</p>
</li>
<li>
<p>Initializes Terraform.</p>
</li>
<li>
<p>Runs terraform apply to deploy resources.</p>
</li>
</ul>
<h4 id="terraform-destroy"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#terraform-destroy">Terraform Destroy</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Destroy&#39;</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="nt">on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">workflow_dispatch</span>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="nt">permissions</span><span class="p">:</span>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="w">  </span><span class="nt">id-token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a>
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a>
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="w">  </span><span class="nt">terraform</span><span class="p">:</span>
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Terraform&#39;</span>
</span><span id="__span-87-13"><a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-87-14"><a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a>
</span><span id="__span-87-15"><a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a><span class="w">    </span><span class="nt">defaults</span><span class="p">:</span>
</span><span id="__span-87-16"><a id="__codelineno-87-16" name="__codelineno-87-16" href="#__codelineno-87-16"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span>
</span><span id="__span-87-17"><a id="__codelineno-87-17" name="__codelineno-87-17" href="#__codelineno-87-17"></a><span class="w">        </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bash</span>
</span><span id="__span-87-18"><a id="__codelineno-87-18" name="__codelineno-87-18" href="#__codelineno-87-18"></a>
</span><span id="__span-87-19"><a id="__codelineno-87-19" name="__codelineno-87-19" href="#__codelineno-87-19"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-87-20"><a id="__codelineno-87-20" name="__codelineno-87-20" href="#__codelineno-87-20"></a>
</span><span id="__span-87-21"><a id="__codelineno-87-21" name="__codelineno-87-21" href="#__codelineno-87-21"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-87-22"><a id="__codelineno-87-22" name="__codelineno-87-22" href="#__codelineno-87-22"></a><span class="w">    </span><span class="c1"># Checkout the repository to the GitHub Actions runner</span>
</span><span id="__span-87-23"><a id="__codelineno-87-23" name="__codelineno-87-23" href="#__codelineno-87-23"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS Credentials</span>
</span><span id="__span-87-24"><a id="__codelineno-87-24" name="__codelineno-87-24" href="#__codelineno-87-24"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v4</span>
</span><span id="__span-87-25"><a id="__codelineno-87-25" name="__codelineno-87-25" href="#__codelineno-87-25"></a><span class="w">      </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-87-26"><a id="__codelineno-87-26" name="__codelineno-87-26" href="#__codelineno-87-26"></a><span class="w">        </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.ROLE_TO_ASSUME }}</span>
</span><span id="__span-87-27"><a id="__codelineno-87-27" name="__codelineno-87-27" href="#__codelineno-87-27"></a><span class="w">        </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eu-west-2</span>
</span><span id="__span-87-28"><a id="__codelineno-87-28" name="__codelineno-87-28" href="#__codelineno-87-28"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout</span>
</span><span id="__span-87-29"><a id="__codelineno-87-29" name="__codelineno-87-29" href="#__codelineno-87-29"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
</span><span id="__span-87-30"><a id="__codelineno-87-30" name="__codelineno-87-30" href="#__codelineno-87-30"></a>
</span><span id="__span-87-31"><a id="__codelineno-87-31" name="__codelineno-87-31" href="#__codelineno-87-31"></a><span class="w">    </span><span class="c1"># Install the latest version of Terraform CLI and configure the Terraform CLI configuration file with a Terraform Cloud user API token</span>
</span><span id="__span-87-32"><a id="__codelineno-87-32" name="__codelineno-87-32" href="#__codelineno-87-32"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
</span><span id="__span-87-33"><a id="__codelineno-87-33" name="__codelineno-87-33" href="#__codelineno-87-33"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v3</span>
</span><span id="__span-87-34"><a id="__codelineno-87-34" name="__codelineno-87-34" href="#__codelineno-87-34"></a>
</span><span id="__span-87-35"><a id="__codelineno-87-35" name="__codelineno-87-35" href="#__codelineno-87-35"></a><span class="w">    </span><span class="c1"># Initialize a new or existing Terraform working directory by creating initial files, loading any remote state, downloading modules, etc.</span>
</span><span id="__span-87-36"><a id="__codelineno-87-36" name="__codelineno-87-36" href="#__codelineno-87-36"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
</span><span id="__span-87-37"><a id="__codelineno-87-37" name="__codelineno-87-37" href="#__codelineno-87-37"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform -chdir=&quot;./terraform&quot; init</span>
</span><span id="__span-87-38"><a id="__codelineno-87-38" name="__codelineno-87-38" href="#__codelineno-87-38"></a>
</span><span id="__span-87-39"><a id="__codelineno-87-39" name="__codelineno-87-39" href="#__codelineno-87-39"></a><span class="w">    </span><span class="c1"># Checks that all Terraform configuration files adhere to a canonical format</span>
</span><span id="__span-87-40"><a id="__codelineno-87-40" name="__codelineno-87-40" href="#__codelineno-87-40"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Format</span>
</span><span id="__span-87-41"><a id="__codelineno-87-41" name="__codelineno-87-41" href="#__codelineno-87-41"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform -chdir=&quot;./terraform&quot; fmt -check</span>
</span><span id="__span-87-42"><a id="__codelineno-87-42" name="__codelineno-87-42" href="#__codelineno-87-42"></a>
</span><span id="__span-87-43"><a id="__codelineno-87-43" name="__codelineno-87-43" href="#__codelineno-87-43"></a><span class="w">    </span><span class="c1"># Generates an execution plan for Terraform</span>
</span><span id="__span-87-44"><a id="__codelineno-87-44" name="__codelineno-87-44" href="#__codelineno-87-44"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Plan</span>
</span><span id="__span-87-45"><a id="__codelineno-87-45" name="__codelineno-87-45" href="#__codelineno-87-45"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform -chdir=&quot;./terraform&quot; plan -input=false</span>
</span><span id="__span-87-46"><a id="__codelineno-87-46" name="__codelineno-87-46" href="#__codelineno-87-46"></a>
</span><span id="__span-87-47"><a id="__codelineno-87-47" name="__codelineno-87-47" href="#__codelineno-87-47"></a><span class="w">    </span><span class="c1"># Apply the Configuration</span>
</span><span id="__span-87-48"><a id="__codelineno-87-48" name="__codelineno-87-48" href="#__codelineno-87-48"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Destroy</span>
</span><span id="__span-87-49"><a id="__codelineno-87-49" name="__codelineno-87-49" href="#__codelineno-87-49"></a><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform -chdir=&quot;./terraform&quot; destroy -input=false -auto-approve</span>
</span></code></pre></div>
<p><strong>Purpose</strong>: Destroys deployed infrastructure when it's no longer needed.</p>
<p><strong>Triggers</strong>: Runs only when manually triggered via workflow_dispatch.</p>
<p><strong>Key Steps</strong>:</p>
<ul>
<li>
<p>Checks out the repository.</p>
</li>
<li>
<p>Configures AWS credentials.</p>
</li>
<li>
<p>Initializes Terraform.</p>
</li>
<li>
<p>Runs terraform destroy to remove all resources.</p>
</li>
</ul>
<h5 id="push-changes-to-a-feature-branch-in-github-codespaces"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#push-changes-to-a-feature-branch-in-github-codespaces"><strong>Push Changes to a Feature Branch (in GitHub Codespaces)</strong></a></h5>
<p>Run the following commands inside <strong>your cloned GitHub repository</strong>:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="c1"># Create and switch to a new feature branch</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>feature-branch<span class="w"> </span>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a>
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="c1"># Stage all modified files</span>
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a>git<span class="w"> </span>add<span class="w"> </span>.<span class="w"> </span>
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a>
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="c1"># Commit the changes with a meaningful message</span>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Testing CI/CD&quot;</span>
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a>
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a><span class="c1"># Push the feature branch to GitHub</span>
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a>git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>feature-branch
</span></code></pre></div>
<h4 id="deploying-aws-resources-with-terraform"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#deploying-aws-resources-with-terraform">Deploying AWS Resources with Terraform</a></h4>
<p>Terraform Configuration Breakdown</p>
<blockquote>
<p>The following Terraform files define the infrastructure to be deployed. Below, we explain each file and its role in the deployment process.</p>
</blockquote>
<h4 id="versionstf"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#versionstf">versions.tf</a></h4>
<p>Defines the required Terraform version and provider constraints to ensure compatibility.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>terraform<span class="w"> </span><span class="o">{</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="w">  </span><span class="nv">required_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&gt;= 1.3.0&quot;</span>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a>
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="w">  </span>backend<span class="w"> </span><span class="s2">&quot;s3&quot;</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="w">    </span><span class="nv">bucket</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gitops-tf-backend-mpcloudlab&quot;</span>
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="w">    </span><span class="nv">key</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform.tfstate&quot;</span>
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="w">    </span><span class="nv">region</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;eu-west-2&quot;</span>
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="w">    </span><span class="nv">dynamodb_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;GitopsTerraformLocks&quot;</span>
</span><span id="__span-89-9"><a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-89-10"><a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a><span class="o">}</span>
</span></code></pre></div>
<h4 id="providerstf"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#providerstf">providers.tf</a></h4>
<p>Configures the AWS provider and region settings.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>terraform<span class="w"> </span><span class="o">{</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="w">  </span>required_providers<span class="w"> </span><span class="o">{</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="w">    </span><span class="nv">aws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="w">      </span><span class="nb">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hashicorp/aws&quot;</span>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="w">      </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;5.69.0&quot;</span>
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-90-7"><a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a><span class="w">    </span><span class="nv">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="w">      </span><span class="nb">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hashicorp/http&quot;</span>
</span><span id="__span-90-9"><a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a><span class="w">      </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;3.4.5&quot;</span>
</span><span id="__span-90-10"><a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-90-11"><a id="__codelineno-90-11" name="__codelineno-90-11" href="#__codelineno-90-11"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-90-12"><a id="__codelineno-90-12" name="__codelineno-90-12" href="#__codelineno-90-12"></a><span class="o">}</span>
</span><span id="__span-90-13"><a id="__codelineno-90-13" name="__codelineno-90-13" href="#__codelineno-90-13"></a>
</span><span id="__span-90-14"><a id="__codelineno-90-14" name="__codelineno-90-14" href="#__codelineno-90-14"></a>provider<span class="w"> </span><span class="s2">&quot;aws&quot;</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-90-15"><a id="__codelineno-90-15" name="__codelineno-90-15" href="#__codelineno-90-15"></a><span class="w">  </span><span class="nv">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>var.region
</span><span id="__span-90-16"><a id="__codelineno-90-16" name="__codelineno-90-16" href="#__codelineno-90-16"></a><span class="o">}</span>
</span></code></pre></div>
<h4 id="variablestf"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#variablestf">variables.tf</a></h4>
<p>Declares input variables used throughout the Terraform configuration.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a>variable<span class="w"> </span><span class="s2">&quot;region&quot;</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="w">  </span><span class="nv">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWS region where resources will be deployed&quot;</span>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="w">  </span><span class="nb">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span>string
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="w">  </span><span class="nv">default</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;eu-west-2&quot;</span>
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="o">}</span>
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a>
</span><span id="__span-91-7"><a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a>variable<span class="w"> </span><span class="s2">&quot;instance_type&quot;</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-91-8"><a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a><span class="w">  </span><span class="nv">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;EC2 instance type&quot;</span>
</span><span id="__span-91-9"><a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a><span class="w">  </span><span class="nb">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span>string
</span><span id="__span-91-10"><a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a><span class="w">  </span><span class="nv">default</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;t3.micro&quot;</span>
</span><span id="__span-91-11"><a id="__codelineno-91-11" name="__codelineno-91-11" href="#__codelineno-91-11"></a><span class="o">}</span>
</span></code></pre></div>
<h4 id="terraformtfvars"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#terraformtfvars">terraform.tfvars</a></h4>
<p>Defines default values for input variables.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="nv">region</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;eu-west-2&quot;</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="nv">instance_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;t3.micro&quot;</span>
</span></code></pre></div>
<h4 id="maintf"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#maintf">main.tf</a></h4>
<p>Defines the main infrastructure resources to be deployed.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a>data<span class="w"> </span><span class="s2">&quot;aws_ami&quot;</span><span class="w"> </span><span class="s2">&quot;ubuntu&quot;</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="w">  </span><span class="nv">most_recent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a>
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="w">  </span>filter<span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="w">    </span><span class="nv">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;name&quot;</span>
</span><span id="__span-93-6"><a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a><span class="w">    </span><span class="nv">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*&quot;</span><span class="o">]</span>
</span><span id="__span-93-7"><a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-93-8"><a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a>
</span><span id="__span-93-9"><a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a><span class="w">  </span>filter<span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-10"><a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a><span class="w">    </span><span class="nv">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;virtualization-type&quot;</span>
</span><span id="__span-93-11"><a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a><span class="w">    </span><span class="nv">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;hvm&quot;</span><span class="o">]</span>
</span><span id="__span-93-12"><a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-93-13"><a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a>
</span><span id="__span-93-14"><a id="__codelineno-93-14" name="__codelineno-93-14" href="#__codelineno-93-14"></a><span class="w">  </span><span class="nv">owners</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;099720109477&quot;</span><span class="o">]</span><span class="w"> </span><span class="c1"># Canonical</span>
</span><span id="__span-93-15"><a id="__codelineno-93-15" name="__codelineno-93-15" href="#__codelineno-93-15"></a><span class="o">}</span>
</span><span id="__span-93-16"><a id="__codelineno-93-16" name="__codelineno-93-16" href="#__codelineno-93-16"></a>
</span><span id="__span-93-17"><a id="__codelineno-93-17" name="__codelineno-93-17" href="#__codelineno-93-17"></a>resource<span class="w"> </span><span class="s2">&quot;aws_vpc&quot;</span><span class="w"> </span><span class="s2">&quot;gitops_vpc&quot;</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-18"><a id="__codelineno-93-18" name="__codelineno-93-18" href="#__codelineno-93-18"></a><span class="w">  </span><span class="nv">cidr_block</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.0.0.0/16&quot;</span>
</span><span id="__span-93-19"><a id="__codelineno-93-19" name="__codelineno-93-19" href="#__codelineno-93-19"></a><span class="w">  </span><span class="nv">enable_dns_support</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-93-20"><a id="__codelineno-93-20" name="__codelineno-93-20" href="#__codelineno-93-20"></a><span class="w">  </span><span class="nv">enable_dns_hostnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-93-21"><a id="__codelineno-93-21" name="__codelineno-93-21" href="#__codelineno-93-21"></a>
</span><span id="__span-93-22"><a id="__codelineno-93-22" name="__codelineno-93-22" href="#__codelineno-93-22"></a><span class="w">  </span><span class="nv">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-23"><a id="__codelineno-93-23" name="__codelineno-93-23" href="#__codelineno-93-23"></a><span class="w">    </span><span class="nv">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gitops-vpc&quot;</span>
</span><span id="__span-93-24"><a id="__codelineno-93-24" name="__codelineno-93-24" href="#__codelineno-93-24"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-93-25"><a id="__codelineno-93-25" name="__codelineno-93-25" href="#__codelineno-93-25"></a><span class="o">}</span>
</span><span id="__span-93-26"><a id="__codelineno-93-26" name="__codelineno-93-26" href="#__codelineno-93-26"></a>
</span><span id="__span-93-27"><a id="__codelineno-93-27" name="__codelineno-93-27" href="#__codelineno-93-27"></a>resource<span class="w"> </span><span class="s2">&quot;aws_internet_gateway&quot;</span><span class="w"> </span><span class="s2">&quot;gitops_igw&quot;</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-28"><a id="__codelineno-93-28" name="__codelineno-93-28" href="#__codelineno-93-28"></a><span class="w">  </span><span class="nv">vpc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>aws_vpc.gitops_vpc.id
</span><span id="__span-93-29"><a id="__codelineno-93-29" name="__codelineno-93-29" href="#__codelineno-93-29"></a>
</span><span id="__span-93-30"><a id="__codelineno-93-30" name="__codelineno-93-30" href="#__codelineno-93-30"></a><span class="w">  </span><span class="nv">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-31"><a id="__codelineno-93-31" name="__codelineno-93-31" href="#__codelineno-93-31"></a><span class="w">    </span><span class="nv">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gitops-igw&quot;</span>
</span><span id="__span-93-32"><a id="__codelineno-93-32" name="__codelineno-93-32" href="#__codelineno-93-32"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-93-33"><a id="__codelineno-93-33" name="__codelineno-93-33" href="#__codelineno-93-33"></a><span class="o">}</span>
</span><span id="__span-93-34"><a id="__codelineno-93-34" name="__codelineno-93-34" href="#__codelineno-93-34"></a>
</span><span id="__span-93-35"><a id="__codelineno-93-35" name="__codelineno-93-35" href="#__codelineno-93-35"></a>resource<span class="w"> </span><span class="s2">&quot;aws_route_table&quot;</span><span class="w"> </span><span class="s2">&quot;gitops_rt&quot;</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-36"><a id="__codelineno-93-36" name="__codelineno-93-36" href="#__codelineno-93-36"></a><span class="w">  </span><span class="nv">vpc_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>aws_vpc.gitops_vpc.id
</span><span id="__span-93-37"><a id="__codelineno-93-37" name="__codelineno-93-37" href="#__codelineno-93-37"></a>
</span><span id="__span-93-38"><a id="__codelineno-93-38" name="__codelineno-93-38" href="#__codelineno-93-38"></a><span class="w">  </span>route<span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-39"><a id="__codelineno-93-39" name="__codelineno-93-39" href="#__codelineno-93-39"></a><span class="w">    </span><span class="nv">cidr_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0.0.0.0/0&quot;</span>
</span><span id="__span-93-40"><a id="__codelineno-93-40" name="__codelineno-93-40" href="#__codelineno-93-40"></a><span class="w">    </span><span class="nv">gateway_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>aws_internet_gateway.gitops_igw.id
</span><span id="__span-93-41"><a id="__codelineno-93-41" name="__codelineno-93-41" href="#__codelineno-93-41"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-93-42"><a id="__codelineno-93-42" name="__codelineno-93-42" href="#__codelineno-93-42"></a>
</span><span id="__span-93-43"><a id="__codelineno-93-43" name="__codelineno-93-43" href="#__codelineno-93-43"></a><span class="w">  </span><span class="nv">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-44"><a id="__codelineno-93-44" name="__codelineno-93-44" href="#__codelineno-93-44"></a><span class="w">    </span><span class="nv">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gitops-rt&quot;</span>
</span><span id="__span-93-45"><a id="__codelineno-93-45" name="__codelineno-93-45" href="#__codelineno-93-45"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-93-46"><a id="__codelineno-93-46" name="__codelineno-93-46" href="#__codelineno-93-46"></a><span class="o">}</span>
</span><span id="__span-93-47"><a id="__codelineno-93-47" name="__codelineno-93-47" href="#__codelineno-93-47"></a>
</span><span id="__span-93-48"><a id="__codelineno-93-48" name="__codelineno-93-48" href="#__codelineno-93-48"></a>resource<span class="w"> </span><span class="s2">&quot;aws_subnet&quot;</span><span class="w"> </span><span class="s2">&quot;gitops_subnet&quot;</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-49"><a id="__codelineno-93-49" name="__codelineno-93-49" href="#__codelineno-93-49"></a><span class="w">  </span><span class="nv">vpc_id</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span>aws_vpc.gitops_vpc.id
</span><span id="__span-93-50"><a id="__codelineno-93-50" name="__codelineno-93-50" href="#__codelineno-93-50"></a><span class="w">  </span><span class="nv">cidr_block</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;10.0.1.0/24&quot;</span>
</span><span id="__span-93-51"><a id="__codelineno-93-51" name="__codelineno-93-51" href="#__codelineno-93-51"></a><span class="w">  </span><span class="nv">map_public_ip_on_launch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-93-52"><a id="__codelineno-93-52" name="__codelineno-93-52" href="#__codelineno-93-52"></a>
</span><span id="__span-93-53"><a id="__codelineno-93-53" name="__codelineno-93-53" href="#__codelineno-93-53"></a><span class="w">  </span><span class="nv">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-54"><a id="__codelineno-93-54" name="__codelineno-93-54" href="#__codelineno-93-54"></a><span class="w">    </span><span class="nv">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gitops-subnet&quot;</span>
</span><span id="__span-93-55"><a id="__codelineno-93-55" name="__codelineno-93-55" href="#__codelineno-93-55"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-93-56"><a id="__codelineno-93-56" name="__codelineno-93-56" href="#__codelineno-93-56"></a><span class="o">}</span>
</span><span id="__span-93-57"><a id="__codelineno-93-57" name="__codelineno-93-57" href="#__codelineno-93-57"></a>
</span><span id="__span-93-58"><a id="__codelineno-93-58" name="__codelineno-93-58" href="#__codelineno-93-58"></a>resource<span class="w"> </span><span class="s2">&quot;aws_route_table_association&quot;</span><span class="w"> </span><span class="s2">&quot;gitops_rta&quot;</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-59"><a id="__codelineno-93-59" name="__codelineno-93-59" href="#__codelineno-93-59"></a><span class="w">  </span><span class="nv">subnet_id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>aws_subnet.gitops_subnet.id
</span><span id="__span-93-60"><a id="__codelineno-93-60" name="__codelineno-93-60" href="#__codelineno-93-60"></a><span class="w">  </span><span class="nv">route_table_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>aws_route_table.gitops_rt.id
</span><span id="__span-93-61"><a id="__codelineno-93-61" name="__codelineno-93-61" href="#__codelineno-93-61"></a><span class="o">}</span>
</span><span id="__span-93-62"><a id="__codelineno-93-62" name="__codelineno-93-62" href="#__codelineno-93-62"></a>
</span><span id="__span-93-63"><a id="__codelineno-93-63" name="__codelineno-93-63" href="#__codelineno-93-63"></a>resource<span class="w"> </span><span class="s2">&quot;aws_security_group&quot;</span><span class="w"> </span><span class="s2">&quot;gitops_sg&quot;</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-64"><a id="__codelineno-93-64" name="__codelineno-93-64" href="#__codelineno-93-64"></a><span class="w">  </span><span class="nv">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gitops_sg&quot;</span>
</span><span id="__span-93-65"><a id="__codelineno-93-65" name="__codelineno-93-65" href="#__codelineno-93-65"></a><span class="w">  </span><span class="nv">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow port 3000&quot;</span>
</span><span id="__span-93-66"><a id="__codelineno-93-66" name="__codelineno-93-66" href="#__codelineno-93-66"></a><span class="w">  </span><span class="nv">vpc_id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>aws_vpc.gitops_vpc.id
</span><span id="__span-93-67"><a id="__codelineno-93-67" name="__codelineno-93-67" href="#__codelineno-93-67"></a>
</span><span id="__span-93-68"><a id="__codelineno-93-68" name="__codelineno-93-68" href="#__codelineno-93-68"></a><span class="w">  </span>ingress<span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-69"><a id="__codelineno-93-69" name="__codelineno-93-69" href="#__codelineno-93-69"></a><span class="w">    </span><span class="nv">from_port</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">3000</span>
</span><span id="__span-93-70"><a id="__codelineno-93-70" name="__codelineno-93-70" href="#__codelineno-93-70"></a><span class="w">    </span><span class="nv">to_port</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">3000</span>
</span><span id="__span-93-71"><a id="__codelineno-93-71" name="__codelineno-93-71" href="#__codelineno-93-71"></a><span class="w">    </span><span class="nv">protocol</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tcp&quot;</span>
</span><span id="__span-93-72"><a id="__codelineno-93-72" name="__codelineno-93-72" href="#__codelineno-93-72"></a><span class="w">    </span><span class="nv">cidr_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;0.0.0.0/0&quot;</span><span class="o">]</span>
</span><span id="__span-93-73"><a id="__codelineno-93-73" name="__codelineno-93-73" href="#__codelineno-93-73"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-93-74"><a id="__codelineno-93-74" name="__codelineno-93-74" href="#__codelineno-93-74"></a>
</span><span id="__span-93-75"><a id="__codelineno-93-75" name="__codelineno-93-75" href="#__codelineno-93-75"></a><span class="w">  </span>egress<span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-76"><a id="__codelineno-93-76" name="__codelineno-93-76" href="#__codelineno-93-76"></a><span class="w">    </span><span class="nv">from_port</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-93-77"><a id="__codelineno-93-77" name="__codelineno-93-77" href="#__codelineno-93-77"></a><span class="w">    </span><span class="nv">to_port</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-93-78"><a id="__codelineno-93-78" name="__codelineno-93-78" href="#__codelineno-93-78"></a><span class="w">    </span><span class="nv">protocol</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-1&quot;</span>
</span><span id="__span-93-79"><a id="__codelineno-93-79" name="__codelineno-93-79" href="#__codelineno-93-79"></a><span class="w">    </span><span class="nv">cidr_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;0.0.0.0/0&quot;</span><span class="o">]</span>
</span><span id="__span-93-80"><a id="__codelineno-93-80" name="__codelineno-93-80" href="#__codelineno-93-80"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-93-81"><a id="__codelineno-93-81" name="__codelineno-93-81" href="#__codelineno-93-81"></a>
</span><span id="__span-93-82"><a id="__codelineno-93-82" name="__codelineno-93-82" href="#__codelineno-93-82"></a><span class="w">  </span><span class="nv">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-83"><a id="__codelineno-93-83" name="__codelineno-93-83" href="#__codelineno-93-83"></a><span class="w">    </span><span class="nv">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gitops-sg&quot;</span>
</span><span id="__span-93-84"><a id="__codelineno-93-84" name="__codelineno-93-84" href="#__codelineno-93-84"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-93-85"><a id="__codelineno-93-85" name="__codelineno-93-85" href="#__codelineno-93-85"></a><span class="o">}</span>
</span><span id="__span-93-86"><a id="__codelineno-93-86" name="__codelineno-93-86" href="#__codelineno-93-86"></a>
</span><span id="__span-93-87"><a id="__codelineno-93-87" name="__codelineno-93-87" href="#__codelineno-93-87"></a>resource<span class="w"> </span><span class="s2">&quot;aws_instance&quot;</span><span class="w"> </span><span class="s2">&quot;grafana_server&quot;</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-88"><a id="__codelineno-93-88" name="__codelineno-93-88" href="#__codelineno-93-88"></a><span class="w">  </span><span class="nv">ami</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span>data.aws_ami.ubuntu.id
</span><span id="__span-93-89"><a id="__codelineno-93-89" name="__codelineno-93-89" href="#__codelineno-93-89"></a><span class="w">  </span><span class="nv">instance_type</span><span class="w">          </span><span class="o">=</span><span class="w"> </span>var.instance_type
</span><span id="__span-93-90"><a id="__codelineno-93-90" name="__codelineno-93-90" href="#__codelineno-93-90"></a><span class="w">  </span><span class="nv">subnet_id</span><span class="w">              </span><span class="o">=</span><span class="w"> </span>aws_subnet.gitops_subnet.id
</span><span id="__span-93-91"><a id="__codelineno-93-91" name="__codelineno-93-91" href="#__codelineno-93-91"></a><span class="w">  </span><span class="nv">vpc_security_group_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>aws_security_group.gitops_sg.id<span class="o">]</span>
</span><span id="__span-93-92"><a id="__codelineno-93-92" name="__codelineno-93-92" href="#__codelineno-93-92"></a><span class="w">  </span><span class="nv">user_data</span><span class="w">              </span><span class="o">=</span><span class="w"> </span>file<span class="o">(</span><span class="s2">&quot;userdata.tftpl&quot;</span><span class="o">)</span>
</span><span id="__span-93-93"><a id="__codelineno-93-93" name="__codelineno-93-93" href="#__codelineno-93-93"></a>
</span><span id="__span-93-94"><a id="__codelineno-93-94" name="__codelineno-93-94" href="#__codelineno-93-94"></a><span class="w">  </span>root_block_device<span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-95"><a id="__codelineno-93-95" name="__codelineno-93-95" href="#__codelineno-93-95"></a><span class="w">    </span><span class="nv">encrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-93-96"><a id="__codelineno-93-96" name="__codelineno-93-96" href="#__codelineno-93-96"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-93-97"><a id="__codelineno-93-97" name="__codelineno-93-97" href="#__codelineno-93-97"></a>
</span><span id="__span-93-98"><a id="__codelineno-93-98" name="__codelineno-93-98" href="#__codelineno-93-98"></a><span class="w">  </span>metadata_options<span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-99"><a id="__codelineno-93-99" name="__codelineno-93-99" href="#__codelineno-93-99"></a><span class="w">    </span><span class="nv">http_tokens</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;required&quot;</span>
</span><span id="__span-93-100"><a id="__codelineno-93-100" name="__codelineno-93-100" href="#__codelineno-93-100"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-93-101"><a id="__codelineno-93-101" name="__codelineno-93-101" href="#__codelineno-93-101"></a>
</span><span id="__span-93-102"><a id="__codelineno-93-102" name="__codelineno-93-102" href="#__codelineno-93-102"></a><span class="w">  </span><span class="nv">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-103"><a id="__codelineno-93-103" name="__codelineno-93-103" href="#__codelineno-93-103"></a><span class="w">    </span><span class="nv">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;grafana-server&quot;</span>
</span><span id="__span-93-104"><a id="__codelineno-93-104" name="__codelineno-93-104" href="#__codelineno-93-104"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-93-105"><a id="__codelineno-93-105" name="__codelineno-93-105" href="#__codelineno-93-105"></a><span class="o">}</span>
</span><span id="__span-93-106"><a id="__codelineno-93-106" name="__codelineno-93-106" href="#__codelineno-93-106"></a>
</span><span id="__span-93-107"><a id="__codelineno-93-107" name="__codelineno-93-107" href="#__codelineno-93-107"></a>check<span class="w"> </span><span class="s2">&quot;grafana_health_check&quot;</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-108"><a id="__codelineno-93-108" name="__codelineno-93-108" href="#__codelineno-93-108"></a><span class="w">  </span>data<span class="w"> </span><span class="s2">&quot;http&quot;</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-109"><a id="__codelineno-93-109" name="__codelineno-93-109" href="#__codelineno-93-109"></a><span class="w">    </span><span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;http://</span><span class="si">${</span><span class="nv">aws_instance</span><span class="p">.grafana_server.public_ip</span><span class="si">}</span><span class="s2">:3000&quot;</span>
</span><span id="__span-93-110"><a id="__codelineno-93-110" name="__codelineno-93-110" href="#__codelineno-93-110"></a><span class="w">    </span>retry<span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-111"><a id="__codelineno-93-111" name="__codelineno-93-111" href="#__codelineno-93-111"></a><span class="w">      </span><span class="nv">attempts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>
</span><span id="__span-93-112"><a id="__codelineno-93-112" name="__codelineno-93-112" href="#__codelineno-93-112"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-93-113"><a id="__codelineno-93-113" name="__codelineno-93-113" href="#__codelineno-93-113"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-93-114"><a id="__codelineno-93-114" name="__codelineno-93-114" href="#__codelineno-93-114"></a><span class="w">  </span>assert<span class="w"> </span><span class="o">{</span>
</span><span id="__span-93-115"><a id="__codelineno-93-115" name="__codelineno-93-115" href="#__codelineno-93-115"></a><span class="w">    </span><span class="nv">condition</span><span class="w">     </span><span class="o">=</span><span class="w"> </span>data.http.test.status_code<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">200</span>
</span><span id="__span-93-116"><a id="__codelineno-93-116" name="__codelineno-93-116" href="#__codelineno-93-116"></a><span class="w">    </span><span class="nv">error_message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Grafana is inaccessible on port 3000.&quot;</span>
</span><span id="__span-93-117"><a id="__codelineno-93-117" name="__codelineno-93-117" href="#__codelineno-93-117"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-93-118"><a id="__codelineno-93-118" name="__codelineno-93-118" href="#__codelineno-93-118"></a><span class="o">}</span>
</span></code></pre></div>
<h4 id="userdatatftpl"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#userdatatftpl">userdata.tftpl</a></h4>
<p>Contains startup scripts that run when the EC2 instance is launched.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>apt-transport-https<span class="w"> </span>software-properties-common<span class="w"> </span>wget<span class="w"> </span><span class="o">&amp;&amp;</span>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/apt/keyrings/<span class="w"> </span><span class="o">&amp;&amp;</span>
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a>wget<span class="w"> </span>-q<span class="w"> </span>-O<span class="w"> </span>-<span class="w"> </span>https://apt.grafana.com/gpg.key<span class="w"> </span><span class="p">|</span><span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/keyrings/grafana.gpg<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span>
</span><span id="__span-94-5"><a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [signed-by=/etc/apt/keyrings/grafana.gpg] https://apt.grafana.com stable main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/apt/sources.list.d/grafana.list<span class="w"> </span><span class="o">&amp;&amp;</span>
</span><span id="__span-94-6"><a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span>
</span><span id="__span-94-7"><a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>grafana<span class="w"> </span><span class="o">&amp;&amp;</span>
</span><span id="__span-94-8"><a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>grafana-server<span class="w"> </span><span class="o">&amp;&amp;</span>
</span><span id="__span-94-9"><a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>grafana-server
</span></code></pre></div>
<h4 id="outputstf"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#outputstf">outputs.tf</a></h4>
<p>Defines output values to retrieve important details after deployment.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a>output<span class="w"> </span><span class="s2">&quot;grafana_ip&quot;</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="w">  </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;http://</span><span class="si">${</span><span class="nv">aws_instance</span><span class="p">.grafana_server.public_ip</span><span class="si">}</span><span class="s2">:3000&quot;</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="o">}</span>
</span></code></pre></div>
<h4 id="steps-to-deploy-terraform-resources"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#steps-to-deploy-terraform-resources">Steps to Deploy Terraform Resources</a></h4>
<p>Initialize Terraform</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>terraform<span class="w"> </span>init
</span></code></pre></div>
<p>Validate the configuration</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a>terraform<span class="w"> </span>validate
</span></code></pre></div>
<p>Generate an execution plan</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a>terraform<span class="w"> </span>plan
</span></code></pre></div>
<p>Apply the configuration</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>terraform<span class="w"> </span>apply<span class="w"> </span>-auto-approve
</span></code></pre></div>
<p>Retrieve outputs</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>terraform<span class="w"> </span>output
</span></code></pre></div>
<h4 id="verifying-the-deployment"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#verifying-the-deployment">Verifying the Deployment</a></h4>
<ul>
<li>
<p>Check the AWS Console to confirm that resources have been created.</p>
</li>
<li>
<p>Use SSH or a browser to access the deployed EC2 instance.</p>
</li>
</ul>
<h4 id="destroying-the-infrastructure"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#destroying-the-infrastructure">Destroying the Infrastructure</a></h4>
<p>When no longer needed, remove all resources:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>terraform<span class="w"> </span>destroy<span class="w"> </span>-auto-approve
</span></code></pre></div>
<p>or use the <code>Destroy</code> GitHub Actions workflow</p>
<h4 id="running-and-testing-the-pipeline"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#running-and-testing-the-pipeline">Running and Testing the Pipeline</a></h4>
<p>How to Trigger Workflows</p>
<h5 id="automatic-triggers"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#automatic-triggers">Automatic Triggers</a></h5>
<ul>
<li>
<p>Pushes and pull requests to main trigger the Plan, Security Scan, and Linter.</p>
</li>
<li>
<p>Pull requests trigger Infracost Cost Analysis.</p>
</li>
</ul>
<h5 id="manual-triggers"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#manual-triggers">Manual Triggers</a></h5>
<ul>
<li>
<p><code>terraform apply</code> and <code>terraform destroy</code> require workflow_dispatch (manual execution via GitHub UI).</p>
</li>
<li>
<p>Manually trigger <code>Apply</code> workflow to deploy</p>
</li>
<li>
<p>Manually trigger <code>Destroy</code> workflow to clean up resources</p>
</li>
</ul>
<h4 id="step-by-step-execution"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#step-by-step-execution">Step-by-Step Execution</a></h4>
<h5 id="push-changes-to-a-new-feature-branch"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#push-changes-to-a-new-feature-branch">Push Changes to a New Feature Branch</a></h5>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>feature-branch
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a>git<span class="w"> </span>add<span class="w"> </span>.
</span><span id="__span-102-3"><a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Testing CI/CD&quot;</span>
</span><span id="__span-102-4"><a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a>git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>feature-branch
</span></code></pre></div>
<h5 id="open-a-pull-request"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#open-a-pull-request">Open a Pull Request</a></h5>
<ul>
<li>
<p>This will trigger security scans, cost analysis, and Terraform plan.</p>
</li>
<li>
<p>Review GitHub Actions Results</p>
</li>
<li>
<p>Check logs for security, cost, and linting errors.</p>
</li>
<li>
<p>Merge to branch when approved</p>
</li>
</ul>
<h4 id="project-folder-structure"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#project-folder-structure">Project Folder Structure</a></h4>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a>├──<span class="w"> </span>.github<span class="w">                  </span><span class="c1"># GitHub Actions workflows</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a>│<span class="w">   </span>└──<span class="w"> </span>workflows
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a>│<span class="w">       </span>├──<span class="w"> </span>apply.yml<span class="w">       </span><span class="c1"># GitHub Actions workflow for applying Terraform changes</span>
</span><span id="__span-103-4"><a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a>│<span class="w">       </span>├──<span class="w"> </span>destroy.yml<span class="w">     </span><span class="c1"># GitHub Actions workflow for destroying Terraform resources</span>
</span><span id="__span-103-5"><a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a>│<span class="w">       </span>├──<span class="w"> </span>infracost.yml<span class="w">   </span><span class="c1"># Workflow for running Infracost to estimate Terraform costs</span>
</span><span id="__span-103-6"><a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a>│<span class="w">       </span>├──<span class="w"> </span>plan.yml<span class="w">        </span><span class="c1"># Workflow for running Terraform Plan</span>
</span><span id="__span-103-7"><a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a>│<span class="w">       </span>├──<span class="w"> </span>tflint.yml<span class="w">      </span><span class="c1"># Workflow for running TFLint to check Terraform syntax</span>
</span><span id="__span-103-8"><a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a>│<span class="w">       </span>└──<span class="w"> </span>tfsec.yml<span class="w">       </span><span class="c1"># Workflow for running tfsec to check Terraform security</span>
</span><span id="__span-103-9"><a id="__codelineno-103-9" name="__codelineno-103-9" href="#__codelineno-103-9"></a>├──<span class="w"> </span>.gitignore<span class="w">              </span><span class="c1"># Specifies files and directories to ignore in Git</span>
</span><span id="__span-103-10"><a id="__codelineno-103-10" name="__codelineno-103-10" href="#__codelineno-103-10"></a>├──<span class="w"> </span>.trivyignore<span class="w">            </span><span class="c1"># Ignore file for Trivy security scanning</span>
</span><span id="__span-103-11"><a id="__codelineno-103-11" name="__codelineno-103-11" href="#__codelineno-103-11"></a>├──<span class="w"> </span>README.md<span class="w">               </span><span class="c1"># Project documentation and setup instructions</span>
</span><span id="__span-103-12"><a id="__codelineno-103-12" name="__codelineno-103-12" href="#__codelineno-103-12"></a>├──<span class="w"> </span>cfn<span class="w">                     </span><span class="c1"># CloudFormation templates for infrastructure</span>
</span><span id="__span-103-13"><a id="__codelineno-103-13" name="__codelineno-103-13" href="#__codelineno-103-13"></a>│<span class="w">   </span>├──<span class="w"> </span>backend-resources.yaml<span class="w">  </span><span class="c1"># Defines S3 and DynamoDB resources for Terraform backend</span>
</span><span id="__span-103-14"><a id="__codelineno-103-14" name="__codelineno-103-14" href="#__codelineno-103-14"></a>│<span class="w">   </span>└──<span class="w"> </span>oidc-role.yaml<span class="w">      </span><span class="c1"># CloudFormation template to create OIDC role for GitHub Actions</span>
</span><span id="__span-103-15"><a id="__codelineno-103-15" name="__codelineno-103-15" href="#__codelineno-103-15"></a>├──<span class="w"> </span>install<span class="w"> </span>terraform.txt<span class="w">   </span><span class="c1"># Instructions for installing Terraform</span>
</span><span id="__span-103-16"><a id="__codelineno-103-16" name="__codelineno-103-16" href="#__codelineno-103-16"></a>├──<span class="w"> </span>policies<span class="w">                </span><span class="c1"># Policies for security and cost analysis</span>
</span><span id="__span-103-17"><a id="__codelineno-103-17" name="__codelineno-103-17" href="#__codelineno-103-17"></a>│<span class="w">   </span>├──<span class="w"> </span>cost.rego<span class="w">           </span><span class="c1"># OPA policy for Infracost cost enforcement</span>
</span><span id="__span-103-18"><a id="__codelineno-103-18" name="__codelineno-103-18" href="#__codelineno-103-18"></a>│<span class="w">   </span>├──<span class="w"> </span>instance-policy.rego<span class="w"> </span><span class="c1"># OPA policy for Terraform instance compliance</span>
</span><span id="__span-103-19"><a id="__codelineno-103-19" name="__codelineno-103-19" href="#__codelineno-103-19"></a>│<span class="w">   </span>└──<span class="w"> </span>plan.json<span class="w">           </span><span class="c1"># JSON representation of Terraform Plan for policy validation</span>
</span><span id="__span-103-20"><a id="__codelineno-103-20" name="__codelineno-103-20" href="#__codelineno-103-20"></a>└──<span class="w"> </span>terraform<span class="w">               </span><span class="c1"># Terraform configuration files</span>
</span><span id="__span-103-21"><a id="__codelineno-103-21" name="__codelineno-103-21" href="#__codelineno-103-21"></a><span class="w">    </span>├──<span class="w"> </span>main.tf<span class="w">             </span><span class="c1"># Defines core infrastructure (VPC, EC2, Security Groups, etc.)</span>
</span><span id="__span-103-22"><a id="__codelineno-103-22" name="__codelineno-103-22" href="#__codelineno-103-22"></a><span class="w">    </span>├──<span class="w"> </span>outputs.tf<span class="w">          </span><span class="c1"># Specifies Terraform output values</span>
</span><span id="__span-103-23"><a id="__codelineno-103-23" name="__codelineno-103-23" href="#__codelineno-103-23"></a><span class="w">    </span>├──<span class="w"> </span>providers.tf<span class="w">        </span><span class="c1"># Configures Terraform providers (AWS, HTTP, etc.)</span>
</span><span id="__span-103-24"><a id="__codelineno-103-24" name="__codelineno-103-24" href="#__codelineno-103-24"></a><span class="w">    </span>├──<span class="w"> </span>terraform.tfvars<span class="w">    </span><span class="c1"># Defines Terraform input variable values</span>
</span><span id="__span-103-25"><a id="__codelineno-103-25" name="__codelineno-103-25" href="#__codelineno-103-25"></a><span class="w">    </span>├──<span class="w"> </span>userdata.tftpl<span class="w">      </span><span class="c1"># Cloud-init script for configuring EC2 instances</span>
</span><span id="__span-103-26"><a id="__codelineno-103-26" name="__codelineno-103-26" href="#__codelineno-103-26"></a><span class="w">    </span>├──<span class="w"> </span>variables.tf<span class="w">        </span><span class="c1"># Declares Terraform input variables</span>
</span><span id="__span-103-27"><a id="__codelineno-103-27" name="__codelineno-103-27" href="#__codelineno-103-27"></a><span class="w">    </span>└──<span class="w"> </span>versions.tf<span class="w">         </span><span class="c1"># Specifies required Terraform and provider versions</span>
</span></code></pre></div>
<h4 id="conclusion"><a class="toclink" href="../../gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/#conclusion">Conclusion</a></h4>
<p>By implementing this GitOps pipeline, we achieve:</p>
<p>🚀 Automation – Eliminates manual deployments
🔒 Security – Enforces compliance using OPA &amp; Trivy
💰 Cost Awareness – Monitors infrastructure costs via Infracost</p>
<p>This approach provides scalability, consistency, and security for managing AWS infrastructure.</p>
<p>If you have questions, feedback, or suggestions, feel free to reach out!</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=GitOps%20Project%3A%20Automating%20AWS%20infrastructure%20deployment%20with%20Terraform%20and%20GitHub%20Actions%0A&amp;url=https://blog.pollockweb.com/blog/gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/gitops-project-automating-aws-infrastructure-deployment-with-terraform-and-github-actions/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-03 00:00:00+00:00">March 3, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/mkdocs/" class="md-meta__link">MkDocs</a>, 
              <a href="../../category/customization/" class="md-meta__link">Customization</a>, 
              <a href="../../category/blogging/" class="md-meta__link">Blogging</a>, 
              <a href="../../category/tech/" class="md-meta__link">Tech</a></li>
        
        
          
          <li class="md-meta__item">
            
              5 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="customizing-your-mkdocs-blog"><a class="toclink" href="../../customizing-your-mkdocs-blog/">Customizing Your MkDocs Blog 🎨</a></h2>
<p>Once you've set up your MkDocs blog, it's time to personalize it. In this post, I'll cover various customizations, including <strong>social media sharing hooks, changing the blog icon and favicon, adding authors, and using tags</strong>. These modifications will make your blog more interactive and visually appealing.</p>
<p>All of the steps covered in this guide are available in the <a href="https://squidfunk.github.io/mkdocs-material/getting-started/">MKDocs Documentation</a> or via the superb video tutorials created by <a href="https://youtu.be/pPEUhfTZswc?si=AjoyIaM5Ig7MZdgo">James Willett</a></p>
<h3 id="adding-social-media-sharing-hooks"><a class="toclink" href="../../customizing-your-mkdocs-blog/#adding-social-media-sharing-hooks">Adding Social Media Sharing Hooks 🔄</a></h3>
<p>To allow users to share your blog posts easily, you can create a <code>socialmedia.py</code> hook. This script appends sharing buttons to each post.</p>
<h4 id="create-the-hook-file"><a class="toclink" href="../../customizing-your-mkdocs-blog/#create-the-hook-file"><strong>Create the Hook File</strong></a></h4>
<p>Inside your project, create a folder named <code>hooks/</code> if it doesn't already exist, and then add a file called <code>socialmedia.py</code>:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a>mkdir<span class="w"> </span>hooks
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>nano<span class="w"> </span>hooks/socialmedia.py
</span></code></pre></div>
<h4 id="add-the-social-media-sharing-code"><a class="toclink" href="../../customizing-your-mkdocs-blog/#add-the-social-media-sharing-code"><strong>Add the Social Media Sharing Code</strong></a></h4>
<p>Paste the following into <code>socialmedia.py</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">textwrap</span><span class="w"> </span><span class="kn">import</span> <span class="n">dedent</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">urllib.parse</span>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a>
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="n">x_intent</span> <span class="o">=</span> <span class="s2">&quot;https://x.com/intent/tweet&quot;</span>
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="n">fb_sharer</span> <span class="o">=</span> <span class="s2">&quot;https://www.facebook.com/sharer/sharer.php&quot;</span>
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="n">include</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;posts/.*&quot;</span><span class="p">)</span>
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a>
</span><span id="__span-89-9"><a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">on_page_markdown</span><span class="p">(</span><span class="n">markdown</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="__span-89-10"><a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a>    <span class="n">page</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span>
</span><span id="__span-89-11"><a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a>    <span class="n">config</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>
</span><span id="__span-89-12"><a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">include</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">url</span><span class="p">):</span>
</span><span id="__span-89-13"><a id="__codelineno-89-13" name="__codelineno-89-13" href="#__codelineno-89-13"></a>        <span class="k">return</span> <span class="n">markdown</span>
</span><span id="__span-89-14"><a id="__codelineno-89-14" name="__codelineno-89-14" href="#__codelineno-89-14"></a>
</span><span id="__span-89-15"><a id="__codelineno-89-15" name="__codelineno-89-15" href="#__codelineno-89-15"></a>    <span class="n">page_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">site_url</span> <span class="o">+</span> <span class="n">page</span><span class="o">.</span><span class="n">url</span>
</span><span id="__span-89-16"><a id="__codelineno-89-16" name="__codelineno-89-16" href="#__codelineno-89-16"></a>    <span class="n">page_title</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-89-17"><a id="__codelineno-89-17" name="__codelineno-89-17" href="#__codelineno-89-17"></a>
</span><span id="__span-89-18"><a id="__codelineno-89-18" name="__codelineno-89-18" href="#__codelineno-89-18"></a>    <span class="k">return</span> <span class="n">markdown</span> <span class="o">+</span> <span class="n">dedent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-89-19"><a id="__codelineno-89-19" name="__codelineno-89-19" href="#__codelineno-89-19"></a><span class="s2">    [Share on :simple-x:](</span><span class="si">{</span><span class="n">x_intent</span><span class="si">}</span><span class="s2">?text=</span><span class="si">{</span><span class="n">page_title</span><span class="si">}</span><span class="s2">&amp;url=</span><span class="si">{</span><span class="n">page_url</span><span class="si">}</span><span class="s2">)</span><span class="se">{{</span><span class="s2"> .md-button </span><span class="se">}}</span>
</span><span id="__span-89-20"><a id="__codelineno-89-20" name="__codelineno-89-20" href="#__codelineno-89-20"></a><span class="s2">    [Share on :simple-facebook:](</span><span class="si">{</span><span class="n">fb_sharer</span><span class="si">}</span><span class="s2">?u=</span><span class="si">{</span><span class="n">page_url</span><span class="si">}</span><span class="s2">)</span><span class="se">{{</span><span class="s2"> .md-button </span><span class="se">}}</span>
</span><span id="__span-89-21"><a id="__codelineno-89-21" name="__codelineno-89-21" href="#__codelineno-89-21"></a><span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>How the Code Works:</strong></p>
<ul>
<li>The script identifies blog post pages using a regular expression (<code>posts/.*</code>)</li>
<li>It gets the current page URL and title from MkDocs</li>
<li>It adds formatted markdown buttons at the end of your content</li>
<li>The buttons link to X (Twitter) and Facebook with pre-filled sharing information</li>
</ul>
<h4 id="enable-the-hook-in-mkdocsyml"><a class="toclink" href="../../customizing-your-mkdocs-blog/#enable-the-hook-in-mkdocsyml"><strong>Enable the Hook in <code>mkdocs.yml</code></strong></a></h4>
<p>Modify <code>mkdocs.yml</code> to include the hook:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="nt">hooks</span><span class="p">:</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hooks/socialmedia.py</span>
</span></code></pre></div>
<p>This will append social media sharing buttons to your posts.</p>
<h3 id="changing-the-blog-icon-and-favicon"><a class="toclink" href="../../customizing-your-mkdocs-blog/#changing-the-blog-icon-and-favicon">Changing the Blog Icon and Favicon 🖼️</a></h3>
<p>Updating your blog's favicon and site icon enhances branding.</p>
<h4 id="prepare-the-icons"><a class="toclink" href="../../customizing-your-mkdocs-blog/#prepare-the-icons"><strong>Prepare the Icons</strong></a></h4>
<p>Save your icons in <code>docs/images/</code> as:</p>
<ul>
<li><code>favicon.ico</code> (16x16 or 32x32 pixels) - Used by browsers in tabs and bookmarks</li>
<li><code>logo.png</code> (recommended 512x512 pixels) - Displayed in your site header/navigation</li>
</ul>
<h4 id="update-mkdocsyml"><a class="toclink" href="../../customizing-your-mkdocs-blog/#update-mkdocsyml"><strong>Update <code>mkdocs.yml</code></strong></a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="nt">extra</span><span class="p">:</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="w">  </span><span class="nt">logo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">images/logo.png</span>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="w">  </span><span class="nt">favicon</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">images/favicon.ico</span>
</span></code></pre></div>
<p>Note: These paths are relative to your <code>docs/</code> directory, and both settings should be nested under the <code>extra:</code> key in your configuration file.</p>
<h4 id="restart-the-server"><a class="toclink" href="../../customizing-your-mkdocs-blog/#restart-the-server"><strong>Restart the Server</strong></a></h4>
<p>Run <code>mkdocs serve</code> to preview the changes.</p>
<h3 id="adding-authors"><a class="toclink" href="../../customizing-your-mkdocs-blog/#adding-authors">Adding Authors 👥</a></h3>
<p>To attribute posts to different authors, create an <code>authors.yml</code> file.</p>
<h4 id="create-authorsyml"><a class="toclink" href="../../customizing-your-mkdocs-blog/#create-authorsyml"><strong>Create <code>authors.yml</code></strong></a></h4>
<p>In the <code>docs/</code> directory of your project, create a file named <code>authors.yml</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="nt">matthew</span><span class="p">:</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Matthew</span><span class="nv"> </span><span class="s">Pollock&quot;</span>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="w">  </span><span class="nt">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;matthew@example.com&quot;</span>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="w">  </span><span class="nt">website</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://matthewblog.com&quot;</span>
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a>
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a><span class="nt">team</span><span class="p">:</span>
</span><span id="__span-92-7"><a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Blog</span><span class="nv"> </span><span class="s">Team&quot;</span>
</span><span id="__span-92-8"><a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a><span class="w">  </span><span class="nt">website</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://teamwebsite.com&quot;</span>
</span><span id="__span-92-9"><a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a>
</span><span id="__span-92-10"><a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a><span class="nt">squidfunk</span><span class="p">:</span>
</span><span id="__span-92-11"><a id="__codelineno-92-11" name="__codelineno-92-11" href="#__codelineno-92-11"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SquidFunk&quot;</span>
</span><span id="__span-92-12"><a id="__codelineno-92-12" name="__codelineno-92-12" href="#__codelineno-92-12"></a><span class="w">  </span><span class="nt">website</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://squidfunk.github.io/&quot;</span>
</span></code></pre></div>
<h4 id="link-authors-to-posts"><a class="toclink" href="../../customizing-your-mkdocs-blog/#link-authors-to-posts"><strong>Link Authors to Posts</strong></a></h4>
<p>Modify each post's metadata:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="nt">authors</span><span class="p">:</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">matthew</span>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">team</span>
</span></code></pre></div>
<h3 id="adding-tags"><a class="toclink" href="../../customizing-your-mkdocs-blog/#adding-tags">Adding Tags 🏷️</a></h3>
<p>Tags help categorize your blog posts.</p>
<h4 id="create-tagsmd"><a class="toclink" href="../../customizing-your-mkdocs-blog/#create-tagsmd"><strong>Create <code>tags.md</code></strong></a></h4>
<p>Create a <code>docs/tags.md</code> file. Below are the tags used in this blog:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="c1"># Tags</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">technology</span>
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">learning</span>
</span></code></pre></div>
<h4 id="enable-tags-in-mkdocsyml"><a class="toclink" href="../../customizing-your-mkdocs-blog/#enable-tags-in-mkdocsyml"><strong>Enable Tags in <code>mkdocs.yml</code></strong></a></h4>
<p>Modify <code>mkdocs.yml</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="nt">plugins</span><span class="p">:</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="w">      </span><span class="nt">tags_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tags.md</span>
</span></code></pre></div>
<p>Now, you can tag posts like this:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">technology</span>
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">learning</span>
</span></code></pre></div>
<h3 id="enabling-comments-on-blog-posts"><a class="toclink" href="../../customizing-your-mkdocs-blog/#enabling-comments-on-blog-posts">Enabling Comments on Blog Posts 💬</a></h3>
<p>If you want to enable comments on blog posts, follow these steps:</p>
<h4 id="create-the-comments-template"><a class="toclink" href="../../customizing-your-mkdocs-blog/#create-the-comments-template"><strong>Create the Comments Template</strong></a></h4>
<p>Create a directory <code>overrides/partials/</code> if it doesn't exist, then add a file called <code>comments.html</code> with your Disqus integration code:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;disqus_thread&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">disqus_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
</span><span id="__span-97-5"><a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">identifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
</span><span id="__span-97-6"><a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-97-7"><a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="w">  </span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-97-8"><a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
</span><span id="__span-97-9"><a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;https://your-disqus-name.disqus.com/embed.js&#39;</span><span class="p">;</span>
</span><span id="__span-97-10"><a id="__codelineno-97-10" name="__codelineno-97-10" href="#__codelineno-97-10"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;data-timestamp&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">+</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">());</span>
</span><span id="__span-97-11"><a id="__codelineno-97-11" name="__codelineno-97-11" href="#__codelineno-97-11"></a><span class="w">    </span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">head</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">d</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
</span><span id="__span-97-12"><a id="__codelineno-97-12" name="__codelineno-97-12" href="#__codelineno-97-12"></a><span class="w">  </span><span class="p">})();</span>
</span><span id="__span-97-13"><a id="__codelineno-97-13" name="__codelineno-97-13" href="#__codelineno-97-13"></a><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></code></pre></div>
<p><strong>Note:</strong> Replace <code>your-disqus-name</code> with your Disqus shortname, which you can find in your Disqus admin panel after creating a site.</p>
<h4 id="enable-comments-in-mkdocsyml"><a class="toclink" href="../../customizing-your-mkdocs-blog/#enable-comments-in-mkdocsyml"><strong>Enable Comments in <code>mkdocs.yml</code></strong></a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="nt">extra</span><span class="p">:</span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="w">  </span><span class="nt">comments</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div>
<p>Restart MkDocs and test:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>mkdocs<span class="w"> </span>serve
</span></code></pre></div>
<h3 id="theme-customization"><a class="toclink" href="../../customizing-your-mkdocs-blog/#theme-customization">Theme Customization 🎭</a></h3>
<p>The Material theme offers extensive customization options for colors, fonts, and more.</p>
<h4 id="custom-color-scheme"><a class="toclink" href="../../customizing-your-mkdocs-blog/#custom-color-scheme"><strong>Custom Color Scheme</strong></a></h4>
<p>Add this to your <code>mkdocs.yml</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="nt">theme</span><span class="p">:</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">material</span>
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="w">  </span><span class="nt">palette</span><span class="p">:</span>
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a><span class="w">    </span><span class="c1"># Light mode</span>
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">media</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;(prefers-color-scheme:</span><span class="nv"> </span><span class="s">light)&quot;</span>
</span><span id="__span-100-6"><a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a><span class="w">      </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
</span><span id="__span-100-7"><a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a><span class="w">      </span><span class="nt">primary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">indigo</span>
</span><span id="__span-100-8"><a id="__codelineno-100-8" name="__codelineno-100-8" href="#__codelineno-100-8"></a><span class="w">      </span><span class="nt">accent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">indigo</span>
</span><span id="__span-100-9"><a id="__codelineno-100-9" name="__codelineno-100-9" href="#__codelineno-100-9"></a><span class="w">      </span><span class="nt">toggle</span><span class="p">:</span>
</span><span id="__span-100-10"><a id="__codelineno-100-10" name="__codelineno-100-10" href="#__codelineno-100-10"></a><span class="w">        </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">material/toggle-switch-off-outline</span>
</span><span id="__span-100-11"><a id="__codelineno-100-11" name="__codelineno-100-11" href="#__codelineno-100-11"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Switch to dark mode</span>
</span><span id="__span-100-12"><a id="__codelineno-100-12" name="__codelineno-100-12" href="#__codelineno-100-12"></a><span class="w">    </span><span class="c1"># Dark mode</span>
</span><span id="__span-100-13"><a id="__codelineno-100-13" name="__codelineno-100-13" href="#__codelineno-100-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">media</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;(prefers-color-scheme:</span><span class="nv"> </span><span class="s">dark)&quot;</span>
</span><span id="__span-100-14"><a id="__codelineno-100-14" name="__codelineno-100-14" href="#__codelineno-100-14"></a><span class="w">      </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">slate</span>
</span><span id="__span-100-15"><a id="__codelineno-100-15" name="__codelineno-100-15" href="#__codelineno-100-15"></a><span class="w">      </span><span class="nt">primary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">blue</span>
</span><span id="__span-100-16"><a id="__codelineno-100-16" name="__codelineno-100-16" href="#__codelineno-100-16"></a><span class="w">      </span><span class="nt">accent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">blue</span>
</span><span id="__span-100-17"><a id="__codelineno-100-17" name="__codelineno-100-17" href="#__codelineno-100-17"></a><span class="w">      </span><span class="nt">toggle</span><span class="p">:</span>
</span><span id="__span-100-18"><a id="__codelineno-100-18" name="__codelineno-100-18" href="#__codelineno-100-18"></a><span class="w">        </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">material/toggle-switch</span>
</span><span id="__span-100-19"><a id="__codelineno-100-19" name="__codelineno-100-19" href="#__codelineno-100-19"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Switch to light mode</span>
</span></code></pre></div>
<h4 id="custom-fonts"><a class="toclink" href="../../customizing-your-mkdocs-blog/#custom-fonts"><strong>Custom Fonts</strong></a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="nt">theme</span><span class="p">:</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="w">  </span><span class="nt">font</span><span class="p">:</span>
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="w">    </span><span class="nt">text</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Roboto</span>
</span><span id="__span-101-4"><a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="w">    </span><span class="nt">code</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Roboto Mono</span>
</span></code></pre></div>
<h3 id="analytics-integration"><a class="toclink" href="../../customizing-your-mkdocs-blog/#analytics-integration">Analytics Integration 📊</a></h3>
<p>Add analytics to track your blog's performance.</p>
<h4 id="google-analytics"><a class="toclink" href="../../customizing-your-mkdocs-blog/#google-analytics"><strong>Google Analytics</strong></a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="nt">extra</span><span class="p">:</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="w">  </span><span class="nt">analytics</span><span class="p">:</span>
</span><span id="__span-102-3"><a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="w">    </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">google</span>
</span><span id="__span-102-4"><a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="w">    </span><span class="nt">property</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">G-XXXXXXXXXX</span>
</span></code></pre></div>
<h4 id="plausible-analytics"><a class="toclink" href="../../customizing-your-mkdocs-blog/#plausible-analytics"><strong>Plausible Analytics</strong></a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="nt">extra</span><span class="p">:</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="w">  </span><span class="nt">analytics</span><span class="p">:</span>
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="w">    </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plausible</span>
</span><span id="__span-103-4"><a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="w">    </span><span class="nt">domain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yourdomain.com</span>
</span></code></pre></div>
<h3 id="seo-optimization"><a class="toclink" href="../../customizing-your-mkdocs-blog/#seo-optimization">SEO Optimization 🔍</a></h3>
<p>Improve your blog's search engine visibility.</p>
<h4 id="add-meta-tags"><a class="toclink" href="../../customizing-your-mkdocs-blog/#add-meta-tags"><strong>Add Meta Tags</strong></a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="nt">plugins</span><span class="p">:</span>
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">meta</span>
</span></code></pre></div>
<p>Then in each post, add:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="nt">meta</span><span class="p">:</span>
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;A</span><span class="nv"> </span><span class="s">detailed</span><span class="nv"> </span><span class="s">guide</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">customizing</span><span class="nv"> </span><span class="s">MkDocs</span><span class="nv"> </span><span class="s">blogs&quot;</span>
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="w">  </span><span class="nt">keywords</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mkdocs, blog, customization, web development</span>
</span><span id="__span-105-4"><a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a><span class="w">  </span><span class="nt">robots</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">index, follow</span>
</span><span id="__span-105-5"><a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a><span class="w">  </span><span class="nt">og:image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/assets/social-card.png</span>
</span></code></pre></div>
<h3 id="performance-optimization"><a class="toclink" href="../../customizing-your-mkdocs-blog/#performance-optimization">Performance Optimization ⚡</a></h3>
<p>Keep your blog fast and responsive.</p>
<h4 id="image-optimization"><a class="toclink" href="../../customizing-your-mkdocs-blog/#image-optimization"><strong>Image Optimization</strong></a></h4>
<ol>
<li>Compress all images before adding them to your blog</li>
<li>Use modern formats like WebP</li>
<li>Specify image dimensions in HTML to prevent layout shifts</li>
</ol>
<h4 id="lazy-loading"><a class="toclink" href="../../customizing-your-mkdocs-blog/#lazy-loading"><strong>Lazy Loading</strong></a></h4>
<p>Enable lazy loading of images using the <code>loading="lazy"</code> attribute:</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a>![<span class="nt">Alt text</span>](<span class="na">image.jpg</span>){ loading=lazy }
</span></code></pre></div>
<h3 id="understanding-your-mkdocs-project-structure"><a class="toclink" href="../../customizing-your-mkdocs-blog/#understanding-your-mkdocs-project-structure">Understanding Your MkDocs Project Structure 📁</a></h3>
<p>Once you have created an MkDocs project and added the components listed in the two posts in this series, you'll see a folder structure similar to this:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a>project-blog/
</span><span id="__span-107-2"><a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a>├── docs/                 # Documentation files (Markdown content)
</span><span id="__span-107-3"><a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a>│   ├── index.md          # Homepage of your site
</span><span id="__span-107-4"><a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a>│   ├── tags.md           # Tags page for blog posts
</span><span id="__span-107-5"><a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a>│   ├── authors.yml       # Defines author metadata
</span><span id="__span-107-6"><a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a>│   ├── posts/            # Blog post storage
</span><span id="__span-107-7"><a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a>│   │   ├── firstpost.md  
</span><span id="__span-107-8"><a id="__codelineno-107-8" name="__codelineno-107-8" href="#__codelineno-107-8"></a>│   │   ├── secondpost.md  
</span><span id="__span-107-9"><a id="__codelineno-107-9" name="__codelineno-107-9" href="#__codelineno-107-9"></a>│   │   ├── thirdpost.md  
</span><span id="__span-107-10"><a id="__codelineno-107-10" name="__codelineno-107-10" href="#__codelineno-107-10"></a>│   ├── images/           # Store all your images here
</span><span id="__span-107-11"><a id="__codelineno-107-11" name="__codelineno-107-11" href="#__codelineno-107-11"></a>│   │   ├── logo.png  
</span><span id="__span-107-12"><a id="__codelineno-107-12" name="__codelineno-107-12" href="#__codelineno-107-12"></a>│   │   ├── favicon.ico
</span><span id="__span-107-13"><a id="__codelineno-107-13" name="__codelineno-107-13" href="#__codelineno-107-13"></a>├── hooks/                # Custom MkDocs hooks (like social media sharing)
</span><span id="__span-107-14"><a id="__codelineno-107-14" name="__codelineno-107-14" href="#__codelineno-107-14"></a>├── overrides/            # Custom HTML overrides for Material theme
</span><span id="__span-107-15"><a id="__codelineno-107-15" name="__codelineno-107-15" href="#__codelineno-107-15"></a>│   ├── partials/comments.html  # Comment system (if enabled)
</span><span id="__span-107-16"><a id="__codelineno-107-16" name="__codelineno-107-16" href="#__codelineno-107-16"></a>├── mkdocs.yml            # Configuration file for MkDocs
</span><span id="__span-107-17"><a id="__codelineno-107-17" name="__codelineno-107-17" href="#__codelineno-107-17"></a>├── requirements.txt      # Python dependencies
</span><span id="__span-107-18"><a id="__codelineno-107-18" name="__codelineno-107-18" href="#__codelineno-107-18"></a>├── .gitignore            # Files to exclude from Git
</span></code></pre></div>
<p>This structure keeps content organized, making it easy to scale your documentation or blog.</p>
<h3 id="deploying-updates"><a class="toclink" href="../../customizing-your-mkdocs-blog/#deploying-updates">Deploying Updates 🚀</a></h3>
<p>Whenever you make changes, redeploy your site:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a>mkdocs<span class="w"> </span>gh-deploy
</span></code></pre></div>
<p>This command builds your site and pushes it to the <code>gh-pages</code> branch of your repository.</p>
<h3 id="troubleshooting-tips"><a class="toclink" href="../../customizing-your-mkdocs-blog/#troubleshooting-tips">Troubleshooting Tips 🔧</a></h3>
<h4 id="social-media-buttons-not-showing"><a class="toclink" href="../../customizing-your-mkdocs-blog/#social-media-buttons-not-showing"><strong>Social Media Buttons Not Showing</strong></a></h4>
<ul>
<li>Ensure your <code>mkdocs.yml</code> has the <code>site_url</code> property set correctly</li>
<li>Verify the hook is correctly installed in the <code>hooks/</code> directory</li>
</ul>
<h4 id="favicon-not-displaying"><a class="toclink" href="../../customizing-your-mkdocs-blog/#favicon-not-displaying"><strong>Favicon Not Displaying</strong></a></h4>
<ul>
<li>Clear your browser cache</li>
<li>Ensure the path in <code>mkdocs.yml</code> is correct relative to the <code>docs/</code> directory</li>
</ul>
<h4 id="comments-not-loading"><a class="toclink" href="../../customizing-your-mkdocs-blog/#comments-not-loading"><strong>Comments Not Loading</strong></a></h4>
<ul>
<li>Check your browser console for JavaScript errors</li>
<li>Verify your Disqus shortname is correct</li>
<li>Ensure <code>extra.comments</code> is set to <code>true</code> in <code>mkdocs.yml</code></li>
</ul>
<h4 id="deployment-issues"><a class="toclink" href="../../customizing-your-mkdocs-blog/#deployment-issues"><strong>Deployment Issues</strong></a></h4>
<p>If <code>mkdocs gh-deploy</code> fails:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="c1"># Ensure you have the latest version of MkDocs</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>mkdocs<span class="w"> </span>mkdocs-material
</span><span id="__span-109-3"><a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a>
</span><span id="__span-109-4"><a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a><span class="c1"># Check your git configuration</span>
</span><span id="__span-109-5"><a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>user.name<span class="w"> </span><span class="s2">&quot;Your Name&quot;</span>
</span><span id="__span-109-6"><a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>user.email<span class="w"> </span><span class="s2">&quot;your.email@example.com&quot;</span>
</span></code></pre></div>
<h3 id="conclusion"><a class="toclink" href="../../customizing-your-mkdocs-blog/#conclusion">Conclusion 🎉</a></h3>
<p>With these customizations, your MkDocs blog will be more interactive and visually engaging. The additions of social sharing, comments, better visualization with icons, and proper author attribution will make your blog more professional and user-friendly.</p>
<p>In our next post, we'll cover advanced MkDocs features including content reuse, advanced search configuration, and integration with other tools in your workflow.</p>
<p>Stay tuned for more tips!</p>
<hr />
<p>📌 <em>Published on:</em> <code>2025-03-09</code><br />
⏳ <em>Read time:</em> 8 min</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Customizing%20Your%20MkDocs%20Blog%0A&amp;url=https://blog.pollockweb.com/blog/customizing-your-mkdocs-blog/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/customizing-your-mkdocs-blog/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  <a class="md-pagination__link" href="../../">1</a> <span class="md-pagination__current">2</span> <a class="md-pagination__link" href="../3/">3</a>
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        
  <div class="custom-footer">
    <div class="custom-footer-left">
      <p>Copyright &copy; 2025 Matthew Pollock</p>
    </div>
    <div class="custom-footer-right">
      <a href="https://github.com/cloudlabmp" target="_blank" title="GitHub">
        <i class="fab fa-github"></i>
      </a>
      <a href="https://linkedin.com/in/matthew-pollock-76831920/" target="_blank" title="LinkedIn">
        <i class="fab fa-linkedin"></i>
      </a>
      <a href="https://profile.pollockweb.com" target="_blank" title="profile.pollockweb.com">
        <i class="fas fa-globe"></i>
      </a>
    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.indexes", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "content.code.select", "content.code.copy", "announce.dismiss"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>