<head>
    <!-- Other head elements -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
   <link href="../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../../../assets/javascripts/glightbox.min.js"></script></head>

  
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A blog about tech stuff">
      
      
        <meta name="author" content="matt.pollock@outlook.com">
      
      
        <link rel="canonical" href="https://blog.pollockweb.com/blog/archive/2025/page/2/">
      
      
        <link rel="prev" href="../../../../category/windows/">
      
      
        <link rel="next" href="../../../../../learn/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../../../assets/icons/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>2025 - cloudlabmp</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-800NGKWBYL"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-800NGKWBYL",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-800NGKWBYL",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="2025 - cloudlabmp" >
      
        <meta  property="og:description"  content="A blog about tech stuff" >
      
        <meta  property="og:image"  content="https://blog.pollockweb.com/assets/images/social/blog/archive/2025/page/2.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://blog.pollockweb.com/blog/archive/2025/page/2/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="2025 - cloudlabmp" >
      
        <meta  name="twitter:description"  content="A blog about tech stuff" >
      
        <meta  name="twitter:image"  content="https://blog.pollockweb.com/assets/images/social/blog/archive/2025/page/2.png" >
      
    
    
   <link href="../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-orange" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2025" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
              </button>
            
            
    <div class="announcement-content">
      <p>Welcome to my blog! Connect with me:</p>
      <a href="https://www.linkedin.com/in/matthew-pollock-76831920/" target="_blank" title="LinkedIn">
        <i class="fab fa-linkedin fa-2x"></i>
      </a>
      <a href="https://profile.pollockweb.com" target="_blank" title="profile.pollockweb.com">
        <i class="fas fa-globe fa-2x"></i>
      </a>
      <a href="https://github.com/cloudlabmp" target="_blank" title="GitHub">
        <i class="fab fa-github fa-2x"></i>
      </a>
      <a href="https://blog.pollockweb.com/feed_rss_created.xml" target="_blank" title="RSS Feed">
        <i class="fa-solid fa-rss fa-2x"></i>
      </a>
    </div>
  
          </div>
          
            <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://blog.pollockweb.com/blog/" title="cloudlabmp" class="md-header__button md-logo" aria-label="cloudlabmp" data-md-component="logo">
      
  <img src="../../../../../assets/icons/logo-48x48.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            cloudlabmp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2025
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-orange" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/cloudlabmp/project-blog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    cloudlabmp/project-blog
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../../" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../learn/" class="md-tabs__link">
        
  
    
  
  Learn

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../about/" class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../work/" class="md-tabs__link">
        
  
    
  
  Work

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://blog.pollockweb.com/blog/" title="cloudlabmp" class="md-nav__button md-logo" aria-label="cloudlabmp" data-md-component="logo">
      
  <img src="../../../../../assets/icons/logo-48x48.png" alt="logo">

    </a>
    cloudlabmp
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cloudlabmp/project-blog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    cloudlabmp/project-blog
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tags
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Posts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Posts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
      
    
  
  
    <li class="md-nav__item">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    2025
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="../../" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    2025
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads" class="md-nav__link">
    <span class="md-ellipsis">
      🕵️ Replacing SAS Tokens with User Assigned Managed Identity (UAMI) in AzCopy for Blob Uploads
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance" class="md-nav__link">
    <span class="md-ellipsis">
      Replacing SQL Credentials with User Assigned Managed Identity (UAMI) in Azure SQL Managed Instance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-resume-challenge-with-terraform-final-reflections-future-directions" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Resume Challenge with Terraform: Final Reflections &amp; Future Directions 🎯
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Resume Challenge with Terraform: Automating Deployments with GitHub Actions ⚡
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-resume-challenge-with-terraform-building-the-backend-api" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Resume Challenge with Terraform: Building the Backend API 🚀
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-resume-challenge-with-terraform-deploying-the-static-website" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Resume Challenge with Terraform: Deploying the Static Website 🚀
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-resume-challenge-with-terraform-introduction-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Resume Challenge with Terraform: Introduction &amp; Setup 🚀
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-an-iis-based-web-farm-with-azure-application-insights" class="md-nav__link">
    <span class="md-ellipsis">
      📊 Monitoring an IIS-Based Web Farm with Azure Application Insights
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uninstalling-papercut-mf-client-via-intune-a-step-by-step-guide" class="md-nav__link">
    <span class="md-ellipsis">
      📢 Uninstalling PaperCut MF Client via Intune – A Step-by-Step Guide 🚀
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn" class="md-nav__link">
    <span class="md-ellipsis">
      How I Used ChatGPT to Create AZ-400 Exam Prep Notes from MSLearn
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/ai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/ai--study-techniques/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AI &amp; Study Techniques
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/ai-integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AI Integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/aws/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/application-insights/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application Insights
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/automation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/azure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/azure-openai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure OpenAI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/bcdr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BCDR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/blogging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blogging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/cicd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI/CD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/career-development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Career Development
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/claude-code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Claude Code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/cloud-architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/cloud-engineering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud Engineering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/cloud-resume-challenge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud Resume Challenge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Containers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/customization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/devops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DevOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/finops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FinOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/gitops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/group-policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Group Policy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/iis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IIS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/iac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IaC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/identity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Identity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/infrastructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infrastructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/intune/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intune
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/learning-projects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learning Projects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/life-update/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Life Update
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/microsoft-certifications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microsoft Certifications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/mkdocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MkDocs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/patch-management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Patch Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/powershell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PowerShell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/projects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Projects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/rag/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RAG
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/regional-settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Regional Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/sql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/scripting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scripting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/self-hosting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Self-Hosting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/serverless/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serverless
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/tech/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tech
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/terraform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terraform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/time-settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/vector-databases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vector Databases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/vibe-coding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vibe Coding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/web-hosting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web Hosting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/windows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../learn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learn
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../work/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Work
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads" class="md-nav__link">
    <span class="md-ellipsis">
      🕵️ Replacing SAS Tokens with User Assigned Managed Identity (UAMI) in AzCopy for Blob Uploads
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance" class="md-nav__link">
    <span class="md-ellipsis">
      Replacing SQL Credentials with User Assigned Managed Identity (UAMI) in Azure SQL Managed Instance
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-resume-challenge-with-terraform-final-reflections-future-directions" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Resume Challenge with Terraform: Final Reflections &amp; Future Directions 🎯
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Resume Challenge with Terraform: Automating Deployments with GitHub Actions ⚡
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-resume-challenge-with-terraform-building-the-backend-api" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Resume Challenge with Terraform: Building the Backend API 🚀
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-resume-challenge-with-terraform-deploying-the-static-website" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Resume Challenge with Terraform: Deploying the Static Website 🚀
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-resume-challenge-with-terraform-introduction-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Resume Challenge with Terraform: Introduction &amp; Setup 🚀
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-an-iis-based-web-farm-with-azure-application-insights" class="md-nav__link">
    <span class="md-ellipsis">
      📊 Monitoring an IIS-Based Web Farm with Azure Application Insights
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uninstalling-papercut-mf-client-via-intune-a-step-by-step-guide" class="md-nav__link">
    <span class="md-ellipsis">
      📢 Uninstalling PaperCut MF Client via Intune – A Step-by-Step Guide 🚀
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn" class="md-nav__link">
    <span class="md-ellipsis">
      How I Used ChatGPT to Create AZ-400 Exam Prep Notes from MSLearn
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="2025">2025</h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-28 00:00:00+00:00">March 28, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/azure/" class="md-meta__link">Azure</a>, 
              <a href="../../../../category/storage/" class="md-meta__link">Storage</a>, 
              <a href="../../../../category/identity/" class="md-meta__link">Identity</a>, 
              <a href="../../../../category/automation/" class="md-meta__link">Automation</a></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/">🕵️ Replacing SAS Tokens with User Assigned Managed Identity (UAMI) in AzCopy for Blob Uploads</a></h2>
<p>Using Shared Access Signature (SAS) tokens with <code>azcopy</code> is common — but rotating tokens and handling them securely can be a hassle. To improve security and simplify our automation, I recently replaced SAS-based authentication in our scheduled AzCopy jobs with <strong>Azure User Assigned Managed Identity (UAMI)</strong>.</p>
<p>In this post, I’ll walk through how to:</p>
<ul>
<li>Replace AzCopy SAS tokens with managed identity authentication</li>
<li>Assign the right roles to the UAMI</li>
<li>Use <code>azcopy login</code> to authenticate non-interactively</li>
<li>Automate the whole process in PowerShell</li>
</ul>
<hr />
<h3 id="why-remove-sas-tokens"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#why-remove-sas-tokens">🔍 Why Remove SAS Tokens?</a></h3>
<p>SAS tokens are useful, but:</p>
<ul>
<li>🔑 They’re still secrets — and secrets can be leaked</li>
<li>📅 They expire — which breaks automation when not rotated</li>
<li>🔐 They grant broad access — unless scoped very carefully</li>
</ul>
<p>Managed Identity is a much better approach when the copy job is running from within Azure (like an Azure VM or Automation account).</p>
<hr />
<h3 id="project-goal"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#project-goal">🌟 Project Goal</a></h3>
<blockquote>
<p>Replace the use of SAS tokens in an AzCopy job that uploads files from a local UNC share to Azure Blob Storage — by using a <strong>User Assigned Managed Identity</strong>.</p>
</blockquote>
<hr />
<h3 id="prerequisites"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#prerequisites">✅ Prerequisites</a></h3>
<p>To follow along, you’ll need:</p>
<ul>
<li>A <strong>User Assigned Managed Identity</strong> (UAMI)</li>
<li>A <strong>Windows Server or Azure VM</strong> to run the copy job</li>
<li>Access to a <strong>local source folder or UNC share</strong> (e.g., <code>\\fileserver\\data\\export\\</code>)</li>
<li><strong>AzCopy v10.7+</strong> installed on the machine</li>
<li>Azure RBAC permissions to assign roles</li>
</ul>
<blockquote>
<p>ℹ️ <strong>Check AzCopy Version:</strong>
Run <code>azcopy --version</code> to ensure you're using <strong>v10.7.0 or later</strong>, which is required for <code>--identity-client-id</code> support.</p>
</blockquote>
<hr />
<h3 id="step-by-step-setup"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#step-by-step-setup">🔧 Step-by-Step Setup</a></h3>
<h4 id="step-1-create-the-uami"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#step-1-create-the-uami">🛠️ Step 1: Create the UAMI</a></h4>
<h5 id="cli"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#cli">✅ CLI</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>az<span class="w"> </span>identity<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">  </span>--name<span class="w"> </span>my-azcopy-uami<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">  </span>--resource-group<span class="w"> </span>my-resource-group<span class="w"> </span><span class="se">\</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">  </span>--location<span class="w"> </span>&lt;region&gt;
</span></code></pre></div>
<h5 id="portal"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#portal">✅ Portal</a></h5>
<ol>
<li>Go to <strong>Managed Identities</strong> in the Azure Portal</li>
<li>Click <strong>+ Create</strong> and follow the wizard</li>
</ol>
<hr />
<h4 id="step-2-assign-the-uami-to-the-azure-vm"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#step-2-assign-the-uami-to-the-azure-vm">🖇️ Step 2: Assign the UAMI to the Azure VM</a></h4>
<p>AzCopy running on a VM must be able to assume the identity. Assign the UAMI to your VM:</p>
<h5 id="cli_1"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#cli_1">✅ CLI</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>az<span class="w"> </span>vm<span class="w"> </span>identity<span class="w"> </span>assign<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">  </span>--name<span class="w"> </span>my-vm-name<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">  </span>--resource-group<span class="w"> </span>my-resource-group<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">  </span>--identities<span class="w"> </span>my-azcopy-uami
</span></code></pre></div>
<h5 id="portal_1"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#portal_1">✅ Portal</a></h5>
<ol>
<li>Navigate to the <strong>Virtual Machines</strong> blade</li>
<li>Select the VM running your AzCopy script</li>
<li>Under <strong>Settings</strong>, click <strong>Identity</strong></li>
<li>Go to the <strong>User assigned</strong> tab</li>
<li>Click <strong>+ Add</strong>, select your UAMI, then click <strong>Add</strong></li>
</ol>
<hr />
<h4 id="step-3-assign-rbac-permissions-to-uami"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#step-3-assign-rbac-permissions-to-uami">🔐 Step 3: Assign RBAC Permissions to UAMI</a></h4>
<p>For AzCopy to function correctly with a UAMI, the following role assignments are recommended:</p>
<ul>
<li><strong>Storage Blob Data Contributor</strong>: Required for read/write blob operations</li>
<li><strong>Storage Blob Data Reader</strong>: (Optional) For read-only scenarios or validation scripts</li>
<li><strong>Reader</strong>: (Optional) For browsing or metadata-only permissions on the storage account</li>
</ul>
<blockquote>
<p>⏳ <strong>RBAC Tip</strong>: It may take up to 5 minutes for role assignments to propagate fully. If access fails initially, wait and retry.</p>
</blockquote>
<h5 id="cli_2"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#cli_2">✅ CLI</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>az<span class="w"> </span>role<span class="w"> </span>assignment<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">  </span>--assignee<span class="w"> </span>&lt;client-id-or-object-id&gt;<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">  </span>--role<span class="w"> </span><span class="s2">&quot;Storage Blob Data Contributor&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">  </span>--scope<span class="w"> </span><span class="s2">&quot;/subscriptions/&lt;sub-id&gt;/resourceGroups/&lt;rg&gt;/providers/Microsoft.Storage/storageAccounts/&lt;storage-account&gt;/blobServices/default/containers/&lt;container-name&gt;&quot;</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>az<span class="w"> </span>role<span class="w"> </span>assignment<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">  </span>--assignee<span class="w"> </span>&lt;client-id-or-object-id&gt;<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="w">  </span>--role<span class="w"> </span><span class="s2">&quot;Storage Blob Data Reader&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="w">  </span>--scope<span class="w"> </span><span class="s2">&quot;/subscriptions/&lt;sub-id&gt;/resourceGroups/&lt;rg&gt;/providers/Microsoft.Storage/storageAccounts/&lt;storage-account&gt;&quot;</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>az<span class="w"> </span>role<span class="w"> </span>assignment<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="w">  </span>--assignee<span class="w"> </span>&lt;client-id-or-object-id&gt;<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="w">  </span>--role<span class="w"> </span><span class="s2">&quot;Reader&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="w">  </span>--scope<span class="w"> </span><span class="s2">&quot;/subscriptions/&lt;sub-id&gt;/resourceGroups/&lt;rg&gt;/providers/Microsoft.Storage/storageAccounts/&lt;storage-account&gt;&quot;</span>
</span></code></pre></div>
<h5 id="portal_2"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#portal_2">✅ Portal</a></h5>
<ol>
<li>Go to your <strong>Storage Account</strong> in the Azure Portal</li>
<li>Click on the relevant <strong>container</strong> (or stay at the account level for broader scope)</li>
<li>Open <strong>Access Control (IAM)</strong></li>
<li>Click <strong>+ Add role assignment</strong></li>
<li>Repeat this for each role:</li>
<li>Select <strong>Storage Blob Data Contributor</strong>, assign to your UAMI, and click <strong>Save</strong></li>
<li>Select <strong>Storage Blob Data Reader</strong>, assign to your UAMI, and click <strong>Save</strong></li>
<li>Select <strong>Reader</strong>, assign to your UAMI, and click <strong>Save</strong></li>
</ol>
<hr />
<h4 id="step-4-test-azcopy-login-using-uami"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#step-4-test-azcopy-login-using-uami">🧪 Step 4: Test AzCopy Login Using UAMI</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nv">$clientId</span> <span class="p">=</span> <span class="s2">&quot;&lt;your-uami-client-id&gt;&quot;</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="p">&amp;</span> <span class="s2">&quot;C:\azcopy\azcopy.exe&quot;</span> <span class="n">login</span> <span class="p">-</span><span class="n">-identity</span> <span class="p">-</span><span class="n">-identity-client-id</span> <span class="nv">$clientId</span>
</span></code></pre></div>
<p>You should see a confirmation message that AzCopy has successfully logged in.</p>
<blockquote>
<p>🔍 To verify AzCopy is authenticated with the correct identity, you can run:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>azcopy env
</span></code></pre></div>
<p>This will show the login type and confirm whether the token is being sourced from the Managed Identity.</p>
</blockquote>
<hr />
<h4 id="step-5-upload-files-using-azcopy-uami"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#step-5-upload-files-using-azcopy-uami">📁 Step 5: Upload Files Using AzCopy + UAMI</a></h4>
<p>Here's the PowerShell script that copies all files from a local share to the Blob container:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="nv">$clientId</span> <span class="p">=</span> <span class="s2">&quot;&lt;your-uami-client-id&gt;&quot;</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="c"># Login with Managed Identity</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="p">&amp;</span> <span class="s2">&quot;C:\azcopy\azcopy.exe&quot;</span> <span class="n">login</span> <span class="p">-</span><span class="n">-identity</span> <span class="p">-</span><span class="n">-identity-client-id</span> <span class="nv">$clientId</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="c"># Run the copy job</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="p">&amp;</span> <span class="s2">&quot;C:\azcopy\azcopy.exe&quot;</span> <span class="nb">copy </span><span class="p">\</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>  <span class="s2">&quot;\\\\fileserver\\data\\export\\&quot;</span> <span class="p">\</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>  <span class="s2">&quot;https://&lt;your-storage-account&gt;.blob.core.windows.net/&lt;container-name&gt;&quot;</span> <span class="p">\</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>  <span class="p">-</span><span class="n">-overwrite</span><span class="p">=</span><span class="n">true</span> <span class="p">\</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>  <span class="p">-</span><span class="n">-from-to</span><span class="p">=</span><span class="n">LocalBlob</span> <span class="p">\</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>  <span class="p">-</span><span class="n">-blob-type</span><span class="p">=</span><span class="n">Detect</span> <span class="p">\</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>  <span class="p">-</span><span class="n">-put-md5</span> <span class="p">\</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>  <span class="p">-</span><span class="n">-recursive</span> <span class="p">\</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>  <span class="p">-</span><span class="n">-log-level</span><span class="p">=</span><span class="n">INFO</span>
</span></code></pre></div>
<blockquote>
<p>💡 <strong>UNC Note</strong>: Double backslashes are used in PowerShell to represent UNC paths properly.</p>
</blockquote>
<p>This script can be scheduled using Task Scheduler or run on demand.</p>
<hr />
<h4 id="automate-with-task-scheduler-optional"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#automate-with-task-scheduler-optional">⏱️ Automate with Task Scheduler (Optional)</a></h4>
<p>To automate the job:</p>
<ol>
<li>Open <strong>Task Scheduler</strong> on your VM</li>
<li>Create a <strong>New Task</strong> (not a Basic Task)</li>
<li>Under <strong>General</strong>, select "Run whether user is logged on or not"</li>
<li>Under <strong>Actions</strong>, add a new action to run <code>powershell.exe</code></li>
<li>Set the arguments to point to your <code>.ps1</code> script</li>
<li>Ensure the AzCopy path is hardcoded in your script</li>
</ol>
<hr />
<h4 id="troubleshooting-common-errors"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#troubleshooting-common-errors">🚑 Troubleshooting Common Errors</a></h4>
<h5 id="403-authorizationpermissionmismatch"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#403-authorizationpermissionmismatch">❌ 403 AuthorizationPermissionMismatch</a></h5>
<ul>
<li>Usually means the identity doesn’t have the correct role or the role hasn’t propagated yet</li>
<li>Double-check:</li>
<li>UAMI is assigned to the VM</li>
<li>UAMI has <code>Storage Blob Data Contributor</code> on the correct container</li>
<li>Wait 2–5 minutes and try again</li>
</ul>
<h5 id="azcopy-the-term-azcopy-is-not-recognized"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#azcopy-the-term-azcopy-is-not-recognized">❌ azcopy : The term 'azcopy' is not recognized</a></h5>
<ul>
<li>AzCopy is not in the system PATH</li>
<li>Solution: Use the full path to <code>azcopy.exe</code>, like <code>C:\azcopy\azcopy.exe</code></li>
</ul>
<hr />
<h3 id="benefits-of-switching-to-uami"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#benefits-of-switching-to-uami">🛡️ Benefits of Switching to UAMI</a></h3>
<ul>
<li>✅ No secrets or keys stored on disk</li>
<li>✅ No manual token expiry issues</li>
<li>✅ Access controlled via Azure RBAC</li>
<li>✅ Easily scoped and auditable</li>
</ul>
<hr />
<h3 id="final-thoughts"><a class="toclink" href="../../../../replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/#final-thoughts">🧼 Final Thoughts</a></h3>
<p>Replacing AzCopy SAS tokens with UAMI is one of those small wins that pays dividends over time. Once set up, it's secure, robust, and hands-off.</p>
<p>Let me know if you'd like a variant of this that works from Azure Automation or a hybrid worker!</p>
<hr />
<p><a class="md-button" href="https://x.com/intent/tweet?text=Replacing%20SAS%20Tokens%20with%20User%20Assigned%20Managed%20Identity%20%28UAMI%29%20in%20AzCopy%20for%20Blob%20Uploads%0A&amp;url=https://blog.pollockweb.com/blog/replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/replacing-sas-tokens-with-user-assigned-managed-identity-uami-in-azcopy-for-blob-uploads/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-27 00:00:00+00:00">March 27, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/azure/" class="md-meta__link">Azure</a>, 
              <a href="../../../../category/sql/" class="md-meta__link">SQL</a>, 
              <a href="../../../../category/security/" class="md-meta__link">Security</a></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/">Replacing SQL Credentials with User Assigned Managed Identity (UAMI) in Azure SQL Managed Instance</a></h2>
<p>Storing SQL usernames and passwords in application configuration files is still common practice — but it poses a significant security risk. As part of improving our cloud security posture, I recently completed a project to eliminate plain text credentials from our app connection strings by switching to <strong>Azure User Assigned Managed Identity (UAMI)</strong> authentication for our <strong>SQL Managed Instance</strong>.</p>
<p>In this post, I’ll walk through how to:</p>
<ul>
<li>Securely connect to Azure SQL Managed Instance without using usernames or passwords</li>
<li>Use a <strong>User Assigned Managed Identity (UAMI)</strong> for authentication</li>
<li>Test this connection using the new Go-based <code>sqlcmd</code> CLI</li>
<li>Update real application code to remove SQL credentials</li>
</ul>
<hr />
<h3 id="why-replace-sql-credentials"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#why-replace-sql-credentials">🔐 Why Replace SQL Credentials?</a></h3>
<p>Hardcoded SQL credentials come with several downsides:</p>
<ul>
<li><strong>Security risk</strong>: Stored secrets can be compromised if not properly secured</li>
<li><strong>Maintenance overhead</strong>: Rotating passwords across environments is cumbersome</li>
<li><strong>Audit concerns</strong>: Plain text credentials often trigger compliance red flags</li>
</ul>
<p>Azure Managed Identity solves this by providing a token-based, identity-first way to connect to services — no secrets required.</p>
<hr />
<h3 id="what-is-a-user-assigned-managed-identity"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#what-is-a-user-assigned-managed-identity">⚙️ What is a User Assigned Managed Identity?</a></h3>
<p>There are two types of Managed Identities in Azure:</p>
<ul>
<li><strong>System-assigned</strong>: Tied to the lifecycle of a specific resource (like a VM or App Service)</li>
<li><strong>User-assigned</strong>: Standalone identity that can be attached to one or more resources</li>
</ul>
<p>For this project, we used a <strong>User Assigned Managed Identity (UAMI)</strong> to allow our applications to authenticate against SQL without managing secrets.</p>
<hr />
<h3 id="project-objective"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#project-objective">🌟 Project Objective</a></h3>
<blockquote>
<p>Replace plain text SQL credentials in application connection strings with <strong>User Assigned Managed Identity (UAMI)</strong> for secure, best-practice authentication to Azure SQL Managed Instances.</p>
</blockquote>
<hr />
<h3 id="prerequisites"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#prerequisites">✅ Prerequisites</a></h3>
<p>To follow this guide, you’ll need:</p>
<ul>
<li>An <strong>Azure SQL Managed Instance</strong> with Microsoft Entra (AAD) authentication enabled</li>
<li>A <strong>User Assigned Managed Identity</strong> (UAMI)</li>
<li>An <strong>Azure VM or App Service</strong> to host your app (or test client)</li>
<li>The <strong>Go-based <code>sqlcmd</code> CLI</strong> installed<br />
  → <a href="https://learn.microsoft.com/sql/tools/sqlcmd-utility?view=sql-server-ver16">Install guide</a></li>
</ul>
<hr />
<h3 id="setting-up-the-user-assigned-managed-identity-uami"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#setting-up-the-user-assigned-managed-identity-uami">🔧 Setting Up the User Assigned Managed Identity (UAMI)</a></h3>
<p>Before connecting to Azure SQL using UAMI, ensure the following steps are completed:</p>
<ul>
<li>Create the UAMI</li>
<li>Assign the UAMI to the Virtual Machine(s)</li>
<li>Configure Microsoft Entra authentication on the SQL Managed Instance</li>
<li>Grant SQL access to the UAMI</li>
</ul>
<p>These steps can be completed via <strong>Azure CLI</strong>, <strong>PowerShell</strong>, or the <strong>Azure Portal</strong>.</p>
<hr />
<h4 id="step-1-create-the-user-assigned-managed-identity-uami"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#step-1-create-the-user-assigned-managed-identity-uami">🛠️ Step 1: Create the User Assigned Managed Identity (UAMI)</a></h4>
<h5 id="cli"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#cli">✅ CLI</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>az<span class="w"> </span>identity<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">  </span>--name<span class="w"> </span>my-sql-uami<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">  </span>--resource-group<span class="w"> </span>my-rg<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">  </span>--location<span class="w"> </span>&lt;region&gt;
</span></code></pre></div>
<p>Save the <strong>Client ID</strong> and <strong>Object ID</strong> — you’ll need them later.</p>
<h5 id="portal"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#portal">✅ Portal</a></h5>
<ol>
<li>Go to <strong>Azure Portal</strong> → Search <strong>Managed Identities</strong></li>
<li>Click <strong>+ Create</strong></li>
<li>Choose Subscription, Resource Group, and Region</li>
<li>Name the identity (e.g., <code>my-sql-uami</code>)</li>
<li>Click <strong>Review + Create</strong></li>
</ol>
<hr />
<h4 id="step-2-assign-the-uami-to-a-virtual-machine"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#step-2-assign-the-uami-to-a-virtual-machine">🖇️ Step 2: Assign the UAMI to a Virtual Machine</a></h4>
<p>Attach the UAMI to:</p>
<ul>
<li>The VM(s) running your application code</li>
<li>The VM used to test the connection</li>
</ul>
<h5 id="cli_1"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#cli_1">✅ CLI</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>az<span class="w"> </span>vm<span class="w"> </span>identity<span class="w"> </span>assign<span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">  </span>--name<span class="w"> </span>my-vm-name<span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">  </span>--resource-group<span class="w"> </span>my-rg<span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">  </span>--identities<span class="w"> </span>my-sql-uami
</span></code></pre></div>
<h5 id="portal_1"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#portal_1">✅ Portal</a></h5>
<ol>
<li>Go to <strong>Virtual Machines</strong> → Select your VM</li>
<li>Click <strong>Identity</strong> under <strong>Settings</strong></li>
<li>Go to the <strong>User assigned</strong> tab</li>
<li>Click <strong>+ Add</strong> → Select the UAMI</li>
<li>Click <strong>Add</strong></li>
</ol>
<hr />
<h4 id="step-3-configure-sql-managed-instance-for-microsoft-entra-authentication"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#step-3-configure-sql-managed-instance-for-microsoft-entra-authentication">🔑 Step 3: Configure SQL Managed Instance for Microsoft Entra Authentication</a></h4>
<ol>
<li><strong>Set an Entra Admin</strong>:</li>
<li>Go to your SQL MI → <strong>Azure AD admin</strong> blade</li>
<li>Click <strong>Set admin</strong> and choose a user or group</li>
<li>
<p>Save changes</p>
</li>
<li>
<p><strong>Ensure Directory Reader permissions</strong>:</p>
</li>
<li>Your SQL MI’s managed identity needs <strong>Directory Reader</strong> access</li>
<li>You can assign this role via Entra ID &gt; Roles and administrators &gt; Directory Readers</li>
</ol>
<p>More details: <a href="https://learn.microsoft.com/azure/azure-sql/database/authentication-aad-configure">Configure Entra authentication</a></p>
<hr />
<h4 id="step-4-optional-assign-azure-role-to-the-uami"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#step-4-optional-assign-azure-role-to-the-uami">📜 Step 4: (Optional) Assign Azure Role to the UAMI</a></h4>
<blockquote>
<p>This may be needed if the identity needs to access Azure resource metadata or use Azure CLI from the VM.</p>
</blockquote>
<h5 id="cli_2"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#cli_2">✅ CLI</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>az<span class="w"> </span>role<span class="w"> </span>assignment<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">  </span>--assignee-object-id<span class="w"> </span>&lt;uami-object-id&gt;<span class="w"> </span><span class="se">\</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">  </span>--role<span class="w"> </span><span class="s2">&quot;Reader&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">  </span>--scope<span class="w"> </span>/subscriptions/&lt;sub-id&gt;/resourceGroups/&lt;rg-name&gt;
</span></code></pre></div>
<h5 id="portal_2"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#portal_2">✅ Portal</a></h5>
<ol>
<li>Go to the UAMI → <strong>Azure role assignments</strong></li>
<li>Click <strong>+ Add role assignment</strong></li>
<li>Choose role (e.g., Reader)</li>
<li>Set scope</li>
<li>Click <strong>Save</strong></li>
</ol>
<hr />
<h3 id="step-5-grant-sql-access-to-the-uami"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#step-5-grant-sql-access-to-the-uami">🔑 Step 5: Grant SQL Access to the UAMI</a></h3>
<p>Once the UAMI is assigned to the VM and Entra auth is enabled on SQL MI, log in with an admin and run:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">client</span><span class="o">-</span><span class="n">id</span><span class="o">&gt;</span><span class="p">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">EXTERNAL</span><span class="w"> </span><span class="n">PROVIDER</span><span class="p">;</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="k">ALTER</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">db_datareader</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">MEMBER</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">client</span><span class="o">-</span><span class="n">id</span><span class="o">&gt;</span><span class="p">];</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="k">ALTER</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">db_datawriter</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">MEMBER</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">client</span><span class="o">-</span><span class="n">id</span><span class="o">&gt;</span><span class="p">];</span>
</span></code></pre></div>
<p>Or use a friendly name:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="p">[</span><span class="n">my</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="k">identity</span><span class="p">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">EXTERNAL</span><span class="w"> </span><span class="n">PROVIDER</span><span class="p">;</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="k">ALTER</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">db_datareader</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">MEMBER</span><span class="w"> </span><span class="p">[</span><span class="n">my</span><span class="o">-</span><span class="n">app</span><span class="o">-</span><span class="k">identity</span><span class="p">];</span>
</span></code></pre></div>
<hr />
<h3 id="step-6-test-the-connection-using-sqlcmd"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#step-6-test-the-connection-using-sqlcmd">🧪 Step 6: Test the Connection Using <code>sqlcmd</code></a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>sqlcmd<span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="w">  </span>-S<span class="w"> </span>&lt;your-sql-mi&gt;.database.windows.net<span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="w">  </span>-d<span class="w"> </span>&lt;database-name&gt;<span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="w">  </span>--authentication-method<span class="w"> </span>ActiveDirectoryManagedIdentity<span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="w">  </span>-U<span class="w"> </span>&lt;client-id-of-uami&gt;
</span></code></pre></div>
<p>If successful, you’ll see the <code>1&gt;</code> prompt where you can execute SQL queries.</p>
<hr />
<h3 id="step-7-update-application-code"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#step-7-update-application-code">📊 Step 7: Update Application Code</a></h3>
<p>Update your app to use the UAMI for authentication.</p>
<p>Example connection string for UAMI in C#:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">connectionString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;Server=tcp:&lt;your-sql-mi&gt;.database.windows.net;&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w">                          </span><span class="s">&quot;Authentication=Active Directory Managed Identity;&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">                          </span><span class="s">&quot;Encrypt=True;&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">                          </span><span class="s">&quot;User Id=&lt;your-uami-client-id&gt;;&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">                          </span><span class="s">&quot;Database=&lt;your-db-name&gt;;&quot;</span><span class="p">;</span>
</span></code></pre></div>
<blockquote>
<p>Make sure your code uses <code>Microsoft.Data.SqlClient</code> with AAD token support.</p>
</blockquote>
<p>Or retrieve and assign the token programmatically:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">credential</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultAzureCredential</span><span class="p">();</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">credential</span><span class="p">.</span><span class="n">GetTokenAsync</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">TokenRequestContext</span><span class="p">(</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">    </span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;https://database.windows.net/&quot;</span><span class="w"> </span><span class="p">}));</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="kt">var</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlConnection</span><span class="p">(</span><span class="s">&quot;Server=&lt;your-sql-mi&gt;; Database=&lt;your-db-name&gt;; Encrypt=True;&quot;</span><span class="p">);</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="n">connection</span><span class="p">.</span><span class="n">AccessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">token</span><span class="p">.</span><span class="n">Token</span><span class="p">;</span>
</span></code></pre></div>
<hr />
<h3 id="security-benefits"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#security-benefits">🔒 Security Benefits</a></h3>
<ul>
<li>🔐 No credentials stored</li>
<li>🔁 No password rotation</li>
<li>🛡️ Entra-integrated access control and auditing</li>
</ul>
<hr />
<h3 id="summary"><a class="toclink" href="../../../../replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/#summary">✅ Summary</a></h3>
<p>By switching to User Assigned Managed Identity, we removed credentials from connection strings and aligned SQL access with best practices for cloud identity and security.</p>
<p>Comments and feedback welcome!</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Replacing%20SQL%20Credentials%20with%20User%20Assigned%20Managed%20Identity%20%28UAMI%29%20in%20Azure%20SQL%20Managed%20Instance%0A&amp;url=https://blog.pollockweb.com/blog/replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/replacing-sql-credentials-with-user-assigned-managed-identity-uami-in-azure-sql-managed-instance/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-21 00:00:00+00:00">March 21, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/aws/" class="md-meta__link">AWS</a>, 
              <a href="../../../../category/terraform/" class="md-meta__link">Terraform</a>, 
              <a href="../../../../category/devops/" class="md-meta__link">DevOps</a>, 
              <a href="../../../../category/career-development/" class="md-meta__link">Career Development</a>, 
              <a href="../../../../category/cloud-resume-challenge/" class="md-meta__link">Cloud Resume Challenge</a></li>
        
        
          
          <li class="md-meta__item">
            
              6 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="cloud-resume-challenge-with-terraform-final-reflections-future-directions"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/">Cloud Resume Challenge with Terraform: Final Reflections &amp; Future Directions 🎯</a></h2>
<h3 id="journey-complete-what-weve-built"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#journey-complete-what-weve-built">Journey Complete: What We've Built 🏗️</a></h3>
<p>Over the course of this blog series, we've successfully completed the Cloud Resume Challenge using Terraform as our infrastructure-as-code tool. Let's recap what we've accomplished:</p>
<ol>
<li><strong>Set up our development environment</strong> with Terraform and AWS credentials</li>
<li><strong>Deployed a static website</strong> using S3, CloudFront, Route 53, and ACM</li>
<li><strong>Built a serverless backend API</strong> with API Gateway, Lambda, and DynamoDB</li>
<li><strong>Implemented CI/CD pipelines</strong> with GitHub Actions for automated deployments</li>
<li><strong>Added security enhancements</strong> like OIDC authentication and least-privilege IAM policies</li>
</ol>
<p>The final architecture we've created looks like this:</p>
<p><img alt="Basic Project Diagram" src="../../../../crc-aws/CRCArchitecture.png" /></p>
<p>The most valuable aspect of this project is that we've built a <strong>completely automated, production-quality cloud solution</strong>. Every component is defined as code, enabling us to track changes, rollback if needed, and redeploy the entire infrastructure with minimal effort.</p>
<h3 id="key-learnings-from-the-challenge"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#key-learnings-from-the-challenge">Key Learnings from the Challenge 🧠</a></h3>
<h4 id="technical-skills-gained"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#technical-skills-gained">Technical Skills Gained 💻</a></h4>
<p>Throughout this challenge, I've gained significant technical skills:</p>
<ol>
<li><strong>Terraform expertise</strong>: I've moved from basic understanding to writing modular, reusable infrastructure code</li>
<li><strong>AWS service integration</strong>: Learned how multiple AWS services work together to create a cohesive system</li>
<li><strong>CI/CD implementation</strong>: Set up professional GitHub Actions workflows for continuous deployment</li>
<li><strong>Security best practices</strong>: Implemented OIDC, least privilege, encryption, and more</li>
<li><strong>Serverless architecture</strong>: Built and connected serverless components for a scalable, cost-effective solution</li>
</ol>
<h4 id="unexpected-challenges-solutions"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#unexpected-challenges-solutions">Unexpected Challenges &amp; Solutions 🔄</a></h4>
<p>The journey wasn't without obstacles. Here are some challenges I faced and how I overcame them:</p>
<h5 id="1-state-management-complexity"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#1-state-management-complexity">1. State Management Complexity</a></h5>
<p><strong>Challenge</strong>: As the project grew, managing Terraform state became more complex, especially when working across different environments.</p>
<p><strong>Solution</strong>: I restructured the project to use workspaces and remote state with careful output references between modules. This improved state organization and made multi-environment deployments more manageable.</p>
<h5 id="2-cloudfront-cache-invalidation"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#2-cloudfront-cache-invalidation">2. CloudFront Cache Invalidation</a></h5>
<p><strong>Challenge</strong>: Updates to the website weren't immediately visible due to CloudFront caching.</p>
<p><strong>Solution</strong>: Implemented proper cache invalidation in the CI/CD pipeline and set appropriate cache behaviors for different file types.</p>
<h5 id="3-cors-configuration"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#3-cors-configuration">3. CORS Configuration</a></h5>
<p><strong>Challenge</strong>: The frontend JavaScript couldn't connect to the API due to CORS issues.</p>
<p><strong>Solution</strong>: Added comprehensive CORS handling at both the API Gateway and Lambda levels, ensuring proper headers were returned.</p>
<h5 id="4-cicd-authentication-security"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#4-cicd-authentication-security">4. CI/CD Authentication Security</a></h5>
<p><strong>Challenge</strong>: Initially used long-lived AWS credentials in GitHub Secrets, which posed security risks.</p>
<p><strong>Solution</strong>: Replaced with OIDC for keyless authentication between GitHub Actions and AWS, eliminating credential management concerns.</p>
<h3 id="real-world-applications-of-this-project"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#real-world-applications-of-this-project">Real-World Applications of This Project 🌐</a></h3>
<p>The skills demonstrated in this challenge directly translate to real-world cloud engineering roles:</p>
<h4 id="1-infrastructure-as-code-expertise"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#1-infrastructure-as-code-expertise">1. Infrastructure as Code Expertise</a></h4>
<p>The ability to define, version, and automate infrastructure is increasingly essential in modern IT environments. This project showcases expertise with Terraform that can be applied to any cloud provider or on-premises infrastructure.</p>
<h4 id="2-devops-pipeline-creation"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#2-devops-pipeline-creation">2. DevOps Pipeline Creation</a></h4>
<p>Setting up CI/CD workflows that automate testing and deployment demonstrates key DevOps skills that organizations need to accelerate their development cycles.</p>
<h4 id="3-serverless-architecture-design"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#3-serverless-architecture-design">3. Serverless Architecture Design</a></h4>
<p>The backend API implementation shows understanding of event-driven, serverless architecture patterns that are becoming standard for new cloud applications.</p>
<h4 id="4-security-implementation"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#4-security-implementation">4. Security Implementation</a></h4>
<p>The security considerations throughout the project - from IAM roles to OIDC authentication - demonstrate the ability to build secure systems from the ground up.</p>
<h3 id="maintaining-your-cloud-resume"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#maintaining-your-cloud-resume">Maintaining Your Cloud Resume 🔧</a></h3>
<p>Now that your resume is live, here are some tips for maintaining it:</p>
<h4 id="1-regular-updates"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#1-regular-updates">1. Regular Updates</a></h4>
<p>Set a schedule to update both your resume content and the underlying infrastructure. I recommend:</p>
<ul>
<li>Monthly content refreshes to keep your experience and skills current</li>
<li>Quarterly infrastructure reviews to apply security patches and update dependencies</li>
<li>Annual architecture reviews to consider new AWS services or features</li>
</ul>
<h4 id="2-cost-management"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#2-cost-management">2. Cost Management</a></h4>
<p>While this solution is relatively inexpensive, it's good practice to set up AWS Budgets and alerts to monitor costs. My current monthly costs are approximately:</p>
<ul>
<li><strong>S3</strong>: ~$0.10 for storage</li>
<li><strong>CloudFront</strong>: ~$0.50 for data transfer</li>
<li><strong>Route 53</strong>: $0.50 for hosted zone</li>
<li><strong>Lambda</strong>: Free tier covers typical usage</li>
<li><strong>DynamoDB</strong>: Free tier covers typical usage</li>
<li><strong>API Gateway</strong>: ~$1.00 for API calls</li>
<li><strong>Total</strong>: ~$2.10/month</li>
</ul>
<h4 id="3-monitoring-and-alerting"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#3-monitoring-and-alerting">3. Monitoring and Alerting</a></h4>
<p>I've set up CloudWatch alarms for:</p>
<ul>
<li>API errors exceeding normal thresholds</li>
<li>Unusual traffic patterns that might indicate abuse</li>
<li>Lambda function failures</li>
</ul>
<p>Consider adding application performance monitoring tools like AWS X-Ray for deeper insights.</p>
<h3 id="future-enhancements"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#future-enhancements">Future Enhancements 🚀</a></h3>
<p>There are many ways to extend this project further:</p>
<h4 id="1-content-management-system-integration"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#1-content-management-system-integration">1. Content Management System Integration</a></h4>
<p>Add a headless CMS like Contentful or Sanity to make resume updates easier without needing to edit HTML directly:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;contentful_integration&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./modules/contentful&quot;</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">  </span><span class="na">api_key</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">var.contentful_api_key</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">  </span><span class="na">space_id</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">var.contentful_space_id</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">  </span><span class="na">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="p">}</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_function&quot;</span><span class="w"> </span><span class="nv">&quot;content_sync&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-content-sync-${var.environment}&quot;</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="w">  </span><span class="na">handler</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.handler&quot;</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="w">  </span><span class="na">runtime</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;nodejs14.x&quot;</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="w">  </span><span class="na">role</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.content_sync_role.arn</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="w">  </span><span class="nb">environment</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="w">    </span><span class="nb">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="w">      </span><span class="na">CONTENTFUL_API_KEY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.contentful_api_key</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a><span class="w">      </span><span class="na">CONTENTFUL_SPACE_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.contentful_space_id</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="w">      </span><span class="na">S3_BUCKET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">module.frontend.website_bucket_name</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="2-advanced-analytics"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#2-advanced-analytics">2. Advanced Analytics</a></h4>
<p>Implement sophisticated visitor analytics beyond simple counting:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_kinesis_firehose_delivery_stream&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_analytics&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-visitor-analytics-${var.environment}&quot;</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">  </span><span class="na">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;extended_s3&quot;</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">  </span><span class="nb">extended_s3_configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">    </span><span class="na">role_arn</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.firehose_role.arn</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">    </span><span class="na">bucket_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.analytics.arn</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">    </span><span class="nb">processing_configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">      </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">      </span><span class="nb">processors</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="w">        </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Lambda&quot;</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w">        </span><span class="nb">parameters</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">          </span><span class="na">parameter_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;LambdaArn&quot;</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="w">          </span><span class="na">parameter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.analytics_processor.arn</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="p">}</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_athena_workgroup&quot;</span><span class="w"> </span><span class="nv">&quot;analytics&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-analytics-${var.environment}&quot;</span>
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a>
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a><span class="w">  </span><span class="nb">configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a><span class="w">    </span><span class="nb">result_configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a><span class="w">      </span><span class="na">output_location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;s3://${aws_s3_bucket.analytics_results.bucket}/results/&quot;</span>
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-25-31"><a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-25-32"><a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="3-multi-region-deployment"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#3-multi-region-deployment">3. Multi-Region Deployment</a></h4>
<p>Enhance reliability and performance by deploying to multiple AWS regions:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;frontend_us_east_1&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./modules/frontend&quot;</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">  </span><span class="nb">providers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">    </span><span class="na">aws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws.us_east_1</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="c1">  # Configuration for US East region</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="p">}</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;frontend_eu_west_1&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./modules/frontend&quot;</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="w">  </span><span class="nb">providers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="w">    </span><span class="na">aws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws.eu_west_1</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="c1">  # Configuration for EU West region</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="p">}</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_health_check&quot;</span><span class="w"> </span><span class="nv">&quot;primary_region&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a><span class="w">  </span><span class="na">fqdn</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="nv">module.frontend_us_east_1.cloudfront_domain_name</span>
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a><span class="w">  </span><span class="na">port</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="m">443</span>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a><span class="w">  </span><span class="na">type</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;HTTPS&quot;</span>
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a><span class="w">  </span><span class="na">resource_path</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/&quot;</span>
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a><span class="w">  </span><span class="na">failure_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a><span class="w">  </span><span class="na">request_interval</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">30</span>
</span><span id="__span-26-28"><a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a><span class="p">}</span>
</span><span id="__span-26-29"><a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>
</span><span id="__span-26-30"><a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_record&quot;</span><span class="w"> </span><span class="nv">&quot;global&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-31"><a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a><span class="w">  </span><span class="na">zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_route53_zone.selected.zone_id</span>
</span><span id="__span-26-32"><a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a><span class="w">  </span><span class="na">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">var.domain_name</span>
</span><span id="__span-26-33"><a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a><span class="w">  </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;CNAME&quot;</span>
</span><span id="__span-26-34"><a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>
</span><span id="__span-26-35"><a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a><span class="w">  </span><span class="nb">failover_routing_policy</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-36"><a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a><span class="w">    </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PRIMARY&quot;</span>
</span><span id="__span-26-37"><a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-26-38"><a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a>
</span><span id="__span-26-39"><a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a><span class="w">  </span><span class="na">health_check_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_route53_health_check.primary_region.id</span>
</span><span id="__span-26-40"><a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a><span class="w">  </span><span class="na">set_identifier</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;primary&quot;</span>
</span><span id="__span-26-41"><a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a><span class="w">  </span><span class="na">records</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">module.frontend_us_east_1.cloudfront_domain_name</span><span class="p">]</span>
</span><span id="__span-26-42"><a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a><span class="w">  </span><span class="na">ttl</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="m">300</span>
</span><span id="__span-26-43"><a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="4-infrastructure-testing"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#4-infrastructure-testing">4. Infrastructure Testing</a></h4>
<p>Add comprehensive testing using Terratest:</p>
<div class="language-go highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">test</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">    </span><span class="s">&quot;testing&quot;</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">    </span><span class="s">&quot;github.com/gruntwork-io/terratest/modules/terraform&quot;</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">    </span><span class="s">&quot;github.com/stretchr/testify/assert&quot;</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="p">)</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">TestResumeFrontend</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">    </span><span class="nx">terraformOptions</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">WithDefaultRetryableErrors</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="w">        </span><span class="nx">TerraformDir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;../modules/frontend&quot;</span><span class="p">,</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="w">        </span><span class="nx">Vars</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="w">            </span><span class="s">&quot;environment&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">,</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="w">            </span><span class="s">&quot;domain_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test.example.com&quot;</span><span class="p">,</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Destroy</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">)</span>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a><span class="w">    </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">InitAndApply</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">)</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a><span class="w">    </span><span class="c1">// Verify outputs</span>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a><span class="w">    </span><span class="nx">bucketName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">terraform</span><span class="p">.</span><span class="nx">Output</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">terraformOptions</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;website_bucket_name&quot;</span><span class="p">)</span>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a><span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">bucketName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;resume-website-test&quot;</span><span class="p">)</span>
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="career-impact-personal-growth"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#career-impact-personal-growth">Career Impact &amp; Personal Growth 📈</a></h3>
<p>Completing this challenge has had a significant impact on my career development:</p>
<h4 id="technical-growth"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#technical-growth">Technical Growth</a></h4>
<p>I've moved from basic cloud knowledge to being able to architect and implement complex, multi-service solutions. The hands-on experience with Terraform has been particularly valuable, as it's a highly sought-after skill in the job market.</p>
<h4 id="portfolio-enhancement"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#portfolio-enhancement">Portfolio Enhancement</a></h4>
<p>This project now serves as both my resume and a demonstration of my cloud engineering capabilities. I've included the GitHub repository links on my resume, allowing potential employers to see the code behind the deployment.</p>
<h4 id="community-engagement"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#community-engagement">Community Engagement</a></h4>
<p>Sharing this project through blog posts has connected me with the broader cloud community. The feedback and discussions have been invaluable for refining my approach and learning from others.</p>
<h3 id="final-thoughts"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#final-thoughts">Final Thoughts 💭</a></h3>
<p>The Cloud Resume Challenge has been an invaluable learning experience. By implementing it with Terraform, I've gained practical experience with both AWS services and infrastructure as code - skills that are directly applicable to professional cloud engineering roles.</p>
<p>What makes this challenge particularly powerful is how it combines so many aspects of modern cloud development:</p>
<ul>
<li>Front-end web development</li>
<li>Back-end serverless APIs</li>
<li>Infrastructure as code</li>
<li>CI/CD automation</li>
<li>Security implementation</li>
<li>DNS configuration</li>
<li>Content delivery networks</li>
</ul>
<p>If you're following along with this series, I encourage you to customize and extend the project to showcase your unique skills and interests. The foundational architecture we've built provides a flexible platform that can evolve with your career.</p>
<p>For those just starting their cloud journey, this challenge offers a perfect blend of practical skills in a realistic project that demonstrates end-to-end capabilities. It's far more valuable than isolated tutorials or theoretical knowledge alone.</p>
<p>The cloud engineering field continues to evolve rapidly, but the principles we've applied throughout this project - automation, security, scalability, and operational excellence - remain constants regardless of which specific technologies are in favor.</p>
<h3 id="whats-next"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-final-reflections--future-directions/#whats-next">What's Next? 🔮</a></h3>
<p>While this concludes our Cloud Resume Challenge series, my cloud learning journey continues. Some areas I'm exploring next include:</p>
<ul>
<li>Kubernetes and container orchestration</li>
<li>Infrastructure testing frameworks</li>
<li>Cloud cost optimization</li>
<li>Multi-cloud deployments</li>
<li>Infrastructure security scanning</li>
<li>Service mesh implementations</li>
</ul>
<p>I hope this series has been helpful in your own cloud journey. Feel free to reach out with questions or to share your own implementations of the challenge!</p>
<hr />
<p>This post concludes our Cloud Resume Challenge with Terraform series. Thanks for following along!</p>
<p>Want to see the Cloud Resume Challenge in action? Visit <a href="https://resume.example.com">my resume website</a> and check out the <a href="https://profile.pollockweb.com">GitHub repositories</a> for the complete code.</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Cloud%20Resume%20Challenge%20with%20Terraform%3A%20Final%20Reflections%20%26%20Future%20Directions%0A&amp;url=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-final-reflections--future-directions/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-final-reflections--future-directions/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-20 00:00:00+00:00">March 20, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/aws/" class="md-meta__link">AWS</a>, 
              <a href="../../../../category/terraform/" class="md-meta__link">Terraform</a>, 
              <a href="../../../../category/devops/" class="md-meta__link">DevOps</a>, 
              <a href="../../../../category/cicd/" class="md-meta__link">CI/CD</a>, 
              <a href="../../../../category/cloud-resume-challenge/" class="md-meta__link">Cloud Resume Challenge</a></li>
        
        
          
          <li class="md-meta__item">
            
              14 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/">Cloud Resume Challenge with Terraform: Automating Deployments with GitHub Actions ⚡</a></h2>
<p>In our <a href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/">previous posts</a>, we built the frontend and backend components of our cloud resume project. Now it's time to take our implementation to the next level by implementing <strong>continuous integration and deployment (CI/CD)</strong> with GitHub Actions.</p>
<h3 id="why-cicd-is-critical-for-cloud-engineers"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#why-cicd-is-critical-for-cloud-engineers">Why CI/CD Is Critical for Cloud Engineers 🛠️</a></h3>
<p>When I first started this challenge, I manually ran <code>terraform apply</code> every time I made a change. This quickly became tedious and error-prone. As a cloud engineer, I wanted to demonstrate a professional approach to infrastructure management by implementing proper CI/CD pipelines.</p>
<p>Automating deployments offers several key benefits:</p>
<ul>
<li><strong>Consistency</strong>: Every deployment follows the same process</li>
<li><strong>Efficiency</strong>: No more manual steps or waiting around</li>
<li><strong>Safety</strong>: Automated tests catch issues before they reach production</li>
<li><strong>Auditability</strong>: Each change is tracked with a commit and workflow run</li>
</ul>
<p>This approach mirrors how professional cloud teams work and is a crucial skill for any cloud engineer.</p>
<h3 id="cicd-architecture-overview"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#cicd-architecture-overview">CI/CD Architecture Overview 🏗️</a></h3>
<p>Here's a visual representation of our CI/CD pipelines:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a>┌─────────────┐          ┌─────────────────┐          ┌─────────────┐
</span><span id="__span-132-2"><a id="__codelineno-132-2" name="__codelineno-132-2" href="#__codelineno-132-2"></a>│             │          │                 │          │             │
</span><span id="__span-132-3"><a id="__codelineno-132-3" name="__codelineno-132-3" href="#__codelineno-132-3"></a>│  Developer  ├─────────►│  GitHub Actions ├─────────►│  AWS Cloud  │
</span><span id="__span-132-4"><a id="__codelineno-132-4" name="__codelineno-132-4" href="#__codelineno-132-4"></a>│  Workstation│          │                 │          │             │
</span><span id="__span-132-5"><a id="__codelineno-132-5" name="__codelineno-132-5" href="#__codelineno-132-5"></a>└─────────────┘          └─────────────────┘          └─────────────┘
</span><span id="__span-132-6"><a id="__codelineno-132-6" name="__codelineno-132-6" href="#__codelineno-132-6"></a>       │                          │                          ▲
</span><span id="__span-132-7"><a id="__codelineno-132-7" name="__codelineno-132-7" href="#__codelineno-132-7"></a>       │                          │                          │
</span><span id="__span-132-8"><a id="__codelineno-132-8" name="__codelineno-132-8" href="#__codelineno-132-8"></a>       ▼                          ▼                          │
</span><span id="__span-132-9"><a id="__codelineno-132-9" name="__codelineno-132-9" href="#__codelineno-132-9"></a>┌─────────────┐          ┌─────────────────┐                 │
</span><span id="__span-132-10"><a id="__codelineno-132-10" name="__codelineno-132-10" href="#__codelineno-132-10"></a>│             │          │                 │                 │
</span><span id="__span-132-11"><a id="__codelineno-132-11" name="__codelineno-132-11" href="#__codelineno-132-11"></a>│   GitHub    │          │  Terraform      │                 │
</span><span id="__span-132-12"><a id="__codelineno-132-12" name="__codelineno-132-12" href="#__codelineno-132-12"></a>│ Repositories│          │  Plan &amp; Apply   ├─────────────────┘
</span><span id="__span-132-13"><a id="__codelineno-132-13" name="__codelineno-132-13" href="#__codelineno-132-13"></a>│             │          │                 │
</span><span id="__span-132-14"><a id="__codelineno-132-14" name="__codelineno-132-14" href="#__codelineno-132-14"></a>└─────────────┘          └─────────────────┘
</span></code></pre></div>
<p>We'll set up separate workflows for:</p>
<ol>
<li><strong>Frontend deployment</strong>: Updates the S3 website content and invalidates CloudFront</li>
<li><strong>Backend deployment</strong>: Runs Terraform to update our API infrastructure</li>
<li><strong>Smoke tests</strong>: Verifies that both components are working correctly after deployment</li>
</ol>
<h3 id="setting-up-github-repositories"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#setting-up-github-repositories">Setting Up GitHub Repositories 📁</a></h3>
<p>For this challenge, I've created two repositories:</p>
<ul>
<li><code>cloud-resume-frontend</code>: Contains HTML, CSS, JavaScript, and frontend deployment workflows</li>
<li><code>cloud-resume-backend</code>: Contains Terraform configuration, Lambda code, and backend deployment workflows</li>
</ul>
<h4 id="repository-structure"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#repository-structure">Repository Structure</a></h4>
<p>Here's how I've organized my repositories:</p>
<p><strong>Frontend Repository</strong>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a>cloud-resume-frontend/
</span><span id="__span-133-2"><a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a>├── .github/
</span><span id="__span-133-3"><a id="__codelineno-133-3" name="__codelineno-133-3" href="#__codelineno-133-3"></a>│   └── workflows/
</span><span id="__span-133-4"><a id="__codelineno-133-4" name="__codelineno-133-4" href="#__codelineno-133-4"></a>│       └── deploy.yml
</span><span id="__span-133-5"><a id="__codelineno-133-5" name="__codelineno-133-5" href="#__codelineno-133-5"></a>├── website/
</span><span id="__span-133-6"><a id="__codelineno-133-6" name="__codelineno-133-6" href="#__codelineno-133-6"></a>│   ├── index.html
</span><span id="__span-133-7"><a id="__codelineno-133-7" name="__codelineno-133-7" href="#__codelineno-133-7"></a>│   ├── styles.css
</span><span id="__span-133-8"><a id="__codelineno-133-8" name="__codelineno-133-8" href="#__codelineno-133-8"></a>│   ├── counter.js
</span><span id="__span-133-9"><a id="__codelineno-133-9" name="__codelineno-133-9" href="#__codelineno-133-9"></a>│   └── error.html
</span><span id="__span-133-10"><a id="__codelineno-133-10" name="__codelineno-133-10" href="#__codelineno-133-10"></a>├── tests/
</span><span id="__span-133-11"><a id="__codelineno-133-11" name="__codelineno-133-11" href="#__codelineno-133-11"></a>│   └── cypress/
</span><span id="__span-133-12"><a id="__codelineno-133-12" name="__codelineno-133-12" href="#__codelineno-133-12"></a>│       └── integration/
</span><span id="__span-133-13"><a id="__codelineno-133-13" name="__codelineno-133-13" href="#__codelineno-133-13"></a>│           └── counter.spec.js
</span><span id="__span-133-14"><a id="__codelineno-133-14" name="__codelineno-133-14" href="#__codelineno-133-14"></a>└── README.md
</span></code></pre></div>
<p><strong>Backend Repository</strong>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a>cloud-resume-backend/
</span><span id="__span-134-2"><a id="__codelineno-134-2" name="__codelineno-134-2" href="#__codelineno-134-2"></a>├── .github/
</span><span id="__span-134-3"><a id="__codelineno-134-3" name="__codelineno-134-3" href="#__codelineno-134-3"></a>│   └── workflows/
</span><span id="__span-134-4"><a id="__codelineno-134-4" name="__codelineno-134-4" href="#__codelineno-134-4"></a>│       └── deploy.yml
</span><span id="__span-134-5"><a id="__codelineno-134-5" name="__codelineno-134-5" href="#__codelineno-134-5"></a>├── lambda/
</span><span id="__span-134-6"><a id="__codelineno-134-6" name="__codelineno-134-6" href="#__codelineno-134-6"></a>│   └── visitor_counter.py
</span><span id="__span-134-7"><a id="__codelineno-134-7" name="__codelineno-134-7" href="#__codelineno-134-7"></a>├── terraform/
</span><span id="__span-134-8"><a id="__codelineno-134-8" name="__codelineno-134-8" href="#__codelineno-134-8"></a>│   ├── modules/
</span><span id="__span-134-9"><a id="__codelineno-134-9" name="__codelineno-134-9" href="#__codelineno-134-9"></a>│   │   ├── backend/
</span><span id="__span-134-10"><a id="__codelineno-134-10" name="__codelineno-134-10" href="#__codelineno-134-10"></a>│   │   │   ├── api_gateway.tf
</span><span id="__span-134-11"><a id="__codelineno-134-11" name="__codelineno-134-11" href="#__codelineno-134-11"></a>│   │   │   ├── dynamodb.tf
</span><span id="__span-134-12"><a id="__codelineno-134-12" name="__codelineno-134-12" href="#__codelineno-134-12"></a>│   │   │   ├── lambda.tf
</span><span id="__span-134-13"><a id="__codelineno-134-13" name="__codelineno-134-13" href="#__codelineno-134-13"></a>│   │   │   ├── variables.tf
</span><span id="__span-134-14"><a id="__codelineno-134-14" name="__codelineno-134-14" href="#__codelineno-134-14"></a>│   │   │   └── outputs.tf
</span><span id="__span-134-15"><a id="__codelineno-134-15" name="__codelineno-134-15" href="#__codelineno-134-15"></a>│   ├── environments/
</span><span id="__span-134-16"><a id="__codelineno-134-16" name="__codelineno-134-16" href="#__codelineno-134-16"></a>│   │   ├── dev/
</span><span id="__span-134-17"><a id="__codelineno-134-17" name="__codelineno-134-17" href="#__codelineno-134-17"></a>│   │   │   └── main.tf
</span><span id="__span-134-18"><a id="__codelineno-134-18" name="__codelineno-134-18" href="#__codelineno-134-18"></a>│   │   └── prod/
</span><span id="__span-134-19"><a id="__codelineno-134-19" name="__codelineno-134-19" href="#__codelineno-134-19"></a>│   │       └── main.tf
</span><span id="__span-134-20"><a id="__codelineno-134-20" name="__codelineno-134-20" href="#__codelineno-134-20"></a>│   ├── main.tf
</span><span id="__span-134-21"><a id="__codelineno-134-21" name="__codelineno-134-21" href="#__codelineno-134-21"></a>│   ├── variables.tf
</span><span id="__span-134-22"><a id="__codelineno-134-22" name="__codelineno-134-22" href="#__codelineno-134-22"></a>│   └── outputs.tf
</span><span id="__span-134-23"><a id="__codelineno-134-23" name="__codelineno-134-23" href="#__codelineno-134-23"></a>├── tests/
</span><span id="__span-134-24"><a id="__codelineno-134-24" name="__codelineno-134-24" href="#__codelineno-134-24"></a>│   └── test_visitor_counter.py
</span><span id="__span-134-25"><a id="__codelineno-134-25" name="__codelineno-134-25" href="#__codelineno-134-25"></a>└── README.md
</span></code></pre></div>
<h3 id="securing-aws-authentication-in-github-actions"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#securing-aws-authentication-in-github-actions">Securing AWS Authentication in GitHub Actions 🔒</a></h3>
<p>Before setting up our workflows, we need to address a critical security concern: <strong>how to securely authenticate GitHub Actions with AWS</strong>.</p>
<p>In the past, many tutorials recommended storing AWS access keys as GitHub Secrets. This approach works but has significant security drawbacks:</p>
<ul>
<li>Long-lived credentials are a security risk</li>
<li>Credential rotation is manual and error-prone</li>
<li>Access is typically overly permissive</li>
</ul>
<p>Instead, I'll implement a more secure approach using <strong>OpenID Connect (OIDC)</strong> for keyless authentication between GitHub Actions and AWS.</p>
<h4 id="setting-up-oidc-authentication"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#setting-up-oidc-authentication">Setting Up OIDC Authentication</a></h4>
<p>First, create an IAM OIDC provider for GitHub in your AWS account:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a><span class="c1"># oidc-provider.tf</span>
</span><span id="__span-135-2"><a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_openid_connect_provider&quot;</span><span class="w"> </span><span class="nv">&quot;github&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-135-3"><a id="__codelineno-135-3" name="__codelineno-135-3" href="#__codelineno-135-3"></a><span class="w">  </span><span class="na">url</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://token.actions.githubusercontent.com&quot;</span>
</span><span id="__span-135-4"><a id="__codelineno-135-4" name="__codelineno-135-4" href="#__codelineno-135-4"></a><span class="w">  </span><span class="na">client_id_list</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;sts.amazonaws.com&quot;</span><span class="p">]</span>
</span><span id="__span-135-5"><a id="__codelineno-135-5" name="__codelineno-135-5" href="#__codelineno-135-5"></a><span class="w">  </span><span class="na">thumbprint_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;6938fd4d98bab03faadb97b34396831e3780aea1&quot;</span><span class="p">]</span>
</span><span id="__span-135-6"><a id="__codelineno-135-6" name="__codelineno-135-6" href="#__codelineno-135-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then, create an IAM role that GitHub Actions can assume:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="c1"># oidc-role.tf</span>
</span><span id="__span-136-2"><a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role&quot;</span><span class="w"> </span><span class="nv">&quot;github_actions&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-136-3"><a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;github-actions-role&quot;</span>
</span><span id="__span-136-4"><a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a>
</span><span id="__span-136-5"><a id="__codelineno-136-5" name="__codelineno-136-5" href="#__codelineno-136-5"></a><span class="w">  </span><span class="na">assume_role_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-136-6"><a id="__codelineno-136-6" name="__codelineno-136-6" href="#__codelineno-136-6"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-136-7"><a id="__codelineno-136-7" name="__codelineno-136-7" href="#__codelineno-136-7"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-136-8"><a id="__codelineno-136-8" name="__codelineno-136-8" href="#__codelineno-136-8"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-136-9"><a id="__codelineno-136-9" name="__codelineno-136-9" href="#__codelineno-136-9"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRoleWithWebIdentity&quot;</span>
</span><span id="__span-136-10"><a id="__codelineno-136-10" name="__codelineno-136-10" href="#__codelineno-136-10"></a><span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-136-11"><a id="__codelineno-136-11" name="__codelineno-136-11" href="#__codelineno-136-11"></a><span class="w">        </span><span class="nb">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-136-12"><a id="__codelineno-136-12" name="__codelineno-136-12" href="#__codelineno-136-12"></a><span class="w">          </span><span class="na">Federated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_openid_connect_provider.github.arn</span>
</span><span id="__span-136-13"><a id="__codelineno-136-13" name="__codelineno-136-13" href="#__codelineno-136-13"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-136-14"><a id="__codelineno-136-14" name="__codelineno-136-14" href="#__codelineno-136-14"></a><span class="w">        </span><span class="nb">Condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-136-15"><a id="__codelineno-136-15" name="__codelineno-136-15" href="#__codelineno-136-15"></a><span class="w">          </span><span class="nb">StringEquals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-136-16"><a id="__codelineno-136-16" name="__codelineno-136-16" href="#__codelineno-136-16"></a><span class="w">            </span><span class="s2">&quot;token.actions.githubusercontent.com:aud&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sts.amazonaws.com&quot;</span>
</span><span id="__span-136-17"><a id="__codelineno-136-17" name="__codelineno-136-17" href="#__codelineno-136-17"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-136-18"><a id="__codelineno-136-18" name="__codelineno-136-18" href="#__codelineno-136-18"></a><span class="w">          </span><span class="nb">StringLike</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-136-19"><a id="__codelineno-136-19" name="__codelineno-136-19" href="#__codelineno-136-19"></a><span class="w">            </span><span class="s2">&quot;token.actions.githubusercontent.com:sub&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;repo:${var.github_org}/${var.github_repo}:*&quot;</span>
</span><span id="__span-136-20"><a id="__codelineno-136-20" name="__codelineno-136-20" href="#__codelineno-136-20"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-136-21"><a id="__codelineno-136-21" name="__codelineno-136-21" href="#__codelineno-136-21"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-136-22"><a id="__codelineno-136-22" name="__codelineno-136-22" href="#__codelineno-136-22"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-136-23"><a id="__codelineno-136-23" name="__codelineno-136-23" href="#__codelineno-136-23"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-136-24"><a id="__codelineno-136-24" name="__codelineno-136-24" href="#__codelineno-136-24"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-136-25"><a id="__codelineno-136-25" name="__codelineno-136-25" href="#__codelineno-136-25"></a><span class="p">}</span>
</span><span id="__span-136-26"><a id="__codelineno-136-26" name="__codelineno-136-26" href="#__codelineno-136-26"></a>
</span><span id="__span-136-27"><a id="__codelineno-136-27" name="__codelineno-136-27" href="#__codelineno-136-27"></a><span class="c1"># Attach policies to the role</span>
</span><span id="__span-136-28"><a id="__codelineno-136-28" name="__codelineno-136-28" href="#__codelineno-136-28"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role_policy_attachment&quot;</span><span class="w"> </span><span class="nv">&quot;terraform_permissions&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-136-29"><a id="__codelineno-136-29" name="__codelineno-136-29" href="#__codelineno-136-29"></a><span class="w">  </span><span class="na">role</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.github_actions.name</span>
</span><span id="__span-136-30"><a id="__codelineno-136-30" name="__codelineno-136-30" href="#__codelineno-136-30"></a><span class="w">  </span><span class="na">policy_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_policy.terraform_permissions.arn</span>
</span><span id="__span-136-31"><a id="__codelineno-136-31" name="__codelineno-136-31" href="#__codelineno-136-31"></a><span class="p">}</span>
</span><span id="__span-136-32"><a id="__codelineno-136-32" name="__codelineno-136-32" href="#__codelineno-136-32"></a>
</span><span id="__span-136-33"><a id="__codelineno-136-33" name="__codelineno-136-33" href="#__codelineno-136-33"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_policy&quot;</span><span class="w"> </span><span class="nv">&quot;terraform_permissions&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-136-34"><a id="__codelineno-136-34" name="__codelineno-136-34" href="#__codelineno-136-34"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-deployment-policy&quot;</span>
</span><span id="__span-136-35"><a id="__codelineno-136-35" name="__codelineno-136-35" href="#__codelineno-136-35"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Policy for Terraform deployments via GitHub Actions&quot;</span>
</span><span id="__span-136-36"><a id="__codelineno-136-36" name="__codelineno-136-36" href="#__codelineno-136-36"></a>
</span><span id="__span-136-37"><a id="__codelineno-136-37" name="__codelineno-136-37" href="#__codelineno-136-37"></a><span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-136-38"><a id="__codelineno-136-38" name="__codelineno-136-38" href="#__codelineno-136-38"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-136-39"><a id="__codelineno-136-39" name="__codelineno-136-39" href="#__codelineno-136-39"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-136-40"><a id="__codelineno-136-40" name="__codelineno-136-40" href="#__codelineno-136-40"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-136-41"><a id="__codelineno-136-41" name="__codelineno-136-41" href="#__codelineno-136-41"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-136-42"><a id="__codelineno-136-42" name="__codelineno-136-42" href="#__codelineno-136-42"></a><span class="w">          </span><span class="s2">&quot;s3:*&quot;</span><span class="p">,</span>
</span><span id="__span-136-43"><a id="__codelineno-136-43" name="__codelineno-136-43" href="#__codelineno-136-43"></a><span class="w">          </span><span class="s2">&quot;cloudfront:*&quot;</span><span class="p">,</span>
</span><span id="__span-136-44"><a id="__codelineno-136-44" name="__codelineno-136-44" href="#__codelineno-136-44"></a><span class="w">          </span><span class="s2">&quot;route53:*&quot;</span><span class="p">,</span>
</span><span id="__span-136-45"><a id="__codelineno-136-45" name="__codelineno-136-45" href="#__codelineno-136-45"></a><span class="w">          </span><span class="s2">&quot;acm:*&quot;</span><span class="p">,</span>
</span><span id="__span-136-46"><a id="__codelineno-136-46" name="__codelineno-136-46" href="#__codelineno-136-46"></a><span class="w">          </span><span class="s2">&quot;lambda:*&quot;</span><span class="p">,</span>
</span><span id="__span-136-47"><a id="__codelineno-136-47" name="__codelineno-136-47" href="#__codelineno-136-47"></a><span class="w">          </span><span class="s2">&quot;apigateway:*&quot;</span><span class="p">,</span>
</span><span id="__span-136-48"><a id="__codelineno-136-48" name="__codelineno-136-48" href="#__codelineno-136-48"></a><span class="w">          </span><span class="s2">&quot;dynamodb:*&quot;</span><span class="p">,</span>
</span><span id="__span-136-49"><a id="__codelineno-136-49" name="__codelineno-136-49" href="#__codelineno-136-49"></a><span class="w">          </span><span class="s2">&quot;logs:*&quot;</span><span class="p">,</span>
</span><span id="__span-136-50"><a id="__codelineno-136-50" name="__codelineno-136-50" href="#__codelineno-136-50"></a><span class="w">          </span><span class="s2">&quot;iam:GetRole&quot;</span><span class="p">,</span>
</span><span id="__span-136-51"><a id="__codelineno-136-51" name="__codelineno-136-51" href="#__codelineno-136-51"></a><span class="w">          </span><span class="s2">&quot;iam:PassRole&quot;</span><span class="p">,</span>
</span><span id="__span-136-52"><a id="__codelineno-136-52" name="__codelineno-136-52" href="#__codelineno-136-52"></a><span class="w">          </span><span class="s2">&quot;iam:CreateRole&quot;</span><span class="p">,</span>
</span><span id="__span-136-53"><a id="__codelineno-136-53" name="__codelineno-136-53" href="#__codelineno-136-53"></a><span class="w">          </span><span class="s2">&quot;iam:DeleteRole&quot;</span><span class="p">,</span>
</span><span id="__span-136-54"><a id="__codelineno-136-54" name="__codelineno-136-54" href="#__codelineno-136-54"></a><span class="w">          </span><span class="s2">&quot;iam:PutRolePolicy&quot;</span><span class="p">,</span>
</span><span id="__span-136-55"><a id="__codelineno-136-55" name="__codelineno-136-55" href="#__codelineno-136-55"></a><span class="w">          </span><span class="s2">&quot;iam:DeleteRolePolicy&quot;</span><span class="p">,</span>
</span><span id="__span-136-56"><a id="__codelineno-136-56" name="__codelineno-136-56" href="#__codelineno-136-56"></a><span class="w">          </span><span class="s2">&quot;iam:AttachRolePolicy&quot;</span><span class="p">,</span>
</span><span id="__span-136-57"><a id="__codelineno-136-57" name="__codelineno-136-57" href="#__codelineno-136-57"></a><span class="w">          </span><span class="s2">&quot;iam:DetachRolePolicy&quot;</span>
</span><span id="__span-136-58"><a id="__codelineno-136-58" name="__codelineno-136-58" href="#__codelineno-136-58"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-136-59"><a id="__codelineno-136-59" name="__codelineno-136-59" href="#__codelineno-136-59"></a><span class="w">        </span><span class="na">Effect</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-136-60"><a id="__codelineno-136-60" name="__codelineno-136-60" href="#__codelineno-136-60"></a><span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-136-61"><a id="__codelineno-136-61" name="__codelineno-136-61" href="#__codelineno-136-61"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-136-62"><a id="__codelineno-136-62" name="__codelineno-136-62" href="#__codelineno-136-62"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-136-63"><a id="__codelineno-136-63" name="__codelineno-136-63" href="#__codelineno-136-63"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-136-64"><a id="__codelineno-136-64" name="__codelineno-136-64" href="#__codelineno-136-64"></a><span class="p">}</span>
</span></code></pre></div>
<p>For a production environment, I would use more fine-grained permissions, but this policy works for our demonstration.</p>
<h3 id="implementing-frontend-cicd-workflow"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#implementing-frontend-cicd-workflow">Implementing Frontend CI/CD Workflow 🔄</a></h3>
<p>Let's create a GitHub Actions workflow for our frontend repository. Create a file at <code>.github/workflows/deploy.yml</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy Frontend</span>
</span><span id="__span-137-2"><a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a>
</span><span id="__span-137-3"><a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a><span class="nt">on</span><span class="p">:</span>
</span><span id="__span-137-4"><a id="__codelineno-137-4" name="__codelineno-137-4" href="#__codelineno-137-4"></a><span class="w">  </span><span class="nt">push</span><span class="p">:</span>
</span><span id="__span-137-5"><a id="__codelineno-137-5" name="__codelineno-137-5" href="#__codelineno-137-5"></a><span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
</span><span id="__span-137-6"><a id="__codelineno-137-6" name="__codelineno-137-6" href="#__codelineno-137-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id="__span-137-7"><a id="__codelineno-137-7" name="__codelineno-137-7" href="#__codelineno-137-7"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-137-8"><a id="__codelineno-137-8" name="__codelineno-137-8" href="#__codelineno-137-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;website/**&#39;</span>
</span><span id="__span-137-9"><a id="__codelineno-137-9" name="__codelineno-137-9" href="#__codelineno-137-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;.github/workflows/deploy.yml&#39;</span>
</span><span id="__span-137-10"><a id="__codelineno-137-10" name="__codelineno-137-10" href="#__codelineno-137-10"></a>
</span><span id="__span-137-11"><a id="__codelineno-137-11" name="__codelineno-137-11" href="#__codelineno-137-11"></a><span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span>
</span><span id="__span-137-12"><a id="__codelineno-137-12" name="__codelineno-137-12" href="#__codelineno-137-12"></a>
</span><span id="__span-137-13"><a id="__codelineno-137-13" name="__codelineno-137-13" href="#__codelineno-137-13"></a><span class="nt">permissions</span><span class="p">:</span>
</span><span id="__span-137-14"><a id="__codelineno-137-14" name="__codelineno-137-14" href="#__codelineno-137-14"></a><span class="w">  </span><span class="nt">id-token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id="__span-137-15"><a id="__codelineno-137-15" name="__codelineno-137-15" href="#__codelineno-137-15"></a><span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id="__span-137-16"><a id="__codelineno-137-16" name="__codelineno-137-16" href="#__codelineno-137-16"></a>
</span><span id="__span-137-17"><a id="__codelineno-137-17" name="__codelineno-137-17" href="#__codelineno-137-17"></a><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-137-18"><a id="__codelineno-137-18" name="__codelineno-137-18" href="#__codelineno-137-18"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-137-19"><a id="__codelineno-137-19" name="__codelineno-137-19" href="#__codelineno-137-19"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Deploy</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">S3</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">Invalidate</span><span class="nv"> </span><span class="s">CloudFront&#39;</span>
</span><span id="__span-137-20"><a id="__codelineno-137-20" name="__codelineno-137-20" href="#__codelineno-137-20"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-137-21"><a id="__codelineno-137-21" name="__codelineno-137-21" href="#__codelineno-137-21"></a>
</span><span id="__span-137-22"><a id="__codelineno-137-22" name="__codelineno-137-22" href="#__codelineno-137-22"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-137-23"><a id="__codelineno-137-23" name="__codelineno-137-23" href="#__codelineno-137-23"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-137-24"><a id="__codelineno-137-24" name="__codelineno-137-24" href="#__codelineno-137-24"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-137-25"><a id="__codelineno-137-25" name="__codelineno-137-25" href="#__codelineno-137-25"></a>
</span><span id="__span-137-26"><a id="__codelineno-137-26" name="__codelineno-137-26" href="#__codelineno-137-26"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS Credentials</span>
</span><span id="__span-137-27"><a id="__codelineno-137-27" name="__codelineno-137-27" href="#__codelineno-137-27"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v2</span>
</span><span id="__span-137-28"><a id="__codelineno-137-28" name="__codelineno-137-28" href="#__codelineno-137-28"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-137-29"><a id="__codelineno-137-29" name="__codelineno-137-29" href="#__codelineno-137-29"></a><span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/github-actions-role</span>
</span><span id="__span-137-30"><a id="__codelineno-137-30" name="__codelineno-137-30" href="#__codelineno-137-30"></a><span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
</span><span id="__span-137-31"><a id="__codelineno-137-31" name="__codelineno-137-31" href="#__codelineno-137-31"></a>
</span><span id="__span-137-32"><a id="__codelineno-137-32" name="__codelineno-137-32" href="#__codelineno-137-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to S3</span>
</span><span id="__span-137-33"><a id="__codelineno-137-33" name="__codelineno-137-33" href="#__codelineno-137-33"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-137-34"><a id="__codelineno-137-34" name="__codelineno-137-34" href="#__codelineno-137-34"></a><span class="w">          </span><span class="no">aws s3 sync website/ s3://${{ secrets.S3_BUCKET_NAME }} --delete</span>
</span><span id="__span-137-35"><a id="__codelineno-137-35" name="__codelineno-137-35" href="#__codelineno-137-35"></a>
</span><span id="__span-137-36"><a id="__codelineno-137-36" name="__codelineno-137-36" href="#__codelineno-137-36"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Invalidate CloudFront Cache</span>
</span><span id="__span-137-37"><a id="__codelineno-137-37" name="__codelineno-137-37" href="#__codelineno-137-37"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-137-38"><a id="__codelineno-137-38" name="__codelineno-137-38" href="#__codelineno-137-38"></a><span class="w">          </span><span class="no">aws cloudfront create-invalidation --distribution-id ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }} --paths &quot;/*&quot;</span>
</span><span id="__span-137-39"><a id="__codelineno-137-39" name="__codelineno-137-39" href="#__codelineno-137-39"></a>
</span><span id="__span-137-40"><a id="__codelineno-137-40" name="__codelineno-137-40" href="#__codelineno-137-40"></a><span class="w">  </span><span class="nt">test</span><span class="p">:</span>
</span><span id="__span-137-41"><a id="__codelineno-137-41" name="__codelineno-137-41" href="#__codelineno-137-41"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Run</span><span class="nv"> </span><span class="s">Smoke</span><span class="nv"> </span><span class="s">Tests&#39;</span>
</span><span id="__span-137-42"><a id="__codelineno-137-42" name="__codelineno-137-42" href="#__codelineno-137-42"></a><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
</span><span id="__span-137-43"><a id="__codelineno-137-43" name="__codelineno-137-43" href="#__codelineno-137-43"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-137-44"><a id="__codelineno-137-44" name="__codelineno-137-44" href="#__codelineno-137-44"></a>
</span><span id="__span-137-45"><a id="__codelineno-137-45" name="__codelineno-137-45" href="#__codelineno-137-45"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-137-46"><a id="__codelineno-137-46" name="__codelineno-137-46" href="#__codelineno-137-46"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-137-47"><a id="__codelineno-137-47" name="__codelineno-137-47" href="#__codelineno-137-47"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-137-48"><a id="__codelineno-137-48" name="__codelineno-137-48" href="#__codelineno-137-48"></a>
</span><span id="__span-137-49"><a id="__codelineno-137-49" name="__codelineno-137-49" href="#__codelineno-137-49"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Cypress</span>
</span><span id="__span-137-50"><a id="__codelineno-137-50" name="__codelineno-137-50" href="#__codelineno-137-50"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cypress-io/github-action@v5</span>
</span><span id="__span-137-51"><a id="__codelineno-137-51" name="__codelineno-137-51" href="#__codelineno-137-51"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-137-52"><a id="__codelineno-137-52" name="__codelineno-137-52" href="#__codelineno-137-52"></a><span class="w">          </span><span class="nt">install-command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm install</span>
</span><span id="__span-137-53"><a id="__codelineno-137-53" name="__codelineno-137-53" href="#__codelineno-137-53"></a>
</span><span id="__span-137-54"><a id="__codelineno-137-54" name="__codelineno-137-54" href="#__codelineno-137-54"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Cypress Tests</span>
</span><span id="__span-137-55"><a id="__codelineno-137-55" name="__codelineno-137-55" href="#__codelineno-137-55"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cypress-io/github-action@v5</span>
</span><span id="__span-137-56"><a id="__codelineno-137-56" name="__codelineno-137-56" href="#__codelineno-137-56"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-137-57"><a id="__codelineno-137-57" name="__codelineno-137-57" href="#__codelineno-137-57"></a><span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npx cypress run</span>
</span><span id="__span-137-58"><a id="__codelineno-137-58" name="__codelineno-137-58" href="#__codelineno-137-58"></a><span class="w">          </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">baseUrl=${{ secrets.WEBSITE_URL }}</span>
</span></code></pre></div>
<p>This workflow:</p>
<ol>
<li>Authenticates using OIDC</li>
<li>Syncs website files to the S3 bucket</li>
<li>Invalidates the CloudFront cache</li>
<li>Runs Cypress tests to verify the site is working</li>
</ol>
<h4 id="creating-a-cypress-test-for-the-frontend"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#creating-a-cypress-test-for-the-frontend">Creating a Cypress Test for the Frontend</a></h4>
<p>Let's create a simple Cypress test to verify that our visitor counter is working. First, create a <code>package.json</code> file in the root of your frontend repository:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="p">{</span>
</span><span id="__span-138-2"><a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cloud-resume-frontend&quot;</span><span class="p">,</span>
</span><span id="__span-138-3"><a id="__codelineno-138-3" name="__codelineno-138-3" href="#__codelineno-138-3"></a><span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-138-4"><a id="__codelineno-138-4" name="__codelineno-138-4" href="#__codelineno-138-4"></a><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Frontend for Cloud Resume Challenge&quot;</span><span class="p">,</span>
</span><span id="__span-138-5"><a id="__codelineno-138-5" name="__codelineno-138-5" href="#__codelineno-138-5"></a><span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-138-6"><a id="__codelineno-138-6" name="__codelineno-138-6" href="#__codelineno-138-6"></a><span class="w">    </span><span class="nt">&quot;test&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cypress open&quot;</span><span class="p">,</span>
</span><span id="__span-138-7"><a id="__codelineno-138-7" name="__codelineno-138-7" href="#__codelineno-138-7"></a><span class="w">    </span><span class="nt">&quot;test:ci&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cypress run&quot;</span>
</span><span id="__span-138-8"><a id="__codelineno-138-8" name="__codelineno-138-8" href="#__codelineno-138-8"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-138-9"><a id="__codelineno-138-9" name="__codelineno-138-9" href="#__codelineno-138-9"></a><span class="w">  </span><span class="nt">&quot;devDependencies&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-138-10"><a id="__codelineno-138-10" name="__codelineno-138-10" href="#__codelineno-138-10"></a><span class="w">    </span><span class="nt">&quot;cypress&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^12.0.0&quot;</span>
</span><span id="__span-138-11"><a id="__codelineno-138-11" name="__codelineno-138-11" href="#__codelineno-138-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-138-12"><a id="__codelineno-138-12" name="__codelineno-138-12" href="#__codelineno-138-12"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then create a Cypress test at <code>tests/cypress/integration/counter.spec.js</code>:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Resume Website Tests&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-139-2"><a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a><span class="w">  </span><span class="nx">beforeEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-139-3"><a id="__codelineno-139-3" name="__codelineno-139-3" href="#__codelineno-139-3"></a><span class="w">    </span><span class="c1">// Visit the home page before each test</span>
</span><span id="__span-139-4"><a id="__codelineno-139-4" name="__codelineno-139-4" href="#__codelineno-139-4"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
</span><span id="__span-139-5"><a id="__codelineno-139-5" name="__codelineno-139-5" href="#__codelineno-139-5"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-139-6"><a id="__codelineno-139-6" name="__codelineno-139-6" href="#__codelineno-139-6"></a>
</span><span id="__span-139-7"><a id="__codelineno-139-7" name="__codelineno-139-7" href="#__codelineno-139-7"></a><span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should load the resume page&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-139-8"><a id="__codelineno-139-8" name="__codelineno-139-8" href="#__codelineno-139-8"></a><span class="w">    </span><span class="c1">// Check that we have a title</span>
</span><span id="__span-139-9"><a id="__codelineno-139-9" name="__codelineno-139-9" href="#__codelineno-139-9"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;be.visible&#39;</span><span class="p">);</span>
</span><span id="__span-139-10"><a id="__codelineno-139-10" name="__codelineno-139-10" href="#__codelineno-139-10"></a>
</span><span id="__span-139-11"><a id="__codelineno-139-11" name="__codelineno-139-11" href="#__codelineno-139-11"></a><span class="w">    </span><span class="c1">// Check that key sections exist</span>
</span><span id="__span-139-12"><a id="__codelineno-139-12" name="__codelineno-139-12" href="#__codelineno-139-12"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;Experience&#39;</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;be.visible&#39;</span><span class="p">);</span>
</span><span id="__span-139-13"><a id="__codelineno-139-13" name="__codelineno-139-13" href="#__codelineno-139-13"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;Education&#39;</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;be.visible&#39;</span><span class="p">);</span>
</span><span id="__span-139-14"><a id="__codelineno-139-14" name="__codelineno-139-14" href="#__codelineno-139-14"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;Skills&#39;</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;be.visible&#39;</span><span class="p">);</span>
</span><span id="__span-139-15"><a id="__codelineno-139-15" name="__codelineno-139-15" href="#__codelineno-139-15"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-139-16"><a id="__codelineno-139-16" name="__codelineno-139-16" href="#__codelineno-139-16"></a>
</span><span id="__span-139-17"><a id="__codelineno-139-17" name="__codelineno-139-17" href="#__codelineno-139-17"></a><span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should load and display the visitor counter&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-139-18"><a id="__codelineno-139-18" name="__codelineno-139-18" href="#__codelineno-139-18"></a><span class="w">    </span><span class="c1">// Check that the counter element exists</span>
</span><span id="__span-139-19"><a id="__codelineno-139-19" name="__codelineno-139-19" href="#__codelineno-139-19"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;#count&#39;</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;exist&#39;</span><span class="p">);</span>
</span><span id="__span-139-20"><a id="__codelineno-139-20" name="__codelineno-139-20" href="#__codelineno-139-20"></a>
</span><span id="__span-139-21"><a id="__codelineno-139-21" name="__codelineno-139-21" href="#__codelineno-139-21"></a><span class="w">    </span><span class="c1">// Wait for the counter to update (should not remain at 0)</span>
</span><span id="__span-139-22"><a id="__codelineno-139-22" name="__codelineno-139-22" href="#__codelineno-139-22"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;#count&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">timeout</span><span class="o">:</span><span class="w"> </span><span class="mf">10000</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-139-23"><a id="__codelineno-139-23" name="__codelineno-139-23" href="#__codelineno-139-23"></a><span class="w">      </span><span class="p">.</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;not.contain&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
</span><span id="__span-139-24"><a id="__codelineno-139-24" name="__codelineno-139-24" href="#__codelineno-139-24"></a><span class="w">      </span><span class="p">.</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;not.contain&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Loading&#39;</span><span class="p">);</span>
</span><span id="__span-139-25"><a id="__codelineno-139-25" name="__codelineno-139-25" href="#__codelineno-139-25"></a>
</span><span id="__span-139-26"><a id="__codelineno-139-26" name="__codelineno-139-26" href="#__codelineno-139-26"></a><span class="w">    </span><span class="c1">// Verify the counter shows a number</span>
</span><span id="__span-139-27"><a id="__codelineno-139-27" name="__codelineno-139-27" href="#__codelineno-139-27"></a><span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;#count&#39;</span><span class="p">).</span><span class="nx">invoke</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">)</span>
</span><span id="__span-139-28"><a id="__codelineno-139-28" name="__codelineno-139-28" href="#__codelineno-139-28"></a><span class="w">      </span><span class="p">.</span><span class="nx">should</span><span class="p">(</span><span class="s1">&#39;be.gt&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-139-29"><a id="__codelineno-139-29" name="__codelineno-139-29" href="#__codelineno-139-29"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-139-30"><a id="__codelineno-139-30" name="__codelineno-139-30" href="#__codelineno-139-30"></a><span class="p">});</span>
</span></code></pre></div>
<h3 id="implementing-backend-cicd-workflow"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#implementing-backend-cicd-workflow">Implementing Backend CI/CD Workflow 🔄</a></h3>
<p>Now, let's create a GitHub Actions workflow for our backend repository. Create a file at <code>.github/workflows/deploy.yml</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy Backend</span>
</span><span id="__span-140-2"><a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a>
</span><span id="__span-140-3"><a id="__codelineno-140-3" name="__codelineno-140-3" href="#__codelineno-140-3"></a><span class="nt">on</span><span class="p">:</span>
</span><span id="__span-140-4"><a id="__codelineno-140-4" name="__codelineno-140-4" href="#__codelineno-140-4"></a><span class="w">  </span><span class="nt">push</span><span class="p">:</span>
</span><span id="__span-140-5"><a id="__codelineno-140-5" name="__codelineno-140-5" href="#__codelineno-140-5"></a><span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
</span><span id="__span-140-6"><a id="__codelineno-140-6" name="__codelineno-140-6" href="#__codelineno-140-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id="__span-140-7"><a id="__codelineno-140-7" name="__codelineno-140-7" href="#__codelineno-140-7"></a><span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-140-8"><a id="__codelineno-140-8" name="__codelineno-140-8" href="#__codelineno-140-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;lambda/**&#39;</span>
</span><span id="__span-140-9"><a id="__codelineno-140-9" name="__codelineno-140-9" href="#__codelineno-140-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;terraform/**&#39;</span>
</span><span id="__span-140-10"><a id="__codelineno-140-10" name="__codelineno-140-10" href="#__codelineno-140-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;.github/workflows/deploy.yml&#39;</span>
</span><span id="__span-140-11"><a id="__codelineno-140-11" name="__codelineno-140-11" href="#__codelineno-140-11"></a>
</span><span id="__span-140-12"><a id="__codelineno-140-12" name="__codelineno-140-12" href="#__codelineno-140-12"></a><span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
</span><span id="__span-140-13"><a id="__codelineno-140-13" name="__codelineno-140-13" href="#__codelineno-140-13"></a><span class="w">    </span><span class="nt">branches</span><span class="p">:</span>
</span><span id="__span-140-14"><a id="__codelineno-140-14" name="__codelineno-140-14" href="#__codelineno-140-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</span><span id="__span-140-15"><a id="__codelineno-140-15" name="__codelineno-140-15" href="#__codelineno-140-15"></a>
</span><span id="__span-140-16"><a id="__codelineno-140-16" name="__codelineno-140-16" href="#__codelineno-140-16"></a><span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span>
</span><span id="__span-140-17"><a id="__codelineno-140-17" name="__codelineno-140-17" href="#__codelineno-140-17"></a>
</span><span id="__span-140-18"><a id="__codelineno-140-18" name="__codelineno-140-18" href="#__codelineno-140-18"></a><span class="nt">permissions</span><span class="p">:</span>
</span><span id="__span-140-19"><a id="__codelineno-140-19" name="__codelineno-140-19" href="#__codelineno-140-19"></a><span class="w">  </span><span class="nt">id-token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id="__span-140-20"><a id="__codelineno-140-20" name="__codelineno-140-20" href="#__codelineno-140-20"></a><span class="w">  </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id="__span-140-21"><a id="__codelineno-140-21" name="__codelineno-140-21" href="#__codelineno-140-21"></a><span class="w">  </span><span class="nt">pull-requests</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id="__span-140-22"><a id="__codelineno-140-22" name="__codelineno-140-22" href="#__codelineno-140-22"></a>
</span><span id="__span-140-23"><a id="__codelineno-140-23" name="__codelineno-140-23" href="#__codelineno-140-23"></a><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-140-24"><a id="__codelineno-140-24" name="__codelineno-140-24" href="#__codelineno-140-24"></a><span class="w">  </span><span class="nt">test</span><span class="p">:</span>
</span><span id="__span-140-25"><a id="__codelineno-140-25" name="__codelineno-140-25" href="#__codelineno-140-25"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Run</span><span class="nv"> </span><span class="s">Python</span><span class="nv"> </span><span class="s">Tests&#39;</span>
</span><span id="__span-140-26"><a id="__codelineno-140-26" name="__codelineno-140-26" href="#__codelineno-140-26"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-140-27"><a id="__codelineno-140-27" name="__codelineno-140-27" href="#__codelineno-140-27"></a>
</span><span id="__span-140-28"><a id="__codelineno-140-28" name="__codelineno-140-28" href="#__codelineno-140-28"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-140-29"><a id="__codelineno-140-29" name="__codelineno-140-29" href="#__codelineno-140-29"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-140-30"><a id="__codelineno-140-30" name="__codelineno-140-30" href="#__codelineno-140-30"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-140-31"><a id="__codelineno-140-31" name="__codelineno-140-31" href="#__codelineno-140-31"></a>
</span><span id="__span-140-32"><a id="__codelineno-140-32" name="__codelineno-140-32" href="#__codelineno-140-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python</span>
</span><span id="__span-140-33"><a id="__codelineno-140-33" name="__codelineno-140-33" href="#__codelineno-140-33"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v4</span>
</span><span id="__span-140-34"><a id="__codelineno-140-34" name="__codelineno-140-34" href="#__codelineno-140-34"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-140-35"><a id="__codelineno-140-35" name="__codelineno-140-35" href="#__codelineno-140-35"></a><span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.9&#39;</span>
</span><span id="__span-140-36"><a id="__codelineno-140-36" name="__codelineno-140-36" href="#__codelineno-140-36"></a>
</span><span id="__span-140-37"><a id="__codelineno-140-37" name="__codelineno-140-37" href="#__codelineno-140-37"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Dependencies</span>
</span><span id="__span-140-38"><a id="__codelineno-140-38" name="__codelineno-140-38" href="#__codelineno-140-38"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-140-39"><a id="__codelineno-140-39" name="__codelineno-140-39" href="#__codelineno-140-39"></a><span class="w">          </span><span class="no">python -m pip install --upgrade pip</span>
</span><span id="__span-140-40"><a id="__codelineno-140-40" name="__codelineno-140-40" href="#__codelineno-140-40"></a><span class="w">          </span><span class="no">pip install pytest boto3 moto</span>
</span><span id="__span-140-41"><a id="__codelineno-140-41" name="__codelineno-140-41" href="#__codelineno-140-41"></a>
</span><span id="__span-140-42"><a id="__codelineno-140-42" name="__codelineno-140-42" href="#__codelineno-140-42"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Tests</span>
</span><span id="__span-140-43"><a id="__codelineno-140-43" name="__codelineno-140-43" href="#__codelineno-140-43"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-140-44"><a id="__codelineno-140-44" name="__codelineno-140-44" href="#__codelineno-140-44"></a><span class="w">          </span><span class="no">python -m pytest tests/</span>
</span><span id="__span-140-45"><a id="__codelineno-140-45" name="__codelineno-140-45" href="#__codelineno-140-45"></a>
</span><span id="__span-140-46"><a id="__codelineno-140-46" name="__codelineno-140-46" href="#__codelineno-140-46"></a><span class="w">  </span><span class="nt">validate</span><span class="p">:</span>
</span><span id="__span-140-47"><a id="__codelineno-140-47" name="__codelineno-140-47" href="#__codelineno-140-47"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Validate</span><span class="nv"> </span><span class="s">Terraform&#39;</span>
</span><span id="__span-140-48"><a id="__codelineno-140-48" name="__codelineno-140-48" href="#__codelineno-140-48"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-140-49"><a id="__codelineno-140-49" name="__codelineno-140-49" href="#__codelineno-140-49"></a><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
</span><span id="__span-140-50"><a id="__codelineno-140-50" name="__codelineno-140-50" href="#__codelineno-140-50"></a>
</span><span id="__span-140-51"><a id="__codelineno-140-51" name="__codelineno-140-51" href="#__codelineno-140-51"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-140-52"><a id="__codelineno-140-52" name="__codelineno-140-52" href="#__codelineno-140-52"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-140-53"><a id="__codelineno-140-53" name="__codelineno-140-53" href="#__codelineno-140-53"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-140-54"><a id="__codelineno-140-54" name="__codelineno-140-54" href="#__codelineno-140-54"></a>
</span><span id="__span-140-55"><a id="__codelineno-140-55" name="__codelineno-140-55" href="#__codelineno-140-55"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
</span><span id="__span-140-56"><a id="__codelineno-140-56" name="__codelineno-140-56" href="#__codelineno-140-56"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v2</span>
</span><span id="__span-140-57"><a id="__codelineno-140-57" name="__codelineno-140-57" href="#__codelineno-140-57"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-140-58"><a id="__codelineno-140-58" name="__codelineno-140-58" href="#__codelineno-140-58"></a><span class="w">          </span><span class="nt">terraform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2.0</span>
</span><span id="__span-140-59"><a id="__codelineno-140-59" name="__codelineno-140-59" href="#__codelineno-140-59"></a>
</span><span id="__span-140-60"><a id="__codelineno-140-60" name="__codelineno-140-60" href="#__codelineno-140-60"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Format</span>
</span><span id="__span-140-61"><a id="__codelineno-140-61" name="__codelineno-140-61" href="#__codelineno-140-61"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-140-62"><a id="__codelineno-140-62" name="__codelineno-140-62" href="#__codelineno-140-62"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform fmt -check</span>
</span><span id="__span-140-63"><a id="__codelineno-140-63" name="__codelineno-140-63" href="#__codelineno-140-63"></a>
</span><span id="__span-140-64"><a id="__codelineno-140-64" name="__codelineno-140-64" href="#__codelineno-140-64"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
</span><span id="__span-140-65"><a id="__codelineno-140-65" name="__codelineno-140-65" href="#__codelineno-140-65"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-140-66"><a id="__codelineno-140-66" name="__codelineno-140-66" href="#__codelineno-140-66"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform init -backend=false</span>
</span><span id="__span-140-67"><a id="__codelineno-140-67" name="__codelineno-140-67" href="#__codelineno-140-67"></a>
</span><span id="__span-140-68"><a id="__codelineno-140-68" name="__codelineno-140-68" href="#__codelineno-140-68"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Validate</span>
</span><span id="__span-140-69"><a id="__codelineno-140-69" name="__codelineno-140-69" href="#__codelineno-140-69"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-140-70"><a id="__codelineno-140-70" name="__codelineno-140-70" href="#__codelineno-140-70"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform validate</span>
</span><span id="__span-140-71"><a id="__codelineno-140-71" name="__codelineno-140-71" href="#__codelineno-140-71"></a>
</span><span id="__span-140-72"><a id="__codelineno-140-72" name="__codelineno-140-72" href="#__codelineno-140-72"></a><span class="w">  </span><span class="nt">plan</span><span class="p">:</span>
</span><span id="__span-140-73"><a id="__codelineno-140-73" name="__codelineno-140-73" href="#__codelineno-140-73"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Terraform</span><span class="nv"> </span><span class="s">Plan&#39;</span>
</span><span id="__span-140-74"><a id="__codelineno-140-74" name="__codelineno-140-74" href="#__codelineno-140-74"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-140-75"><a id="__codelineno-140-75" name="__codelineno-140-75" href="#__codelineno-140-75"></a><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validate</span>
</span><span id="__span-140-76"><a id="__codelineno-140-76" name="__codelineno-140-76" href="#__codelineno-140-76"></a><span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.event_name == &#39;pull_request&#39; || github.event_name == &#39;push&#39; || github.event_name == &#39;workflow_dispatch&#39;</span>
</span><span id="__span-140-77"><a id="__codelineno-140-77" name="__codelineno-140-77" href="#__codelineno-140-77"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
</span><span id="__span-140-78"><a id="__codelineno-140-78" name="__codelineno-140-78" href="#__codelineno-140-78"></a>
</span><span id="__span-140-79"><a id="__codelineno-140-79" name="__codelineno-140-79" href="#__codelineno-140-79"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-140-80"><a id="__codelineno-140-80" name="__codelineno-140-80" href="#__codelineno-140-80"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-140-81"><a id="__codelineno-140-81" name="__codelineno-140-81" href="#__codelineno-140-81"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-140-82"><a id="__codelineno-140-82" name="__codelineno-140-82" href="#__codelineno-140-82"></a>
</span><span id="__span-140-83"><a id="__codelineno-140-83" name="__codelineno-140-83" href="#__codelineno-140-83"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS Credentials</span>
</span><span id="__span-140-84"><a id="__codelineno-140-84" name="__codelineno-140-84" href="#__codelineno-140-84"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v2</span>
</span><span id="__span-140-85"><a id="__codelineno-140-85" name="__codelineno-140-85" href="#__codelineno-140-85"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-140-86"><a id="__codelineno-140-86" name="__codelineno-140-86" href="#__codelineno-140-86"></a><span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/github-actions-role</span>
</span><span id="__span-140-87"><a id="__codelineno-140-87" name="__codelineno-140-87" href="#__codelineno-140-87"></a><span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
</span><span id="__span-140-88"><a id="__codelineno-140-88" name="__codelineno-140-88" href="#__codelineno-140-88"></a>
</span><span id="__span-140-89"><a id="__codelineno-140-89" name="__codelineno-140-89" href="#__codelineno-140-89"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
</span><span id="__span-140-90"><a id="__codelineno-140-90" name="__codelineno-140-90" href="#__codelineno-140-90"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v2</span>
</span><span id="__span-140-91"><a id="__codelineno-140-91" name="__codelineno-140-91" href="#__codelineno-140-91"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-140-92"><a id="__codelineno-140-92" name="__codelineno-140-92" href="#__codelineno-140-92"></a><span class="w">          </span><span class="nt">terraform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2.0</span>
</span><span id="__span-140-93"><a id="__codelineno-140-93" name="__codelineno-140-93" href="#__codelineno-140-93"></a>
</span><span id="__span-140-94"><a id="__codelineno-140-94" name="__codelineno-140-94" href="#__codelineno-140-94"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
</span><span id="__span-140-95"><a id="__codelineno-140-95" name="__codelineno-140-95" href="#__codelineno-140-95"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-140-96"><a id="__codelineno-140-96" name="__codelineno-140-96" href="#__codelineno-140-96"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform init -backend-config=&quot;bucket=${{ secrets.TF_STATE_BUCKET }}&quot; -backend-config=&quot;key=${{ secrets.TF_STATE_KEY }}&quot; -backend-config=&quot;region=us-east-1&quot;</span>
</span><span id="__span-140-97"><a id="__codelineno-140-97" name="__codelineno-140-97" href="#__codelineno-140-97"></a>
</span><span id="__span-140-98"><a id="__codelineno-140-98" name="__codelineno-140-98" href="#__codelineno-140-98"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Plan</span>
</span><span id="__span-140-99"><a id="__codelineno-140-99" name="__codelineno-140-99" href="#__codelineno-140-99"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-140-100"><a id="__codelineno-140-100" name="__codelineno-140-100" href="#__codelineno-140-100"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform plan -var=&quot;environment=dev&quot; -var=&quot;domain_name=${{ secrets.DOMAIN_NAME }}&quot; -out=tfplan</span>
</span><span id="__span-140-101"><a id="__codelineno-140-101" name="__codelineno-140-101" href="#__codelineno-140-101"></a>
</span><span id="__span-140-102"><a id="__codelineno-140-102" name="__codelineno-140-102" href="#__codelineno-140-102"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Comment Plan on PR</span>
</span><span id="__span-140-103"><a id="__codelineno-140-103" name="__codelineno-140-103" href="#__codelineno-140-103"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/github-script@v6</span>
</span><span id="__span-140-104"><a id="__codelineno-140-104" name="__codelineno-140-104" href="#__codelineno-140-104"></a><span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.event_name == &#39;pull_request&#39;</span>
</span><span id="__span-140-105"><a id="__codelineno-140-105" name="__codelineno-140-105" href="#__codelineno-140-105"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-140-106"><a id="__codelineno-140-106" name="__codelineno-140-106" href="#__codelineno-140-106"></a><span class="w">          </span><span class="nt">github-token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
</span><span id="__span-140-107"><a id="__codelineno-140-107" name="__codelineno-140-107" href="#__codelineno-140-107"></a><span class="w">          </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-140-108"><a id="__codelineno-140-108" name="__codelineno-140-108" href="#__codelineno-140-108"></a><span class="w">            </span><span class="no">const output = `#### Terraform Format and Style 🖌\`${{ steps.fmt.outcome }}\`</span>
</span><span id="__span-140-109"><a id="__codelineno-140-109" name="__codelineno-140-109" href="#__codelineno-140-109"></a><span class="w">            </span><span class="no">#### Terraform Plan 📖\`${{ steps.plan.outcome }}\`</span>
</span><span id="__span-140-110"><a id="__codelineno-140-110" name="__codelineno-140-110" href="#__codelineno-140-110"></a>
</span><span id="__span-140-111"><a id="__codelineno-140-111" name="__codelineno-140-111" href="#__codelineno-140-111"></a><span class="w">            </span><span class="no">&lt;details&gt;&lt;summary&gt;Show Plan&lt;/summary&gt;</span>
</span><span id="__span-140-112"><a id="__codelineno-140-112" name="__codelineno-140-112" href="#__codelineno-140-112"></a>
</span><span id="__span-140-113"><a id="__codelineno-140-113" name="__codelineno-140-113" href="#__codelineno-140-113"></a><span class="w">            </span><span class="no">\`\`\`terraform</span>
</span><span id="__span-140-114"><a id="__codelineno-140-114" name="__codelineno-140-114" href="#__codelineno-140-114"></a><span class="w">            </span><span class="no">${{ steps.plan.outputs.stdout }}</span>
</span><span id="__span-140-115"><a id="__codelineno-140-115" name="__codelineno-140-115" href="#__codelineno-140-115"></a><span class="w">            </span><span class="no">\`\`\`</span>
</span><span id="__span-140-116"><a id="__codelineno-140-116" name="__codelineno-140-116" href="#__codelineno-140-116"></a>
</span><span id="__span-140-117"><a id="__codelineno-140-117" name="__codelineno-140-117" href="#__codelineno-140-117"></a><span class="w">            </span><span class="no">&lt;/details&gt;`;</span>
</span><span id="__span-140-118"><a id="__codelineno-140-118" name="__codelineno-140-118" href="#__codelineno-140-118"></a><span class="w">            </span><span class="no">github.rest.issues.createComment({</span>
</span><span id="__span-140-119"><a id="__codelineno-140-119" name="__codelineno-140-119" href="#__codelineno-140-119"></a><span class="w">              </span><span class="no">issue_number: context.issue.number,</span>
</span><span id="__span-140-120"><a id="__codelineno-140-120" name="__codelineno-140-120" href="#__codelineno-140-120"></a><span class="w">              </span><span class="no">owner: context.repo.owner,</span>
</span><span id="__span-140-121"><a id="__codelineno-140-121" name="__codelineno-140-121" href="#__codelineno-140-121"></a><span class="w">              </span><span class="no">repo: context.repo.repo,</span>
</span><span id="__span-140-122"><a id="__codelineno-140-122" name="__codelineno-140-122" href="#__codelineno-140-122"></a><span class="w">              </span><span class="no">body: output</span>
</span><span id="__span-140-123"><a id="__codelineno-140-123" name="__codelineno-140-123" href="#__codelineno-140-123"></a><span class="w">            </span><span class="no">})</span>
</span><span id="__span-140-124"><a id="__codelineno-140-124" name="__codelineno-140-124" href="#__codelineno-140-124"></a>
</span><span id="__span-140-125"><a id="__codelineno-140-125" name="__codelineno-140-125" href="#__codelineno-140-125"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload Plan Artifact</span>
</span><span id="__span-140-126"><a id="__codelineno-140-126" name="__codelineno-140-126" href="#__codelineno-140-126"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/upload-artifact@v3</span>
</span><span id="__span-140-127"><a id="__codelineno-140-127" name="__codelineno-140-127" href="#__codelineno-140-127"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-140-128"><a id="__codelineno-140-128" name="__codelineno-140-128" href="#__codelineno-140-128"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tfplan</span>
</span><span id="__span-140-129"><a id="__codelineno-140-129" name="__codelineno-140-129" href="#__codelineno-140-129"></a><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/tfplan</span>
</span><span id="__span-140-130"><a id="__codelineno-140-130" name="__codelineno-140-130" href="#__codelineno-140-130"></a>
</span><span id="__span-140-131"><a id="__codelineno-140-131" name="__codelineno-140-131" href="#__codelineno-140-131"></a><span class="w">  </span><span class="nt">apply</span><span class="p">:</span>
</span><span id="__span-140-132"><a id="__codelineno-140-132" name="__codelineno-140-132" href="#__codelineno-140-132"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Terraform</span><span class="nv"> </span><span class="s">Apply&#39;</span>
</span><span id="__span-140-133"><a id="__codelineno-140-133" name="__codelineno-140-133" href="#__codelineno-140-133"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-140-134"><a id="__codelineno-140-134" name="__codelineno-140-134" href="#__codelineno-140-134"></a><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plan</span>
</span><span id="__span-140-135"><a id="__codelineno-140-135" name="__codelineno-140-135" href="#__codelineno-140-135"></a><span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.event_name == &#39;push&#39; &amp;&amp; github.ref == &#39;refs/heads/main&#39; || github.event_name == &#39;workflow_dispatch&#39;</span>
</span><span id="__span-140-136"><a id="__codelineno-140-136" name="__codelineno-140-136" href="#__codelineno-140-136"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
</span><span id="__span-140-137"><a id="__codelineno-140-137" name="__codelineno-140-137" href="#__codelineno-140-137"></a>
</span><span id="__span-140-138"><a id="__codelineno-140-138" name="__codelineno-140-138" href="#__codelineno-140-138"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-140-139"><a id="__codelineno-140-139" name="__codelineno-140-139" href="#__codelineno-140-139"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-140-140"><a id="__codelineno-140-140" name="__codelineno-140-140" href="#__codelineno-140-140"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-140-141"><a id="__codelineno-140-141" name="__codelineno-140-141" href="#__codelineno-140-141"></a>
</span><span id="__span-140-142"><a id="__codelineno-140-142" name="__codelineno-140-142" href="#__codelineno-140-142"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS Credentials</span>
</span><span id="__span-140-143"><a id="__codelineno-140-143" name="__codelineno-140-143" href="#__codelineno-140-143"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v2</span>
</span><span id="__span-140-144"><a id="__codelineno-140-144" name="__codelineno-140-144" href="#__codelineno-140-144"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-140-145"><a id="__codelineno-140-145" name="__codelineno-140-145" href="#__codelineno-140-145"></a><span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/github-actions-role</span>
</span><span id="__span-140-146"><a id="__codelineno-140-146" name="__codelineno-140-146" href="#__codelineno-140-146"></a><span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
</span><span id="__span-140-147"><a id="__codelineno-140-147" name="__codelineno-140-147" href="#__codelineno-140-147"></a>
</span><span id="__span-140-148"><a id="__codelineno-140-148" name="__codelineno-140-148" href="#__codelineno-140-148"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
</span><span id="__span-140-149"><a id="__codelineno-140-149" name="__codelineno-140-149" href="#__codelineno-140-149"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v2</span>
</span><span id="__span-140-150"><a id="__codelineno-140-150" name="__codelineno-140-150" href="#__codelineno-140-150"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-140-151"><a id="__codelineno-140-151" name="__codelineno-140-151" href="#__codelineno-140-151"></a><span class="w">          </span><span class="nt">terraform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2.0</span>
</span><span id="__span-140-152"><a id="__codelineno-140-152" name="__codelineno-140-152" href="#__codelineno-140-152"></a>
</span><span id="__span-140-153"><a id="__codelineno-140-153" name="__codelineno-140-153" href="#__codelineno-140-153"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
</span><span id="__span-140-154"><a id="__codelineno-140-154" name="__codelineno-140-154" href="#__codelineno-140-154"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-140-155"><a id="__codelineno-140-155" name="__codelineno-140-155" href="#__codelineno-140-155"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform init -backend-config=&quot;bucket=${{ secrets.TF_STATE_BUCKET }}&quot; -backend-config=&quot;key=${{ secrets.TF_STATE_KEY }}&quot; -backend-config=&quot;region=us-east-1&quot;</span>
</span><span id="__span-140-156"><a id="__codelineno-140-156" name="__codelineno-140-156" href="#__codelineno-140-156"></a>
</span><span id="__span-140-157"><a id="__codelineno-140-157" name="__codelineno-140-157" href="#__codelineno-140-157"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Download Plan Artifact</span>
</span><span id="__span-140-158"><a id="__codelineno-140-158" name="__codelineno-140-158" href="#__codelineno-140-158"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/download-artifact@v3</span>
</span><span id="__span-140-159"><a id="__codelineno-140-159" name="__codelineno-140-159" href="#__codelineno-140-159"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-140-160"><a id="__codelineno-140-160" name="__codelineno-140-160" href="#__codelineno-140-160"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tfplan</span>
</span><span id="__span-140-161"><a id="__codelineno-140-161" name="__codelineno-140-161" href="#__codelineno-140-161"></a><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-140-162"><a id="__codelineno-140-162" name="__codelineno-140-162" href="#__codelineno-140-162"></a>
</span><span id="__span-140-163"><a id="__codelineno-140-163" name="__codelineno-140-163" href="#__codelineno-140-163"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Apply</span>
</span><span id="__span-140-164"><a id="__codelineno-140-164" name="__codelineno-140-164" href="#__codelineno-140-164"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-140-165"><a id="__codelineno-140-165" name="__codelineno-140-165" href="#__codelineno-140-165"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform apply -auto-approve tfplan</span>
</span><span id="__span-140-166"><a id="__codelineno-140-166" name="__codelineno-140-166" href="#__codelineno-140-166"></a>
</span><span id="__span-140-167"><a id="__codelineno-140-167" name="__codelineno-140-167" href="#__codelineno-140-167"></a><span class="w">  </span><span class="nt">test-api</span><span class="p">:</span>
</span><span id="__span-140-168"><a id="__codelineno-140-168" name="__codelineno-140-168" href="#__codelineno-140-168"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Test</span><span class="nv"> </span><span class="s">API</span><span class="nv"> </span><span class="s">Deployment&#39;</span>
</span><span id="__span-140-169"><a id="__codelineno-140-169" name="__codelineno-140-169" href="#__codelineno-140-169"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-140-170"><a id="__codelineno-140-170" name="__codelineno-140-170" href="#__codelineno-140-170"></a><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apply</span>
</span><span id="__span-140-171"><a id="__codelineno-140-171" name="__codelineno-140-171" href="#__codelineno-140-171"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
</span><span id="__span-140-172"><a id="__codelineno-140-172" name="__codelineno-140-172" href="#__codelineno-140-172"></a>
</span><span id="__span-140-173"><a id="__codelineno-140-173" name="__codelineno-140-173" href="#__codelineno-140-173"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-140-174"><a id="__codelineno-140-174" name="__codelineno-140-174" href="#__codelineno-140-174"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-140-175"><a id="__codelineno-140-175" name="__codelineno-140-175" href="#__codelineno-140-175"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-140-176"><a id="__codelineno-140-176" name="__codelineno-140-176" href="#__codelineno-140-176"></a>
</span><span id="__span-140-177"><a id="__codelineno-140-177" name="__codelineno-140-177" href="#__codelineno-140-177"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS Credentials</span>
</span><span id="__span-140-178"><a id="__codelineno-140-178" name="__codelineno-140-178" href="#__codelineno-140-178"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v2</span>
</span><span id="__span-140-179"><a id="__codelineno-140-179" name="__codelineno-140-179" href="#__codelineno-140-179"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-140-180"><a id="__codelineno-140-180" name="__codelineno-140-180" href="#__codelineno-140-180"></a><span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/github-actions-role</span>
</span><span id="__span-140-181"><a id="__codelineno-140-181" name="__codelineno-140-181" href="#__codelineno-140-181"></a><span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
</span><span id="__span-140-182"><a id="__codelineno-140-182" name="__codelineno-140-182" href="#__codelineno-140-182"></a>
</span><span id="__span-140-183"><a id="__codelineno-140-183" name="__codelineno-140-183" href="#__codelineno-140-183"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Fetch API Endpoint</span>
</span><span id="__span-140-184"><a id="__codelineno-140-184" name="__codelineno-140-184" href="#__codelineno-140-184"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-140-185"><a id="__codelineno-140-185" name="__codelineno-140-185" href="#__codelineno-140-185"></a><span class="w">          </span><span class="no">API_ENDPOINT=$(aws cloudformation describe-stacks --stack-name resume-backend-dev --query &quot;Stacks[0].Outputs[?OutputKey==&#39;ApiEndpoint&#39;].OutputValue&quot; --output text)</span>
</span><span id="__span-140-186"><a id="__codelineno-140-186" name="__codelineno-140-186" href="#__codelineno-140-186"></a><span class="w">          </span><span class="no">echo &quot;API_ENDPOINT=$API_ENDPOINT&quot; &gt;&gt; $GITHUB_ENV</span>
</span><span id="__span-140-187"><a id="__codelineno-140-187" name="__codelineno-140-187" href="#__codelineno-140-187"></a>
</span><span id="__span-140-188"><a id="__codelineno-140-188" name="__codelineno-140-188" href="#__codelineno-140-188"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test API Response</span>
</span><span id="__span-140-189"><a id="__codelineno-140-189" name="__codelineno-140-189" href="#__codelineno-140-189"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-140-190"><a id="__codelineno-140-190" name="__codelineno-140-190" href="#__codelineno-140-190"></a><span class="w">          </span><span class="no">response=$(curl -s &quot;$API_ENDPOINT/count&quot;)</span>
</span><span id="__span-140-191"><a id="__codelineno-140-191" name="__codelineno-140-191" href="#__codelineno-140-191"></a><span class="w">          </span><span class="no">echo &quot;API Response: $response&quot;</span>
</span><span id="__span-140-192"><a id="__codelineno-140-192" name="__codelineno-140-192" href="#__codelineno-140-192"></a>
</span><span id="__span-140-193"><a id="__codelineno-140-193" name="__codelineno-140-193" href="#__codelineno-140-193"></a><span class="w">          </span><span class="no"># Check if the response contains a count field</span>
</span><span id="__span-140-194"><a id="__codelineno-140-194" name="__codelineno-140-194" href="#__codelineno-140-194"></a><span class="w">          </span><span class="no">echo $response | grep -q &#39;&quot;count&quot;:&#39;</span>
</span><span id="__span-140-195"><a id="__codelineno-140-195" name="__codelineno-140-195" href="#__codelineno-140-195"></a><span class="w">          </span><span class="no">if [ $? -eq 0 ]; then</span>
</span><span id="__span-140-196"><a id="__codelineno-140-196" name="__codelineno-140-196" href="#__codelineno-140-196"></a><span class="w">            </span><span class="no">echo &quot;API test successful&quot;</span>
</span><span id="__span-140-197"><a id="__codelineno-140-197" name="__codelineno-140-197" href="#__codelineno-140-197"></a><span class="w">          </span><span class="no">else</span>
</span><span id="__span-140-198"><a id="__codelineno-140-198" name="__codelineno-140-198" href="#__codelineno-140-198"></a><span class="w">            </span><span class="no">echo &quot;API test failed&quot;</span>
</span><span id="__span-140-199"><a id="__codelineno-140-199" name="__codelineno-140-199" href="#__codelineno-140-199"></a><span class="w">            </span><span class="no">exit 1</span>
</span><span id="__span-140-200"><a id="__codelineno-140-200" name="__codelineno-140-200" href="#__codelineno-140-200"></a><span class="w">          </span><span class="no">fi</span>
</span></code></pre></div>
<p>This workflow is more complex and includes:</p>
<ol>
<li>Running Python tests for the Lambda function</li>
<li>Validating Terraform syntax and formatting</li>
<li>Planning Terraform changes (with PR comments for review)</li>
<li>Applying Terraform changes to the environment</li>
<li>Testing the deployed API to ensure it's functioning</li>
</ol>
<h3 id="implementing-multi-environment-deployments"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#implementing-multi-environment-deployments">Implementing Multi-Environment Deployments 🌍</a></h3>
<p>One of the most valuable CI/CD patterns is deploying to multiple environments. Let's modify our backend workflow to support both development and production environments:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a><span class="c1"># Additional job for production deployment after dev is successful</span>
</span><span id="__span-141-2"><a id="__codelineno-141-2" name="__codelineno-141-2" href="#__codelineno-141-2"></a><span class="w">  </span><span class="nt">promote-to-prod</span><span class="p">:</span>
</span><span id="__span-141-3"><a id="__codelineno-141-3" name="__codelineno-141-3" href="#__codelineno-141-3"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Promote</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">Production&#39;</span>
</span><span id="__span-141-4"><a id="__codelineno-141-4" name="__codelineno-141-4" href="#__codelineno-141-4"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-141-5"><a id="__codelineno-141-5" name="__codelineno-141-5" href="#__codelineno-141-5"></a><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-api</span>
</span><span id="__span-141-6"><a id="__codelineno-141-6" name="__codelineno-141-6" href="#__codelineno-141-6"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-141-7"><a id="__codelineno-141-7" name="__codelineno-141-7" href="#__codelineno-141-7"></a><span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.event_name == &#39;workflow_dispatch&#39;</span>
</span><span id="__span-141-8"><a id="__codelineno-141-8" name="__codelineno-141-8" href="#__codelineno-141-8"></a>
</span><span id="__span-141-9"><a id="__codelineno-141-9" name="__codelineno-141-9" href="#__codelineno-141-9"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-141-10"><a id="__codelineno-141-10" name="__codelineno-141-10" href="#__codelineno-141-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-141-11"><a id="__codelineno-141-11" name="__codelineno-141-11" href="#__codelineno-141-11"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-141-12"><a id="__codelineno-141-12" name="__codelineno-141-12" href="#__codelineno-141-12"></a>
</span><span id="__span-141-13"><a id="__codelineno-141-13" name="__codelineno-141-13" href="#__codelineno-141-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS Credentials</span>
</span><span id="__span-141-14"><a id="__codelineno-141-14" name="__codelineno-141-14" href="#__codelineno-141-14"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v2</span>
</span><span id="__span-141-15"><a id="__codelineno-141-15" name="__codelineno-141-15" href="#__codelineno-141-15"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-141-16"><a id="__codelineno-141-16" name="__codelineno-141-16" href="#__codelineno-141-16"></a><span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/github-actions-role</span>
</span><span id="__span-141-17"><a id="__codelineno-141-17" name="__codelineno-141-17" href="#__codelineno-141-17"></a><span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
</span><span id="__span-141-18"><a id="__codelineno-141-18" name="__codelineno-141-18" href="#__codelineno-141-18"></a>
</span><span id="__span-141-19"><a id="__codelineno-141-19" name="__codelineno-141-19" href="#__codelineno-141-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
</span><span id="__span-141-20"><a id="__codelineno-141-20" name="__codelineno-141-20" href="#__codelineno-141-20"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v2</span>
</span><span id="__span-141-21"><a id="__codelineno-141-21" name="__codelineno-141-21" href="#__codelineno-141-21"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-141-22"><a id="__codelineno-141-22" name="__codelineno-141-22" href="#__codelineno-141-22"></a><span class="w">          </span><span class="nt">terraform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2.0</span>
</span><span id="__span-141-23"><a id="__codelineno-141-23" name="__codelineno-141-23" href="#__codelineno-141-23"></a>
</span><span id="__span-141-24"><a id="__codelineno-141-24" name="__codelineno-141-24" href="#__codelineno-141-24"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
</span><span id="__span-141-25"><a id="__codelineno-141-25" name="__codelineno-141-25" href="#__codelineno-141-25"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/environments/prod</span>
</span><span id="__span-141-26"><a id="__codelineno-141-26" name="__codelineno-141-26" href="#__codelineno-141-26"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform init -backend-config=&quot;bucket=${{ secrets.TF_STATE_BUCKET }}&quot; -backend-config=&quot;key=${{ secrets.TF_STATE_KEY_PROD }}&quot; -backend-config=&quot;region=us-east-1&quot;</span>
</span><span id="__span-141-27"><a id="__codelineno-141-27" name="__codelineno-141-27" href="#__codelineno-141-27"></a>
</span><span id="__span-141-28"><a id="__codelineno-141-28" name="__codelineno-141-28" href="#__codelineno-141-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Plan</span>
</span><span id="__span-141-29"><a id="__codelineno-141-29" name="__codelineno-141-29" href="#__codelineno-141-29"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/environments/prod</span>
</span><span id="__span-141-30"><a id="__codelineno-141-30" name="__codelineno-141-30" href="#__codelineno-141-30"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform plan -var=&quot;environment=prod&quot; -var=&quot;domain_name=${{ secrets.DOMAIN_NAME_PROD }}&quot; -out=tfplan</span>
</span><span id="__span-141-31"><a id="__codelineno-141-31" name="__codelineno-141-31" href="#__codelineno-141-31"></a>
</span><span id="__span-141-32"><a id="__codelineno-141-32" name="__codelineno-141-32" href="#__codelineno-141-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Apply</span>
</span><span id="__span-141-33"><a id="__codelineno-141-33" name="__codelineno-141-33" href="#__codelineno-141-33"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform/environments/prod</span>
</span><span id="__span-141-34"><a id="__codelineno-141-34" name="__codelineno-141-34" href="#__codelineno-141-34"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform apply -auto-approve tfplan</span>
</span><span id="__span-141-35"><a id="__codelineno-141-35" name="__codelineno-141-35" href="#__codelineno-141-35"></a>
</span><span id="__span-141-36"><a id="__codelineno-141-36" name="__codelineno-141-36" href="#__codelineno-141-36"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test Production API</span>
</span><span id="__span-141-37"><a id="__codelineno-141-37" name="__codelineno-141-37" href="#__codelineno-141-37"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-141-38"><a id="__codelineno-141-38" name="__codelineno-141-38" href="#__codelineno-141-38"></a><span class="w">          </span><span class="no">API_ENDPOINT=$(aws cloudformation describe-stacks --stack-name resume-backend-prod --query &quot;Stacks[0].Outputs[?OutputKey==&#39;ApiEndpoint&#39;].OutputValue&quot; --output text)</span>
</span><span id="__span-141-39"><a id="__codelineno-141-39" name="__codelineno-141-39" href="#__codelineno-141-39"></a><span class="w">          </span><span class="no">response=$(curl -s &quot;$API_ENDPOINT/count&quot;)</span>
</span><span id="__span-141-40"><a id="__codelineno-141-40" name="__codelineno-141-40" href="#__codelineno-141-40"></a><span class="w">          </span><span class="no">echo &quot;API Response: $response&quot;</span>
</span><span id="__span-141-41"><a id="__codelineno-141-41" name="__codelineno-141-41" href="#__codelineno-141-41"></a>
</span><span id="__span-141-42"><a id="__codelineno-141-42" name="__codelineno-141-42" href="#__codelineno-141-42"></a><span class="w">          </span><span class="no"># Check if the response contains a count field</span>
</span><span id="__span-141-43"><a id="__codelineno-141-43" name="__codelineno-141-43" href="#__codelineno-141-43"></a><span class="w">          </span><span class="no">echo $response | grep -q &#39;&quot;count&quot;:&#39;</span>
</span><span id="__span-141-44"><a id="__codelineno-141-44" name="__codelineno-141-44" href="#__codelineno-141-44"></a><span class="w">          </span><span class="no">if [ $? -eq 0 ]; then</span>
</span><span id="__span-141-45"><a id="__codelineno-141-45" name="__codelineno-141-45" href="#__codelineno-141-45"></a><span class="w">            </span><span class="no">echo &quot;Production API test successful&quot;</span>
</span><span id="__span-141-46"><a id="__codelineno-141-46" name="__codelineno-141-46" href="#__codelineno-141-46"></a><span class="w">          </span><span class="no">else</span>
</span><span id="__span-141-47"><a id="__codelineno-141-47" name="__codelineno-141-47" href="#__codelineno-141-47"></a><span class="w">            </span><span class="no">echo &quot;Production API test failed&quot;</span>
</span><span id="__span-141-48"><a id="__codelineno-141-48" name="__codelineno-141-48" href="#__codelineno-141-48"></a><span class="w">            </span><span class="no">exit 1</span>
</span><span id="__span-141-49"><a id="__codelineno-141-49" name="__codelineno-141-49" href="#__codelineno-141-49"></a><span class="w">          </span><span class="no">fi</span>
</span></code></pre></div>
<h4 id="terraform-structure-for-multiple-environments"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#terraform-structure-for-multiple-environments">Terraform Structure for Multiple Environments</a></h4>
<p>To support multiple environments, I've reorganized my Terraform configuration:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a>terraform/
</span><span id="__span-142-2"><a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a>├── modules/
</span><span id="__span-142-3"><a id="__codelineno-142-3" name="__codelineno-142-3" href="#__codelineno-142-3"></a>│   ├── backend/
</span><span id="__span-142-4"><a id="__codelineno-142-4" name="__codelineno-142-4" href="#__codelineno-142-4"></a>│   │   ├── api_gateway.tf
</span><span id="__span-142-5"><a id="__codelineno-142-5" name="__codelineno-142-5" href="#__codelineno-142-5"></a>│   │   ├── dynamodb.tf
</span><span id="__span-142-6"><a id="__codelineno-142-6" name="__codelineno-142-6" href="#__codelineno-142-6"></a>│   │   ├── lambda.tf
</span><span id="__span-142-7"><a id="__codelineno-142-7" name="__codelineno-142-7" href="#__codelineno-142-7"></a>│   │   ├── variables.tf
</span><span id="__span-142-8"><a id="__codelineno-142-8" name="__codelineno-142-8" href="#__codelineno-142-8"></a>│   │   └── outputs.tf
</span><span id="__span-142-9"><a id="__codelineno-142-9" name="__codelineno-142-9" href="#__codelineno-142-9"></a>├── environments/
</span><span id="__span-142-10"><a id="__codelineno-142-10" name="__codelineno-142-10" href="#__codelineno-142-10"></a>│   ├── dev/
</span><span id="__span-142-11"><a id="__codelineno-142-11" name="__codelineno-142-11" href="#__codelineno-142-11"></a>│   │   ├── main.tf
</span><span id="__span-142-12"><a id="__codelineno-142-12" name="__codelineno-142-12" href="#__codelineno-142-12"></a>│   │   ├── variables.tf
</span><span id="__span-142-13"><a id="__codelineno-142-13" name="__codelineno-142-13" href="#__codelineno-142-13"></a>│   │   └── outputs.tf
</span><span id="__span-142-14"><a id="__codelineno-142-14" name="__codelineno-142-14" href="#__codelineno-142-14"></a>│   └── prod/
</span><span id="__span-142-15"><a id="__codelineno-142-15" name="__codelineno-142-15" href="#__codelineno-142-15"></a>│       ├── main.tf
</span><span id="__span-142-16"><a id="__codelineno-142-16" name="__codelineno-142-16" href="#__codelineno-142-16"></a>│       ├── variables.tf
</span><span id="__span-142-17"><a id="__codelineno-142-17" name="__codelineno-142-17" href="#__codelineno-142-17"></a>│       └── outputs.tf
</span></code></pre></div>
<p>Each environment directory contains its own Terraform configuration that references the shared modules.</p>
<h3 id="implementing-github-security-best-practices"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#implementing-github-security-best-practices">Implementing GitHub Security Best Practices 🔒</a></h3>
<p>To enhance the security of our CI/CD pipelines, I've implemented several additional measures:</p>
<h4 id="1-supply-chain-security-with-dependabot"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#1-supply-chain-security-with-dependabot">1. Supply Chain Security with Dependabot</a></h4>
<p>Create a file at <code>.github/dependabot.yml</code> in both repositories:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-143-2"><a id="__codelineno-143-2" name="__codelineno-143-2" href="#__codelineno-143-2"></a><span class="nt">updates</span><span class="p">:</span>
</span><span id="__span-143-3"><a id="__codelineno-143-3" name="__codelineno-143-3" href="#__codelineno-143-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">package-ecosystem</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;github-actions&quot;</span>
</span><span id="__span-143-4"><a id="__codelineno-143-4" name="__codelineno-143-4" href="#__codelineno-143-4"></a><span class="w">    </span><span class="nt">directory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
</span><span id="__span-143-5"><a id="__codelineno-143-5" name="__codelineno-143-5" href="#__codelineno-143-5"></a><span class="w">    </span><span class="nt">schedule</span><span class="p">:</span>
</span><span id="__span-143-6"><a id="__codelineno-143-6" name="__codelineno-143-6" href="#__codelineno-143-6"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;weekly&quot;</span>
</span><span id="__span-143-7"><a id="__codelineno-143-7" name="__codelineno-143-7" href="#__codelineno-143-7"></a><span class="w">    </span><span class="nt">open-pull-requests-limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span><span id="__span-143-8"><a id="__codelineno-143-8" name="__codelineno-143-8" href="#__codelineno-143-8"></a>
</span><span id="__span-143-9"><a id="__codelineno-143-9" name="__codelineno-143-9" href="#__codelineno-143-9"></a><span class="w">  </span><span class="c1"># For frontend</span>
</span><span id="__span-143-10"><a id="__codelineno-143-10" name="__codelineno-143-10" href="#__codelineno-143-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">package-ecosystem</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;npm&quot;</span>
</span><span id="__span-143-11"><a id="__codelineno-143-11" name="__codelineno-143-11" href="#__codelineno-143-11"></a><span class="w">    </span><span class="nt">directory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
</span><span id="__span-143-12"><a id="__codelineno-143-12" name="__codelineno-143-12" href="#__codelineno-143-12"></a><span class="w">    </span><span class="nt">schedule</span><span class="p">:</span>
</span><span id="__span-143-13"><a id="__codelineno-143-13" name="__codelineno-143-13" href="#__codelineno-143-13"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;weekly&quot;</span>
</span><span id="__span-143-14"><a id="__codelineno-143-14" name="__codelineno-143-14" href="#__codelineno-143-14"></a><span class="w">    </span><span class="nt">open-pull-requests-limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span><span id="__span-143-15"><a id="__codelineno-143-15" name="__codelineno-143-15" href="#__codelineno-143-15"></a>
</span><span id="__span-143-16"><a id="__codelineno-143-16" name="__codelineno-143-16" href="#__codelineno-143-16"></a><span class="w">  </span><span class="c1"># For backend</span>
</span><span id="__span-143-17"><a id="__codelineno-143-17" name="__codelineno-143-17" href="#__codelineno-143-17"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">package-ecosystem</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pip&quot;</span>
</span><span id="__span-143-18"><a id="__codelineno-143-18" name="__codelineno-143-18" href="#__codelineno-143-18"></a><span class="w">    </span><span class="nt">directory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
</span><span id="__span-143-19"><a id="__codelineno-143-19" name="__codelineno-143-19" href="#__codelineno-143-19"></a><span class="w">    </span><span class="nt">schedule</span><span class="p">:</span>
</span><span id="__span-143-20"><a id="__codelineno-143-20" name="__codelineno-143-20" href="#__codelineno-143-20"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;weekly&quot;</span>
</span><span id="__span-143-21"><a id="__codelineno-143-21" name="__codelineno-143-21" href="#__codelineno-143-21"></a><span class="w">    </span><span class="nt">open-pull-requests-limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span></code></pre></div>
<p>This configuration automatically updates dependencies and identifies security vulnerabilities.</p>
<h4 id="2-code-scanning-with-codeql"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#2-code-scanning-with-codeql">2. Code Scanning with CodeQL</a></h4>
<p>Create a file at <code>.github/workflows/codeql.yml</code> in the backend repository:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CodeQL&quot;</span>
</span><span id="__span-144-2"><a id="__codelineno-144-2" name="__codelineno-144-2" href="#__codelineno-144-2"></a>
</span><span id="__span-144-3"><a id="__codelineno-144-3" name="__codelineno-144-3" href="#__codelineno-144-3"></a><span class="nt">on</span><span class="p">:</span>
</span><span id="__span-144-4"><a id="__codelineno-144-4" name="__codelineno-144-4" href="#__codelineno-144-4"></a><span class="w">  </span><span class="nt">push</span><span class="p">:</span>
</span><span id="__span-144-5"><a id="__codelineno-144-5" name="__codelineno-144-5" href="#__codelineno-144-5"></a><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">main</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span><span id="__span-144-6"><a id="__codelineno-144-6" name="__codelineno-144-6" href="#__codelineno-144-6"></a><span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
</span><span id="__span-144-7"><a id="__codelineno-144-7" name="__codelineno-144-7" href="#__codelineno-144-7"></a><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">main</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span><span id="__span-144-8"><a id="__codelineno-144-8" name="__codelineno-144-8" href="#__codelineno-144-8"></a><span class="w">  </span><span class="nt">schedule</span><span class="p">:</span>
</span><span id="__span-144-9"><a id="__codelineno-144-9" name="__codelineno-144-9" href="#__codelineno-144-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cron</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">0&#39;</span><span class="w">  </span><span class="c1"># Run weekly</span>
</span><span id="__span-144-10"><a id="__codelineno-144-10" name="__codelineno-144-10" href="#__codelineno-144-10"></a>
</span><span id="__span-144-11"><a id="__codelineno-144-11" name="__codelineno-144-11" href="#__codelineno-144-11"></a><span class="nt">jobs</span><span class="p">:</span>
</span><span id="__span-144-12"><a id="__codelineno-144-12" name="__codelineno-144-12" href="#__codelineno-144-12"></a><span class="w">  </span><span class="nt">analyze</span><span class="p">:</span>
</span><span id="__span-144-13"><a id="__codelineno-144-13" name="__codelineno-144-13" href="#__codelineno-144-13"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Analyze</span>
</span><span id="__span-144-14"><a id="__codelineno-144-14" name="__codelineno-144-14" href="#__codelineno-144-14"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-144-15"><a id="__codelineno-144-15" name="__codelineno-144-15" href="#__codelineno-144-15"></a><span class="w">    </span><span class="nt">permissions</span><span class="p">:</span>
</span><span id="__span-144-16"><a id="__codelineno-144-16" name="__codelineno-144-16" href="#__codelineno-144-16"></a><span class="w">      </span><span class="nt">actions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id="__span-144-17"><a id="__codelineno-144-17" name="__codelineno-144-17" href="#__codelineno-144-17"></a><span class="w">      </span><span class="nt">contents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">read</span>
</span><span id="__span-144-18"><a id="__codelineno-144-18" name="__codelineno-144-18" href="#__codelineno-144-18"></a><span class="w">      </span><span class="nt">security-events</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id="__span-144-19"><a id="__codelineno-144-19" name="__codelineno-144-19" href="#__codelineno-144-19"></a>
</span><span id="__span-144-20"><a id="__codelineno-144-20" name="__codelineno-144-20" href="#__codelineno-144-20"></a><span class="w">    </span><span class="nt">strategy</span><span class="p">:</span>
</span><span id="__span-144-21"><a id="__codelineno-144-21" name="__codelineno-144-21" href="#__codelineno-144-21"></a><span class="w">      </span><span class="nt">fail-fast</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-144-22"><a id="__codelineno-144-22" name="__codelineno-144-22" href="#__codelineno-144-22"></a><span class="w">      </span><span class="nt">matrix</span><span class="p">:</span>
</span><span id="__span-144-23"><a id="__codelineno-144-23" name="__codelineno-144-23" href="#__codelineno-144-23"></a><span class="w">        </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&#39;python&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;javascript&#39;</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span><span id="__span-144-24"><a id="__codelineno-144-24" name="__codelineno-144-24" href="#__codelineno-144-24"></a>
</span><span id="__span-144-25"><a id="__codelineno-144-25" name="__codelineno-144-25" href="#__codelineno-144-25"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-144-26"><a id="__codelineno-144-26" name="__codelineno-144-26" href="#__codelineno-144-26"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout repository</span>
</span><span id="__span-144-27"><a id="__codelineno-144-27" name="__codelineno-144-27" href="#__codelineno-144-27"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-144-28"><a id="__codelineno-144-28" name="__codelineno-144-28" href="#__codelineno-144-28"></a>
</span><span id="__span-144-29"><a id="__codelineno-144-29" name="__codelineno-144-29" href="#__codelineno-144-29"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Initialize CodeQL</span>
</span><span id="__span-144-30"><a id="__codelineno-144-30" name="__codelineno-144-30" href="#__codelineno-144-30"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github/codeql-action/init@v2</span>
</span><span id="__span-144-31"><a id="__codelineno-144-31" name="__codelineno-144-31" href="#__codelineno-144-31"></a><span class="w">      </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-144-32"><a id="__codelineno-144-32" name="__codelineno-144-32" href="#__codelineno-144-32"></a><span class="w">        </span><span class="nt">languages</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ matrix.language }}</span>
</span><span id="__span-144-33"><a id="__codelineno-144-33" name="__codelineno-144-33" href="#__codelineno-144-33"></a>
</span><span id="__span-144-34"><a id="__codelineno-144-34" name="__codelineno-144-34" href="#__codelineno-144-34"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Perform CodeQL Analysis</span>
</span><span id="__span-144-35"><a id="__codelineno-144-35" name="__codelineno-144-35" href="#__codelineno-144-35"></a><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github/codeql-action/analyze@v2</span>
</span></code></pre></div>
<p>This workflow scans our code for security vulnerabilities and coding problems.</p>
<h4 id="3-branch-protection-rules"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#3-branch-protection-rules">3. Branch Protection Rules</a></h4>
<p>I've set up branch protection rules for the <code>main</code> branch in both repositories:</p>
<ul>
<li>Require pull request reviews before merging</li>
<li>Require status checks to pass before merging</li>
<li>Require signed commits</li>
<li>Do not allow bypassing the above settings</li>
</ul>
<h3 id="adding-verification-tests-to-the-workflow"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#adding-verification-tests-to-the-workflow">Adding Verification Tests to the Workflow 🧪</a></h3>
<p>In addition to unit tests, I've added end-to-end integration tests to verify that the frontend and backend work together correctly:</p>
<h4 id="1-frontend-backend-integration-test"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#1-frontend-backend-integration-test">1. Frontend-Backend Integration Test</a></h4>
<p>Create a file at <code>tests/integration-test.js</code> in the frontend repository:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">axios</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;axios&#39;</span><span class="p">);</span>
</span><span id="__span-145-2"><a id="__codelineno-145-2" name="__codelineno-145-2" href="#__codelineno-145-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">assert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;assert&#39;</span><span class="p">);</span>
</span><span id="__span-145-3"><a id="__codelineno-145-3" name="__codelineno-145-3" href="#__codelineno-145-3"></a>
</span><span id="__span-145-4"><a id="__codelineno-145-4" name="__codelineno-145-4" href="#__codelineno-145-4"></a><span class="c1">// URLs to test - these should be passed as environment variables</span>
</span><span id="__span-145-5"><a id="__codelineno-145-5" name="__codelineno-145-5" href="#__codelineno-145-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">WEBSITE_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">WEBSITE_URL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;https://resume.yourdomain.com&#39;</span><span class="p">;</span>
</span><span id="__span-145-6"><a id="__codelineno-145-6" name="__codelineno-145-6" href="#__codelineno-145-6"></a><span class="kd">const</span><span class="w"> </span><span class="nx">API_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">API_URL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;https://api.yourdomain.com/count&#39;</span><span class="p">;</span>
</span><span id="__span-145-7"><a id="__codelineno-145-7" name="__codelineno-145-7" href="#__codelineno-145-7"></a>
</span><span id="__span-145-8"><a id="__codelineno-145-8" name="__codelineno-145-8" href="#__codelineno-145-8"></a><span class="c1">// Test that the API returns a valid response</span>
</span><span id="__span-145-9"><a id="__codelineno-145-9" name="__codelineno-145-9" href="#__codelineno-145-9"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">testAPI</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-145-10"><a id="__codelineno-145-10" name="__codelineno-145-10" href="#__codelineno-145-10"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-145-11"><a id="__codelineno-145-11" name="__codelineno-145-11" href="#__codelineno-145-11"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Testing API at </span><span class="si">${</span><span class="nx">API_URL</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-145-12"><a id="__codelineno-145-12" name="__codelineno-145-12" href="#__codelineno-145-12"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">API_URL</span><span class="p">);</span>
</span><span id="__span-145-13"><a id="__codelineno-145-13" name="__codelineno-145-13" href="#__codelineno-145-13"></a>
</span><span id="__span-145-14"><a id="__codelineno-145-14" name="__codelineno-145-14" href="#__codelineno-145-14"></a><span class="w">    </span><span class="c1">// Verify the API response contains a count</span>
</span><span id="__span-145-15"><a id="__codelineno-145-15" name="__codelineno-145-15" href="#__codelineno-145-15"></a><span class="w">    </span><span class="nx">assert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="sb">`API returned status </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-145-16"><a id="__codelineno-145-16" name="__codelineno-145-16" href="#__codelineno-145-16"></a><span class="w">    </span><span class="nx">assert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;API response missing count field&#39;</span><span class="p">);</span>
</span><span id="__span-145-17"><a id="__codelineno-145-17" name="__codelineno-145-17" href="#__codelineno-145-17"></a><span class="w">    </span><span class="nx">assert</span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Count is not a number&#39;</span><span class="p">);</span>
</span><span id="__span-145-18"><a id="__codelineno-145-18" name="__codelineno-145-18" href="#__codelineno-145-18"></a>
</span><span id="__span-145-19"><a id="__codelineno-145-19" name="__codelineno-145-19" href="#__codelineno-145-19"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`API test successful. Count: </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">count</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-145-20"><a id="__codelineno-145-20" name="__codelineno-145-20" href="#__codelineno-145-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-145-21"><a id="__codelineno-145-21" name="__codelineno-145-21" href="#__codelineno-145-21"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-145-22"><a id="__codelineno-145-22" name="__codelineno-145-22" href="#__codelineno-145-22"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;API test failed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span><span id="__span-145-23"><a id="__codelineno-145-23" name="__codelineno-145-23" href="#__codelineno-145-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-145-24"><a id="__codelineno-145-24" name="__codelineno-145-24" href="#__codelineno-145-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-145-25"><a id="__codelineno-145-25" name="__codelineno-145-25" href="#__codelineno-145-25"></a><span class="p">}</span>
</span><span id="__span-145-26"><a id="__codelineno-145-26" name="__codelineno-145-26" href="#__codelineno-145-26"></a>
</span><span id="__span-145-27"><a id="__codelineno-145-27" name="__codelineno-145-27" href="#__codelineno-145-27"></a><span class="c1">// Test that the website loads and contains necessary elements</span>
</span><span id="__span-145-28"><a id="__codelineno-145-28" name="__codelineno-145-28" href="#__codelineno-145-28"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">testWebsite</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-145-29"><a id="__codelineno-145-29" name="__codelineno-145-29" href="#__codelineno-145-29"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-145-30"><a id="__codelineno-145-30" name="__codelineno-145-30" href="#__codelineno-145-30"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Testing website at </span><span class="si">${</span><span class="nx">WEBSITE_URL</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-145-31"><a id="__codelineno-145-31" name="__codelineno-145-31" href="#__codelineno-145-31"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">WEBSITE_URL</span><span class="p">);</span>
</span><span id="__span-145-32"><a id="__codelineno-145-32" name="__codelineno-145-32" href="#__codelineno-145-32"></a>
</span><span id="__span-145-33"><a id="__codelineno-145-33" name="__codelineno-145-33" href="#__codelineno-145-33"></a><span class="w">    </span><span class="c1">// Verify the website loads</span>
</span><span id="__span-145-34"><a id="__codelineno-145-34" name="__codelineno-145-34" href="#__codelineno-145-34"></a><span class="w">    </span><span class="nx">assert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="sb">`Website returned status </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-145-35"><a id="__codelineno-145-35" name="__codelineno-145-35" href="#__codelineno-145-35"></a>
</span><span id="__span-145-36"><a id="__codelineno-145-36" name="__codelineno-145-36" href="#__codelineno-145-36"></a><span class="w">    </span><span class="c1">// Check that the page contains some expected content</span>
</span><span id="__span-145-37"><a id="__codelineno-145-37" name="__codelineno-145-37" href="#__codelineno-145-37"></a><span class="w">    </span><span class="nx">assert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;&lt;html&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Response is not HTML&#39;</span><span class="p">);</span>
</span><span id="__span-145-38"><a id="__codelineno-145-38" name="__codelineno-145-38" href="#__codelineno-145-38"></a><span class="w">    </span><span class="nx">assert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;id=&quot;count&quot;&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Counter element not found&#39;</span><span class="p">);</span>
</span><span id="__span-145-39"><a id="__codelineno-145-39" name="__codelineno-145-39" href="#__codelineno-145-39"></a>
</span><span id="__span-145-40"><a id="__codelineno-145-40" name="__codelineno-145-40" href="#__codelineno-145-40"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Website test successful&#39;</span><span class="p">);</span>
</span><span id="__span-145-41"><a id="__codelineno-145-41" name="__codelineno-145-41" href="#__codelineno-145-41"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-145-42"><a id="__codelineno-145-42" name="__codelineno-145-42" href="#__codelineno-145-42"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-145-43"><a id="__codelineno-145-43" name="__codelineno-145-43" href="#__codelineno-145-43"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Website test failed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span><span id="__span-145-44"><a id="__codelineno-145-44" name="__codelineno-145-44" href="#__codelineno-145-44"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-145-45"><a id="__codelineno-145-45" name="__codelineno-145-45" href="#__codelineno-145-45"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-145-46"><a id="__codelineno-145-46" name="__codelineno-145-46" href="#__codelineno-145-46"></a><span class="p">}</span>
</span><span id="__span-145-47"><a id="__codelineno-145-47" name="__codelineno-145-47" href="#__codelineno-145-47"></a>
</span><span id="__span-145-48"><a id="__codelineno-145-48" name="__codelineno-145-48" href="#__codelineno-145-48"></a><span class="c1">// Run all tests</span>
</span><span id="__span-145-49"><a id="__codelineno-145-49" name="__codelineno-145-49" href="#__codelineno-145-49"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">runTests</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-145-50"><a id="__codelineno-145-50" name="__codelineno-145-50" href="#__codelineno-145-50"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">apiResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">testAPI</span><span class="p">();</span>
</span><span id="__span-145-51"><a id="__codelineno-145-51" name="__codelineno-145-51" href="#__codelineno-145-51"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">websiteResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">testWebsite</span><span class="p">();</span>
</span><span id="__span-145-52"><a id="__codelineno-145-52" name="__codelineno-145-52" href="#__codelineno-145-52"></a>
</span><span id="__span-145-53"><a id="__codelineno-145-53" name="__codelineno-145-53" href="#__codelineno-145-53"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">apiResult</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">websiteResult</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-145-54"><a id="__codelineno-145-54" name="__codelineno-145-54" href="#__codelineno-145-54"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;All integration tests passed!&#39;</span><span class="p">);</span>
</span><span id="__span-145-55"><a id="__codelineno-145-55" name="__codelineno-145-55" href="#__codelineno-145-55"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-145-56"><a id="__codelineno-145-56" name="__codelineno-145-56" href="#__codelineno-145-56"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-145-57"><a id="__codelineno-145-57" name="__codelineno-145-57" href="#__codelineno-145-57"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Some integration tests failed&#39;</span><span class="p">);</span>
</span><span id="__span-145-58"><a id="__codelineno-145-58" name="__codelineno-145-58" href="#__codelineno-145-58"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-145-59"><a id="__codelineno-145-59" name="__codelineno-145-59" href="#__codelineno-145-59"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-145-60"><a id="__codelineno-145-60" name="__codelineno-145-60" href="#__codelineno-145-60"></a><span class="p">}</span>
</span><span id="__span-145-61"><a id="__codelineno-145-61" name="__codelineno-145-61" href="#__codelineno-145-61"></a>
</span><span id="__span-145-62"><a id="__codelineno-145-62" name="__codelineno-145-62" href="#__codelineno-145-62"></a><span class="c1">// Run the tests</span>
</span><span id="__span-145-63"><a id="__codelineno-145-63" name="__codelineno-145-63" href="#__codelineno-145-63"></a><span class="nx">runTests</span><span class="p">();</span>
</span></code></pre></div>
<p>Then add a step to the workflow:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Integration Tests</span>
</span><span id="__span-146-2"><a id="__codelineno-146-2" name="__codelineno-146-2" href="#__codelineno-146-2"></a><span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-146-3"><a id="__codelineno-146-3" name="__codelineno-146-3" href="#__codelineno-146-3"></a><span class="w">    </span><span class="no">npm install axios</span>
</span><span id="__span-146-4"><a id="__codelineno-146-4" name="__codelineno-146-4" href="#__codelineno-146-4"></a><span class="w">    </span><span class="no">node tests/integration-test.js</span>
</span><span id="__span-146-5"><a id="__codelineno-146-5" name="__codelineno-146-5" href="#__codelineno-146-5"></a><span class="w">  </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-146-6"><a id="__codelineno-146-6" name="__codelineno-146-6" href="#__codelineno-146-6"></a><span class="w">    </span><span class="nt">WEBSITE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.WEBSITE_URL }}</span>
</span><span id="__span-146-7"><a id="__codelineno-146-7" name="__codelineno-146-7" href="#__codelineno-146-7"></a><span class="w">    </span><span class="nt">API_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.API_URL }}</span>
</span></code></pre></div>
<h3 id="implementing-secure-github-action-secrets"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#implementing-secure-github-action-secrets">Implementing Secure GitHub Action Secrets 🔐</a></h3>
<p>For our GitHub Actions workflows, I've set up the following repository secrets:</p>
<ul>
<li><code>AWS_ACCOUNT_ID</code>: The AWS account ID used for OIDC authentication</li>
<li><code>S3_BUCKET_NAME</code>: The name of the S3 bucket for the website</li>
<li><code>CLOUDFRONT_DISTRIBUTION_ID</code>: The ID of the CloudFront distribution</li>
<li><code>WEBSITE_URL</code>: The URL of the deployed website</li>
<li><code>API_URL</code>: The URL of the deployed API</li>
<li><code>TF_STATE_BUCKET</code>: The bucket for Terraform state</li>
<li><code>TF_STATE_KEY</code>: The key for Terraform state (dev)</li>
<li><code>TF_STATE_KEY_PROD</code>: The key for Terraform state (prod)</li>
<li><code>DOMAIN_NAME</code>: The domain name for the dev environment</li>
<li><code>DOMAIN_NAME_PROD</code>: The domain name for the prod environment</li>
</ul>
<p>These secrets are protected by GitHub and only exposed to authorized workflow runs.</p>
<h3 id="managing-manual-approvals-for-production-deployments"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#managing-manual-approvals-for-production-deployments">Managing Manual Approvals for Production Deployments 🚦</a></h3>
<p>For production deployments, I've added a manual approval step using GitHub Environments:</p>
<ol>
<li>Go to your repository settings</li>
<li>Navigate to Environments</li>
<li>Create a new environment called "production"</li>
<li>Enable "Required reviewers" and add yourself</li>
<li>Configure "Deployment branches" to limit deployments to specific branches</li>
</ol>
<p>Now, production deployments will require explicit approval from an authorized reviewer.</p>
<h3 id="monitoring-deployment-status-and-notifications"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#monitoring-deployment-status-and-notifications">Monitoring Deployment Status and Notifications 📊</a></h3>
<p>To stay informed about deployment status, I've added notifications to the workflow:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Notify Deployment Success</span>
</span><span id="__span-147-2"><a id="__codelineno-147-2" name="__codelineno-147-2" href="#__codelineno-147-2"></a><span class="w">  </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">success()</span>
</span><span id="__span-147-3"><a id="__codelineno-147-3" name="__codelineno-147-3" href="#__codelineno-147-3"></a><span class="w">  </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rtCamp/action-slack-notify@v2</span>
</span><span id="__span-147-4"><a id="__codelineno-147-4" name="__codelineno-147-4" href="#__codelineno-147-4"></a><span class="w">  </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-147-5"><a id="__codelineno-147-5" name="__codelineno-147-5" href="#__codelineno-147-5"></a><span class="w">    </span><span class="nt">SLACK_WEBHOOK</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SLACK_WEBHOOK }}</span>
</span><span id="__span-147-6"><a id="__codelineno-147-6" name="__codelineno-147-6" href="#__codelineno-147-6"></a><span class="w">    </span><span class="nt">SLACK_TITLE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment Successful</span>
</span><span id="__span-147-7"><a id="__codelineno-147-7" name="__codelineno-147-7" href="#__codelineno-147-7"></a><span class="w">    </span><span class="nt">SLACK_MESSAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;✅</span><span class="nv"> </span><span class="s">Deployment</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">${{</span><span class="nv"> </span><span class="s">github.workflow</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">was</span><span class="nv"> </span><span class="s">successful!&quot;</span>
</span><span id="__span-147-8"><a id="__codelineno-147-8" name="__codelineno-147-8" href="#__codelineno-147-8"></a><span class="w">    </span><span class="nt">SLACK_COLOR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">good</span>
</span><span id="__span-147-9"><a id="__codelineno-147-9" name="__codelineno-147-9" href="#__codelineno-147-9"></a>
</span><span id="__span-147-10"><a id="__codelineno-147-10" name="__codelineno-147-10" href="#__codelineno-147-10"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Notify Deployment Failure</span>
</span><span id="__span-147-11"><a id="__codelineno-147-11" name="__codelineno-147-11" href="#__codelineno-147-11"></a><span class="w">  </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">failure()</span>
</span><span id="__span-147-12"><a id="__codelineno-147-12" name="__codelineno-147-12" href="#__codelineno-147-12"></a><span class="w">  </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rtCamp/action-slack-notify@v2</span>
</span><span id="__span-147-13"><a id="__codelineno-147-13" name="__codelineno-147-13" href="#__codelineno-147-13"></a><span class="w">  </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-147-14"><a id="__codelineno-147-14" name="__codelineno-147-14" href="#__codelineno-147-14"></a><span class="w">    </span><span class="nt">SLACK_WEBHOOK</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SLACK_WEBHOOK }}</span>
</span><span id="__span-147-15"><a id="__codelineno-147-15" name="__codelineno-147-15" href="#__codelineno-147-15"></a><span class="w">    </span><span class="nt">SLACK_TITLE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment Failed</span>
</span><span id="__span-147-16"><a id="__codelineno-147-16" name="__codelineno-147-16" href="#__codelineno-147-16"></a><span class="w">    </span><span class="nt">SLACK_MESSAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;❌</span><span class="nv"> </span><span class="s">Deployment</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">${{</span><span class="nv"> </span><span class="s">github.workflow</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">failed!&quot;</span>
</span><span id="__span-147-17"><a id="__codelineno-147-17" name="__codelineno-147-17" href="#__codelineno-147-17"></a><span class="w">    </span><span class="nt">SLACK_COLOR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">danger</span>
</span></code></pre></div>
<p>This sends notifications to a Slack channel when deployments succeed or fail.</p>
<h3 id="implementing-additional-security-for-aws-cloudfront"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#implementing-additional-security-for-aws-cloudfront">Implementing Additional Security for AWS CloudFront 🔒</a></h3>
<p>To enhance the security of our CloudFront distribution, I've added a custom response headers policy:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-148-1"><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudfront_response_headers_policy&quot;</span><span class="w"> </span><span class="nv">&quot;security_headers&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-148-2"><a id="__codelineno-148-2" name="__codelineno-148-2" href="#__codelineno-148-2"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;security-headers-policy&quot;</span>
</span><span id="__span-148-3"><a id="__codelineno-148-3" name="__codelineno-148-3" href="#__codelineno-148-3"></a>
</span><span id="__span-148-4"><a id="__codelineno-148-4" name="__codelineno-148-4" href="#__codelineno-148-4"></a><span class="w">  </span><span class="nb">security_headers_config</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-148-5"><a id="__codelineno-148-5" name="__codelineno-148-5" href="#__codelineno-148-5"></a><span class="w">    </span><span class="nb">content_security_policy</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-148-6"><a id="__codelineno-148-6" name="__codelineno-148-6" href="#__codelineno-148-6"></a><span class="w">      </span><span class="na">content_security_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;default-src &#39;self&#39;; img-src &#39;self&#39;; script-src &#39;self&#39;; style-src &#39;self&#39;; object-src &#39;none&#39;;&quot;</span>
</span><span id="__span-148-7"><a id="__codelineno-148-7" name="__codelineno-148-7" href="#__codelineno-148-7"></a><span class="w">      </span><span class="na">override</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-148-8"><a id="__codelineno-148-8" name="__codelineno-148-8" href="#__codelineno-148-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-148-9"><a id="__codelineno-148-9" name="__codelineno-148-9" href="#__codelineno-148-9"></a>
</span><span id="__span-148-10"><a id="__codelineno-148-10" name="__codelineno-148-10" href="#__codelineno-148-10"></a><span class="w">    </span><span class="nb">content_type_options</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-148-11"><a id="__codelineno-148-11" name="__codelineno-148-11" href="#__codelineno-148-11"></a><span class="w">      </span><span class="na">override</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-148-12"><a id="__codelineno-148-12" name="__codelineno-148-12" href="#__codelineno-148-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-148-13"><a id="__codelineno-148-13" name="__codelineno-148-13" href="#__codelineno-148-13"></a>
</span><span id="__span-148-14"><a id="__codelineno-148-14" name="__codelineno-148-14" href="#__codelineno-148-14"></a><span class="w">    </span><span class="nb">frame_options</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-148-15"><a id="__codelineno-148-15" name="__codelineno-148-15" href="#__codelineno-148-15"></a><span class="w">      </span><span class="na">frame_option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DENY&quot;</span>
</span><span id="__span-148-16"><a id="__codelineno-148-16" name="__codelineno-148-16" href="#__codelineno-148-16"></a><span class="w">      </span><span class="na">override</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-148-17"><a id="__codelineno-148-17" name="__codelineno-148-17" href="#__codelineno-148-17"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-148-18"><a id="__codelineno-148-18" name="__codelineno-148-18" href="#__codelineno-148-18"></a>
</span><span id="__span-148-19"><a id="__codelineno-148-19" name="__codelineno-148-19" href="#__codelineno-148-19"></a><span class="w">    </span><span class="nb">referrer_policy</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-148-20"><a id="__codelineno-148-20" name="__codelineno-148-20" href="#__codelineno-148-20"></a><span class="w">      </span><span class="na">referrer_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;same-origin&quot;</span>
</span><span id="__span-148-21"><a id="__codelineno-148-21" name="__codelineno-148-21" href="#__codelineno-148-21"></a><span class="w">      </span><span class="na">override</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-148-22"><a id="__codelineno-148-22" name="__codelineno-148-22" href="#__codelineno-148-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-148-23"><a id="__codelineno-148-23" name="__codelineno-148-23" href="#__codelineno-148-23"></a>
</span><span id="__span-148-24"><a id="__codelineno-148-24" name="__codelineno-148-24" href="#__codelineno-148-24"></a><span class="w">    </span><span class="nb">strict_transport_security</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-148-25"><a id="__codelineno-148-25" name="__codelineno-148-25" href="#__codelineno-148-25"></a><span class="w">      </span><span class="na">access_control_max_age_sec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">31536000</span>
</span><span id="__span-148-26"><a id="__codelineno-148-26" name="__codelineno-148-26" href="#__codelineno-148-26"></a><span class="w">      </span><span class="na">include_subdomains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-148-27"><a id="__codelineno-148-27" name="__codelineno-148-27" href="#__codelineno-148-27"></a><span class="w">      </span><span class="na">preload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-148-28"><a id="__codelineno-148-28" name="__codelineno-148-28" href="#__codelineno-148-28"></a><span class="w">      </span><span class="na">override</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-148-29"><a id="__codelineno-148-29" name="__codelineno-148-29" href="#__codelineno-148-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-148-30"><a id="__codelineno-148-30" name="__codelineno-148-30" href="#__codelineno-148-30"></a>
</span><span id="__span-148-31"><a id="__codelineno-148-31" name="__codelineno-148-31" href="#__codelineno-148-31"></a><span class="w">    </span><span class="nb">xss_protection</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-148-32"><a id="__codelineno-148-32" name="__codelineno-148-32" href="#__codelineno-148-32"></a><span class="w">      </span><span class="na">mode_block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-148-33"><a id="__codelineno-148-33" name="__codelineno-148-33" href="#__codelineno-148-33"></a><span class="w">      </span><span class="na">protection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-148-34"><a id="__codelineno-148-34" name="__codelineno-148-34" href="#__codelineno-148-34"></a><span class="w">      </span><span class="na">override</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-148-35"><a id="__codelineno-148-35" name="__codelineno-148-35" href="#__codelineno-148-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-148-36"><a id="__codelineno-148-36" name="__codelineno-148-36" href="#__codelineno-148-36"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-148-37"><a id="__codelineno-148-37" name="__codelineno-148-37" href="#__codelineno-148-37"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then reference this policy in the CloudFront distribution:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudfront_distribution&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-149-2"><a id="__codelineno-149-2" name="__codelineno-149-2" href="#__codelineno-149-2"></a><span class="c1">  # ... other configuration ...</span>
</span><span id="__span-149-3"><a id="__codelineno-149-3" name="__codelineno-149-3" href="#__codelineno-149-3"></a>
</span><span id="__span-149-4"><a id="__codelineno-149-4" name="__codelineno-149-4" href="#__codelineno-149-4"></a><span class="w">  </span><span class="nb">default_cache_behavior</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-149-5"><a id="__codelineno-149-5" name="__codelineno-149-5" href="#__codelineno-149-5"></a><span class="c1">    # ... other configuration ...</span>
</span><span id="__span-149-6"><a id="__codelineno-149-6" name="__codelineno-149-6" href="#__codelineno-149-6"></a><span class="w">    </span><span class="na">response_headers_policy_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_response_headers_policy.security_headers.id</span>
</span><span id="__span-149-7"><a id="__codelineno-149-7" name="__codelineno-149-7" href="#__codelineno-149-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-149-8"><a id="__codelineno-149-8" name="__codelineno-149-8" href="#__codelineno-149-8"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="lessons-learned"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#lessons-learned">Lessons Learned 💡</a></h3>
<p>Implementing CI/CD for this project taught me several valuable lessons:</p>
<ol>
<li>
<p><strong>Start Simple, Then Iterate</strong>: My first workflow was basic - just syncing files to S3. As I gained confidence, I added testing, multiple environments, and security features.</p>
</li>
<li>
<p><strong>Security Is Non-Negotiable</strong>: Using OIDC for authentication instead of long-lived credentials was a game-changer for security. This approach follows AWS best practices and eliminates credential management headaches.</p>
</li>
<li>
<p><strong>Test Everything</strong>: Automated tests at every level (unit, integration, end-to-end) catch issues early. The time invested in writing tests paid off with more reliable deployments.</p>
</li>
<li>
<p><strong>Environment Separation</strong>: Keeping development and production environments separate allowed me to test changes safely before affecting the live site.</p>
</li>
<li>
<p><strong>Infrastructure as Code Works</strong>: Using Terraform to define all infrastructure components made the CI/CD process much more reliable. Everything is tracked, versioned, and repeatable.</p>
</li>
</ol>
<h3 id="my-integration-challenges-and-solutions"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#my-integration-challenges-and-solutions">My Integration Challenges and Solutions 🧩</a></h3>
<p>During implementation, I encountered several challenges:</p>
<ol>
<li>
<p><strong>CORS Issues</strong>: The API and website needed proper CORS configuration to work together. Adding the correct headers in both Lambda and API Gateway fixed this.</p>
</li>
<li>
<p><strong>Environment Variables</strong>: Managing different configurations for dev and prod was tricky. I solved this by using GitHub environment variables and separate Terraform workspaces.</p>
</li>
<li>
<p><strong>Cache Invalidation Delays</strong>: Changes to the website sometimes weren't visible immediately due to CloudFront caching. Adding proper cache invalidation to the workflow fixed this.</p>
</li>
<li>
<p><strong>State Locking</strong>: When multiple workflow runs executed simultaneously, they occasionally conflicted on Terraform state. Using DynamoDB for state locking resolved this issue.</p>
</li>
</ol>
<h3 id="devops-mod-multi-stage-pipeline-with-pull-request-environments"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#devops-mod-multi-stage-pipeline-with-pull-request-environments">DevOps Mod: Multi-Stage Pipeline with Pull Request Environments 🚀</a></h3>
<p>To extend this challenge further, I implemented a feature that creates temporary preview environments for pull requests:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a><span class="w">  </span><span class="nt">create_preview</span><span class="p">:</span>
</span><span id="__span-150-2"><a id="__codelineno-150-2" name="__codelineno-150-2" href="#__codelineno-150-2"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Create</span><span class="nv"> </span><span class="s">Preview</span><span class="nv"> </span><span class="s">Environment&#39;</span>
</span><span id="__span-150-3"><a id="__codelineno-150-3" name="__codelineno-150-3" href="#__codelineno-150-3"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-150-4"><a id="__codelineno-150-4" name="__codelineno-150-4" href="#__codelineno-150-4"></a><span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.event_name == &#39;pull_request&#39;</span>
</span><span id="__span-150-5"><a id="__codelineno-150-5" name="__codelineno-150-5" href="#__codelineno-150-5"></a>
</span><span id="__span-150-6"><a id="__codelineno-150-6" name="__codelineno-150-6" href="#__codelineno-150-6"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-150-7"><a id="__codelineno-150-7" name="__codelineno-150-7" href="#__codelineno-150-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Repository</span>
</span><span id="__span-150-8"><a id="__codelineno-150-8" name="__codelineno-150-8" href="#__codelineno-150-8"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>
</span><span id="__span-150-9"><a id="__codelineno-150-9" name="__codelineno-150-9" href="#__codelineno-150-9"></a>
</span><span id="__span-150-10"><a id="__codelineno-150-10" name="__codelineno-150-10" href="#__codelineno-150-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure AWS Credentials</span>
</span><span id="__span-150-11"><a id="__codelineno-150-11" name="__codelineno-150-11" href="#__codelineno-150-11"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-actions/configure-aws-credentials@v2</span>
</span><span id="__span-150-12"><a id="__codelineno-150-12" name="__codelineno-150-12" href="#__codelineno-150-12"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-150-13"><a id="__codelineno-150-13" name="__codelineno-150-13" href="#__codelineno-150-13"></a><span class="w">          </span><span class="nt">role-to-assume</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/github-actions-role</span>
</span><span id="__span-150-14"><a id="__codelineno-150-14" name="__codelineno-150-14" href="#__codelineno-150-14"></a><span class="w">          </span><span class="nt">aws-region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
</span><span id="__span-150-15"><a id="__codelineno-150-15" name="__codelineno-150-15" href="#__codelineno-150-15"></a>
</span><span id="__span-150-16"><a id="__codelineno-150-16" name="__codelineno-150-16" href="#__codelineno-150-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Terraform</span>
</span><span id="__span-150-17"><a id="__codelineno-150-17" name="__codelineno-150-17" href="#__codelineno-150-17"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hashicorp/setup-terraform@v2</span>
</span><span id="__span-150-18"><a id="__codelineno-150-18" name="__codelineno-150-18" href="#__codelineno-150-18"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-150-19"><a id="__codelineno-150-19" name="__codelineno-150-19" href="#__codelineno-150-19"></a><span class="w">          </span><span class="nt">terraform_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2.0</span>
</span><span id="__span-150-20"><a id="__codelineno-150-20" name="__codelineno-150-20" href="#__codelineno-150-20"></a>
</span><span id="__span-150-21"><a id="__codelineno-150-21" name="__codelineno-150-21" href="#__codelineno-150-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Generate Unique Environment Name</span>
</span><span id="__span-150-22"><a id="__codelineno-150-22" name="__codelineno-150-22" href="#__codelineno-150-22"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-150-23"><a id="__codelineno-150-23" name="__codelineno-150-23" href="#__codelineno-150-23"></a><span class="w">          </span><span class="no">PR_NUMBER=${{ github.event.pull_request.number }}</span>
</span><span id="__span-150-24"><a id="__codelineno-150-24" name="__codelineno-150-24" href="#__codelineno-150-24"></a><span class="w">          </span><span class="no">BRANCH_NAME=$(echo ${{ github.head_ref }} | tr -cd &#39;[:alnum:]&#39; | tr &#39;[:upper:]&#39; &#39;[:lower:]&#39;)</span>
</span><span id="__span-150-25"><a id="__codelineno-150-25" name="__codelineno-150-25" href="#__codelineno-150-25"></a><span class="w">          </span><span class="no">ENV_NAME=&quot;pr-${PR_NUMBER}-${BRANCH_NAME}&quot;</span>
</span><span id="__span-150-26"><a id="__codelineno-150-26" name="__codelineno-150-26" href="#__codelineno-150-26"></a><span class="w">          </span><span class="no">echo &quot;ENV_NAME=${ENV_NAME}&quot; &gt;&gt; $GITHUB_ENV</span>
</span><span id="__span-150-27"><a id="__codelineno-150-27" name="__codelineno-150-27" href="#__codelineno-150-27"></a>
</span><span id="__span-150-28"><a id="__codelineno-150-28" name="__codelineno-150-28" href="#__codelineno-150-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Init</span>
</span><span id="__span-150-29"><a id="__codelineno-150-29" name="__codelineno-150-29" href="#__codelineno-150-29"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-150-30"><a id="__codelineno-150-30" name="__codelineno-150-30" href="#__codelineno-150-30"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">terraform init -backend-config=&quot;bucket=${{ secrets.TF_STATE_BUCKET }}&quot; -backend-config=&quot;key=preview/${{ env.ENV_NAME }}/terraform.tfstate&quot; -backend-config=&quot;region=us-east-1&quot;</span>
</span><span id="__span-150-31"><a id="__codelineno-150-31" name="__codelineno-150-31" href="#__codelineno-150-31"></a>
</span><span id="__span-150-32"><a id="__codelineno-150-32" name="__codelineno-150-32" href="#__codelineno-150-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terraform Apply</span>
</span><span id="__span-150-33"><a id="__codelineno-150-33" name="__codelineno-150-33" href="#__codelineno-150-33"></a><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./terraform</span>
</span><span id="__span-150-34"><a id="__codelineno-150-34" name="__codelineno-150-34" href="#__codelineno-150-34"></a><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-150-35"><a id="__codelineno-150-35" name="__codelineno-150-35" href="#__codelineno-150-35"></a><span class="w">          </span><span class="no">terraform apply -auto-approve \</span>
</span><span id="__span-150-36"><a id="__codelineno-150-36" name="__codelineno-150-36" href="#__codelineno-150-36"></a><span class="w">            </span><span class="no">-var=&quot;environment=${{ env.ENV_NAME }}&quot; \</span>
</span><span id="__span-150-37"><a id="__codelineno-150-37" name="__codelineno-150-37" href="#__codelineno-150-37"></a><span class="w">            </span><span class="no">-var=&quot;domain_name=pr-${{ github.event.pull_request.number }}.${{ secrets.DOMAIN_NAME }}&quot;</span>
</span><span id="__span-150-38"><a id="__codelineno-150-38" name="__codelineno-150-38" href="#__codelineno-150-38"></a>
</span><span id="__span-150-39"><a id="__codelineno-150-39" name="__codelineno-150-39" href="#__codelineno-150-39"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Comment Preview URL</span>
</span><span id="__span-150-40"><a id="__codelineno-150-40" name="__codelineno-150-40" href="#__codelineno-150-40"></a><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/github-script@v6</span>
</span><span id="__span-150-41"><a id="__codelineno-150-41" name="__codelineno-150-41" href="#__codelineno-150-41"></a><span class="w">        </span><span class="nt">with</span><span class="p">:</span>
</span><span id="__span-150-42"><a id="__codelineno-150-42" name="__codelineno-150-42" href="#__codelineno-150-42"></a><span class="w">          </span><span class="nt">github-token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
</span><span id="__span-150-43"><a id="__codelineno-150-43" name="__codelineno-150-43" href="#__codelineno-150-43"></a><span class="w">          </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-150-44"><a id="__codelineno-150-44" name="__codelineno-150-44" href="#__codelineno-150-44"></a><span class="w">            </span><span class="no">const output = `## 🚀 Preview Environment Deployed</span>
</span><span id="__span-150-45"><a id="__codelineno-150-45" name="__codelineno-150-45" href="#__codelineno-150-45"></a>
</span><span id="__span-150-46"><a id="__codelineno-150-46" name="__codelineno-150-46" href="#__codelineno-150-46"></a><span class="w">            </span><span class="no">Preview URL: https://pr-${{ github.event.pull_request.number }}.${{ secrets.DOMAIN_NAME }}</span>
</span><span id="__span-150-47"><a id="__codelineno-150-47" name="__codelineno-150-47" href="#__codelineno-150-47"></a>
</span><span id="__span-150-48"><a id="__codelineno-150-48" name="__codelineno-150-48" href="#__codelineno-150-48"></a><span class="w">            </span><span class="no">API Endpoint: https://api-pr-${{ github.event.pull_request.number }}.${{ secrets.DOMAIN_NAME }}/count</span>
</span><span id="__span-150-49"><a id="__codelineno-150-49" name="__codelineno-150-49" href="#__codelineno-150-49"></a>
</span><span id="__span-150-50"><a id="__codelineno-150-50" name="__codelineno-150-50" href="#__codelineno-150-50"></a><span class="w">            </span><span class="no">This environment will be automatically deleted when the PR is closed.`;</span>
</span><span id="__span-150-51"><a id="__codelineno-150-51" name="__codelineno-150-51" href="#__codelineno-150-51"></a>
</span><span id="__span-150-52"><a id="__codelineno-150-52" name="__codelineno-150-52" href="#__codelineno-150-52"></a><span class="w">            </span><span class="no">github.rest.issues.createComment({</span>
</span><span id="__span-150-53"><a id="__codelineno-150-53" name="__codelineno-150-53" href="#__codelineno-150-53"></a><span class="w">              </span><span class="no">issue_number: context.issue.number,</span>
</span><span id="__span-150-54"><a id="__codelineno-150-54" name="__codelineno-150-54" href="#__codelineno-150-54"></a><span class="w">              </span><span class="no">owner: context.repo.owner,</span>
</span><span id="__span-150-55"><a id="__codelineno-150-55" name="__codelineno-150-55" href="#__codelineno-150-55"></a><span class="w">              </span><span class="no">repo: context.repo.repo,</span>
</span><span id="__span-150-56"><a id="__codelineno-150-56" name="__codelineno-150-56" href="#__codelineno-150-56"></a><span class="w">              </span><span class="no">body: output</span>
</span><span id="__span-150-57"><a id="__codelineno-150-57" name="__codelineno-150-57" href="#__codelineno-150-57"></a><span class="w">            </span><span class="no">})</span>
</span></code></pre></div>
<p>And add a cleanup job to delete the preview environment when the PR is closed:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a><span class="w">  </span><span class="nt">cleanup_preview</span><span class="p">:</span>
</span><span id="__span-151-2"><a id="__codelineno-151-2" name="__codelineno-151-2" href="#__codelineno-151-2"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Cleanup</span><span class="nv"> </span><span class="s">Preview</span><span class="nv"> </span><span class="s">Environment&#39;</span>
</span><span id="__span-151-3"><a id="__codelineno-151-3" name="__codelineno-151-3" href="#__codelineno-151-3"></a><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
</span><span id="__span-151-4"><a id="__codelineno-151-4" name="__codelineno-151-4" href="#__codelineno-151-4"></a><span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.event_name == &#39;pull_request&#39; &amp;&amp; github.event.action == &#39;closed&#39;</span>
</span><span id="__span-151-5"><a id="__codelineno-151-5" name="__codelineno-151-5" href="#__codelineno-151-5"></a>
</span><span id="__span-151-6"><a id="__codelineno-151-6" name="__codelineno-151-6" href="#__codelineno-151-6"></a><span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
</span><span id="__span-151-7"><a id="__codelineno-151-7" name="__codelineno-151-7" href="#__codelineno-151-7"></a><span class="w">      </span><span class="c1"># Similar to create_preview but with terraform destroy</span>
</span></code></pre></div>
<h3 id="security-mod-implementing-aws-secrets-manager-for-api-keys"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#security-mod-implementing-aws-secrets-manager-for-api-keys">Security Mod: Implementing AWS Secrets Manager for API Keys 🔐</a></h3>
<p>To enhance the security of our API, I added API key authentication using AWS Secrets Manager:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a><span class="c1"># Create a secret to store the API key</span>
</span><span id="__span-152-2"><a id="__codelineno-152-2" name="__codelineno-152-2" href="#__codelineno-152-2"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_secretsmanager_secret&quot;</span><span class="w"> </span><span class="nv">&quot;api_key&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-3"><a id="__codelineno-152-3" name="__codelineno-152-3" href="#__codelineno-152-3"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-api-key-${var.environment}&quot;</span>
</span><span id="__span-152-4"><a id="__codelineno-152-4" name="__codelineno-152-4" href="#__codelineno-152-4"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;API key for the Resume API&quot;</span>
</span><span id="__span-152-5"><a id="__codelineno-152-5" name="__codelineno-152-5" href="#__codelineno-152-5"></a><span class="p">}</span>
</span><span id="__span-152-6"><a id="__codelineno-152-6" name="__codelineno-152-6" href="#__codelineno-152-6"></a>
</span><span id="__span-152-7"><a id="__codelineno-152-7" name="__codelineno-152-7" href="#__codelineno-152-7"></a><span class="c1"># Generate a random API key</span>
</span><span id="__span-152-8"><a id="__codelineno-152-8" name="__codelineno-152-8" href="#__codelineno-152-8"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;random_password&quot;</span><span class="w"> </span><span class="nv">&quot;api_key&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-9"><a id="__codelineno-152-9" name="__codelineno-152-9" href="#__codelineno-152-9"></a><span class="w">  </span><span class="na">length</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">32</span>
</span><span id="__span-152-10"><a id="__codelineno-152-10" name="__codelineno-152-10" href="#__codelineno-152-10"></a><span class="w">  </span><span class="na">special</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-152-11"><a id="__codelineno-152-11" name="__codelineno-152-11" href="#__codelineno-152-11"></a><span class="p">}</span>
</span><span id="__span-152-12"><a id="__codelineno-152-12" name="__codelineno-152-12" href="#__codelineno-152-12"></a>
</span><span id="__span-152-13"><a id="__codelineno-152-13" name="__codelineno-152-13" href="#__codelineno-152-13"></a><span class="c1"># Store the API key in Secrets Manager</span>
</span><span id="__span-152-14"><a id="__codelineno-152-14" name="__codelineno-152-14" href="#__codelineno-152-14"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_secretsmanager_secret_version&quot;</span><span class="w"> </span><span class="nv">&quot;api_key&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-15"><a id="__codelineno-152-15" name="__codelineno-152-15" href="#__codelineno-152-15"></a><span class="w">  </span><span class="na">secret_id</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_secretsmanager_secret.api_key.id</span>
</span><span id="__span-152-16"><a id="__codelineno-152-16" name="__codelineno-152-16" href="#__codelineno-152-16"></a><span class="w">  </span><span class="na">secret_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">random_password.api_key.result</span>
</span><span id="__span-152-17"><a id="__codelineno-152-17" name="__codelineno-152-17" href="#__codelineno-152-17"></a><span class="p">}</span>
</span><span id="__span-152-18"><a id="__codelineno-152-18" name="__codelineno-152-18" href="#__codelineno-152-18"></a>
</span><span id="__span-152-19"><a id="__codelineno-152-19" name="__codelineno-152-19" href="#__codelineno-152-19"></a><span class="c1"># Add API key to API Gateway</span>
</span><span id="__span-152-20"><a id="__codelineno-152-20" name="__codelineno-152-20" href="#__codelineno-152-20"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_api_key&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-21"><a id="__codelineno-152-21" name="__codelineno-152-21" href="#__codelineno-152-21"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;visitor-counter-key-${var.environment}&quot;</span>
</span><span id="__span-152-22"><a id="__codelineno-152-22" name="__codelineno-152-22" href="#__codelineno-152-22"></a><span class="p">}</span>
</span><span id="__span-152-23"><a id="__codelineno-152-23" name="__codelineno-152-23" href="#__codelineno-152-23"></a>
</span><span id="__span-152-24"><a id="__codelineno-152-24" name="__codelineno-152-24" href="#__codelineno-152-24"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_usage_plan&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-25"><a id="__codelineno-152-25" name="__codelineno-152-25" href="#__codelineno-152-25"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;visitor-counter-usage-plan-${var.environment}&quot;</span>
</span><span id="__span-152-26"><a id="__codelineno-152-26" name="__codelineno-152-26" href="#__codelineno-152-26"></a>
</span><span id="__span-152-27"><a id="__codelineno-152-27" name="__codelineno-152-27" href="#__codelineno-152-27"></a><span class="w">  </span><span class="nb">api_stages</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-28"><a id="__codelineno-152-28" name="__codelineno-152-28" href="#__codelineno-152-28"></a><span class="w">    </span><span class="na">api_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-152-29"><a id="__codelineno-152-29" name="__codelineno-152-29" href="#__codelineno-152-29"></a><span class="w">    </span><span class="na">stage</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.stage_name</span>
</span><span id="__span-152-30"><a id="__codelineno-152-30" name="__codelineno-152-30" href="#__codelineno-152-30"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-152-31"><a id="__codelineno-152-31" name="__codelineno-152-31" href="#__codelineno-152-31"></a>
</span><span id="__span-152-32"><a id="__codelineno-152-32" name="__codelineno-152-32" href="#__codelineno-152-32"></a><span class="w">  </span><span class="nb">quota_settings</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-33"><a id="__codelineno-152-33" name="__codelineno-152-33" href="#__codelineno-152-33"></a><span class="w">    </span><span class="na">limit</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span>
</span><span id="__span-152-34"><a id="__codelineno-152-34" name="__codelineno-152-34" href="#__codelineno-152-34"></a><span class="w">    </span><span class="na">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DAY&quot;</span>
</span><span id="__span-152-35"><a id="__codelineno-152-35" name="__codelineno-152-35" href="#__codelineno-152-35"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-152-36"><a id="__codelineno-152-36" name="__codelineno-152-36" href="#__codelineno-152-36"></a>
</span><span id="__span-152-37"><a id="__codelineno-152-37" name="__codelineno-152-37" href="#__codelineno-152-37"></a><span class="w">  </span><span class="nb">throttle_settings</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-38"><a id="__codelineno-152-38" name="__codelineno-152-38" href="#__codelineno-152-38"></a><span class="w">    </span><span class="na">burst_limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>
</span><span id="__span-152-39"><a id="__codelineno-152-39" name="__codelineno-152-39" href="#__codelineno-152-39"></a><span class="w">    </span><span class="na">rate_limit</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>
</span><span id="__span-152-40"><a id="__codelineno-152-40" name="__codelineno-152-40" href="#__codelineno-152-40"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-152-41"><a id="__codelineno-152-41" name="__codelineno-152-41" href="#__codelineno-152-41"></a><span class="p">}</span>
</span><span id="__span-152-42"><a id="__codelineno-152-42" name="__codelineno-152-42" href="#__codelineno-152-42"></a>
</span><span id="__span-152-43"><a id="__codelineno-152-43" name="__codelineno-152-43" href="#__codelineno-152-43"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_usage_plan_key&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-44"><a id="__codelineno-152-44" name="__codelineno-152-44" href="#__codelineno-152-44"></a><span class="w">  </span><span class="na">key_id</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_api_key.visitor_counter.id</span>
</span><span id="__span-152-45"><a id="__codelineno-152-45" name="__codelineno-152-45" href="#__codelineno-152-45"></a><span class="w">  </span><span class="na">key_type</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;API_KEY&quot;</span>
</span><span id="__span-152-46"><a id="__codelineno-152-46" name="__codelineno-152-46" href="#__codelineno-152-46"></a><span class="w">  </span><span class="na">usage_plan_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_usage_plan.visitor_counter.id</span>
</span><span id="__span-152-47"><a id="__codelineno-152-47" name="__codelineno-152-47" href="#__codelineno-152-47"></a><span class="p">}</span>
</span><span id="__span-152-48"><a id="__codelineno-152-48" name="__codelineno-152-48" href="#__codelineno-152-48"></a>
</span><span id="__span-152-49"><a id="__codelineno-152-49" name="__codelineno-152-49" href="#__codelineno-152-49"></a><span class="c1"># Update the Lambda function to verify the API key</span>
</span><span id="__span-152-50"><a id="__codelineno-152-50" name="__codelineno-152-50" href="#__codelineno-152-50"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_function&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-51"><a id="__codelineno-152-51" name="__codelineno-152-51" href="#__codelineno-152-51"></a><span class="c1">  # ... existing configuration ...</span>
</span><span id="__span-152-52"><a id="__codelineno-152-52" name="__codelineno-152-52" href="#__codelineno-152-52"></a>
</span><span id="__span-152-53"><a id="__codelineno-152-53" name="__codelineno-152-53" href="#__codelineno-152-53"></a><span class="w">  </span><span class="nb">environment</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-54"><a id="__codelineno-152-54" name="__codelineno-152-54" href="#__codelineno-152-54"></a><span class="w">    </span><span class="nb">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-152-55"><a id="__codelineno-152-55" name="__codelineno-152-55" href="#__codelineno-152-55"></a><span class="w">      </span><span class="na">DYNAMODB_TABLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_dynamodb_table.visitor_counter.name</span>
</span><span id="__span-152-56"><a id="__codelineno-152-56" name="__codelineno-152-56" href="#__codelineno-152-56"></a><span class="w">      </span><span class="na">ALLOWED_ORIGIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.website_domain</span>
</span><span id="__span-152-57"><a id="__codelineno-152-57" name="__codelineno-152-57" href="#__codelineno-152-57"></a><span class="w">      </span><span class="na">API_KEY_SECRET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_secretsmanager_secret.api_key.name</span>
</span><span id="__span-152-58"><a id="__codelineno-152-58" name="__codelineno-152-58" href="#__codelineno-152-58"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-152-59"><a id="__codelineno-152-59" name="__codelineno-152-59" href="#__codelineno-152-59"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-152-60"><a id="__codelineno-152-60" name="__codelineno-152-60" href="#__codelineno-152-60"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then, modify the Lambda function to retrieve and validate the API key:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
</span><span id="__span-153-2"><a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-153-3"><a id="__codelineno-153-3" name="__codelineno-153-3" href="#__codelineno-153-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-153-4"><a id="__codelineno-153-4" name="__codelineno-153-4" href="#__codelineno-153-4"></a>
</span><span id="__span-153-5"><a id="__codelineno-153-5" name="__codelineno-153-5" href="#__codelineno-153-5"></a><span class="c1"># Initialize Secrets Manager client</span>
</span><span id="__span-153-6"><a id="__codelineno-153-6" name="__codelineno-153-6" href="#__codelineno-153-6"></a><span class="n">secretsmanager</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;secretsmanager&#39;</span><span class="p">)</span>
</span><span id="__span-153-7"><a id="__codelineno-153-7" name="__codelineno-153-7" href="#__codelineno-153-7"></a>
</span><span id="__span-153-8"><a id="__codelineno-153-8" name="__codelineno-153-8" href="#__codelineno-153-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_api_key</span><span class="p">():</span>
</span><span id="__span-153-9"><a id="__codelineno-153-9" name="__codelineno-153-9" href="#__codelineno-153-9"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the API key from Secrets Manager&quot;&quot;&quot;</span>
</span><span id="__span-153-10"><a id="__codelineno-153-10" name="__codelineno-153-10" href="#__codelineno-153-10"></a>    <span class="n">secret_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;API_KEY_SECRET&#39;</span><span class="p">]</span>
</span><span id="__span-153-11"><a id="__codelineno-153-11" name="__codelineno-153-11" href="#__codelineno-153-11"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">secretsmanager</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">(</span><span class="n">SecretId</span><span class="o">=</span><span class="n">secret_name</span><span class="p">)</span>
</span><span id="__span-153-12"><a id="__codelineno-153-12" name="__codelineno-153-12" href="#__codelineno-153-12"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;SecretString&#39;</span><span class="p">]</span>
</span><span id="__span-153-13"><a id="__codelineno-153-13" name="__codelineno-153-13" href="#__codelineno-153-13"></a>
</span><span id="__span-153-14"><a id="__codelineno-153-14" name="__codelineno-153-14" href="#__codelineno-153-14"></a><span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</span><span id="__span-153-15"><a id="__codelineno-153-15" name="__codelineno-153-15" href="#__codelineno-153-15"></a>    <span class="c1"># Verify API key</span>
</span><span id="__span-153-16"><a id="__codelineno-153-16" name="__codelineno-153-16" href="#__codelineno-153-16"></a>    <span class="n">api_key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x-api-key&#39;</span><span class="p">)</span>
</span><span id="__span-153-17"><a id="__codelineno-153-17" name="__codelineno-153-17" href="#__codelineno-153-17"></a>    <span class="n">expected_api_key</span> <span class="o">=</span> <span class="n">get_api_key</span><span class="p">()</span>
</span><span id="__span-153-18"><a id="__codelineno-153-18" name="__codelineno-153-18" href="#__codelineno-153-18"></a>
</span><span id="__span-153-19"><a id="__codelineno-153-19" name="__codelineno-153-19" href="#__codelineno-153-19"></a>    <span class="k">if</span> <span class="n">api_key</span> <span class="o">!=</span> <span class="n">expected_api_key</span><span class="p">:</span>
</span><span id="__span-153-20"><a id="__codelineno-153-20" name="__codelineno-153-20" href="#__codelineno-153-20"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-153-21"><a id="__codelineno-153-21" name="__codelineno-153-21" href="#__codelineno-153-21"></a>            <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">403</span><span class="p">,</span>
</span><span id="__span-153-22"><a id="__codelineno-153-22" name="__codelineno-153-22" href="#__codelineno-153-22"></a>            <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-153-23"><a id="__codelineno-153-23" name="__codelineno-153-23" href="#__codelineno-153-23"></a>                <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span>
</span><span id="__span-153-24"><a id="__codelineno-153-24" name="__codelineno-153-24" href="#__codelineno-153-24"></a>            <span class="p">},</span>
</span><span id="__span-153-25"><a id="__codelineno-153-25" name="__codelineno-153-25" href="#__codelineno-153-25"></a>            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="__span-153-26"><a id="__codelineno-153-26" name="__codelineno-153-26" href="#__codelineno-153-26"></a>                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Forbidden&#39;</span><span class="p">,</span>
</span><span id="__span-153-27"><a id="__codelineno-153-27" name="__codelineno-153-27" href="#__codelineno-153-27"></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid API key&#39;</span>
</span><span id="__span-153-28"><a id="__codelineno-153-28" name="__codelineno-153-28" href="#__codelineno-153-28"></a>            <span class="p">})</span>
</span><span id="__span-153-29"><a id="__codelineno-153-29" name="__codelineno-153-29" href="#__codelineno-153-29"></a>        <span class="p">}</span>
</span><span id="__span-153-30"><a id="__codelineno-153-30" name="__codelineno-153-30" href="#__codelineno-153-30"></a>
</span><span id="__span-153-31"><a id="__codelineno-153-31" name="__codelineno-153-31" href="#__codelineno-153-31"></a>    <span class="c1"># Rest of the function...</span>
</span></code></pre></div>
<h3 id="next-steps"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/#next-steps">Next Steps ⏭️</a></h3>
<p>With our CI/CD pipelines in place, our Cloud Resume Challenge implementation is complete! In the final post, we'll reflect on the project as a whole, discuss lessons learned, and explore potential future enhancements.</p>
<hr />
<p><strong>Up Next:</strong> [Cloud Resume Challenge with Terraform: Final Thoughts &amp; Lessons Learned] 🔗</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Cloud%20Resume%20Challenge%20with%20Terraform%3A%20Automating%20Deployments%20with%20GitHub%20Actions%0A&amp;url=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-automating-deployments-with-github-actions/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-19 00:00:00+00:00">March 19, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/aws/" class="md-meta__link">AWS</a>, 
              <a href="../../../../category/terraform/" class="md-meta__link">Terraform</a>, 
              <a href="../../../../category/serverless/" class="md-meta__link">Serverless</a>, 
              <a href="../../../../category/cloud-resume-challenge/" class="md-meta__link">Cloud Resume Challenge</a></li>
        
        
          
          <li class="md-meta__item">
            
              14 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="cloud-resume-challenge-with-terraform-building-the-backend-api"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/">Cloud Resume Challenge with Terraform: Building the Backend API 🚀</a></h2>
<p>In our <a href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/">previous posts</a>, we set up the frontend infrastructure for our resume website using Terraform. Now it's time to build the backend API that will power our visitor counter.</p>
<h3 id="backend-architecture-overview"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#backend-architecture-overview">Backend Architecture Overview 🏗️</a></h3>
<p>Let's take a look at the serverless architecture we'll be implementing:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>┌─────────────┐     ┌─────────────┐     ┌─────────────┐
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>│             │     │             │     │             │
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>│ API Gateway ├─────► Lambda      ├─────► DynamoDB    │
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>│             │     │             │     │             │
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a>└─────────────┘     └─────────────┘     └─────────────┘
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>       │                   │                   │
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a>       │                   │                   │
</span><span id="__span-80-8"><a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a>       ▼                   ▼                   ▼
</span><span id="__span-80-9"><a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a>┌─────────────┐     ┌─────────────┐     ┌─────────────┐
</span><span id="__span-80-10"><a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a>│             │     │             │     │             │
</span><span id="__span-80-11"><a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a>│ CloudWatch  │     │ CloudWatch  │     │ CloudWatch  │
</span><span id="__span-80-12"><a id="__codelineno-80-12" name="__codelineno-80-12" href="#__codelineno-80-12"></a>│   Logs      │     │   Logs      │     │   Logs      │
</span><span id="__span-80-13"><a id="__codelineno-80-13" name="__codelineno-80-13" href="#__codelineno-80-13"></a>│             │     │             │     │             │
</span><span id="__span-80-14"><a id="__codelineno-80-14" name="__codelineno-80-14" href="#__codelineno-80-14"></a>└─────────────┘     └─────────────┘     └─────────────┘
</span></code></pre></div>
<p>This architecture includes:</p>
<ol>
<li><strong>API Gateway</strong>: Exposes our Lambda function as a REST API</li>
<li><strong>Lambda Function</strong>: Contains the Python code to increment and return the visitor count</li>
<li><strong>DynamoDB</strong>: Stores the visitor count data</li>
<li><strong>CloudWatch</strong>: Monitors and logs activity across all services</li>
</ol>
<h3 id="my-approach-to-dynamodb-design"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#my-approach-to-dynamodb-design">My Approach to DynamoDB Design 💾</a></h3>
<p>Before diving into the Terraform code, I want to share my thought process on DynamoDB table design. When I initially approached this challenge, I had to decide between two approaches:</p>
<ol>
<li><strong>Single-counter approach</strong>: A simple table with just one item for the counter</li>
<li><strong>Visitor log approach</strong>: A more detailed table that logs each visit with timestamps</li>
</ol>
<p>I chose the second approach for a few reasons:</p>
<ul>
<li>It allows for more detailed analytics in the future</li>
<li>It provides a history of visits that can be queried</li>
<li>It demonstrates a more realistic use case for DynamoDB</li>
</ul>
<p>Here's my table design:</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>visit_id</td>
<td>String</td>
<td>Primary key (UUID)</td>
</tr>
<tr>
<td>timestamp</td>
<td>String</td>
<td>ISO8601 timestamp of the visit</td>
</tr>
<tr>
<td>visitor_ip</td>
<td>String</td>
<td>Hashed IP address for privacy</td>
</tr>
<tr>
<td>user_agent</td>
<td>String</td>
<td>Browser/device information</td>
</tr>
<tr>
<td>path</td>
<td>String</td>
<td>Page path visited</td>
</tr>
</tbody>
</table>
<p>This approach gives us flexibility while keeping the solution serverless and cost-effective.</p>
<h3 id="implementing-the-backend-api-with-terraform"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#implementing-the-backend-api-with-terraform">Implementing the Backend API with Terraform 🛠️</a></h3>
<p>Now, let's start implementing our backend infrastructure using Terraform. We'll create modules for each component, starting with DynamoDB.</p>
<h4 id="1-dynamodb-table-for-visitor-counting"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#1-dynamodb-table-for-visitor-counting">1. DynamoDB Table for Visitor Counting 📊</a></h4>
<p>Create a file at <code>modules/backend/dynamodb.tf</code>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_dynamodb_table&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="w">  </span><span class="na">name</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ResumeVisitorCounter-${var.environment}&quot;</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="w">  </span><span class="na">billing_mode</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PAY_PER_REQUEST&quot;</span><span class="c1">  # On-demand capacity for cost savings</span>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="w">  </span><span class="na">hash_key</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;visit_id&quot;</span>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="w">  </span><span class="nb">attribute</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a><span class="w">    </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;visit_id&quot;</span>
</span><span id="__span-81-8"><a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a><span class="w">    </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S&quot;</span>
</span><span id="__span-81-9"><a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-81-10"><a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a>
</span><span id="__span-81-11"><a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a><span class="c1">  # Add TTL for automatic data cleanup after 90 days</span>
</span><span id="__span-81-12"><a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a><span class="w">  </span><span class="nb">ttl</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-81-13"><a id="__codelineno-81-13" name="__codelineno-81-13" href="#__codelineno-81-13"></a><span class="w">    </span><span class="na">attribute_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;expiration_time&quot;</span>
</span><span id="__span-81-14"><a id="__codelineno-81-14" name="__codelineno-81-14" href="#__codelineno-81-14"></a><span class="w">    </span><span class="na">enabled</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-81-15"><a id="__codelineno-81-15" name="__codelineno-81-15" href="#__codelineno-81-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-81-16"><a id="__codelineno-81-16" name="__codelineno-81-16" href="#__codelineno-81-16"></a>
</span><span id="__span-81-17"><a id="__codelineno-81-17" name="__codelineno-81-17" href="#__codelineno-81-17"></a><span class="w">  </span><span class="nb">point_in_time_recovery</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-81-18"><a id="__codelineno-81-18" name="__codelineno-81-18" href="#__codelineno-81-18"></a><span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span><span class="c1">  # Enable PITR for recovery options</span>
</span><span id="__span-81-19"><a id="__codelineno-81-19" name="__codelineno-81-19" href="#__codelineno-81-19"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-81-20"><a id="__codelineno-81-20" name="__codelineno-81-20" href="#__codelineno-81-20"></a>
</span><span id="__span-81-21"><a id="__codelineno-81-21" name="__codelineno-81-21" href="#__codelineno-81-21"></a><span class="c1">  # Use server-side encryption</span>
</span><span id="__span-81-22"><a id="__codelineno-81-22" name="__codelineno-81-22" href="#__codelineno-81-22"></a><span class="w">  </span><span class="nb">server_side_encryption</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-81-23"><a id="__codelineno-81-23" name="__codelineno-81-23" href="#__codelineno-81-23"></a><span class="w">    </span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-81-24"><a id="__codelineno-81-24" name="__codelineno-81-24" href="#__codelineno-81-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-81-25"><a id="__codelineno-81-25" name="__codelineno-81-25" href="#__codelineno-81-25"></a>
</span><span id="__span-81-26"><a id="__codelineno-81-26" name="__codelineno-81-26" href="#__codelineno-81-26"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-81-27"><a id="__codelineno-81-27" name="__codelineno-81-27" href="#__codelineno-81-27"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Visitor Counter&quot;</span>
</span><span id="__span-81-28"><a id="__codelineno-81-28" name="__codelineno-81-28" href="#__codelineno-81-28"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-81-29"><a id="__codelineno-81-29" name="__codelineno-81-29" href="#__codelineno-81-29"></a><span class="w">    </span><span class="na">Project</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cloud Resume Challenge&quot;</span>
</span><span id="__span-81-30"><a id="__codelineno-81-30" name="__codelineno-81-30" href="#__codelineno-81-30"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-81-31"><a id="__codelineno-81-31" name="__codelineno-81-31" href="#__codelineno-81-31"></a><span class="p">}</span>
</span><span id="__span-81-32"><a id="__codelineno-81-32" name="__codelineno-81-32" href="#__codelineno-81-32"></a>
</span><span id="__span-81-33"><a id="__codelineno-81-33" name="__codelineno-81-33" href="#__codelineno-81-33"></a><span class="c1"># Create a GSI for timestamp-based queries</span>
</span><span id="__span-81-34"><a id="__codelineno-81-34" name="__codelineno-81-34" href="#__codelineno-81-34"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_dynamodb_table_item&quot;</span><span class="w"> </span><span class="nv">&quot;counter_init&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-81-35"><a id="__codelineno-81-35" name="__codelineno-81-35" href="#__codelineno-81-35"></a><span class="w">  </span><span class="na">table_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_dynamodb_table.visitor_counter.name</span>
</span><span id="__span-81-36"><a id="__codelineno-81-36" name="__codelineno-81-36" href="#__codelineno-81-36"></a><span class="w">  </span><span class="na">hash_key</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_dynamodb_table.visitor_counter.hash_key</span>
</span><span id="__span-81-37"><a id="__codelineno-81-37" name="__codelineno-81-37" href="#__codelineno-81-37"></a>
</span><span id="__span-81-38"><a id="__codelineno-81-38" name="__codelineno-81-38" href="#__codelineno-81-38"></a><span class="c1">  # Initialize the counter with a value of 0</span>
</span><span id="__span-81-39"><a id="__codelineno-81-39" name="__codelineno-81-39" href="#__codelineno-81-39"></a><span class="w">  </span><span class="na">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-81-40"><a id="__codelineno-81-40" name="__codelineno-81-40" href="#__codelineno-81-40"></a><span class="w">    </span><span class="s2">&quot;visit_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;S&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;total&quot;</span><span class="p">},</span>
</span><span id="__span-81-41"><a id="__codelineno-81-41" name="__codelineno-81-41" href="#__codelineno-81-41"></a><span class="w">    </span><span class="s2">&quot;count&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;N&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">}</span>
</span><span id="__span-81-42"><a id="__codelineno-81-42" name="__codelineno-81-42" href="#__codelineno-81-42"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-81-43"><a id="__codelineno-81-43" name="__codelineno-81-43" href="#__codelineno-81-43"></a>
</span><span id="__span-81-44"><a id="__codelineno-81-44" name="__codelineno-81-44" href="#__codelineno-81-44"></a><span class="c1">  # Only create this item on initial deployment</span>
</span><span id="__span-81-45"><a id="__codelineno-81-45" name="__codelineno-81-45" href="#__codelineno-81-45"></a><span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-81-46"><a id="__codelineno-81-46" name="__codelineno-81-46" href="#__codelineno-81-46"></a><span class="w">    </span><span class="na">ignore_changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">item</span><span class="p">]</span>
</span><span id="__span-81-47"><a id="__codelineno-81-47" name="__codelineno-81-47" href="#__codelineno-81-47"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-81-48"><a id="__codelineno-81-48" name="__codelineno-81-48" href="#__codelineno-81-48"></a><span class="p">}</span>
</span></code></pre></div>
<p>I've implemented several enhancements:</p>
<ul>
<li>Point-in-time recovery for data protection</li>
<li>TTL for automatic cleanup of old records</li>
<li>Server-side encryption for security</li>
<li>An initial counter item to ensure we don't have "cold start" issues</li>
</ul>
<h4 id="2-lambda-function-for-the-api-logic"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#2-lambda-function-for-the-api-logic">2. Lambda Function for the API Logic 🏗️</a></h4>
<p>Now, let's create our Lambda function. First, we'll need the Python code. Create a file at <code>modules/backend/lambda/visitor_counter.py</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">botocore.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientError</span>
</span><span id="__span-82-9"><a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a>
</span><span id="__span-82-10"><a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a><span class="c1"># Set up logging</span>
</span><span id="__span-82-11"><a id="__codelineno-82-11" name="__codelineno-82-11" href="#__codelineno-82-11"></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
</span><span id="__span-82-12"><a id="__codelineno-82-12" name="__codelineno-82-12" href="#__codelineno-82-12"></a><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span><span id="__span-82-13"><a id="__codelineno-82-13" name="__codelineno-82-13" href="#__codelineno-82-13"></a>
</span><span id="__span-82-14"><a id="__codelineno-82-14" name="__codelineno-82-14" href="#__codelineno-82-14"></a><span class="c1"># Initialize DynamoDB client</span>
</span><span id="__span-82-15"><a id="__codelineno-82-15" name="__codelineno-82-15" href="#__codelineno-82-15"></a><span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">)</span>
</span><span id="__span-82-16"><a id="__codelineno-82-16" name="__codelineno-82-16" href="#__codelineno-82-16"></a><span class="n">table_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DYNAMODB_TABLE&#39;</span><span class="p">]</span>
</span><span id="__span-82-17"><a id="__codelineno-82-17" name="__codelineno-82-17" href="#__codelineno-82-17"></a><span class="n">table</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
</span><span id="__span-82-18"><a id="__codelineno-82-18" name="__codelineno-82-18" href="#__codelineno-82-18"></a>
</span><span id="__span-82-19"><a id="__codelineno-82-19" name="__codelineno-82-19" href="#__codelineno-82-19"></a><span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</span><span id="__span-82-20"><a id="__codelineno-82-20" name="__codelineno-82-20" href="#__codelineno-82-20"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-82-21"><a id="__codelineno-82-21" name="__codelineno-82-21" href="#__codelineno-82-21"></a><span class="sd">    Lambda handler to process API Gateway requests for visitor counting.</span>
</span><span id="__span-82-22"><a id="__codelineno-82-22" name="__codelineno-82-22" href="#__codelineno-82-22"></a><span class="sd">    Increments the visitor counter and returns the updated count.</span>
</span><span id="__span-82-23"><a id="__codelineno-82-23" name="__codelineno-82-23" href="#__codelineno-82-23"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-82-24"><a id="__codelineno-82-24" name="__codelineno-82-24" href="#__codelineno-82-24"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing event: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-82-25"><a id="__codelineno-82-25" name="__codelineno-82-25" href="#__codelineno-82-25"></a>
</span><span id="__span-82-26"><a id="__codelineno-82-26" name="__codelineno-82-26" href="#__codelineno-82-26"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-82-27"><a id="__codelineno-82-27" name="__codelineno-82-27" href="#__codelineno-82-27"></a>        <span class="c1"># Extract request information</span>
</span><span id="__span-82-28"><a id="__codelineno-82-28" name="__codelineno-82-28" href="#__codelineno-82-28"></a>        <span class="n">request_context</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;requestContext&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-82-29"><a id="__codelineno-82-29" name="__codelineno-82-29" href="#__codelineno-82-29"></a>        <span class="n">http_method</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;httpMethod&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-82-30"><a id="__codelineno-82-30" name="__codelineno-82-30" href="#__codelineno-82-30"></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-82-31"><a id="__codelineno-82-31" name="__codelineno-82-31" href="#__codelineno-82-31"></a>        <span class="n">headers</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-82-32"><a id="__codelineno-82-32" name="__codelineno-82-32" href="#__codelineno-82-32"></a>        <span class="n">ip_address</span> <span class="o">=</span> <span class="n">request_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;identity&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sourceIp&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
</span><span id="__span-82-33"><a id="__codelineno-82-33" name="__codelineno-82-33" href="#__codelineno-82-33"></a>        <span class="n">user_agent</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
</span><span id="__span-82-34"><a id="__codelineno-82-34" name="__codelineno-82-34" href="#__codelineno-82-34"></a>
</span><span id="__span-82-35"><a id="__codelineno-82-35" name="__codelineno-82-35" href="#__codelineno-82-35"></a>        <span class="c1"># Generate a unique visit ID</span>
</span><span id="__span-82-36"><a id="__codelineno-82-36" name="__codelineno-82-36" href="#__codelineno-82-36"></a>        <span class="n">visit_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="__span-82-37"><a id="__codelineno-82-37" name="__codelineno-82-37" href="#__codelineno-82-37"></a>
</span><span id="__span-82-38"><a id="__codelineno-82-38" name="__codelineno-82-38" href="#__codelineno-82-38"></a>        <span class="c1"># Hash the IP address for privacy</span>
</span><span id="__span-82-39"><a id="__codelineno-82-39" name="__codelineno-82-39" href="#__codelineno-82-39"></a>        <span class="n">hashed_ip</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">ip_address</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span><span id="__span-82-40"><a id="__codelineno-82-40" name="__codelineno-82-40" href="#__codelineno-82-40"></a>
</span><span id="__span-82-41"><a id="__codelineno-82-41" name="__codelineno-82-41" href="#__codelineno-82-41"></a>        <span class="c1"># Get current timestamp</span>
</span><span id="__span-82-42"><a id="__codelineno-82-42" name="__codelineno-82-42" href="#__codelineno-82-42"></a>        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="__span-82-43"><a id="__codelineno-82-43" name="__codelineno-82-43" href="#__codelineno-82-43"></a>
</span><span id="__span-82-44"><a id="__codelineno-82-44" name="__codelineno-82-44" href="#__codelineno-82-44"></a>        <span class="c1"># Calculate expiration time (90 days from now)</span>
</span><span id="__span-82-45"><a id="__codelineno-82-45" name="__codelineno-82-45" href="#__codelineno-82-45"></a>        <span class="n">expiration_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">90</span><span class="p">))</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
</span><span id="__span-82-46"><a id="__codelineno-82-46" name="__codelineno-82-46" href="#__codelineno-82-46"></a>
</span><span id="__span-82-47"><a id="__codelineno-82-47" name="__codelineno-82-47" href="#__codelineno-82-47"></a>        <span class="c1"># Log the visit</span>
</span><span id="__span-82-48"><a id="__codelineno-82-48" name="__codelineno-82-48" href="#__codelineno-82-48"></a>        <span class="n">table</span><span class="o">.</span><span class="n">put_item</span><span class="p">(</span>
</span><span id="__span-82-49"><a id="__codelineno-82-49" name="__codelineno-82-49" href="#__codelineno-82-49"></a>            <span class="n">Item</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-82-50"><a id="__codelineno-82-50" name="__codelineno-82-50" href="#__codelineno-82-50"></a>                <span class="s1">&#39;visit_id&#39;</span><span class="p">:</span> <span class="n">visit_id</span><span class="p">,</span>
</span><span id="__span-82-51"><a id="__codelineno-82-51" name="__codelineno-82-51" href="#__codelineno-82-51"></a>                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
</span><span id="__span-82-52"><a id="__codelineno-82-52" name="__codelineno-82-52" href="#__codelineno-82-52"></a>                <span class="s1">&#39;visitor_ip&#39;</span><span class="p">:</span> <span class="n">hashed_ip</span><span class="p">,</span>
</span><span id="__span-82-53"><a id="__codelineno-82-53" name="__codelineno-82-53" href="#__codelineno-82-53"></a>                <span class="s1">&#39;user_agent&#39;</span><span class="p">:</span> <span class="n">user_agent</span><span class="p">,</span>
</span><span id="__span-82-54"><a id="__codelineno-82-54" name="__codelineno-82-54" href="#__codelineno-82-54"></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
</span><span id="__span-82-55"><a id="__codelineno-82-55" name="__codelineno-82-55" href="#__codelineno-82-55"></a>                <span class="s1">&#39;expiration_time&#39;</span><span class="p">:</span> <span class="n">expiration_time</span>
</span><span id="__span-82-56"><a id="__codelineno-82-56" name="__codelineno-82-56" href="#__codelineno-82-56"></a>            <span class="p">}</span>
</span><span id="__span-82-57"><a id="__codelineno-82-57" name="__codelineno-82-57" href="#__codelineno-82-57"></a>        <span class="p">)</span>
</span><span id="__span-82-58"><a id="__codelineno-82-58" name="__codelineno-82-58" href="#__codelineno-82-58"></a>
</span><span id="__span-82-59"><a id="__codelineno-82-59" name="__codelineno-82-59" href="#__codelineno-82-59"></a>        <span class="c1"># Update the total counter</span>
</span><span id="__span-82-60"><a id="__codelineno-82-60" name="__codelineno-82-60" href="#__codelineno-82-60"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">update_item</span><span class="p">(</span>
</span><span id="__span-82-61"><a id="__codelineno-82-61" name="__codelineno-82-61" href="#__codelineno-82-61"></a>            <span class="n">Key</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;visit_id&#39;</span><span class="p">:</span> <span class="s1">&#39;total&#39;</span><span class="p">},</span>
</span><span id="__span-82-62"><a id="__codelineno-82-62" name="__codelineno-82-62" href="#__codelineno-82-62"></a>            <span class="n">UpdateExpression</span><span class="o">=</span><span class="s1">&#39;ADD #count :incr&#39;</span><span class="p">,</span>
</span><span id="__span-82-63"><a id="__codelineno-82-63" name="__codelineno-82-63" href="#__codelineno-82-63"></a>            <span class="n">ExpressionAttributeNames</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;#count&#39;</span><span class="p">:</span> <span class="s1">&#39;count&#39;</span><span class="p">},</span>
</span><span id="__span-82-64"><a id="__codelineno-82-64" name="__codelineno-82-64" href="#__codelineno-82-64"></a>            <span class="n">ExpressionAttributeValues</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;:incr&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
</span><span id="__span-82-65"><a id="__codelineno-82-65" name="__codelineno-82-65" href="#__codelineno-82-65"></a>            <span class="n">ReturnValues</span><span class="o">=</span><span class="s1">&#39;UPDATED_NEW&#39;</span>
</span><span id="__span-82-66"><a id="__codelineno-82-66" name="__codelineno-82-66" href="#__codelineno-82-66"></a>        <span class="p">)</span>
</span><span id="__span-82-67"><a id="__codelineno-82-67" name="__codelineno-82-67" href="#__codelineno-82-67"></a>
</span><span id="__span-82-68"><a id="__codelineno-82-68" name="__codelineno-82-68" href="#__codelineno-82-68"></a>        <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;Attributes&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>
</span><span id="__span-82-69"><a id="__codelineno-82-69" name="__codelineno-82-69" href="#__codelineno-82-69"></a>
</span><span id="__span-82-70"><a id="__codelineno-82-70" name="__codelineno-82-70" href="#__codelineno-82-70"></a>        <span class="c1"># Return the response</span>
</span><span id="__span-82-71"><a id="__codelineno-82-71" name="__codelineno-82-71" href="#__codelineno-82-71"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-82-72"><a id="__codelineno-82-72" name="__codelineno-82-72" href="#__codelineno-82-72"></a>            <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
</span><span id="__span-82-73"><a id="__codelineno-82-73" name="__codelineno-82-73" href="#__codelineno-82-73"></a>            <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-82-74"><a id="__codelineno-82-74" name="__codelineno-82-74" href="#__codelineno-82-74"></a>                <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="__span-82-75"><a id="__codelineno-82-75" name="__codelineno-82-75" href="#__codelineno-82-75"></a>                <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ALLOWED_ORIGIN&#39;</span><span class="p">],</span>
</span><span id="__span-82-76"><a id="__codelineno-82-76" name="__codelineno-82-76" href="#__codelineno-82-76"></a>                <span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">:</span> <span class="s1">&#39;GET, OPTIONS&#39;</span><span class="p">,</span>
</span><span id="__span-82-77"><a id="__codelineno-82-77" name="__codelineno-82-77" href="#__codelineno-82-77"></a>                <span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">:</span> <span class="s1">&#39;Content-Type&#39;</span>
</span><span id="__span-82-78"><a id="__codelineno-82-78" name="__codelineno-82-78" href="#__codelineno-82-78"></a>            <span class="p">},</span>
</span><span id="__span-82-79"><a id="__codelineno-82-79" name="__codelineno-82-79" href="#__codelineno-82-79"></a>            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="__span-82-80"><a id="__codelineno-82-80" name="__codelineno-82-80" href="#__codelineno-82-80"></a>                <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
</span><span id="__span-82-81"><a id="__codelineno-82-81" name="__codelineno-82-81" href="#__codelineno-82-81"></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Visitor count updated successfully&#39;</span>
</span><span id="__span-82-82"><a id="__codelineno-82-82" name="__codelineno-82-82" href="#__codelineno-82-82"></a>            <span class="p">})</span>
</span><span id="__span-82-83"><a id="__codelineno-82-83" name="__codelineno-82-83" href="#__codelineno-82-83"></a>        <span class="p">}</span>
</span><span id="__span-82-84"><a id="__codelineno-82-84" name="__codelineno-82-84" href="#__codelineno-82-84"></a>
</span><span id="__span-82-85"><a id="__codelineno-82-85" name="__codelineno-82-85" href="#__codelineno-82-85"></a>    <span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-82-86"><a id="__codelineno-82-86" name="__codelineno-82-86" href="#__codelineno-82-86"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DynamoDB error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-82-87"><a id="__codelineno-82-87" name="__codelineno-82-87" href="#__codelineno-82-87"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-82-88"><a id="__codelineno-82-88" name="__codelineno-82-88" href="#__codelineno-82-88"></a>            <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
</span><span id="__span-82-89"><a id="__codelineno-82-89" name="__codelineno-82-89" href="#__codelineno-82-89"></a>            <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-82-90"><a id="__codelineno-82-90" name="__codelineno-82-90" href="#__codelineno-82-90"></a>                <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="__span-82-91"><a id="__codelineno-82-91" name="__codelineno-82-91" href="#__codelineno-82-91"></a>                <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ALLOWED_ORIGIN&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="__span-82-92"><a id="__codelineno-82-92" name="__codelineno-82-92" href="#__codelineno-82-92"></a>            <span class="p">},</span>
</span><span id="__span-82-93"><a id="__codelineno-82-93" name="__codelineno-82-93" href="#__codelineno-82-93"></a>            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="__span-82-94"><a id="__codelineno-82-94" name="__codelineno-82-94" href="#__codelineno-82-94"></a>                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Database error&#39;</span><span class="p">,</span>
</span><span id="__span-82-95"><a id="__codelineno-82-95" name="__codelineno-82-95" href="#__codelineno-82-95"></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-82-96"><a id="__codelineno-82-96" name="__codelineno-82-96" href="#__codelineno-82-96"></a>            <span class="p">})</span>
</span><span id="__span-82-97"><a id="__codelineno-82-97" name="__codelineno-82-97" href="#__codelineno-82-97"></a>        <span class="p">}</span>
</span><span id="__span-82-98"><a id="__codelineno-82-98" name="__codelineno-82-98" href="#__codelineno-82-98"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-82-99"><a id="__codelineno-82-99" name="__codelineno-82-99" href="#__codelineno-82-99"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;General error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-82-100"><a id="__codelineno-82-100" name="__codelineno-82-100" href="#__codelineno-82-100"></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-82-101"><a id="__codelineno-82-101" name="__codelineno-82-101" href="#__codelineno-82-101"></a>            <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
</span><span id="__span-82-102"><a id="__codelineno-82-102" name="__codelineno-82-102" href="#__codelineno-82-102"></a>            <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-82-103"><a id="__codelineno-82-103" name="__codelineno-82-103" href="#__codelineno-82-103"></a>                <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="__span-82-104"><a id="__codelineno-82-104" name="__codelineno-82-104" href="#__codelineno-82-104"></a>                <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ALLOWED_ORIGIN&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="__span-82-105"><a id="__codelineno-82-105" name="__codelineno-82-105" href="#__codelineno-82-105"></a>            <span class="p">},</span>
</span><span id="__span-82-106"><a id="__codelineno-82-106" name="__codelineno-82-106" href="#__codelineno-82-106"></a>            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="__span-82-107"><a id="__codelineno-82-107" name="__codelineno-82-107" href="#__codelineno-82-107"></a>                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Server error&#39;</span><span class="p">,</span>
</span><span id="__span-82-108"><a id="__codelineno-82-108" name="__codelineno-82-108" href="#__codelineno-82-108"></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-82-109"><a id="__codelineno-82-109" name="__codelineno-82-109" href="#__codelineno-82-109"></a>            <span class="p">})</span>
</span><span id="__span-82-110"><a id="__codelineno-82-110" name="__codelineno-82-110" href="#__codelineno-82-110"></a>        <span class="p">}</span>
</span><span id="__span-82-111"><a id="__codelineno-82-111" name="__codelineno-82-111" href="#__codelineno-82-111"></a>
</span><span id="__span-82-112"><a id="__codelineno-82-112" name="__codelineno-82-112" href="#__codelineno-82-112"></a><span class="k">def</span><span class="w"> </span><span class="nf">options_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</span><span id="__span-82-113"><a id="__codelineno-82-113" name="__codelineno-82-113" href="#__codelineno-82-113"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-82-114"><a id="__codelineno-82-114" name="__codelineno-82-114" href="#__codelineno-82-114"></a><span class="sd">    Handler for OPTIONS requests to support CORS</span>
</span><span id="__span-82-115"><a id="__codelineno-82-115" name="__codelineno-82-115" href="#__codelineno-82-115"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-82-116"><a id="__codelineno-82-116" name="__codelineno-82-116" href="#__codelineno-82-116"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-82-117"><a id="__codelineno-82-117" name="__codelineno-82-117" href="#__codelineno-82-117"></a>        <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
</span><span id="__span-82-118"><a id="__codelineno-82-118" name="__codelineno-82-118" href="#__codelineno-82-118"></a>        <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-82-119"><a id="__codelineno-82-119" name="__codelineno-82-119" href="#__codelineno-82-119"></a>            <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ALLOWED_ORIGIN&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">),</span>
</span><span id="__span-82-120"><a id="__codelineno-82-120" name="__codelineno-82-120" href="#__codelineno-82-120"></a>            <span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">:</span> <span class="s1">&#39;GET, OPTIONS&#39;</span><span class="p">,</span>
</span><span id="__span-82-121"><a id="__codelineno-82-121" name="__codelineno-82-121" href="#__codelineno-82-121"></a>            <span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">:</span> <span class="s1">&#39;Content-Type&#39;</span>
</span><span id="__span-82-122"><a id="__codelineno-82-122" name="__codelineno-82-122" href="#__codelineno-82-122"></a>        <span class="p">},</span>
</span><span id="__span-82-123"><a id="__codelineno-82-123" name="__codelineno-82-123" href="#__codelineno-82-123"></a>        <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
</span><span id="__span-82-124"><a id="__codelineno-82-124" name="__codelineno-82-124" href="#__codelineno-82-124"></a>    <span class="p">}</span>
</span></code></pre></div>
<p>Now, let's create the Lambda function using Terraform. Create a file at <code>modules/backend/lambda.tf</code>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="c1"># Archive the Lambda function code</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;archive_file&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_zip&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;zip&quot;</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="w">  </span><span class="na">source_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${path.module}/lambda/visitor_counter.py&quot;</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="w">  </span><span class="na">output_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${path.module}/lambda/visitor_counter.zip&quot;</span>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="p">}</span>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a>
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="c1"># Create the Lambda function</span>
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_function&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="w">  </span><span class="na">filename</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.archive_file.lambda_zip.output_path</span>
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="w">  </span><span class="na">function_name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-visitor-counter-${var.environment}&quot;</span>
</span><span id="__span-83-12"><a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a><span class="w">  </span><span class="na">role</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.lambda_role.arn</span>
</span><span id="__span-83-13"><a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a><span class="w">  </span><span class="na">handler</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;visitor_counter.lambda_handler&quot;</span>
</span><span id="__span-83-14"><a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a><span class="w">  </span><span class="na">source_code_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.archive_file.lambda_zip.output_base64sha256</span>
</span><span id="__span-83-15"><a id="__codelineno-83-15" name="__codelineno-83-15" href="#__codelineno-83-15"></a><span class="w">  </span><span class="na">runtime</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;python3.9&quot;</span>
</span><span id="__span-83-16"><a id="__codelineno-83-16" name="__codelineno-83-16" href="#__codelineno-83-16"></a><span class="w">  </span><span class="na">timeout</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="c1">  # Increased timeout for better error handling</span>
</span><span id="__span-83-17"><a id="__codelineno-83-17" name="__codelineno-83-17" href="#__codelineno-83-17"></a><span class="w">  </span><span class="na">memory_size</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">128</span>
</span><span id="__span-83-18"><a id="__codelineno-83-18" name="__codelineno-83-18" href="#__codelineno-83-18"></a>
</span><span id="__span-83-19"><a id="__codelineno-83-19" name="__codelineno-83-19" href="#__codelineno-83-19"></a><span class="w">  </span><span class="nb">environment</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-20"><a id="__codelineno-83-20" name="__codelineno-83-20" href="#__codelineno-83-20"></a><span class="w">    </span><span class="nb">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-21"><a id="__codelineno-83-21" name="__codelineno-83-21" href="#__codelineno-83-21"></a><span class="w">      </span><span class="na">DYNAMODB_TABLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_dynamodb_table.visitor_counter.name</span>
</span><span id="__span-83-22"><a id="__codelineno-83-22" name="__codelineno-83-22" href="#__codelineno-83-22"></a><span class="w">      </span><span class="na">ALLOWED_ORIGIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.website_domain</span>
</span><span id="__span-83-23"><a id="__codelineno-83-23" name="__codelineno-83-23" href="#__codelineno-83-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-83-24"><a id="__codelineno-83-24" name="__codelineno-83-24" href="#__codelineno-83-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-83-25"><a id="__codelineno-83-25" name="__codelineno-83-25" href="#__codelineno-83-25"></a>
</span><span id="__span-83-26"><a id="__codelineno-83-26" name="__codelineno-83-26" href="#__codelineno-83-26"></a><span class="w">  </span><span class="nb">tracing_config</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-27"><a id="__codelineno-83-27" name="__codelineno-83-27" href="#__codelineno-83-27"></a><span class="w">    </span><span class="na">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Active&quot;</span><span class="c1">  # Enable X-Ray tracing</span>
</span><span id="__span-83-28"><a id="__codelineno-83-28" name="__codelineno-83-28" href="#__codelineno-83-28"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-83-29"><a id="__codelineno-83-29" name="__codelineno-83-29" href="#__codelineno-83-29"></a>
</span><span id="__span-83-30"><a id="__codelineno-83-30" name="__codelineno-83-30" href="#__codelineno-83-30"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-31"><a id="__codelineno-83-31" name="__codelineno-83-31" href="#__codelineno-83-31"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Visitor Counter Lambda&quot;</span>
</span><span id="__span-83-32"><a id="__codelineno-83-32" name="__codelineno-83-32" href="#__codelineno-83-32"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-83-33"><a id="__codelineno-83-33" name="__codelineno-83-33" href="#__codelineno-83-33"></a><span class="w">    </span><span class="na">Project</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cloud Resume Challenge&quot;</span>
</span><span id="__span-83-34"><a id="__codelineno-83-34" name="__codelineno-83-34" href="#__codelineno-83-34"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-83-35"><a id="__codelineno-83-35" name="__codelineno-83-35" href="#__codelineno-83-35"></a><span class="p">}</span>
</span><span id="__span-83-36"><a id="__codelineno-83-36" name="__codelineno-83-36" href="#__codelineno-83-36"></a>
</span><span id="__span-83-37"><a id="__codelineno-83-37" name="__codelineno-83-37" href="#__codelineno-83-37"></a><span class="c1"># Create an IAM role for the Lambda function</span>
</span><span id="__span-83-38"><a id="__codelineno-83-38" name="__codelineno-83-38" href="#__codelineno-83-38"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_role&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-39"><a id="__codelineno-83-39" name="__codelineno-83-39" href="#__codelineno-83-39"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-visitor-counter-lambda-role-${var.environment}&quot;</span>
</span><span id="__span-83-40"><a id="__codelineno-83-40" name="__codelineno-83-40" href="#__codelineno-83-40"></a>
</span><span id="__span-83-41"><a id="__codelineno-83-41" name="__codelineno-83-41" href="#__codelineno-83-41"></a><span class="w">  </span><span class="na">assume_role_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-83-42"><a id="__codelineno-83-42" name="__codelineno-83-42" href="#__codelineno-83-42"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-83-43"><a id="__codelineno-83-43" name="__codelineno-83-43" href="#__codelineno-83-43"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-83-44"><a id="__codelineno-83-44" name="__codelineno-83-44" href="#__codelineno-83-44"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-83-45"><a id="__codelineno-83-45" name="__codelineno-83-45" href="#__codelineno-83-45"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span>
</span><span id="__span-83-46"><a id="__codelineno-83-46" name="__codelineno-83-46" href="#__codelineno-83-46"></a><span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-83-47"><a id="__codelineno-83-47" name="__codelineno-83-47" href="#__codelineno-83-47"></a><span class="w">        </span><span class="nb">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-48"><a id="__codelineno-83-48" name="__codelineno-83-48" href="#__codelineno-83-48"></a><span class="w">          </span><span class="na">Service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda.amazonaws.com&quot;</span>
</span><span id="__span-83-49"><a id="__codelineno-83-49" name="__codelineno-83-49" href="#__codelineno-83-49"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-83-50"><a id="__codelineno-83-50" name="__codelineno-83-50" href="#__codelineno-83-50"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-83-51"><a id="__codelineno-83-51" name="__codelineno-83-51" href="#__codelineno-83-51"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-83-52"><a id="__codelineno-83-52" name="__codelineno-83-52" href="#__codelineno-83-52"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-83-53"><a id="__codelineno-83-53" name="__codelineno-83-53" href="#__codelineno-83-53"></a><span class="p">}</span>
</span><span id="__span-83-54"><a id="__codelineno-83-54" name="__codelineno-83-54" href="#__codelineno-83-54"></a>
</span><span id="__span-83-55"><a id="__codelineno-83-55" name="__codelineno-83-55" href="#__codelineno-83-55"></a><span class="c1"># Create a custom policy for the Lambda function with least privilege</span>
</span><span id="__span-83-56"><a id="__codelineno-83-56" name="__codelineno-83-56" href="#__codelineno-83-56"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_policy&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_policy&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-57"><a id="__codelineno-83-57" name="__codelineno-83-57" href="#__codelineno-83-57"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-visitor-counter-lambda-policy-${var.environment}&quot;</span>
</span><span id="__span-83-58"><a id="__codelineno-83-58" name="__codelineno-83-58" href="#__codelineno-83-58"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;IAM policy for the visitor counter Lambda function&quot;</span>
</span><span id="__span-83-59"><a id="__codelineno-83-59" name="__codelineno-83-59" href="#__codelineno-83-59"></a>
</span><span id="__span-83-60"><a id="__codelineno-83-60" name="__codelineno-83-60" href="#__codelineno-83-60"></a><span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-83-61"><a id="__codelineno-83-61" name="__codelineno-83-61" href="#__codelineno-83-61"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-83-62"><a id="__codelineno-83-62" name="__codelineno-83-62" href="#__codelineno-83-62"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-83-63"><a id="__codelineno-83-63" name="__codelineno-83-63" href="#__codelineno-83-63"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-83-64"><a id="__codelineno-83-64" name="__codelineno-83-64" href="#__codelineno-83-64"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-83-65"><a id="__codelineno-83-65" name="__codelineno-83-65" href="#__codelineno-83-65"></a><span class="w">          </span><span class="s2">&quot;dynamodb:GetItem&quot;</span><span class="p">,</span>
</span><span id="__span-83-66"><a id="__codelineno-83-66" name="__codelineno-83-66" href="#__codelineno-83-66"></a><span class="w">          </span><span class="s2">&quot;dynamodb:PutItem&quot;</span><span class="p">,</span>
</span><span id="__span-83-67"><a id="__codelineno-83-67" name="__codelineno-83-67" href="#__codelineno-83-67"></a><span class="w">          </span><span class="s2">&quot;dynamodb:UpdateItem&quot;</span>
</span><span id="__span-83-68"><a id="__codelineno-83-68" name="__codelineno-83-68" href="#__codelineno-83-68"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-83-69"><a id="__codelineno-83-69" name="__codelineno-83-69" href="#__codelineno-83-69"></a><span class="w">        </span><span class="na">Effect</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-83-70"><a id="__codelineno-83-70" name="__codelineno-83-70" href="#__codelineno-83-70"></a><span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_dynamodb_table.visitor_counter.arn</span>
</span><span id="__span-83-71"><a id="__codelineno-83-71" name="__codelineno-83-71" href="#__codelineno-83-71"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-83-72"><a id="__codelineno-83-72" name="__codelineno-83-72" href="#__codelineno-83-72"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-83-73"><a id="__codelineno-83-73" name="__codelineno-83-73" href="#__codelineno-83-73"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-83-74"><a id="__codelineno-83-74" name="__codelineno-83-74" href="#__codelineno-83-74"></a><span class="w">          </span><span class="s2">&quot;logs:CreateLogGroup&quot;</span><span class="p">,</span>
</span><span id="__span-83-75"><a id="__codelineno-83-75" name="__codelineno-83-75" href="#__codelineno-83-75"></a><span class="w">          </span><span class="s2">&quot;logs:CreateLogStream&quot;</span><span class="p">,</span>
</span><span id="__span-83-76"><a id="__codelineno-83-76" name="__codelineno-83-76" href="#__codelineno-83-76"></a><span class="w">          </span><span class="s2">&quot;logs:PutLogEvents&quot;</span>
</span><span id="__span-83-77"><a id="__codelineno-83-77" name="__codelineno-83-77" href="#__codelineno-83-77"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-83-78"><a id="__codelineno-83-78" name="__codelineno-83-78" href="#__codelineno-83-78"></a><span class="w">        </span><span class="na">Effect</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-83-79"><a id="__codelineno-83-79" name="__codelineno-83-79" href="#__codelineno-83-79"></a><span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;arn:aws:logs:*:*:*&quot;</span>
</span><span id="__span-83-80"><a id="__codelineno-83-80" name="__codelineno-83-80" href="#__codelineno-83-80"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-83-81"><a id="__codelineno-83-81" name="__codelineno-83-81" href="#__codelineno-83-81"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-83-82"><a id="__codelineno-83-82" name="__codelineno-83-82" href="#__codelineno-83-82"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-83-83"><a id="__codelineno-83-83" name="__codelineno-83-83" href="#__codelineno-83-83"></a><span class="w">          </span><span class="s2">&quot;xray:PutTraceSegments&quot;</span><span class="p">,</span>
</span><span id="__span-83-84"><a id="__codelineno-83-84" name="__codelineno-83-84" href="#__codelineno-83-84"></a><span class="w">          </span><span class="s2">&quot;xray:PutTelemetryRecords&quot;</span>
</span><span id="__span-83-85"><a id="__codelineno-83-85" name="__codelineno-83-85" href="#__codelineno-83-85"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-83-86"><a id="__codelineno-83-86" name="__codelineno-83-86" href="#__codelineno-83-86"></a><span class="w">        </span><span class="na">Effect</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-83-87"><a id="__codelineno-83-87" name="__codelineno-83-87" href="#__codelineno-83-87"></a><span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-83-88"><a id="__codelineno-83-88" name="__codelineno-83-88" href="#__codelineno-83-88"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-83-89"><a id="__codelineno-83-89" name="__codelineno-83-89" href="#__codelineno-83-89"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-83-90"><a id="__codelineno-83-90" name="__codelineno-83-90" href="#__codelineno-83-90"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-83-91"><a id="__codelineno-83-91" name="__codelineno-83-91" href="#__codelineno-83-91"></a><span class="p">}</span>
</span><span id="__span-83-92"><a id="__codelineno-83-92" name="__codelineno-83-92" href="#__codelineno-83-92"></a>
</span><span id="__span-83-93"><a id="__codelineno-83-93" name="__codelineno-83-93" href="#__codelineno-83-93"></a><span class="c1"># Attach the policy to the IAM role</span>
</span><span id="__span-83-94"><a id="__codelineno-83-94" name="__codelineno-83-94" href="#__codelineno-83-94"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role_policy_attachment&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_policy_attachment&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-95"><a id="__codelineno-83-95" name="__codelineno-83-95" href="#__codelineno-83-95"></a><span class="w">  </span><span class="na">role</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.lambda_role.name</span>
</span><span id="__span-83-96"><a id="__codelineno-83-96" name="__codelineno-83-96" href="#__codelineno-83-96"></a><span class="w">  </span><span class="na">policy_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_policy.lambda_policy.arn</span>
</span><span id="__span-83-97"><a id="__codelineno-83-97" name="__codelineno-83-97" href="#__codelineno-83-97"></a><span class="p">}</span>
</span><span id="__span-83-98"><a id="__codelineno-83-98" name="__codelineno-83-98" href="#__codelineno-83-98"></a>
</span><span id="__span-83-99"><a id="__codelineno-83-99" name="__codelineno-83-99" href="#__codelineno-83-99"></a><span class="c1"># Create a CloudWatch log group for the Lambda function</span>
</span><span id="__span-83-100"><a id="__codelineno-83-100" name="__codelineno-83-100" href="#__codelineno-83-100"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_log_group&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_log_group&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-101"><a id="__codelineno-83-101" name="__codelineno-83-101" href="#__codelineno-83-101"></a><span class="w">  </span><span class="na">name</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/aws/lambda/${aws_lambda_function.visitor_counter.function_name}&quot;</span>
</span><span id="__span-83-102"><a id="__codelineno-83-102" name="__codelineno-83-102" href="#__codelineno-83-102"></a><span class="w">  </span><span class="na">retention_in_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span>
</span><span id="__span-83-103"><a id="__codelineno-83-103" name="__codelineno-83-103" href="#__codelineno-83-103"></a>
</span><span id="__span-83-104"><a id="__codelineno-83-104" name="__codelineno-83-104" href="#__codelineno-83-104"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-105"><a id="__codelineno-83-105" name="__codelineno-83-105" href="#__codelineno-83-105"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-83-106"><a id="__codelineno-83-106" name="__codelineno-83-106" href="#__codelineno-83-106"></a><span class="w">    </span><span class="na">Project</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cloud Resume Challenge&quot;</span>
</span><span id="__span-83-107"><a id="__codelineno-83-107" name="__codelineno-83-107" href="#__codelineno-83-107"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-83-108"><a id="__codelineno-83-108" name="__codelineno-83-108" href="#__codelineno-83-108"></a><span class="p">}</span>
</span><span id="__span-83-109"><a id="__codelineno-83-109" name="__codelineno-83-109" href="#__codelineno-83-109"></a>
</span><span id="__span-83-110"><a id="__codelineno-83-110" name="__codelineno-83-110" href="#__codelineno-83-110"></a><span class="c1"># Create a Lambda function for handling OPTIONS requests (CORS)</span>
</span><span id="__span-83-111"><a id="__codelineno-83-111" name="__codelineno-83-111" href="#__codelineno-83-111"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_function&quot;</span><span class="w"> </span><span class="nv">&quot;options_handler&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-112"><a id="__codelineno-83-112" name="__codelineno-83-112" href="#__codelineno-83-112"></a><span class="w">  </span><span class="na">filename</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.archive_file.lambda_zip.output_path</span>
</span><span id="__span-83-113"><a id="__codelineno-83-113" name="__codelineno-83-113" href="#__codelineno-83-113"></a><span class="w">  </span><span class="na">function_name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-visitor-counter-options-${var.environment}&quot;</span>
</span><span id="__span-83-114"><a id="__codelineno-83-114" name="__codelineno-83-114" href="#__codelineno-83-114"></a><span class="w">  </span><span class="na">role</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.lambda_role.arn</span>
</span><span id="__span-83-115"><a id="__codelineno-83-115" name="__codelineno-83-115" href="#__codelineno-83-115"></a><span class="w">  </span><span class="na">handler</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;visitor_counter.options_handler&quot;</span>
</span><span id="__span-83-116"><a id="__codelineno-83-116" name="__codelineno-83-116" href="#__codelineno-83-116"></a><span class="w">  </span><span class="na">source_code_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.archive_file.lambda_zip.output_base64sha256</span>
</span><span id="__span-83-117"><a id="__codelineno-83-117" name="__codelineno-83-117" href="#__codelineno-83-117"></a><span class="w">  </span><span class="na">runtime</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;python3.9&quot;</span>
</span><span id="__span-83-118"><a id="__codelineno-83-118" name="__codelineno-83-118" href="#__codelineno-83-118"></a><span class="w">  </span><span class="na">timeout</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>
</span><span id="__span-83-119"><a id="__codelineno-83-119" name="__codelineno-83-119" href="#__codelineno-83-119"></a><span class="w">  </span><span class="na">memory_size</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">128</span>
</span><span id="__span-83-120"><a id="__codelineno-83-120" name="__codelineno-83-120" href="#__codelineno-83-120"></a>
</span><span id="__span-83-121"><a id="__codelineno-83-121" name="__codelineno-83-121" href="#__codelineno-83-121"></a><span class="w">  </span><span class="nb">environment</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-122"><a id="__codelineno-83-122" name="__codelineno-83-122" href="#__codelineno-83-122"></a><span class="w">    </span><span class="nb">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-123"><a id="__codelineno-83-123" name="__codelineno-83-123" href="#__codelineno-83-123"></a><span class="w">      </span><span class="na">ALLOWED_ORIGIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.website_domain</span>
</span><span id="__span-83-124"><a id="__codelineno-83-124" name="__codelineno-83-124" href="#__codelineno-83-124"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-83-125"><a id="__codelineno-83-125" name="__codelineno-83-125" href="#__codelineno-83-125"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-83-126"><a id="__codelineno-83-126" name="__codelineno-83-126" href="#__codelineno-83-126"></a>
</span><span id="__span-83-127"><a id="__codelineno-83-127" name="__codelineno-83-127" href="#__codelineno-83-127"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-128"><a id="__codelineno-83-128" name="__codelineno-83-128" href="#__codelineno-83-128"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Options Handler Lambda&quot;</span>
</span><span id="__span-83-129"><a id="__codelineno-83-129" name="__codelineno-83-129" href="#__codelineno-83-129"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-83-130"><a id="__codelineno-83-130" name="__codelineno-83-130" href="#__codelineno-83-130"></a><span class="w">    </span><span class="na">Project</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cloud Resume Challenge&quot;</span>
</span><span id="__span-83-131"><a id="__codelineno-83-131" name="__codelineno-83-131" href="#__codelineno-83-131"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-83-132"><a id="__codelineno-83-132" name="__codelineno-83-132" href="#__codelineno-83-132"></a><span class="p">}</span>
</span></code></pre></div>
<p>I've implemented several security and operational improvements:</p>
<ul>
<li>Least privilege IAM policies</li>
<li>X-Ray tracing for performance monitoring</li>
<li>Proper CORS handling with a dedicated OPTIONS handler</li>
<li>CloudWatch log group with retention policy</li>
<li>Privacy-enhancing IP address hashing</li>
</ul>
<h4 id="3-api-gateway-for-exposing-the-lambda-function"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#3-api-gateway-for-exposing-the-lambda-function">3. API Gateway for Exposing the Lambda Function 🔗</a></h4>
<p>Create a file at <code>modules/backend/api_gateway.tf</code>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="c1"># Create the API Gateway REST API</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_rest_api&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-visitor-counter-${var.environment}&quot;</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;API for the resume visitor counter&quot;</span>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a>
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="w">  </span><span class="nb">endpoint_configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="w">    </span><span class="na">types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;REGIONAL&quot;</span><span class="p">]</span>
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a>
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Visitor Counter API&quot;</span>
</span><span id="__span-84-12"><a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-84-13"><a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a><span class="w">    </span><span class="na">Project</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cloud Resume Challenge&quot;</span>
</span><span id="__span-84-14"><a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-84-15"><a id="__codelineno-84-15" name="__codelineno-84-15" href="#__codelineno-84-15"></a><span class="p">}</span>
</span><span id="__span-84-16"><a id="__codelineno-84-16" name="__codelineno-84-16" href="#__codelineno-84-16"></a>
</span><span id="__span-84-17"><a id="__codelineno-84-17" name="__codelineno-84-17" href="#__codelineno-84-17"></a><span class="c1"># Create a resource for the API</span>
</span><span id="__span-84-18"><a id="__codelineno-84-18" name="__codelineno-84-18" href="#__codelineno-84-18"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_resource&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-19"><a id="__codelineno-84-19" name="__codelineno-84-19" href="#__codelineno-84-19"></a><span class="w">  </span><span class="na">rest_api_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-84-20"><a id="__codelineno-84-20" name="__codelineno-84-20" href="#__codelineno-84-20"></a><span class="w">  </span><span class="na">parent_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.root_resource_id</span>
</span><span id="__span-84-21"><a id="__codelineno-84-21" name="__codelineno-84-21" href="#__codelineno-84-21"></a><span class="w">  </span><span class="na">path_part</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;count&quot;</span>
</span><span id="__span-84-22"><a id="__codelineno-84-22" name="__codelineno-84-22" href="#__codelineno-84-22"></a><span class="p">}</span>
</span><span id="__span-84-23"><a id="__codelineno-84-23" name="__codelineno-84-23" href="#__codelineno-84-23"></a>
</span><span id="__span-84-24"><a id="__codelineno-84-24" name="__codelineno-84-24" href="#__codelineno-84-24"></a><span class="c1"># Create a GET method for the API</span>
</span><span id="__span-84-25"><a id="__codelineno-84-25" name="__codelineno-84-25" href="#__codelineno-84-25"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_method&quot;</span><span class="w"> </span><span class="nv">&quot;get&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-26"><a id="__codelineno-84-26" name="__codelineno-84-26" href="#__codelineno-84-26"></a><span class="w">  </span><span class="na">rest_api_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-84-27"><a id="__codelineno-84-27" name="__codelineno-84-27" href="#__codelineno-84-27"></a><span class="w">  </span><span class="na">resource_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_resource.visitor_counter.id</span>
</span><span id="__span-84-28"><a id="__codelineno-84-28" name="__codelineno-84-28" href="#__codelineno-84-28"></a><span class="w">  </span><span class="na">http_method</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;GET&quot;</span>
</span><span id="__span-84-29"><a id="__codelineno-84-29" name="__codelineno-84-29" href="#__codelineno-84-29"></a><span class="w">  </span><span class="na">authorization_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;NONE&quot;</span>
</span><span id="__span-84-30"><a id="__codelineno-84-30" name="__codelineno-84-30" href="#__codelineno-84-30"></a>
</span><span id="__span-84-31"><a id="__codelineno-84-31" name="__codelineno-84-31" href="#__codelineno-84-31"></a><span class="c1">  # Add API key requirement if needed</span>
</span><span id="__span-84-32"><a id="__codelineno-84-32" name="__codelineno-84-32" href="#__codelineno-84-32"></a><span class="c1">  # api_key_required = true</span>
</span><span id="__span-84-33"><a id="__codelineno-84-33" name="__codelineno-84-33" href="#__codelineno-84-33"></a><span class="p">}</span>
</span><span id="__span-84-34"><a id="__codelineno-84-34" name="__codelineno-84-34" href="#__codelineno-84-34"></a>
</span><span id="__span-84-35"><a id="__codelineno-84-35" name="__codelineno-84-35" href="#__codelineno-84-35"></a><span class="c1"># Create an OPTIONS method for the API (for CORS)</span>
</span><span id="__span-84-36"><a id="__codelineno-84-36" name="__codelineno-84-36" href="#__codelineno-84-36"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_method&quot;</span><span class="w"> </span><span class="nv">&quot;options&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-37"><a id="__codelineno-84-37" name="__codelineno-84-37" href="#__codelineno-84-37"></a><span class="w">  </span><span class="na">rest_api_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-84-38"><a id="__codelineno-84-38" name="__codelineno-84-38" href="#__codelineno-84-38"></a><span class="w">  </span><span class="na">resource_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_resource.visitor_counter.id</span>
</span><span id="__span-84-39"><a id="__codelineno-84-39" name="__codelineno-84-39" href="#__codelineno-84-39"></a><span class="w">  </span><span class="na">http_method</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;OPTIONS&quot;</span>
</span><span id="__span-84-40"><a id="__codelineno-84-40" name="__codelineno-84-40" href="#__codelineno-84-40"></a><span class="w">  </span><span class="na">authorization_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;NONE&quot;</span>
</span><span id="__span-84-41"><a id="__codelineno-84-41" name="__codelineno-84-41" href="#__codelineno-84-41"></a><span class="p">}</span>
</span><span id="__span-84-42"><a id="__codelineno-84-42" name="__codelineno-84-42" href="#__codelineno-84-42"></a>
</span><span id="__span-84-43"><a id="__codelineno-84-43" name="__codelineno-84-43" href="#__codelineno-84-43"></a><span class="c1"># Set up the GET method integration with Lambda</span>
</span><span id="__span-84-44"><a id="__codelineno-84-44" name="__codelineno-84-44" href="#__codelineno-84-44"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_integration&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_get&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-45"><a id="__codelineno-84-45" name="__codelineno-84-45" href="#__codelineno-84-45"></a><span class="w">  </span><span class="na">rest_api_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-84-46"><a id="__codelineno-84-46" name="__codelineno-84-46" href="#__codelineno-84-46"></a><span class="w">  </span><span class="na">resource_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_resource.visitor_counter.id</span>
</span><span id="__span-84-47"><a id="__codelineno-84-47" name="__codelineno-84-47" href="#__codelineno-84-47"></a><span class="w">  </span><span class="na">http_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_method.get.http_method</span>
</span><span id="__span-84-48"><a id="__codelineno-84-48" name="__codelineno-84-48" href="#__codelineno-84-48"></a>
</span><span id="__span-84-49"><a id="__codelineno-84-49" name="__codelineno-84-49" href="#__codelineno-84-49"></a><span class="w">  </span><span class="na">integration_http_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span>
</span><span id="__span-84-50"><a id="__codelineno-84-50" name="__codelineno-84-50" href="#__codelineno-84-50"></a><span class="w">  </span><span class="na">type</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWS_PROXY&quot;</span>
</span><span id="__span-84-51"><a id="__codelineno-84-51" name="__codelineno-84-51" href="#__codelineno-84-51"></a><span class="w">  </span><span class="na">uri</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.visitor_counter.invoke_arn</span>
</span><span id="__span-84-52"><a id="__codelineno-84-52" name="__codelineno-84-52" href="#__codelineno-84-52"></a><span class="p">}</span>
</span><span id="__span-84-53"><a id="__codelineno-84-53" name="__codelineno-84-53" href="#__codelineno-84-53"></a>
</span><span id="__span-84-54"><a id="__codelineno-84-54" name="__codelineno-84-54" href="#__codelineno-84-54"></a><span class="c1"># Set up the OPTIONS method integration with Lambda</span>
</span><span id="__span-84-55"><a id="__codelineno-84-55" name="__codelineno-84-55" href="#__codelineno-84-55"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_integration&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_options&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-56"><a id="__codelineno-84-56" name="__codelineno-84-56" href="#__codelineno-84-56"></a><span class="w">  </span><span class="na">rest_api_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-84-57"><a id="__codelineno-84-57" name="__codelineno-84-57" href="#__codelineno-84-57"></a><span class="w">  </span><span class="na">resource_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_resource.visitor_counter.id</span>
</span><span id="__span-84-58"><a id="__codelineno-84-58" name="__codelineno-84-58" href="#__codelineno-84-58"></a><span class="w">  </span><span class="na">http_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_method.options.http_method</span>
</span><span id="__span-84-59"><a id="__codelineno-84-59" name="__codelineno-84-59" href="#__codelineno-84-59"></a>
</span><span id="__span-84-60"><a id="__codelineno-84-60" name="__codelineno-84-60" href="#__codelineno-84-60"></a><span class="w">  </span><span class="na">integration_http_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span>
</span><span id="__span-84-61"><a id="__codelineno-84-61" name="__codelineno-84-61" href="#__codelineno-84-61"></a><span class="w">  </span><span class="na">type</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWS_PROXY&quot;</span>
</span><span id="__span-84-62"><a id="__codelineno-84-62" name="__codelineno-84-62" href="#__codelineno-84-62"></a><span class="w">  </span><span class="na">uri</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.options_handler.invoke_arn</span>
</span><span id="__span-84-63"><a id="__codelineno-84-63" name="__codelineno-84-63" href="#__codelineno-84-63"></a><span class="p">}</span>
</span><span id="__span-84-64"><a id="__codelineno-84-64" name="__codelineno-84-64" href="#__codelineno-84-64"></a>
</span><span id="__span-84-65"><a id="__codelineno-84-65" name="__codelineno-84-65" href="#__codelineno-84-65"></a><span class="c1"># Create a deployment for the API</span>
</span><span id="__span-84-66"><a id="__codelineno-84-66" name="__codelineno-84-66" href="#__codelineno-84-66"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_deployment&quot;</span><span class="w"> </span><span class="nv">&quot;visitor_counter&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-67"><a id="__codelineno-84-67" name="__codelineno-84-67" href="#__codelineno-84-67"></a><span class="w">  </span><span class="na">depends_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-84-68"><a id="__codelineno-84-68" name="__codelineno-84-68" href="#__codelineno-84-68"></a><span class="w">    </span><span class="nv">aws_api_gateway_integration.lambda_get</span><span class="p">,</span>
</span><span id="__span-84-69"><a id="__codelineno-84-69" name="__codelineno-84-69" href="#__codelineno-84-69"></a><span class="w">    </span><span class="nv">aws_api_gateway_integration.lambda_options</span>
</span><span id="__span-84-70"><a id="__codelineno-84-70" name="__codelineno-84-70" href="#__codelineno-84-70"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-84-71"><a id="__codelineno-84-71" name="__codelineno-84-71" href="#__codelineno-84-71"></a>
</span><span id="__span-84-72"><a id="__codelineno-84-72" name="__codelineno-84-72" href="#__codelineno-84-72"></a><span class="w">  </span><span class="na">rest_api_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-84-73"><a id="__codelineno-84-73" name="__codelineno-84-73" href="#__codelineno-84-73"></a><span class="w">  </span><span class="na">stage_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-84-74"><a id="__codelineno-84-74" name="__codelineno-84-74" href="#__codelineno-84-74"></a>
</span><span id="__span-84-75"><a id="__codelineno-84-75" name="__codelineno-84-75" href="#__codelineno-84-75"></a><span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-76"><a id="__codelineno-84-76" name="__codelineno-84-76" href="#__codelineno-84-76"></a><span class="w">    </span><span class="na">create_before_destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-84-77"><a id="__codelineno-84-77" name="__codelineno-84-77" href="#__codelineno-84-77"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-84-78"><a id="__codelineno-84-78" name="__codelineno-84-78" href="#__codelineno-84-78"></a><span class="p">}</span>
</span><span id="__span-84-79"><a id="__codelineno-84-79" name="__codelineno-84-79" href="#__codelineno-84-79"></a>
</span><span id="__span-84-80"><a id="__codelineno-84-80" name="__codelineno-84-80" href="#__codelineno-84-80"></a><span class="c1"># Add permission for API Gateway to invoke the Lambda function</span>
</span><span id="__span-84-81"><a id="__codelineno-84-81" name="__codelineno-84-81" href="#__codelineno-84-81"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_permission&quot;</span><span class="w"> </span><span class="nv">&quot;api_gateway_lambda&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-82"><a id="__codelineno-84-82" name="__codelineno-84-82" href="#__codelineno-84-82"></a><span class="w">  </span><span class="na">statement_id</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AllowAPIGatewayInvoke&quot;</span>
</span><span id="__span-84-83"><a id="__codelineno-84-83" name="__codelineno-84-83" href="#__codelineno-84-83"></a><span class="w">  </span><span class="na">action</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda:InvokeFunction&quot;</span>
</span><span id="__span-84-84"><a id="__codelineno-84-84" name="__codelineno-84-84" href="#__codelineno-84-84"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.visitor_counter.function_name</span>
</span><span id="__span-84-85"><a id="__codelineno-84-85" name="__codelineno-84-85" href="#__codelineno-84-85"></a><span class="w">  </span><span class="na">principal</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;apigateway.amazonaws.com&quot;</span>
</span><span id="__span-84-86"><a id="__codelineno-84-86" name="__codelineno-84-86" href="#__codelineno-84-86"></a>
</span><span id="__span-84-87"><a id="__codelineno-84-87" name="__codelineno-84-87" href="#__codelineno-84-87"></a><span class="c1">  # The /* part allows invocation from any stage, method and resource path</span>
</span><span id="__span-84-88"><a id="__codelineno-84-88" name="__codelineno-84-88" href="#__codelineno-84-88"></a><span class="c1">  # within API Gateway</span>
</span><span id="__span-84-89"><a id="__codelineno-84-89" name="__codelineno-84-89" href="#__codelineno-84-89"></a><span class="w">  </span><span class="na">source_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${aws_api_gateway_rest_api.visitor_counter.execution_arn}/*/${aws_api_gateway_method.get.http_method}${aws_api_gateway_resource.visitor_counter.path}&quot;</span>
</span><span id="__span-84-90"><a id="__codelineno-84-90" name="__codelineno-84-90" href="#__codelineno-84-90"></a><span class="p">}</span>
</span><span id="__span-84-91"><a id="__codelineno-84-91" name="__codelineno-84-91" href="#__codelineno-84-91"></a>
</span><span id="__span-84-92"><a id="__codelineno-84-92" name="__codelineno-84-92" href="#__codelineno-84-92"></a><span class="c1"># Add permission for API Gateway to invoke the OPTIONS Lambda function</span>
</span><span id="__span-84-93"><a id="__codelineno-84-93" name="__codelineno-84-93" href="#__codelineno-84-93"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_permission&quot;</span><span class="w"> </span><span class="nv">&quot;api_gateway_options_lambda&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-94"><a id="__codelineno-84-94" name="__codelineno-84-94" href="#__codelineno-84-94"></a><span class="w">  </span><span class="na">statement_id</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AllowAPIGatewayInvokeOptions&quot;</span>
</span><span id="__span-84-95"><a id="__codelineno-84-95" name="__codelineno-84-95" href="#__codelineno-84-95"></a><span class="w">  </span><span class="na">action</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda:InvokeFunction&quot;</span>
</span><span id="__span-84-96"><a id="__codelineno-84-96" name="__codelineno-84-96" href="#__codelineno-84-96"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.options_handler.function_name</span>
</span><span id="__span-84-97"><a id="__codelineno-84-97" name="__codelineno-84-97" href="#__codelineno-84-97"></a><span class="w">  </span><span class="na">principal</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;apigateway.amazonaws.com&quot;</span>
</span><span id="__span-84-98"><a id="__codelineno-84-98" name="__codelineno-84-98" href="#__codelineno-84-98"></a>
</span><span id="__span-84-99"><a id="__codelineno-84-99" name="__codelineno-84-99" href="#__codelineno-84-99"></a><span class="w">  </span><span class="na">source_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${aws_api_gateway_rest_api.visitor_counter.execution_arn}/*/${aws_api_gateway_method.options.http_method}${aws_api_gateway_resource.visitor_counter.path}&quot;</span>
</span><span id="__span-84-100"><a id="__codelineno-84-100" name="__codelineno-84-100" href="#__codelineno-84-100"></a><span class="p">}</span>
</span><span id="__span-84-101"><a id="__codelineno-84-101" name="__codelineno-84-101" href="#__codelineno-84-101"></a>
</span><span id="__span-84-102"><a id="__codelineno-84-102" name="__codelineno-84-102" href="#__codelineno-84-102"></a><span class="c1"># Enable CloudWatch logging for API Gateway</span>
</span><span id="__span-84-103"><a id="__codelineno-84-103" name="__codelineno-84-103" href="#__codelineno-84-103"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_account&quot;</span><span class="w"> </span><span class="nv">&quot;main&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-104"><a id="__codelineno-84-104" name="__codelineno-84-104" href="#__codelineno-84-104"></a><span class="w">  </span><span class="na">cloudwatch_role_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.api_gateway_cloudwatch.arn</span>
</span><span id="__span-84-105"><a id="__codelineno-84-105" name="__codelineno-84-105" href="#__codelineno-84-105"></a><span class="p">}</span>
</span><span id="__span-84-106"><a id="__codelineno-84-106" name="__codelineno-84-106" href="#__codelineno-84-106"></a>
</span><span id="__span-84-107"><a id="__codelineno-84-107" name="__codelineno-84-107" href="#__codelineno-84-107"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role&quot;</span><span class="w"> </span><span class="nv">&quot;api_gateway_cloudwatch&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-108"><a id="__codelineno-84-108" name="__codelineno-84-108" href="#__codelineno-84-108"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;api-gateway-cloudwatch-role-${var.environment}&quot;</span>
</span><span id="__span-84-109"><a id="__codelineno-84-109" name="__codelineno-84-109" href="#__codelineno-84-109"></a>
</span><span id="__span-84-110"><a id="__codelineno-84-110" name="__codelineno-84-110" href="#__codelineno-84-110"></a><span class="w">  </span><span class="na">assume_role_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-84-111"><a id="__codelineno-84-111" name="__codelineno-84-111" href="#__codelineno-84-111"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-84-112"><a id="__codelineno-84-112" name="__codelineno-84-112" href="#__codelineno-84-112"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-84-113"><a id="__codelineno-84-113" name="__codelineno-84-113" href="#__codelineno-84-113"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-84-114"><a id="__codelineno-84-114" name="__codelineno-84-114" href="#__codelineno-84-114"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span>
</span><span id="__span-84-115"><a id="__codelineno-84-115" name="__codelineno-84-115" href="#__codelineno-84-115"></a><span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-84-116"><a id="__codelineno-84-116" name="__codelineno-84-116" href="#__codelineno-84-116"></a><span class="w">        </span><span class="nb">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-117"><a id="__codelineno-84-117" name="__codelineno-84-117" href="#__codelineno-84-117"></a><span class="w">          </span><span class="na">Service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;apigateway.amazonaws.com&quot;</span>
</span><span id="__span-84-118"><a id="__codelineno-84-118" name="__codelineno-84-118" href="#__codelineno-84-118"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-84-119"><a id="__codelineno-84-119" name="__codelineno-84-119" href="#__codelineno-84-119"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-84-120"><a id="__codelineno-84-120" name="__codelineno-84-120" href="#__codelineno-84-120"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-84-121"><a id="__codelineno-84-121" name="__codelineno-84-121" href="#__codelineno-84-121"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-84-122"><a id="__codelineno-84-122" name="__codelineno-84-122" href="#__codelineno-84-122"></a><span class="p">}</span>
</span><span id="__span-84-123"><a id="__codelineno-84-123" name="__codelineno-84-123" href="#__codelineno-84-123"></a>
</span><span id="__span-84-124"><a id="__codelineno-84-124" name="__codelineno-84-124" href="#__codelineno-84-124"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role_policy_attachment&quot;</span><span class="w"> </span><span class="nv">&quot;api_gateway_cloudwatch&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-125"><a id="__codelineno-84-125" name="__codelineno-84-125" href="#__codelineno-84-125"></a><span class="w">  </span><span class="na">role</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.api_gateway_cloudwatch.name</span>
</span><span id="__span-84-126"><a id="__codelineno-84-126" name="__codelineno-84-126" href="#__codelineno-84-126"></a><span class="w">  </span><span class="na">policy_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;arn:aws:iam::aws:policy/service-role/AmazonAPIGatewayPushToCloudWatchLogs&quot;</span>
</span><span id="__span-84-127"><a id="__codelineno-84-127" name="__codelineno-84-127" href="#__codelineno-84-127"></a><span class="p">}</span>
</span><span id="__span-84-128"><a id="__codelineno-84-128" name="__codelineno-84-128" href="#__codelineno-84-128"></a>
</span><span id="__span-84-129"><a id="__codelineno-84-129" name="__codelineno-84-129" href="#__codelineno-84-129"></a><span class="c1"># Set up method settings for logging and throttling</span>
</span><span id="__span-84-130"><a id="__codelineno-84-130" name="__codelineno-84-130" href="#__codelineno-84-130"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_method_settings&quot;</span><span class="w"> </span><span class="nv">&quot;settings&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-131"><a id="__codelineno-84-131" name="__codelineno-84-131" href="#__codelineno-84-131"></a><span class="w">  </span><span class="na">rest_api_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-84-132"><a id="__codelineno-84-132" name="__codelineno-84-132" href="#__codelineno-84-132"></a><span class="w">  </span><span class="na">stage_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.stage_name</span>
</span><span id="__span-84-133"><a id="__codelineno-84-133" name="__codelineno-84-133" href="#__codelineno-84-133"></a><span class="w">  </span><span class="na">method_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*/*&quot;</span>
</span><span id="__span-84-134"><a id="__codelineno-84-134" name="__codelineno-84-134" href="#__codelineno-84-134"></a>
</span><span id="__span-84-135"><a id="__codelineno-84-135" name="__codelineno-84-135" href="#__codelineno-84-135"></a><span class="w">  </span><span class="nb">settings</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-136"><a id="__codelineno-84-136" name="__codelineno-84-136" href="#__codelineno-84-136"></a><span class="w">    </span><span class="na">metrics_enabled</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-84-137"><a id="__codelineno-84-137" name="__codelineno-84-137" href="#__codelineno-84-137"></a><span class="w">    </span><span class="na">logging_level</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;INFO&quot;</span>
</span><span id="__span-84-138"><a id="__codelineno-84-138" name="__codelineno-84-138" href="#__codelineno-84-138"></a><span class="w">    </span><span class="na">data_trace_enabled</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-84-139"><a id="__codelineno-84-139" name="__codelineno-84-139" href="#__codelineno-84-139"></a><span class="w">    </span><span class="na">throttling_rate_limit</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>
</span><span id="__span-84-140"><a id="__codelineno-84-140" name="__codelineno-84-140" href="#__codelineno-84-140"></a><span class="w">    </span><span class="na">throttling_burst_limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span>
</span><span id="__span-84-141"><a id="__codelineno-84-141" name="__codelineno-84-141" href="#__codelineno-84-141"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-84-142"><a id="__codelineno-84-142" name="__codelineno-84-142" href="#__codelineno-84-142"></a><span class="p">}</span>
</span><span id="__span-84-143"><a id="__codelineno-84-143" name="__codelineno-84-143" href="#__codelineno-84-143"></a>
</span><span id="__span-84-144"><a id="__codelineno-84-144" name="__codelineno-84-144" href="#__codelineno-84-144"></a><span class="c1"># Create a custom domain for the API</span>
</span><span id="__span-84-145"><a id="__codelineno-84-145" name="__codelineno-84-145" href="#__codelineno-84-145"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_domain_name&quot;</span><span class="w"> </span><span class="nv">&quot;api&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-146"><a id="__codelineno-84-146" name="__codelineno-84-146" href="#__codelineno-84-146"></a><span class="w">  </span><span class="na">domain_name</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;api.${var.domain_name}&quot;</span>
</span><span id="__span-84-147"><a id="__codelineno-84-147" name="__codelineno-84-147" href="#__codelineno-84-147"></a><span class="w">  </span><span class="na">regional_certificate_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.certificate_arn</span>
</span><span id="__span-84-148"><a id="__codelineno-84-148" name="__codelineno-84-148" href="#__codelineno-84-148"></a>
</span><span id="__span-84-149"><a id="__codelineno-84-149" name="__codelineno-84-149" href="#__codelineno-84-149"></a><span class="w">  </span><span class="nb">endpoint_configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-150"><a id="__codelineno-84-150" name="__codelineno-84-150" href="#__codelineno-84-150"></a><span class="w">    </span><span class="na">types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;REGIONAL&quot;</span><span class="p">]</span>
</span><span id="__span-84-151"><a id="__codelineno-84-151" name="__codelineno-84-151" href="#__codelineno-84-151"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-84-152"><a id="__codelineno-84-152" name="__codelineno-84-152" href="#__codelineno-84-152"></a>
</span><span id="__span-84-153"><a id="__codelineno-84-153" name="__codelineno-84-153" href="#__codelineno-84-153"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-154"><a id="__codelineno-84-154" name="__codelineno-84-154" href="#__codelineno-84-154"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume API Domain&quot;</span>
</span><span id="__span-84-155"><a id="__codelineno-84-155" name="__codelineno-84-155" href="#__codelineno-84-155"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-84-156"><a id="__codelineno-84-156" name="__codelineno-84-156" href="#__codelineno-84-156"></a><span class="w">    </span><span class="na">Project</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cloud Resume Challenge&quot;</span>
</span><span id="__span-84-157"><a id="__codelineno-84-157" name="__codelineno-84-157" href="#__codelineno-84-157"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-84-158"><a id="__codelineno-84-158" name="__codelineno-84-158" href="#__codelineno-84-158"></a><span class="p">}</span>
</span><span id="__span-84-159"><a id="__codelineno-84-159" name="__codelineno-84-159" href="#__codelineno-84-159"></a>
</span><span id="__span-84-160"><a id="__codelineno-84-160" name="__codelineno-84-160" href="#__codelineno-84-160"></a><span class="c1"># Create a base path mapping for the custom domain</span>
</span><span id="__span-84-161"><a id="__codelineno-84-161" name="__codelineno-84-161" href="#__codelineno-84-161"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_api_gateway_base_path_mapping&quot;</span><span class="w"> </span><span class="nv">&quot;api&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-162"><a id="__codelineno-84-162" name="__codelineno-84-162" href="#__codelineno-84-162"></a><span class="w">  </span><span class="na">api_id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.id</span>
</span><span id="__span-84-163"><a id="__codelineno-84-163" name="__codelineno-84-163" href="#__codelineno-84-163"></a><span class="w">  </span><span class="na">stage_name</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.stage_name</span>
</span><span id="__span-84-164"><a id="__codelineno-84-164" name="__codelineno-84-164" href="#__codelineno-84-164"></a><span class="w">  </span><span class="na">domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_domain_name.api.domain_name</span>
</span><span id="__span-84-165"><a id="__codelineno-84-165" name="__codelineno-84-165" href="#__codelineno-84-165"></a><span class="p">}</span>
</span><span id="__span-84-166"><a id="__codelineno-84-166" name="__codelineno-84-166" href="#__codelineno-84-166"></a>
</span><span id="__span-84-167"><a id="__codelineno-84-167" name="__codelineno-84-167" href="#__codelineno-84-167"></a><span class="c1"># Create a Route 53 record for the API domain</span>
</span><span id="__span-84-168"><a id="__codelineno-84-168" name="__codelineno-84-168" href="#__codelineno-84-168"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_record&quot;</span><span class="w"> </span><span class="nv">&quot;api&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-169"><a id="__codelineno-84-169" name="__codelineno-84-169" href="#__codelineno-84-169"></a><span class="w">  </span><span class="na">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_domain_name.api.domain_name</span>
</span><span id="__span-84-170"><a id="__codelineno-84-170" name="__codelineno-84-170" href="#__codelineno-84-170"></a><span class="w">  </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;A&quot;</span>
</span><span id="__span-84-171"><a id="__codelineno-84-171" name="__codelineno-84-171" href="#__codelineno-84-171"></a><span class="w">  </span><span class="na">zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.hosted_zone_id</span>
</span><span id="__span-84-172"><a id="__codelineno-84-172" name="__codelineno-84-172" href="#__codelineno-84-172"></a>
</span><span id="__span-84-173"><a id="__codelineno-84-173" name="__codelineno-84-173" href="#__codelineno-84-173"></a><span class="w">  </span><span class="nb">alias</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-174"><a id="__codelineno-84-174" name="__codelineno-84-174" href="#__codelineno-84-174"></a><span class="w">    </span><span class="na">name</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_domain_name.api.regional_domain_name</span>
</span><span id="__span-84-175"><a id="__codelineno-84-175" name="__codelineno-84-175" href="#__codelineno-84-175"></a><span class="w">    </span><span class="na">zone_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_domain_name.api.regional_zone_id</span>
</span><span id="__span-84-176"><a id="__codelineno-84-176" name="__codelineno-84-176" href="#__codelineno-84-176"></a><span class="w">    </span><span class="na">evaluate_target_health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-84-177"><a id="__codelineno-84-177" name="__codelineno-84-177" href="#__codelineno-84-177"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-84-178"><a id="__codelineno-84-178" name="__codelineno-84-178" href="#__codelineno-84-178"></a><span class="p">}</span>
</span></code></pre></div>
<p>The API Gateway configuration includes several enhancements:</p>
<ul>
<li>CloudWatch logging and metrics</li>
<li>Rate limiting and throttling to prevent abuse</li>
<li>Custom domain for a professional API endpoint</li>
<li>Proper Route 53 DNS configuration</li>
</ul>
<h4 id="4-variables-and-outputs"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#4-variables-and-outputs">4. Variables and Outputs 📝</a></h4>
<p>Create files at <code>modules/backend/variables.tf</code> and <code>modules/backend/outputs.tf</code>:</p>
<p><strong>variables.tf</strong>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;environment&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Deployment environment (e.g., dev, prod)&quot;</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="w">  </span><span class="na">default</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dev&quot;</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="p">}</span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;website_domain&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Domain of the resume website (for CORS)&quot;</span>
</span><span id="__span-85-9"><a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-85-10"><a id="__codelineno-85-10" name="__codelineno-85-10" href="#__codelineno-85-10"></a><span class="p">}</span>
</span><span id="__span-85-11"><a id="__codelineno-85-11" name="__codelineno-85-11" href="#__codelineno-85-11"></a>
</span><span id="__span-85-12"><a id="__codelineno-85-12" name="__codelineno-85-12" href="#__codelineno-85-12"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;domain_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-85-13"><a id="__codelineno-85-13" name="__codelineno-85-13" href="#__codelineno-85-13"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Base domain name for custom API endpoint&quot;</span>
</span><span id="__span-85-14"><a id="__codelineno-85-14" name="__codelineno-85-14" href="#__codelineno-85-14"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-85-15"><a id="__codelineno-85-15" name="__codelineno-85-15" href="#__codelineno-85-15"></a><span class="p">}</span>
</span><span id="__span-85-16"><a id="__codelineno-85-16" name="__codelineno-85-16" href="#__codelineno-85-16"></a>
</span><span id="__span-85-17"><a id="__codelineno-85-17" name="__codelineno-85-17" href="#__codelineno-85-17"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;hosted_zone_id&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-85-18"><a id="__codelineno-85-18" name="__codelineno-85-18" href="#__codelineno-85-18"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Route 53 hosted zone ID&quot;</span>
</span><span id="__span-85-19"><a id="__codelineno-85-19" name="__codelineno-85-19" href="#__codelineno-85-19"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-85-20"><a id="__codelineno-85-20" name="__codelineno-85-20" href="#__codelineno-85-20"></a><span class="p">}</span>
</span><span id="__span-85-21"><a id="__codelineno-85-21" name="__codelineno-85-21" href="#__codelineno-85-21"></a>
</span><span id="__span-85-22"><a id="__codelineno-85-22" name="__codelineno-85-22" href="#__codelineno-85-22"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;certificate_arn&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-85-23"><a id="__codelineno-85-23" name="__codelineno-85-23" href="#__codelineno-85-23"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ARN of the ACM certificate for the API domain&quot;</span>
</span><span id="__span-85-24"><a id="__codelineno-85-24" name="__codelineno-85-24" href="#__codelineno-85-24"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-85-25"><a id="__codelineno-85-25" name="__codelineno-85-25" href="#__codelineno-85-25"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>outputs.tf</strong>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;api_endpoint&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Endpoint URL of the API Gateway&quot;</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.invoke_url</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="p">}</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;api_custom_domain&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Custom domain for the API&quot;</span>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_domain_name.api.domain_name</span>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a><span class="p">}</span>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;dynamodb_table_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Name of the DynamoDB table&quot;</span>
</span><span id="__span-86-13"><a id="__codelineno-86-13" name="__codelineno-86-13" href="#__codelineno-86-13"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_dynamodb_table.visitor_counter.name</span>
</span><span id="__span-86-14"><a id="__codelineno-86-14" name="__codelineno-86-14" href="#__codelineno-86-14"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="5-source-control-for-backend-code"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#5-source-control-for-backend-code">5. Source Control for Backend Code 📚</a></h4>
<p>An important aspect of the Cloud Resume Challenge is using source control. We'll create a GitHub repository for our backend code. Here's how I organize my repository:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>resume-backend/
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a>├── .github/
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a>│   └── workflows/
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>│       └── deploy.yml  # GitHub Actions workflow (we&#39;ll create this in next post)
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a>├── lambda/
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a>│   └── visitor_counter.py
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a>├── terraform/
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a>│   ├── modules/
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a>│   │   ├── backend/
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a>│   │   │   ├── api_gateway.tf
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a>│   │   │   ├── dynamodb.tf
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a>│   │   │   ├── lambda.tf
</span><span id="__span-87-13"><a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a>│   │   │   ├── variables.tf
</span><span id="__span-87-14"><a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a>│   │   │   └── outputs.tf
</span><span id="__span-87-15"><a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a>│   ├── main.tf
</span><span id="__span-87-16"><a id="__codelineno-87-16" name="__codelineno-87-16" href="#__codelineno-87-16"></a>│   ├── variables.tf
</span><span id="__span-87-17"><a id="__codelineno-87-17" name="__codelineno-87-17" href="#__codelineno-87-17"></a>│   └── outputs.tf
</span><span id="__span-87-18"><a id="__codelineno-87-18" name="__codelineno-87-18" href="#__codelineno-87-18"></a>├── tests/
</span><span id="__span-87-19"><a id="__codelineno-87-19" name="__codelineno-87-19" href="#__codelineno-87-19"></a>│   └── test_visitor_counter.py  # Python unit tests
</span><span id="__span-87-20"><a id="__codelineno-87-20" name="__codelineno-87-20" href="#__codelineno-87-20"></a>└── README.md
</span></code></pre></div>
<h3 id="implementing-python-tests"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#implementing-python-tests">Implementing Python Tests 🧪</a></h3>
<p>For step 11 of the Cloud Resume Challenge, we need to include tests for our Python code. Create a file at <code>tests/test_visitor_counter.py</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">unittest.mock</span><span class="w"> </span><span class="kn">import</span> <span class="n">patch</span><span class="p">,</span> <span class="n">MagicMock</span>
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a>
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="c1"># Add lambda directory to the path so we can import the function</span>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">))</span>
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a>
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">visitor_counter</span>
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a>
</span><span id="__span-88-12"><a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a><span class="k">class</span><span class="w"> </span><span class="nc">TestVisitorCounter</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
</span><span id="__span-88-13"><a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test cases for the visitor counter Lambda function.&quot;&quot;&quot;</span>
</span><span id="__span-88-14"><a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a>
</span><span id="__span-88-15"><a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a>    <span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;visitor_counter.table&#39;</span><span class="p">)</span>
</span><span id="__span-88-16"><a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_lambda_handler_success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_table</span><span class="p">):</span>
</span><span id="__span-88-17"><a id="__codelineno-88-17" name="__codelineno-88-17" href="#__codelineno-88-17"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test successful execution of the lambda_handler function.&quot;&quot;&quot;</span>
</span><span id="__span-88-18"><a id="__codelineno-88-18" name="__codelineno-88-18" href="#__codelineno-88-18"></a>        <span class="c1"># Mock the DynamoDB responses</span>
</span><span id="__span-88-19"><a id="__codelineno-88-19" name="__codelineno-88-19" href="#__codelineno-88-19"></a>        <span class="n">mock_put_response</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
</span><span id="__span-88-20"><a id="__codelineno-88-20" name="__codelineno-88-20" href="#__codelineno-88-20"></a>        <span class="n">mock_update_response</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-88-21"><a id="__codelineno-88-21" name="__codelineno-88-21" href="#__codelineno-88-21"></a>            <span class="s1">&#39;Attributes&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-88-22"><a id="__codelineno-88-22" name="__codelineno-88-22" href="#__codelineno-88-22"></a>                <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="mi">42</span>
</span><span id="__span-88-23"><a id="__codelineno-88-23" name="__codelineno-88-23" href="#__codelineno-88-23"></a>            <span class="p">}</span>
</span><span id="__span-88-24"><a id="__codelineno-88-24" name="__codelineno-88-24" href="#__codelineno-88-24"></a>        <span class="p">}</span>
</span><span id="__span-88-25"><a id="__codelineno-88-25" name="__codelineno-88-25" href="#__codelineno-88-25"></a>        <span class="n">mock_table</span><span class="o">.</span><span class="n">put_item</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock_put_response</span>
</span><span id="__span-88-26"><a id="__codelineno-88-26" name="__codelineno-88-26" href="#__codelineno-88-26"></a>        <span class="n">mock_table</span><span class="o">.</span><span class="n">update_item</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock_update_response</span>
</span><span id="__span-88-27"><a id="__codelineno-88-27" name="__codelineno-88-27" href="#__codelineno-88-27"></a>
</span><span id="__span-88-28"><a id="__codelineno-88-28" name="__codelineno-88-28" href="#__codelineno-88-28"></a>        <span class="c1"># Set required environment variables</span>
</span><span id="__span-88-29"><a id="__codelineno-88-29" name="__codelineno-88-29" href="#__codelineno-88-29"></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DYNAMODB_TABLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;test-table&#39;</span>
</span><span id="__span-88-30"><a id="__codelineno-88-30" name="__codelineno-88-30" href="#__codelineno-88-30"></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ALLOWED_ORIGIN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://example.com&#39;</span>
</span><span id="__span-88-31"><a id="__codelineno-88-31" name="__codelineno-88-31" href="#__codelineno-88-31"></a>
</span><span id="__span-88-32"><a id="__codelineno-88-32" name="__codelineno-88-32" href="#__codelineno-88-32"></a>        <span class="c1"># Create a test event</span>
</span><span id="__span-88-33"><a id="__codelineno-88-33" name="__codelineno-88-33" href="#__codelineno-88-33"></a>        <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-88-34"><a id="__codelineno-88-34" name="__codelineno-88-34" href="#__codelineno-88-34"></a>            <span class="s1">&#39;httpMethod&#39;</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span><span id="__span-88-35"><a id="__codelineno-88-35" name="__codelineno-88-35" href="#__codelineno-88-35"></a>            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;/count&#39;</span><span class="p">,</span>
</span><span id="__span-88-36"><a id="__codelineno-88-36" name="__codelineno-88-36" href="#__codelineno-88-36"></a>            <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-88-37"><a id="__codelineno-88-37" name="__codelineno-88-37" href="#__codelineno-88-37"></a>                <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;test-agent&#39;</span>
</span><span id="__span-88-38"><a id="__codelineno-88-38" name="__codelineno-88-38" href="#__codelineno-88-38"></a>            <span class="p">},</span>
</span><span id="__span-88-39"><a id="__codelineno-88-39" name="__codelineno-88-39" href="#__codelineno-88-39"></a>            <span class="s1">&#39;requestContext&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-88-40"><a id="__codelineno-88-40" name="__codelineno-88-40" href="#__codelineno-88-40"></a>                <span class="s1">&#39;identity&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-88-41"><a id="__codelineno-88-41" name="__codelineno-88-41" href="#__codelineno-88-41"></a>                    <span class="s1">&#39;sourceIp&#39;</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1&#39;</span>
</span><span id="__span-88-42"><a id="__codelineno-88-42" name="__codelineno-88-42" href="#__codelineno-88-42"></a>                <span class="p">}</span>
</span><span id="__span-88-43"><a id="__codelineno-88-43" name="__codelineno-88-43" href="#__codelineno-88-43"></a>            <span class="p">}</span>
</span><span id="__span-88-44"><a id="__codelineno-88-44" name="__codelineno-88-44" href="#__codelineno-88-44"></a>        <span class="p">}</span>
</span><span id="__span-88-45"><a id="__codelineno-88-45" name="__codelineno-88-45" href="#__codelineno-88-45"></a>
</span><span id="__span-88-46"><a id="__codelineno-88-46" name="__codelineno-88-46" href="#__codelineno-88-46"></a>        <span class="c1"># Call the function</span>
</span><span id="__span-88-47"><a id="__codelineno-88-47" name="__codelineno-88-47" href="#__codelineno-88-47"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">visitor_counter</span><span class="o">.</span><span class="n">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-88-48"><a id="__codelineno-88-48" name="__codelineno-88-48" href="#__codelineno-88-48"></a>
</span><span id="__span-88-49"><a id="__codelineno-88-49" name="__codelineno-88-49" href="#__codelineno-88-49"></a>        <span class="c1"># Assert response is correct</span>
</span><span id="__span-88-50"><a id="__codelineno-88-50" name="__codelineno-88-50" href="#__codelineno-88-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;statusCode&#39;</span><span class="p">],</span> <span class="mi">200</span><span class="p">)</span>
</span><span id="__span-88-51"><a id="__codelineno-88-51" name="__codelineno-88-51" href="#__codelineno-88-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">][</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">],</span> <span class="s1">&#39;application/json&#39;</span><span class="p">)</span>
</span><span id="__span-88-52"><a id="__codelineno-88-52" name="__codelineno-88-52" href="#__codelineno-88-52"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">][</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">],</span> <span class="s1">&#39;https://example.com&#39;</span><span class="p">)</span>
</span><span id="__span-88-53"><a id="__codelineno-88-53" name="__codelineno-88-53" href="#__codelineno-88-53"></a>
</span><span id="__span-88-54"><a id="__codelineno-88-54" name="__codelineno-88-54" href="#__codelineno-88-54"></a>        <span class="c1"># Parse the body and check the count</span>
</span><span id="__span-88-55"><a id="__codelineno-88-55" name="__codelineno-88-55" href="#__codelineno-88-55"></a>        <span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">])</span>
</span><span id="__span-88-56"><a id="__codelineno-88-56" name="__codelineno-88-56" href="#__codelineno-88-56"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">],</span> <span class="mi">42</span><span class="p">)</span>
</span><span id="__span-88-57"><a id="__codelineno-88-57" name="__codelineno-88-57" href="#__codelineno-88-57"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">],</span> <span class="s1">&#39;Visitor count updated successfully&#39;</span><span class="p">)</span>
</span><span id="__span-88-58"><a id="__codelineno-88-58" name="__codelineno-88-58" href="#__codelineno-88-58"></a>
</span><span id="__span-88-59"><a id="__codelineno-88-59" name="__codelineno-88-59" href="#__codelineno-88-59"></a>        <span class="c1"># Verify that DynamoDB was called correctly</span>
</span><span id="__span-88-60"><a id="__codelineno-88-60" name="__codelineno-88-60" href="#__codelineno-88-60"></a>        <span class="n">mock_table</span><span class="o">.</span><span class="n">put_item</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
</span><span id="__span-88-61"><a id="__codelineno-88-61" name="__codelineno-88-61" href="#__codelineno-88-61"></a>        <span class="n">mock_table</span><span class="o">.</span><span class="n">update_item</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span>
</span><span id="__span-88-62"><a id="__codelineno-88-62" name="__codelineno-88-62" href="#__codelineno-88-62"></a>            <span class="n">Key</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;visit_id&#39;</span><span class="p">:</span> <span class="s1">&#39;total&#39;</span><span class="p">},</span>
</span><span id="__span-88-63"><a id="__codelineno-88-63" name="__codelineno-88-63" href="#__codelineno-88-63"></a>            <span class="n">UpdateExpression</span><span class="o">=</span><span class="s1">&#39;ADD #count :incr&#39;</span><span class="p">,</span>
</span><span id="__span-88-64"><a id="__codelineno-88-64" name="__codelineno-88-64" href="#__codelineno-88-64"></a>            <span class="n">ExpressionAttributeNames</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;#count&#39;</span><span class="p">:</span> <span class="s1">&#39;count&#39;</span><span class="p">},</span>
</span><span id="__span-88-65"><a id="__codelineno-88-65" name="__codelineno-88-65" href="#__codelineno-88-65"></a>            <span class="n">ExpressionAttributeValues</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;:incr&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
</span><span id="__span-88-66"><a id="__codelineno-88-66" name="__codelineno-88-66" href="#__codelineno-88-66"></a>            <span class="n">ReturnValues</span><span class="o">=</span><span class="s1">&#39;UPDATED_NEW&#39;</span>
</span><span id="__span-88-67"><a id="__codelineno-88-67" name="__codelineno-88-67" href="#__codelineno-88-67"></a>        <span class="p">)</span>
</span><span id="__span-88-68"><a id="__codelineno-88-68" name="__codelineno-88-68" href="#__codelineno-88-68"></a>
</span><span id="__span-88-69"><a id="__codelineno-88-69" name="__codelineno-88-69" href="#__codelineno-88-69"></a>    <span class="nd">@patch</span><span class="p">(</span><span class="s1">&#39;visitor_counter.table&#39;</span><span class="p">)</span>
</span><span id="__span-88-70"><a id="__codelineno-88-70" name="__codelineno-88-70" href="#__codelineno-88-70"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_lambda_handler_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_table</span><span class="p">):</span>
</span><span id="__span-88-71"><a id="__codelineno-88-71" name="__codelineno-88-71" href="#__codelineno-88-71"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test error handling in the lambda_handler function.&quot;&quot;&quot;</span>
</span><span id="__span-88-72"><a id="__codelineno-88-72" name="__codelineno-88-72" href="#__codelineno-88-72"></a>        <span class="c1"># Simulate a DynamoDB error</span>
</span><span id="__span-88-73"><a id="__codelineno-88-73" name="__codelineno-88-73" href="#__codelineno-88-73"></a>        <span class="n">mock_table</span><span class="o">.</span><span class="n">update_item</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Test error&quot;</span><span class="p">)</span>
</span><span id="__span-88-74"><a id="__codelineno-88-74" name="__codelineno-88-74" href="#__codelineno-88-74"></a>
</span><span id="__span-88-75"><a id="__codelineno-88-75" name="__codelineno-88-75" href="#__codelineno-88-75"></a>        <span class="c1"># Set required environment variables</span>
</span><span id="__span-88-76"><a id="__codelineno-88-76" name="__codelineno-88-76" href="#__codelineno-88-76"></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DYNAMODB_TABLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;test-table&#39;</span>
</span><span id="__span-88-77"><a id="__codelineno-88-77" name="__codelineno-88-77" href="#__codelineno-88-77"></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ALLOWED_ORIGIN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://example.com&#39;</span>
</span><span id="__span-88-78"><a id="__codelineno-88-78" name="__codelineno-88-78" href="#__codelineno-88-78"></a>
</span><span id="__span-88-79"><a id="__codelineno-88-79" name="__codelineno-88-79" href="#__codelineno-88-79"></a>        <span class="c1"># Create a test event</span>
</span><span id="__span-88-80"><a id="__codelineno-88-80" name="__codelineno-88-80" href="#__codelineno-88-80"></a>        <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-88-81"><a id="__codelineno-88-81" name="__codelineno-88-81" href="#__codelineno-88-81"></a>            <span class="s1">&#39;httpMethod&#39;</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span><span id="__span-88-82"><a id="__codelineno-88-82" name="__codelineno-88-82" href="#__codelineno-88-82"></a>            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;/count&#39;</span><span class="p">,</span>
</span><span id="__span-88-83"><a id="__codelineno-88-83" name="__codelineno-88-83" href="#__codelineno-88-83"></a>            <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-88-84"><a id="__codelineno-88-84" name="__codelineno-88-84" href="#__codelineno-88-84"></a>                <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;test-agent&#39;</span>
</span><span id="__span-88-85"><a id="__codelineno-88-85" name="__codelineno-88-85" href="#__codelineno-88-85"></a>            <span class="p">},</span>
</span><span id="__span-88-86"><a id="__codelineno-88-86" name="__codelineno-88-86" href="#__codelineno-88-86"></a>            <span class="s1">&#39;requestContext&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-88-87"><a id="__codelineno-88-87" name="__codelineno-88-87" href="#__codelineno-88-87"></a>                <span class="s1">&#39;identity&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-88-88"><a id="__codelineno-88-88" name="__codelineno-88-88" href="#__codelineno-88-88"></a>                    <span class="s1">&#39;sourceIp&#39;</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1&#39;</span>
</span><span id="__span-88-89"><a id="__codelineno-88-89" name="__codelineno-88-89" href="#__codelineno-88-89"></a>                <span class="p">}</span>
</span><span id="__span-88-90"><a id="__codelineno-88-90" name="__codelineno-88-90" href="#__codelineno-88-90"></a>            <span class="p">}</span>
</span><span id="__span-88-91"><a id="__codelineno-88-91" name="__codelineno-88-91" href="#__codelineno-88-91"></a>        <span class="p">}</span>
</span><span id="__span-88-92"><a id="__codelineno-88-92" name="__codelineno-88-92" href="#__codelineno-88-92"></a>
</span><span id="__span-88-93"><a id="__codelineno-88-93" name="__codelineno-88-93" href="#__codelineno-88-93"></a>        <span class="c1"># Call the function</span>
</span><span id="__span-88-94"><a id="__codelineno-88-94" name="__codelineno-88-94" href="#__codelineno-88-94"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">visitor_counter</span><span class="o">.</span><span class="n">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-88-95"><a id="__codelineno-88-95" name="__codelineno-88-95" href="#__codelineno-88-95"></a>
</span><span id="__span-88-96"><a id="__codelineno-88-96" name="__codelineno-88-96" href="#__codelineno-88-96"></a>        <span class="c1"># Assert response indicates an error</span>
</span><span id="__span-88-97"><a id="__codelineno-88-97" name="__codelineno-88-97" href="#__codelineno-88-97"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;statusCode&#39;</span><span class="p">],</span> <span class="mi">500</span><span class="p">)</span>
</span><span id="__span-88-98"><a id="__codelineno-88-98" name="__codelineno-88-98" href="#__codelineno-88-98"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">][</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">],</span> <span class="s1">&#39;application/json&#39;</span><span class="p">)</span>
</span><span id="__span-88-99"><a id="__codelineno-88-99" name="__codelineno-88-99" href="#__codelineno-88-99"></a>
</span><span id="__span-88-100"><a id="__codelineno-88-100" name="__codelineno-88-100" href="#__codelineno-88-100"></a>        <span class="c1"># Parse the body and check the error message</span>
</span><span id="__span-88-101"><a id="__codelineno-88-101" name="__codelineno-88-101" href="#__codelineno-88-101"></a>        <span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">])</span>
</span><span id="__span-88-102"><a id="__codelineno-88-102" name="__codelineno-88-102" href="#__codelineno-88-102"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
</span><span id="__span-88-103"><a id="__codelineno-88-103" name="__codelineno-88-103" href="#__codelineno-88-103"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
</span><span id="__span-88-104"><a id="__codelineno-88-104" name="__codelineno-88-104" href="#__codelineno-88-104"></a>
</span><span id="__span-88-105"><a id="__codelineno-88-105" name="__codelineno-88-105" href="#__codelineno-88-105"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_options_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-88-106"><a id="__codelineno-88-106" name="__codelineno-88-106" href="#__codelineno-88-106"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the OPTIONS handler for CORS support.&quot;&quot;&quot;</span>
</span><span id="__span-88-107"><a id="__codelineno-88-107" name="__codelineno-88-107" href="#__codelineno-88-107"></a>        <span class="c1"># Set required environment variables</span>
</span><span id="__span-88-108"><a id="__codelineno-88-108" name="__codelineno-88-108" href="#__codelineno-88-108"></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ALLOWED_ORIGIN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://example.com&#39;</span>
</span><span id="__span-88-109"><a id="__codelineno-88-109" name="__codelineno-88-109" href="#__codelineno-88-109"></a>
</span><span id="__span-88-110"><a id="__codelineno-88-110" name="__codelineno-88-110" href="#__codelineno-88-110"></a>        <span class="c1"># Create a test event</span>
</span><span id="__span-88-111"><a id="__codelineno-88-111" name="__codelineno-88-111" href="#__codelineno-88-111"></a>        <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-88-112"><a id="__codelineno-88-112" name="__codelineno-88-112" href="#__codelineno-88-112"></a>            <span class="s1">&#39;httpMethod&#39;</span><span class="p">:</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">,</span>
</span><span id="__span-88-113"><a id="__codelineno-88-113" name="__codelineno-88-113" href="#__codelineno-88-113"></a>            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;/count&#39;</span><span class="p">,</span>
</span><span id="__span-88-114"><a id="__codelineno-88-114" name="__codelineno-88-114" href="#__codelineno-88-114"></a>            <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-88-115"><a id="__codelineno-88-115" name="__codelineno-88-115" href="#__codelineno-88-115"></a>                <span class="s1">&#39;Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;https://example.com&#39;</span>
</span><span id="__span-88-116"><a id="__codelineno-88-116" name="__codelineno-88-116" href="#__codelineno-88-116"></a>            <span class="p">}</span>
</span><span id="__span-88-117"><a id="__codelineno-88-117" name="__codelineno-88-117" href="#__codelineno-88-117"></a>        <span class="p">}</span>
</span><span id="__span-88-118"><a id="__codelineno-88-118" name="__codelineno-88-118" href="#__codelineno-88-118"></a>
</span><span id="__span-88-119"><a id="__codelineno-88-119" name="__codelineno-88-119" href="#__codelineno-88-119"></a>        <span class="c1"># Call the function</span>
</span><span id="__span-88-120"><a id="__codelineno-88-120" name="__codelineno-88-120" href="#__codelineno-88-120"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">visitor_counter</span><span class="o">.</span><span class="n">options_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-88-121"><a id="__codelineno-88-121" name="__codelineno-88-121" href="#__codelineno-88-121"></a>
</span><span id="__span-88-122"><a id="__codelineno-88-122" name="__codelineno-88-122" href="#__codelineno-88-122"></a>        <span class="c1"># Assert response is correct for OPTIONS</span>
</span><span id="__span-88-123"><a id="__codelineno-88-123" name="__codelineno-88-123" href="#__codelineno-88-123"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;statusCode&#39;</span><span class="p">],</span> <span class="mi">200</span><span class="p">)</span>
</span><span id="__span-88-124"><a id="__codelineno-88-124" name="__codelineno-88-124" href="#__codelineno-88-124"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">][</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">],</span> <span class="s1">&#39;https://example.com&#39;</span><span class="p">)</span>
</span><span id="__span-88-125"><a id="__codelineno-88-125" name="__codelineno-88-125" href="#__codelineno-88-125"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">][</span><span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">],</span> <span class="s1">&#39;GET, OPTIONS&#39;</span><span class="p">)</span>
</span><span id="__span-88-126"><a id="__codelineno-88-126" name="__codelineno-88-126" href="#__codelineno-88-126"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">][</span><span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">],</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">)</span>
</span><span id="__span-88-127"><a id="__codelineno-88-127" name="__codelineno-88-127" href="#__codelineno-88-127"></a>
</span><span id="__span-88-128"><a id="__codelineno-88-128" name="__codelineno-88-128" href="#__codelineno-88-128"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span id="__span-88-129"><a id="__codelineno-88-129" name="__codelineno-88-129" href="#__codelineno-88-129"></a>    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
<p>This test suite covers:</p>
<ul>
<li>Successful API calls</li>
<li>Error handling</li>
<li>CORS OPTIONS request handling</li>
</ul>
<p>To run these tests, you would use the following command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>python<span class="w"> </span>-m<span class="w"> </span>unittest<span class="w"> </span>tests/test_visitor_counter.py
</span></code></pre></div>
<h3 id="testing-the-api-manually"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#testing-the-api-manually">Testing the API Manually 🧪</a></h3>
<p>Once you've deployed the API, you can test it manually using tools like cURL or Postman. Here's how to test with cURL:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="c1"># Get the current visitor count</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>https://api.yourdomain.com/count
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="c1"># Test CORS pre-flight request</span>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a>curl<span class="w"> </span>-X<span class="w"> </span>OPTIONS<span class="w"> </span>https://api.yourdomain.com/count<span class="w"> </span><span class="se">\</span>
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Origin: https://yourdomain.com&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-90-7"><a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Access-Control-Request-Method: GET&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Access-Control-Request-Headers: Content-Type&quot;</span>
</span></code></pre></div>
<p>For Postman:</p>
<ol>
<li>Create a new GET request to your API endpoint (<code>https://api.yourdomain.com/count</code>)</li>
<li>Send the request and verify you get a 200 response with a JSON body</li>
<li>Create a new OPTIONS request to test CORS</li>
<li>Add headers: <code>Origin: https://yourdomain.com</code>, <code>Access-Control-Request-Method: GET</code></li>
<li>Send the request and verify you get a 200 response with the correct CORS headers</li>
</ol>
<h3 id="setting-up-cloudwatch-monitoring-and-alarms"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#setting-up-cloudwatch-monitoring-and-alarms">Setting Up CloudWatch Monitoring and Alarms ⚠️</a></h3>
<p>Adding monitoring and alerting is a critical part of any production-grade API. Let's add CloudWatch alarms to notify us if something goes wrong:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="c1"># Add to modules/backend/monitoring.tf</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="c1"># Alarm for Lambda errors</span>
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_metric_alarm&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_errors&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="w">  </span><span class="na">alarm_name</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda-visitor-counter-errors-${var.environment}&quot;</span>
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a><span class="w">  </span><span class="na">comparison_operator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;GreaterThanThreshold&quot;</span>
</span><span id="__span-91-7"><a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a><span class="w">  </span><span class="na">evaluation_periods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-91-8"><a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a><span class="w">  </span><span class="na">metric_name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Errors&quot;</span>
</span><span id="__span-91-9"><a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a><span class="w">  </span><span class="na">namespace</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWS/Lambda&quot;</span>
</span><span id="__span-91-10"><a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a><span class="w">  </span><span class="na">period</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="m">60</span>
</span><span id="__span-91-11"><a id="__codelineno-91-11" name="__codelineno-91-11" href="#__codelineno-91-11"></a><span class="w">  </span><span class="na">statistic</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Sum&quot;</span>
</span><span id="__span-91-12"><a id="__codelineno-91-12" name="__codelineno-91-12" href="#__codelineno-91-12"></a><span class="w">  </span><span class="na">threshold</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-91-13"><a id="__codelineno-91-13" name="__codelineno-91-13" href="#__codelineno-91-13"></a><span class="w">  </span><span class="na">alarm_description</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;This alarm monitors for errors in the visitor counter Lambda function&quot;</span>
</span><span id="__span-91-14"><a id="__codelineno-91-14" name="__codelineno-91-14" href="#__codelineno-91-14"></a>
</span><span id="__span-91-15"><a id="__codelineno-91-15" name="__codelineno-91-15" href="#__codelineno-91-15"></a><span class="w">  </span><span class="nb">dimensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-16"><a id="__codelineno-91-16" name="__codelineno-91-16" href="#__codelineno-91-16"></a><span class="w">    </span><span class="na">FunctionName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.visitor_counter.function_name</span>
</span><span id="__span-91-17"><a id="__codelineno-91-17" name="__codelineno-91-17" href="#__codelineno-91-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-91-18"><a id="__codelineno-91-18" name="__codelineno-91-18" href="#__codelineno-91-18"></a>
</span><span id="__span-91-19"><a id="__codelineno-91-19" name="__codelineno-91-19" href="#__codelineno-91-19"></a><span class="c1">  # Add SNS topic ARN if you want notifications</span>
</span><span id="__span-91-20"><a id="__codelineno-91-20" name="__codelineno-91-20" href="#__codelineno-91-20"></a><span class="c1">  # alarm_actions     = [aws_sns_topic.alerts.arn]</span>
</span><span id="__span-91-21"><a id="__codelineno-91-21" name="__codelineno-91-21" href="#__codelineno-91-21"></a><span class="c1">  # ok_actions        = [aws_sns_topic.alerts.arn]</span>
</span><span id="__span-91-22"><a id="__codelineno-91-22" name="__codelineno-91-22" href="#__codelineno-91-22"></a><span class="p">}</span>
</span><span id="__span-91-23"><a id="__codelineno-91-23" name="__codelineno-91-23" href="#__codelineno-91-23"></a>
</span><span id="__span-91-24"><a id="__codelineno-91-24" name="__codelineno-91-24" href="#__codelineno-91-24"></a><span class="c1"># Alarm for API Gateway 5XX errors</span>
</span><span id="__span-91-25"><a id="__codelineno-91-25" name="__codelineno-91-25" href="#__codelineno-91-25"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_metric_alarm&quot;</span><span class="w"> </span><span class="nv">&quot;api_5xx_errors&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-26"><a id="__codelineno-91-26" name="__codelineno-91-26" href="#__codelineno-91-26"></a><span class="w">  </span><span class="na">alarm_name</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;api-visitor-counter-5xx-errors-${var.environment}&quot;</span>
</span><span id="__span-91-27"><a id="__codelineno-91-27" name="__codelineno-91-27" href="#__codelineno-91-27"></a><span class="w">  </span><span class="na">comparison_operator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;GreaterThanThreshold&quot;</span>
</span><span id="__span-91-28"><a id="__codelineno-91-28" name="__codelineno-91-28" href="#__codelineno-91-28"></a><span class="w">  </span><span class="na">evaluation_periods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-91-29"><a id="__codelineno-91-29" name="__codelineno-91-29" href="#__codelineno-91-29"></a><span class="w">  </span><span class="na">metric_name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;5XXError&quot;</span>
</span><span id="__span-91-30"><a id="__codelineno-91-30" name="__codelineno-91-30" href="#__codelineno-91-30"></a><span class="w">  </span><span class="na">namespace</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWS/ApiGateway&quot;</span>
</span><span id="__span-91-31"><a id="__codelineno-91-31" name="__codelineno-91-31" href="#__codelineno-91-31"></a><span class="w">  </span><span class="na">period</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="m">60</span>
</span><span id="__span-91-32"><a id="__codelineno-91-32" name="__codelineno-91-32" href="#__codelineno-91-32"></a><span class="w">  </span><span class="na">statistic</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Sum&quot;</span>
</span><span id="__span-91-33"><a id="__codelineno-91-33" name="__codelineno-91-33" href="#__codelineno-91-33"></a><span class="w">  </span><span class="na">threshold</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-91-34"><a id="__codelineno-91-34" name="__codelineno-91-34" href="#__codelineno-91-34"></a><span class="w">  </span><span class="na">alarm_description</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;This alarm monitors for 5XX errors in the visitor counter API&quot;</span>
</span><span id="__span-91-35"><a id="__codelineno-91-35" name="__codelineno-91-35" href="#__codelineno-91-35"></a>
</span><span id="__span-91-36"><a id="__codelineno-91-36" name="__codelineno-91-36" href="#__codelineno-91-36"></a><span class="w">  </span><span class="nb">dimensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-37"><a id="__codelineno-91-37" name="__codelineno-91-37" href="#__codelineno-91-37"></a><span class="w">    </span><span class="na">ApiName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_rest_api.visitor_counter.name</span>
</span><span id="__span-91-38"><a id="__codelineno-91-38" name="__codelineno-91-38" href="#__codelineno-91-38"></a><span class="w">    </span><span class="na">Stage</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.stage_name</span>
</span><span id="__span-91-39"><a id="__codelineno-91-39" name="__codelineno-91-39" href="#__codelineno-91-39"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-91-40"><a id="__codelineno-91-40" name="__codelineno-91-40" href="#__codelineno-91-40"></a>
</span><span id="__span-91-41"><a id="__codelineno-91-41" name="__codelineno-91-41" href="#__codelineno-91-41"></a><span class="c1">  # Add SNS topic ARN if you want notifications</span>
</span><span id="__span-91-42"><a id="__codelineno-91-42" name="__codelineno-91-42" href="#__codelineno-91-42"></a><span class="c1">  # alarm_actions     = [aws_sns_topic.alerts.arn]</span>
</span><span id="__span-91-43"><a id="__codelineno-91-43" name="__codelineno-91-43" href="#__codelineno-91-43"></a><span class="c1">  # ok_actions        = [aws_sns_topic.alerts.arn]</span>
</span><span id="__span-91-44"><a id="__codelineno-91-44" name="__codelineno-91-44" href="#__codelineno-91-44"></a><span class="p">}</span>
</span><span id="__span-91-45"><a id="__codelineno-91-45" name="__codelineno-91-45" href="#__codelineno-91-45"></a>
</span><span id="__span-91-46"><a id="__codelineno-91-46" name="__codelineno-91-46" href="#__codelineno-91-46"></a><span class="c1"># Dashboard for monitoring the API</span>
</span><span id="__span-91-47"><a id="__codelineno-91-47" name="__codelineno-91-47" href="#__codelineno-91-47"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudwatch_dashboard&quot;</span><span class="w"> </span><span class="nv">&quot;api_dashboard&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-48"><a id="__codelineno-91-48" name="__codelineno-91-48" href="#__codelineno-91-48"></a><span class="w">  </span><span class="na">dashboard_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;visitor-counter-dashboard-${var.environment}&quot;</span>
</span><span id="__span-91-49"><a id="__codelineno-91-49" name="__codelineno-91-49" href="#__codelineno-91-49"></a>
</span><span id="__span-91-50"><a id="__codelineno-91-50" name="__codelineno-91-50" href="#__codelineno-91-50"></a><span class="w">  </span><span class="na">dashboard_body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-91-51"><a id="__codelineno-91-51" name="__codelineno-91-51" href="#__codelineno-91-51"></a><span class="w">    </span><span class="na">widgets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-91-52"><a id="__codelineno-91-52" name="__codelineno-91-52" href="#__codelineno-91-52"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-91-53"><a id="__codelineno-91-53" name="__codelineno-91-53" href="#__codelineno-91-53"></a><span class="w">        </span><span class="na">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;metric&quot;</span>
</span><span id="__span-91-54"><a id="__codelineno-91-54" name="__codelineno-91-54" href="#__codelineno-91-54"></a><span class="w">        </span><span class="na">x</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-91-55"><a id="__codelineno-91-55" name="__codelineno-91-55" href="#__codelineno-91-55"></a><span class="w">        </span><span class="na">y</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-91-56"><a id="__codelineno-91-56" name="__codelineno-91-56" href="#__codelineno-91-56"></a><span class="w">        </span><span class="na">width</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">12</span>
</span><span id="__span-91-57"><a id="__codelineno-91-57" name="__codelineno-91-57" href="#__codelineno-91-57"></a><span class="w">        </span><span class="na">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span>
</span><span id="__span-91-58"><a id="__codelineno-91-58" name="__codelineno-91-58" href="#__codelineno-91-58"></a><span class="w">        </span><span class="nb">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-59"><a id="__codelineno-91-59" name="__codelineno-91-59" href="#__codelineno-91-59"></a><span class="w">          </span><span class="na">metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-91-60"><a id="__codelineno-91-60" name="__codelineno-91-60" href="#__codelineno-91-60"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;AWS/ApiGateway&quot;, &quot;Count&quot;, &quot;ApiName&quot;, aws_api_gateway_rest_api.visitor_counter.name, &quot;Stage&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.stage_name</span><span class="p">]</span>
</span><span id="__span-91-61"><a id="__codelineno-91-61" name="__codelineno-91-61" href="#__codelineno-91-61"></a><span class="w">          </span><span class="p">]</span>
</span><span id="__span-91-62"><a id="__codelineno-91-62" name="__codelineno-91-62" href="#__codelineno-91-62"></a><span class="w">          </span><span class="na">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span>
</span><span id="__span-91-63"><a id="__codelineno-91-63" name="__codelineno-91-63" href="#__codelineno-91-63"></a><span class="w">          </span><span class="na">stat</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Sum&quot;</span>
</span><span id="__span-91-64"><a id="__codelineno-91-64" name="__codelineno-91-64" href="#__codelineno-91-64"></a><span class="w">          </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-91-65"><a id="__codelineno-91-65" name="__codelineno-91-65" href="#__codelineno-91-65"></a><span class="w">          </span><span class="na">title</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;API Requests&quot;</span>
</span><span id="__span-91-66"><a id="__codelineno-91-66" name="__codelineno-91-66" href="#__codelineno-91-66"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-91-67"><a id="__codelineno-91-67" name="__codelineno-91-67" href="#__codelineno-91-67"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-91-68"><a id="__codelineno-91-68" name="__codelineno-91-68" href="#__codelineno-91-68"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-91-69"><a id="__codelineno-91-69" name="__codelineno-91-69" href="#__codelineno-91-69"></a><span class="w">        </span><span class="na">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;metric&quot;</span>
</span><span id="__span-91-70"><a id="__codelineno-91-70" name="__codelineno-91-70" href="#__codelineno-91-70"></a><span class="w">        </span><span class="na">x</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">12</span>
</span><span id="__span-91-71"><a id="__codelineno-91-71" name="__codelineno-91-71" href="#__codelineno-91-71"></a><span class="w">        </span><span class="na">y</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-91-72"><a id="__codelineno-91-72" name="__codelineno-91-72" href="#__codelineno-91-72"></a><span class="w">        </span><span class="na">width</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">12</span>
</span><span id="__span-91-73"><a id="__codelineno-91-73" name="__codelineno-91-73" href="#__codelineno-91-73"></a><span class="w">        </span><span class="na">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span>
</span><span id="__span-91-74"><a id="__codelineno-91-74" name="__codelineno-91-74" href="#__codelineno-91-74"></a><span class="w">        </span><span class="nb">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-75"><a id="__codelineno-91-75" name="__codelineno-91-75" href="#__codelineno-91-75"></a><span class="w">          </span><span class="na">metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-91-76"><a id="__codelineno-91-76" name="__codelineno-91-76" href="#__codelineno-91-76"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;AWS/ApiGateway&quot;, &quot;4XXError&quot;, &quot;ApiName&quot;, aws_api_gateway_rest_api.visitor_counter.name, &quot;Stage&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.stage_name</span><span class="p">],</span>
</span><span id="__span-91-77"><a id="__codelineno-91-77" name="__codelineno-91-77" href="#__codelineno-91-77"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;AWS/ApiGateway&quot;, &quot;5XXError&quot;, &quot;ApiName&quot;, aws_api_gateway_rest_api.visitor_counter.name, &quot;Stage&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">aws_api_gateway_deployment.visitor_counter.stage_name</span><span class="p">]</span>
</span><span id="__span-91-78"><a id="__codelineno-91-78" name="__codelineno-91-78" href="#__codelineno-91-78"></a><span class="w">          </span><span class="p">]</span>
</span><span id="__span-91-79"><a id="__codelineno-91-79" name="__codelineno-91-79" href="#__codelineno-91-79"></a><span class="w">          </span><span class="na">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span>
</span><span id="__span-91-80"><a id="__codelineno-91-80" name="__codelineno-91-80" href="#__codelineno-91-80"></a><span class="w">          </span><span class="na">stat</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Sum&quot;</span>
</span><span id="__span-91-81"><a id="__codelineno-91-81" name="__codelineno-91-81" href="#__codelineno-91-81"></a><span class="w">          </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-91-82"><a id="__codelineno-91-82" name="__codelineno-91-82" href="#__codelineno-91-82"></a><span class="w">          </span><span class="na">title</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;API Errors&quot;</span>
</span><span id="__span-91-83"><a id="__codelineno-91-83" name="__codelineno-91-83" href="#__codelineno-91-83"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-91-84"><a id="__codelineno-91-84" name="__codelineno-91-84" href="#__codelineno-91-84"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-91-85"><a id="__codelineno-91-85" name="__codelineno-91-85" href="#__codelineno-91-85"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-91-86"><a id="__codelineno-91-86" name="__codelineno-91-86" href="#__codelineno-91-86"></a><span class="w">        </span><span class="na">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;metric&quot;</span>
</span><span id="__span-91-87"><a id="__codelineno-91-87" name="__codelineno-91-87" href="#__codelineno-91-87"></a><span class="w">        </span><span class="na">x</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-91-88"><a id="__codelineno-91-88" name="__codelineno-91-88" href="#__codelineno-91-88"></a><span class="w">        </span><span class="na">y</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">6</span>
</span><span id="__span-91-89"><a id="__codelineno-91-89" name="__codelineno-91-89" href="#__codelineno-91-89"></a><span class="w">        </span><span class="na">width</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">12</span>
</span><span id="__span-91-90"><a id="__codelineno-91-90" name="__codelineno-91-90" href="#__codelineno-91-90"></a><span class="w">        </span><span class="na">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span>
</span><span id="__span-91-91"><a id="__codelineno-91-91" name="__codelineno-91-91" href="#__codelineno-91-91"></a><span class="w">        </span><span class="nb">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-92"><a id="__codelineno-91-92" name="__codelineno-91-92" href="#__codelineno-91-92"></a><span class="w">          </span><span class="na">metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-91-93"><a id="__codelineno-91-93" name="__codelineno-91-93" href="#__codelineno-91-93"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;AWS/Lambda&quot;, &quot;Invocations&quot;, &quot;FunctionName&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">aws_lambda_function.visitor_counter.function_name</span><span class="p">],</span>
</span><span id="__span-91-94"><a id="__codelineno-91-94" name="__codelineno-91-94" href="#__codelineno-91-94"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;AWS/Lambda&quot;, &quot;Errors&quot;, &quot;FunctionName&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">aws_lambda_function.visitor_counter.function_name</span><span class="p">]</span>
</span><span id="__span-91-95"><a id="__codelineno-91-95" name="__codelineno-91-95" href="#__codelineno-91-95"></a><span class="w">          </span><span class="p">]</span>
</span><span id="__span-91-96"><a id="__codelineno-91-96" name="__codelineno-91-96" href="#__codelineno-91-96"></a><span class="w">          </span><span class="na">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span>
</span><span id="__span-91-97"><a id="__codelineno-91-97" name="__codelineno-91-97" href="#__codelineno-91-97"></a><span class="w">          </span><span class="na">stat</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Sum&quot;</span>
</span><span id="__span-91-98"><a id="__codelineno-91-98" name="__codelineno-91-98" href="#__codelineno-91-98"></a><span class="w">          </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-91-99"><a id="__codelineno-91-99" name="__codelineno-91-99" href="#__codelineno-91-99"></a><span class="w">          </span><span class="na">title</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Lambda Invocations and Errors&quot;</span>
</span><span id="__span-91-100"><a id="__codelineno-91-100" name="__codelineno-91-100" href="#__codelineno-91-100"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-91-101"><a id="__codelineno-91-101" name="__codelineno-91-101" href="#__codelineno-91-101"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-91-102"><a id="__codelineno-91-102" name="__codelineno-91-102" href="#__codelineno-91-102"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-91-103"><a id="__codelineno-91-103" name="__codelineno-91-103" href="#__codelineno-91-103"></a><span class="w">        </span><span class="na">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;metric&quot;</span>
</span><span id="__span-91-104"><a id="__codelineno-91-104" name="__codelineno-91-104" href="#__codelineno-91-104"></a><span class="w">        </span><span class="na">x</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">12</span>
</span><span id="__span-91-105"><a id="__codelineno-91-105" name="__codelineno-91-105" href="#__codelineno-91-105"></a><span class="w">        </span><span class="na">y</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">6</span>
</span><span id="__span-91-106"><a id="__codelineno-91-106" name="__codelineno-91-106" href="#__codelineno-91-106"></a><span class="w">        </span><span class="na">width</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">12</span>
</span><span id="__span-91-107"><a id="__codelineno-91-107" name="__codelineno-91-107" href="#__codelineno-91-107"></a><span class="w">        </span><span class="na">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span>
</span><span id="__span-91-108"><a id="__codelineno-91-108" name="__codelineno-91-108" href="#__codelineno-91-108"></a><span class="w">        </span><span class="nb">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-109"><a id="__codelineno-91-109" name="__codelineno-91-109" href="#__codelineno-91-109"></a><span class="w">          </span><span class="na">metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-91-110"><a id="__codelineno-91-110" name="__codelineno-91-110" href="#__codelineno-91-110"></a><span class="w">            </span><span class="p">[</span><span class="s2">&quot;AWS/Lambda&quot;, &quot;Duration&quot;, &quot;FunctionName&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">aws_lambda_function.visitor_counter.function_name</span><span class="p">]</span>
</span><span id="__span-91-111"><a id="__codelineno-91-111" name="__codelineno-91-111" href="#__codelineno-91-111"></a><span class="w">          </span><span class="p">]</span>
</span><span id="__span-91-112"><a id="__codelineno-91-112" name="__codelineno-91-112" href="#__codelineno-91-112"></a><span class="w">          </span><span class="na">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span>
</span><span id="__span-91-113"><a id="__codelineno-91-113" name="__codelineno-91-113" href="#__codelineno-91-113"></a><span class="w">          </span><span class="na">stat</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Average&quot;</span>
</span><span id="__span-91-114"><a id="__codelineno-91-114" name="__codelineno-91-114" href="#__codelineno-91-114"></a><span class="w">          </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-91-115"><a id="__codelineno-91-115" name="__codelineno-91-115" href="#__codelineno-91-115"></a><span class="w">          </span><span class="na">title</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Lambda Duration&quot;</span>
</span><span id="__span-91-116"><a id="__codelineno-91-116" name="__codelineno-91-116" href="#__codelineno-91-116"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-91-117"><a id="__codelineno-91-117" name="__codelineno-91-117" href="#__codelineno-91-117"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-91-118"><a id="__codelineno-91-118" name="__codelineno-91-118" href="#__codelineno-91-118"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-91-119"><a id="__codelineno-91-119" name="__codelineno-91-119" href="#__codelineno-91-119"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-91-120"><a id="__codelineno-91-120" name="__codelineno-91-120" href="#__codelineno-91-120"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="debugging-common-api-issues"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#debugging-common-api-issues">Debugging Common API Issues 🐛</a></h3>
<p>During my implementation, I encountered several challenges:</p>
<ol>
<li>
<p><strong>CORS Issues</strong>: The most common problem was with CORS configuration. Make sure your API Gateway and Lambda function both return the proper CORS headers.</p>
</li>
<li>
<p><strong>IAM Permission Errors</strong>: Initially, I gave my Lambda function too many permissions, then too few. The policy shown above represents the minimal set of permissions needed.</p>
</li>
<li>
<p><strong>DynamoDB Initialization</strong>: The counter needs to be initialized with a value. I solved this by adding an item to the table during deployment.</p>
</li>
<li>
<p><strong>API Gateway Integration</strong>: Make sure your Lambda function and API Gateway are correctly integrated. Check for proper resource paths and method settings.</p>
</li>
</ol>
<h3 id="lessons-learned"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#lessons-learned">Lessons Learned 💡</a></h3>
<ol>
<li>
<p><strong>DynamoDB Design</strong>: My initial design was too simple. Adding more fields like timestamp and user-agent provides valuable analytics data.</p>
</li>
<li>
<p><strong>Error Handling</strong>: Robust error handling is critical for serverless applications. Without proper logging, debugging becomes nearly impossible.</p>
</li>
<li>
<p><strong>Testing Strategy</strong>: Writing tests before implementing the Lambda function (test-driven development) helped me think through edge cases and error scenarios.</p>
</li>
<li>
<p><strong>Security Considerations</strong>: Privacy is important. Hashing IP addresses and implementing proper IAM policies ensures we protect user data.</p>
</li>
</ol>
<h3 id="api-security-considerations"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#api-security-considerations">API Security Considerations 🔒</a></h3>
<p>Security was a primary concern when building this API. Here are the key security measures I implemented:</p>
<ol>
<li>
<p><strong>Least Privilege IAM Policies</strong>: The Lambda function has only the minimal permissions needed.</p>
</li>
<li>
<p><strong>Input Validation</strong>: The Lambda function validates and sanitizes all input.</p>
</li>
<li>
<p><strong>Rate Limiting</strong>: API Gateway is configured with throttling to prevent abuse.</p>
</li>
<li>
<p><strong>HTTPS Only</strong>: All API endpoints use HTTPS with modern TLS settings.</p>
</li>
<li>
<p><strong>CORS Configuration</strong>: Only the resume website domain is allowed to make cross-origin requests.</p>
</li>
<li>
<p><strong>Privacy Protection</strong>: IP addresses are hashed to protect visitor privacy.</p>
</li>
</ol>
<p>These measures help protect against common API vulnerabilities like injection attacks, denial of service, and data exposure.</p>
<h3 id="enhancements-and-mods"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#enhancements-and-mods">Enhancements and Mods 🚀</a></h3>
<p>Here are some ways to extend this part of the challenge:</p>
<h4 id="developer-mod-schemas-and-dreamers"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#developer-mod-schemas-and-dreamers">Developer Mod: Schemas and Dreamers</a></h4>
<p>Instead of using DynamoDB, consider implementing a relational database approach:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_db_subnet_group&quot;</span><span class="w"> </span><span class="nv">&quot;database&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="w">  </span><span class="na">name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-database-subnet-group&quot;</span>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="w">  </span><span class="na">subnet_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.private_subnet_ids</span>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="p">}</span>
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a>
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_security_group&quot;</span><span class="w"> </span><span class="nv">&quot;database&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-92-7"><a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resume-database-sg&quot;</span>
</span><span id="__span-92-8"><a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Security group for the resume database&quot;</span>
</span><span id="__span-92-9"><a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a><span class="w">  </span><span class="na">vpc_id</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">var.vpc_id</span>
</span><span id="__span-92-10"><a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a>
</span><span id="__span-92-11"><a id="__codelineno-92-11" name="__codelineno-92-11" href="#__codelineno-92-11"></a><span class="w">  </span><span class="nb">ingress</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-92-12"><a id="__codelineno-92-12" name="__codelineno-92-12" href="#__codelineno-92-12"></a><span class="w">    </span><span class="na">from_port</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="m">5432</span>
</span><span id="__span-92-13"><a id="__codelineno-92-13" name="__codelineno-92-13" href="#__codelineno-92-13"></a><span class="w">    </span><span class="na">to_port</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="m">5432</span>
</span><span id="__span-92-14"><a id="__codelineno-92-14" name="__codelineno-92-14" href="#__codelineno-92-14"></a><span class="w">    </span><span class="na">protocol</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tcp&quot;</span>
</span><span id="__span-92-15"><a id="__codelineno-92-15" name="__codelineno-92-15" href="#__codelineno-92-15"></a><span class="w">    </span><span class="na">security_groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_security_group.lambda.id</span><span class="p">]</span>
</span><span id="__span-92-16"><a id="__codelineno-92-16" name="__codelineno-92-16" href="#__codelineno-92-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-92-17"><a id="__codelineno-92-17" name="__codelineno-92-17" href="#__codelineno-92-17"></a><span class="p">}</span>
</span><span id="__span-92-18"><a id="__codelineno-92-18" name="__codelineno-92-18" href="#__codelineno-92-18"></a>
</span><span id="__span-92-19"><a id="__codelineno-92-19" name="__codelineno-92-19" href="#__codelineno-92-19"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_db_instance&quot;</span><span class="w"> </span><span class="nv">&quot;postgresql&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-92-20"><a id="__codelineno-92-20" name="__codelineno-92-20" href="#__codelineno-92-20"></a><span class="w">  </span><span class="na">allocated_storage</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">20</span>
</span><span id="__span-92-21"><a id="__codelineno-92-21" name="__codelineno-92-21" href="#__codelineno-92-21"></a><span class="w">  </span><span class="na">storage_type</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gp2&quot;</span>
</span><span id="__span-92-22"><a id="__codelineno-92-22" name="__codelineno-92-22" href="#__codelineno-92-22"></a><span class="w">  </span><span class="na">engine</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;postgres&quot;</span>
</span><span id="__span-92-23"><a id="__codelineno-92-23" name="__codelineno-92-23" href="#__codelineno-92-23"></a><span class="w">  </span><span class="na">engine_version</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;13.4&quot;</span>
</span><span id="__span-92-24"><a id="__codelineno-92-24" name="__codelineno-92-24" href="#__codelineno-92-24"></a><span class="w">  </span><span class="na">instance_class</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;db.t3.micro&quot;</span>
</span><span id="__span-92-25"><a id="__codelineno-92-25" name="__codelineno-92-25" href="#__codelineno-92-25"></a><span class="w">  </span><span class="na">db_name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;resumedb&quot;</span>
</span><span id="__span-92-26"><a id="__codelineno-92-26" name="__codelineno-92-26" href="#__codelineno-92-26"></a><span class="w">  </span><span class="na">username</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;postgres&quot;</span>
</span><span id="__span-92-27"><a id="__codelineno-92-27" name="__codelineno-92-27" href="#__codelineno-92-27"></a><span class="w">  </span><span class="na">password</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="nv">var.db_password</span>
</span><span id="__span-92-28"><a id="__codelineno-92-28" name="__codelineno-92-28" href="#__codelineno-92-28"></a><span class="w">  </span><span class="na">parameter_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;default.postgres13&quot;</span>
</span><span id="__span-92-29"><a id="__codelineno-92-29" name="__codelineno-92-29" href="#__codelineno-92-29"></a><span class="w">  </span><span class="na">db_subnet_group_name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_db_subnet_group.database.name</span>
</span><span id="__span-92-30"><a id="__codelineno-92-30" name="__codelineno-92-30" href="#__codelineno-92-30"></a><span class="w">  </span><span class="na">vpc_security_group_ids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_security_group.database.id</span><span class="p">]</span>
</span><span id="__span-92-31"><a id="__codelineno-92-31" name="__codelineno-92-31" href="#__codelineno-92-31"></a><span class="w">  </span><span class="na">skip_final_snapshot</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-92-32"><a id="__codelineno-92-32" name="__codelineno-92-32" href="#__codelineno-92-32"></a><span class="w">  </span><span class="na">multi_az</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-92-33"><a id="__codelineno-92-33" name="__codelineno-92-33" href="#__codelineno-92-33"></a>
</span><span id="__span-92-34"><a id="__codelineno-92-34" name="__codelineno-92-34" href="#__codelineno-92-34"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-92-35"><a id="__codelineno-92-35" name="__codelineno-92-35" href="#__codelineno-92-35"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Database&quot;</span>
</span><span id="__span-92-36"><a id="__codelineno-92-36" name="__codelineno-92-36" href="#__codelineno-92-36"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-92-37"><a id="__codelineno-92-37" name="__codelineno-92-37" href="#__codelineno-92-37"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-92-38"><a id="__codelineno-92-38" name="__codelineno-92-38" href="#__codelineno-92-38"></a><span class="p">}</span>
</span></code></pre></div>
<p>This approach introduces interesting networking challenges and requires modifications to your Lambda function to connect to PostgreSQL.</p>
<h4 id="devops-mod-monitor-lizard"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#devops-mod-monitor-lizard">DevOps Mod: Monitor Lizard</a></h4>
<p>Enhance monitoring with X-Ray traces and custom CloudWatch metrics:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="c1"># Add to Lambda function configuration</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="nb">tracing_config</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="w">  </span><span class="na">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Active&quot;</span>
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="p">}</span>
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a>
</span><span id="__span-93-6"><a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a><span class="c1"># Add X-Ray policy</span>
</span><span id="__span-93-7"><a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_policy&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_xray&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-93-8"><a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda-xray-policy-${var.environment}&quot;</span>
</span><span id="__span-93-9"><a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;IAM policy for X-Ray tracing&quot;</span>
</span><span id="__span-93-10"><a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a>
</span><span id="__span-93-11"><a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a><span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-93-12"><a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-93-13"><a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-93-14"><a id="__codelineno-93-14" name="__codelineno-93-14" href="#__codelineno-93-14"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-93-15"><a id="__codelineno-93-15" name="__codelineno-93-15" href="#__codelineno-93-15"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-93-16"><a id="__codelineno-93-16" name="__codelineno-93-16" href="#__codelineno-93-16"></a><span class="w">          </span><span class="s2">&quot;xray:PutTraceSegments&quot;</span><span class="p">,</span>
</span><span id="__span-93-17"><a id="__codelineno-93-17" name="__codelineno-93-17" href="#__codelineno-93-17"></a><span class="w">          </span><span class="s2">&quot;xray:PutTelemetryRecords&quot;</span>
</span><span id="__span-93-18"><a id="__codelineno-93-18" name="__codelineno-93-18" href="#__codelineno-93-18"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-93-19"><a id="__codelineno-93-19" name="__codelineno-93-19" href="#__codelineno-93-19"></a><span class="w">        </span><span class="na">Effect</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-93-20"><a id="__codelineno-93-20" name="__codelineno-93-20" href="#__codelineno-93-20"></a><span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-93-21"><a id="__codelineno-93-21" name="__codelineno-93-21" href="#__codelineno-93-21"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-93-22"><a id="__codelineno-93-22" name="__codelineno-93-22" href="#__codelineno-93-22"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-93-23"><a id="__codelineno-93-23" name="__codelineno-93-23" href="#__codelineno-93-23"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-93-24"><a id="__codelineno-93-24" name="__codelineno-93-24" href="#__codelineno-93-24"></a><span class="p">}</span>
</span><span id="__span-93-25"><a id="__codelineno-93-25" name="__codelineno-93-25" href="#__codelineno-93-25"></a>
</span><span id="__span-93-26"><a id="__codelineno-93-26" name="__codelineno-93-26" href="#__codelineno-93-26"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_iam_role_policy_attachment&quot;</span><span class="w"> </span><span class="nv">&quot;lambda_xray&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-93-27"><a id="__codelineno-93-27" name="__codelineno-93-27" href="#__codelineno-93-27"></a><span class="w">  </span><span class="na">role</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.lambda_role.name</span>
</span><span id="__span-93-28"><a id="__codelineno-93-28" name="__codelineno-93-28" href="#__codelineno-93-28"></a><span class="w">  </span><span class="na">policy_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_policy.lambda_xray.arn</span>
</span><span id="__span-93-29"><a id="__codelineno-93-29" name="__codelineno-93-29" href="#__codelineno-93-29"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then modify your Lambda function to emit custom metrics:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aws_xray_sdk.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">xray_recorder</span>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">aws_xray_sdk.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">patch_all</span>
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a>
</span><span id="__span-94-5"><a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a><span class="c1"># Patch all supported libraries for X-Ray</span>
</span><span id="__span-94-6"><a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a><span class="n">patch_all</span><span class="p">()</span>
</span><span id="__span-94-7"><a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a>
</span><span id="__span-94-8"><a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a><span class="n">cloudwatch</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;cloudwatch&#39;</span><span class="p">)</span>
</span><span id="__span-94-9"><a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a>
</span><span id="__span-94-10"><a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a><span class="c1"># Inside lambda_handler</span>
</span><span id="__span-94-11"><a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a><span class="n">cloudwatch</span><span class="o">.</span><span class="n">put_metric_data</span><span class="p">(</span>
</span><span id="__span-94-12"><a id="__codelineno-94-12" name="__codelineno-94-12" href="#__codelineno-94-12"></a>    <span class="n">Namespace</span><span class="o">=</span><span class="s1">&#39;ResumeMetrics&#39;</span><span class="p">,</span>
</span><span id="__span-94-13"><a id="__codelineno-94-13" name="__codelineno-94-13" href="#__codelineno-94-13"></a>    <span class="n">MetricData</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-94-14"><a id="__codelineno-94-14" name="__codelineno-94-14" href="#__codelineno-94-14"></a>        <span class="p">{</span>
</span><span id="__span-94-15"><a id="__codelineno-94-15" name="__codelineno-94-15" href="#__codelineno-94-15"></a>            <span class="s1">&#39;MetricName&#39;</span><span class="p">:</span> <span class="s1">&#39;VisitorCount&#39;</span><span class="p">,</span>
</span><span id="__span-94-16"><a id="__codelineno-94-16" name="__codelineno-94-16" href="#__codelineno-94-16"></a>            <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
</span><span id="__span-94-17"><a id="__codelineno-94-17" name="__codelineno-94-17" href="#__codelineno-94-17"></a>            <span class="s1">&#39;Unit&#39;</span><span class="p">:</span> <span class="s1">&#39;Count&#39;</span>
</span><span id="__span-94-18"><a id="__codelineno-94-18" name="__codelineno-94-18" href="#__codelineno-94-18"></a>        <span class="p">}</span>
</span><span id="__span-94-19"><a id="__codelineno-94-19" name="__codelineno-94-19" href="#__codelineno-94-19"></a>    <span class="p">]</span>
</span><span id="__span-94-20"><a id="__codelineno-94-20" name="__codelineno-94-20" href="#__codelineno-94-20"></a><span class="p">)</span>
</span></code></pre></div>
<h4 id="security-mod-check-your-privilege"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#security-mod-check-your-privilege">Security Mod: Check Your Privilege</a></h4>
<p>Implement AWS WAF to protect your API from common web attacks:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_wafv2_web_acl&quot;</span><span class="w"> </span><span class="nv">&quot;api&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="w">  </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;api-waf-${var.environment}&quot;</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;WAF for the resume API&quot;</span>
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="w">  </span><span class="na">scope</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;REGIONAL&quot;</span>
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a>
</span><span id="__span-95-6"><a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a><span class="w">  </span><span class="nb">default_action</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-7"><a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a><span class="w">    </span><span class="nb">allow</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-95-8"><a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-95-9"><a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a>
</span><span id="__span-95-10"><a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a><span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-11"><a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a><span class="w">    </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWSManagedRulesCommonRuleSet&quot;</span>
</span><span id="__span-95-12"><a id="__codelineno-95-12" name="__codelineno-95-12" href="#__codelineno-95-12"></a><span class="w">    </span><span class="na">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-95-13"><a id="__codelineno-95-13" name="__codelineno-95-13" href="#__codelineno-95-13"></a>
</span><span id="__span-95-14"><a id="__codelineno-95-14" name="__codelineno-95-14" href="#__codelineno-95-14"></a><span class="w">    </span><span class="nb">override_action</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-15"><a id="__codelineno-95-15" name="__codelineno-95-15" href="#__codelineno-95-15"></a><span class="w">      </span><span class="nb">none</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-95-16"><a id="__codelineno-95-16" name="__codelineno-95-16" href="#__codelineno-95-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-95-17"><a id="__codelineno-95-17" name="__codelineno-95-17" href="#__codelineno-95-17"></a>
</span><span id="__span-95-18"><a id="__codelineno-95-18" name="__codelineno-95-18" href="#__codelineno-95-18"></a><span class="w">    </span><span class="nb">statement</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-19"><a id="__codelineno-95-19" name="__codelineno-95-19" href="#__codelineno-95-19"></a><span class="w">      </span><span class="nb">managed_rule_group_statement</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-20"><a id="__codelineno-95-20" name="__codelineno-95-20" href="#__codelineno-95-20"></a><span class="w">        </span><span class="na">name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWSManagedRulesCommonRuleSet&quot;</span>
</span><span id="__span-95-21"><a id="__codelineno-95-21" name="__codelineno-95-21" href="#__codelineno-95-21"></a><span class="w">        </span><span class="na">vendor_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWS&quot;</span>
</span><span id="__span-95-22"><a id="__codelineno-95-22" name="__codelineno-95-22" href="#__codelineno-95-22"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-95-23"><a id="__codelineno-95-23" name="__codelineno-95-23" href="#__codelineno-95-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-95-24"><a id="__codelineno-95-24" name="__codelineno-95-24" href="#__codelineno-95-24"></a>
</span><span id="__span-95-25"><a id="__codelineno-95-25" name="__codelineno-95-25" href="#__codelineno-95-25"></a><span class="w">    </span><span class="nb">visibility_config</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-26"><a id="__codelineno-95-26" name="__codelineno-95-26" href="#__codelineno-95-26"></a><span class="w">      </span><span class="na">cloudwatch_metrics_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-95-27"><a id="__codelineno-95-27" name="__codelineno-95-27" href="#__codelineno-95-27"></a><span class="w">      </span><span class="na">metric_name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AWSManagedRulesCommonRuleSetMetric&quot;</span>
</span><span id="__span-95-28"><a id="__codelineno-95-28" name="__codelineno-95-28" href="#__codelineno-95-28"></a><span class="w">      </span><span class="na">sampled_requests_enabled</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-95-29"><a id="__codelineno-95-29" name="__codelineno-95-29" href="#__codelineno-95-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-95-30"><a id="__codelineno-95-30" name="__codelineno-95-30" href="#__codelineno-95-30"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-95-31"><a id="__codelineno-95-31" name="__codelineno-95-31" href="#__codelineno-95-31"></a>
</span><span id="__span-95-32"><a id="__codelineno-95-32" name="__codelineno-95-32" href="#__codelineno-95-32"></a><span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-33"><a id="__codelineno-95-33" name="__codelineno-95-33" href="#__codelineno-95-33"></a><span class="w">    </span><span class="na">name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;RateLimit&quot;</span>
</span><span id="__span-95-34"><a id="__codelineno-95-34" name="__codelineno-95-34" href="#__codelineno-95-34"></a><span class="w">    </span><span class="na">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-95-35"><a id="__codelineno-95-35" name="__codelineno-95-35" href="#__codelineno-95-35"></a>
</span><span id="__span-95-36"><a id="__codelineno-95-36" name="__codelineno-95-36" href="#__codelineno-95-36"></a><span class="w">    </span><span class="nb">action</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-37"><a id="__codelineno-95-37" name="__codelineno-95-37" href="#__codelineno-95-37"></a><span class="w">      </span><span class="nb">block</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-95-38"><a id="__codelineno-95-38" name="__codelineno-95-38" href="#__codelineno-95-38"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-95-39"><a id="__codelineno-95-39" name="__codelineno-95-39" href="#__codelineno-95-39"></a>
</span><span id="__span-95-40"><a id="__codelineno-95-40" name="__codelineno-95-40" href="#__codelineno-95-40"></a><span class="w">    </span><span class="nb">statement</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-41"><a id="__codelineno-95-41" name="__codelineno-95-41" href="#__codelineno-95-41"></a><span class="w">      </span><span class="nb">rate_based_statement</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-42"><a id="__codelineno-95-42" name="__codelineno-95-42" href="#__codelineno-95-42"></a><span class="w">        </span><span class="na">limit</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>
</span><span id="__span-95-43"><a id="__codelineno-95-43" name="__codelineno-95-43" href="#__codelineno-95-43"></a><span class="w">        </span><span class="na">aggregate_key_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;IP&quot;</span>
</span><span id="__span-95-44"><a id="__codelineno-95-44" name="__codelineno-95-44" href="#__codelineno-95-44"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-95-45"><a id="__codelineno-95-45" name="__codelineno-95-45" href="#__codelineno-95-45"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-95-46"><a id="__codelineno-95-46" name="__codelineno-95-46" href="#__codelineno-95-46"></a>
</span><span id="__span-95-47"><a id="__codelineno-95-47" name="__codelineno-95-47" href="#__codelineno-95-47"></a><span class="w">    </span><span class="nb">visibility_config</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-48"><a id="__codelineno-95-48" name="__codelineno-95-48" href="#__codelineno-95-48"></a><span class="w">      </span><span class="na">cloudwatch_metrics_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-95-49"><a id="__codelineno-95-49" name="__codelineno-95-49" href="#__codelineno-95-49"></a><span class="w">      </span><span class="na">metric_name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;RateLimitMetric&quot;</span>
</span><span id="__span-95-50"><a id="__codelineno-95-50" name="__codelineno-95-50" href="#__codelineno-95-50"></a><span class="w">      </span><span class="na">sampled_requests_enabled</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-95-51"><a id="__codelineno-95-51" name="__codelineno-95-51" href="#__codelineno-95-51"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-95-52"><a id="__codelineno-95-52" name="__codelineno-95-52" href="#__codelineno-95-52"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-95-53"><a id="__codelineno-95-53" name="__codelineno-95-53" href="#__codelineno-95-53"></a>
</span><span id="__span-95-54"><a id="__codelineno-95-54" name="__codelineno-95-54" href="#__codelineno-95-54"></a><span class="w">  </span><span class="nb">visibility_config</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-55"><a id="__codelineno-95-55" name="__codelineno-95-55" href="#__codelineno-95-55"></a><span class="w">    </span><span class="na">cloudwatch_metrics_enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-95-56"><a id="__codelineno-95-56" name="__codelineno-95-56" href="#__codelineno-95-56"></a><span class="w">    </span><span class="na">metric_name</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;APIWebACLMetric&quot;</span>
</span><span id="__span-95-57"><a id="__codelineno-95-57" name="__codelineno-95-57" href="#__codelineno-95-57"></a><span class="w">    </span><span class="na">sampled_requests_enabled</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-95-58"><a id="__codelineno-95-58" name="__codelineno-95-58" href="#__codelineno-95-58"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-95-59"><a id="__codelineno-95-59" name="__codelineno-95-59" href="#__codelineno-95-59"></a><span class="p">}</span>
</span><span id="__span-95-60"><a id="__codelineno-95-60" name="__codelineno-95-60" href="#__codelineno-95-60"></a>
</span><span id="__span-95-61"><a id="__codelineno-95-61" name="__codelineno-95-61" href="#__codelineno-95-61"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_wafv2_web_acl_association&quot;</span><span class="w"> </span><span class="nv">&quot;api&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-62"><a id="__codelineno-95-62" name="__codelineno-95-62" href="#__codelineno-95-62"></a><span class="w">  </span><span class="na">resource_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_api_gateway_stage.visitor_counter.arn</span>
</span><span id="__span-95-63"><a id="__codelineno-95-63" name="__codelineno-95-63" href="#__codelineno-95-63"></a><span class="w">  </span><span class="na">web_acl_arn</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_wafv2_web_acl.api.arn</span>
</span><span id="__span-95-64"><a id="__codelineno-95-64" name="__codelineno-95-64" href="#__codelineno-95-64"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="next-steps"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-building-the-backend-api/#next-steps">Next Steps ⏭️</a></h3>
<p>With our backend API completed, we're ready to connect it to our frontend in the next post. We'll integrate the JavaScript visitor counter with our API and then automate the deployment process using GitHub Actions.</p>
<p>Stay tuned to see how we bring the full stack together!</p>
<hr />
<p><strong>Up Next:</strong> [Cloud Resume Challenge with Terraform: Automating Deployments with GitHub Actions] 🔗</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Cloud%20Resume%20Challenge%20with%20Terraform%3A%20Building%20the%20Backend%20API%0A&amp;url=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-building-the-backend-api/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-building-the-backend-api/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-18 00:00:00+00:00">March 18, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/aws/" class="md-meta__link">AWS</a>, 
              <a href="../../../../category/terraform/" class="md-meta__link">Terraform</a>, 
              <a href="../../../../category/web-hosting/" class="md-meta__link">Web Hosting</a>, 
              <a href="../../../../category/cloud-resume-challenge/" class="md-meta__link">Cloud Resume Challenge</a></li>
        
        
          
          <li class="md-meta__item">
            
              8 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="cloud-resume-challenge-with-terraform-deploying-the-static-website"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/">Cloud Resume Challenge with Terraform: Deploying the Static Website 🚀</a></h2>
<h3 id="introduction"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#introduction">Introduction 🌍</a></h3>
<p>In the <a href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/">previous post</a>, we set up our Terraform environment and outlined the architecture for our Cloud Resume Challenge project. Now it's time to start building! In this post, we'll focus on deploying the first component: <strong>the static website</strong> that will host our resume.</p>
<h3 id="frontend-architecture-overview"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#frontend-architecture-overview">Frontend Architecture Overview 🏗️</a></h3>
<p>Let's look at the specific architecture we'll implement for our frontend:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>┌───────────┐     ┌────────────┐     ┌──────────┐     ┌────────────┐
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>│           │     │            │     │          │     │            │
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>│  Route 53 ├─────► CloudFront ├─────►    S3    │     │    ACM     │
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>│           │     │            │     │          │     │ Certificate│
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a>└───────────┘     └────────────┘     └──────────┘     └────────────┘
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>      ▲                                    ▲                 │
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a>      │                                    │                 │
</span><span id="__span-80-8"><a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a>      └────────────────────────────────────┴─────────────────┘
</span><span id="__span-80-9"><a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a>           DNS &amp; Certificate Validation
</span></code></pre></div>
<p>The frontend consists of:</p>
<ol>
<li><strong>S3 Bucket</strong>: Hosts our HTML, CSS, and JavaScript files</li>
<li><strong>CloudFront</strong>: Provides CDN capabilities for global distribution and HTTPS</li>
<li><strong>Route 53</strong>: Manages our custom domain's DNS</li>
<li><strong>ACM</strong>: Provides SSL/TLS certificate for HTTPS</li>
</ol>
<h3 id="my-htmlcss-resume-design-approach"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#my-htmlcss-resume-design-approach">My HTML/CSS Resume Design Approach 🎨</a></h3>
<p>Before diving into Terraform, I spent some time creating my resume in HTML and CSS. Rather than starting from scratch, I decided to use a minimalist approach with a focus on readability.</p>
<p>Here's a snippet of my HTML structure:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Matthew&#39;s Cloud Resume<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a>    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;styles.css&quot;</span><span class="p">&gt;</span>
</span><span id="__span-81-8"><a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-81-9"><a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-81-10"><a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a>    <span class="p">&lt;</span><span class="nt">header</span><span class="p">&gt;</span>
</span><span id="__span-81-11"><a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a>        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Matthew Johnson<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-81-12"><a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a>        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Cloud Engineer<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-81-13"><a id="__codelineno-81-13" name="__codelineno-81-13" href="#__codelineno-81-13"></a>    <span class="p">&lt;/</span><span class="nt">header</span><span class="p">&gt;</span>
</span><span id="__span-81-14"><a id="__codelineno-81-14" name="__codelineno-81-14" href="#__codelineno-81-14"></a>
</span><span id="__span-81-15"><a id="__codelineno-81-15" name="__codelineno-81-15" href="#__codelineno-81-15"></a>    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;contact&quot;</span><span class="p">&gt;</span>
</span><span id="__span-81-16"><a id="__codelineno-81-16" name="__codelineno-81-16" href="#__codelineno-81-16"></a>        <span class="cm">&lt;!-- Contact information --&gt;</span>
</span><span id="__span-81-17"><a id="__codelineno-81-17" name="__codelineno-81-17" href="#__codelineno-81-17"></a>    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span id="__span-81-18"><a id="__codelineno-81-18" name="__codelineno-81-18" href="#__codelineno-81-18"></a>
</span><span id="__span-81-19"><a id="__codelineno-81-19" name="__codelineno-81-19" href="#__codelineno-81-19"></a>    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;skills&quot;</span><span class="p">&gt;</span>
</span><span id="__span-81-20"><a id="__codelineno-81-20" name="__codelineno-81-20" href="#__codelineno-81-20"></a>        <span class="cm">&lt;!-- Skills list --&gt;</span>
</span><span id="__span-81-21"><a id="__codelineno-81-21" name="__codelineno-81-21" href="#__codelineno-81-21"></a>    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span id="__span-81-22"><a id="__codelineno-81-22" name="__codelineno-81-22" href="#__codelineno-81-22"></a>
</span><span id="__span-81-23"><a id="__codelineno-81-23" name="__codelineno-81-23" href="#__codelineno-81-23"></a>    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;experience&quot;</span><span class="p">&gt;</span>
</span><span id="__span-81-24"><a id="__codelineno-81-24" name="__codelineno-81-24" href="#__codelineno-81-24"></a>        <span class="cm">&lt;!-- Work experience --&gt;</span>
</span><span id="__span-81-25"><a id="__codelineno-81-25" name="__codelineno-81-25" href="#__codelineno-81-25"></a>    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span id="__span-81-26"><a id="__codelineno-81-26" name="__codelineno-81-26" href="#__codelineno-81-26"></a>
</span><span id="__span-81-27"><a id="__codelineno-81-27" name="__codelineno-81-27" href="#__codelineno-81-27"></a>    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;education&quot;</span><span class="p">&gt;</span>
</span><span id="__span-81-28"><a id="__codelineno-81-28" name="__codelineno-81-28" href="#__codelineno-81-28"></a>        <span class="cm">&lt;!-- Education history --&gt;</span>
</span><span id="__span-81-29"><a id="__codelineno-81-29" name="__codelineno-81-29" href="#__codelineno-81-29"></a>    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span id="__span-81-30"><a id="__codelineno-81-30" name="__codelineno-81-30" href="#__codelineno-81-30"></a>
</span><span id="__span-81-31"><a id="__codelineno-81-31" name="__codelineno-81-31" href="#__codelineno-81-31"></a>    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;certifications&quot;</span><span class="p">&gt;</span>
</span><span id="__span-81-32"><a id="__codelineno-81-32" name="__codelineno-81-32" href="#__codelineno-81-32"></a>        <span class="cm">&lt;!-- AWS certifications --&gt;</span>
</span><span id="__span-81-33"><a id="__codelineno-81-33" name="__codelineno-81-33" href="#__codelineno-81-33"></a>    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span id="__span-81-34"><a id="__codelineno-81-34" name="__codelineno-81-34" href="#__codelineno-81-34"></a>
</span><span id="__span-81-35"><a id="__codelineno-81-35" name="__codelineno-81-35" href="#__codelineno-81-35"></a>    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;projects&quot;</span><span class="p">&gt;</span>
</span><span id="__span-81-36"><a id="__codelineno-81-36" name="__codelineno-81-36" href="#__codelineno-81-36"></a>        <span class="cm">&lt;!-- Project descriptions including this challenge --&gt;</span>
</span><span id="__span-81-37"><a id="__codelineno-81-37" name="__codelineno-81-37" href="#__codelineno-81-37"></a>    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span id="__span-81-38"><a id="__codelineno-81-38" name="__codelineno-81-38" href="#__codelineno-81-38"></a>
</span><span id="__span-81-39"><a id="__codelineno-81-39" name="__codelineno-81-39" href="#__codelineno-81-39"></a>    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;counter&quot;</span><span class="p">&gt;</span>
</span><span id="__span-81-40"><a id="__codelineno-81-40" name="__codelineno-81-40" href="#__codelineno-81-40"></a>        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>This page has been viewed <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;count&quot;</span><span class="p">&gt;</span>0<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> times.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-81-41"><a id="__codelineno-81-41" name="__codelineno-81-41" href="#__codelineno-81-41"></a>    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
</span><span id="__span-81-42"><a id="__codelineno-81-42" name="__codelineno-81-42" href="#__codelineno-81-42"></a>
</span><span id="__span-81-43"><a id="__codelineno-81-43" name="__codelineno-81-43" href="#__codelineno-81-43"></a>    <span class="p">&lt;</span><span class="nt">footer</span><span class="p">&gt;</span>
</span><span id="__span-81-44"><a id="__codelineno-81-44" name="__codelineno-81-44" href="#__codelineno-81-44"></a>        <span class="cm">&lt;!-- Footer content --&gt;</span>
</span><span id="__span-81-45"><a id="__codelineno-81-45" name="__codelineno-81-45" href="#__codelineno-81-45"></a>    <span class="p">&lt;/</span><span class="nt">footer</span><span class="p">&gt;</span>
</span><span id="__span-81-46"><a id="__codelineno-81-46" name="__codelineno-81-46" href="#__codelineno-81-46"></a>
</span><span id="__span-81-47"><a id="__codelineno-81-47" name="__codelineno-81-47" href="#__codelineno-81-47"></a>    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;counter.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-81-48"><a id="__codelineno-81-48" name="__codelineno-81-48" href="#__codelineno-81-48"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-81-49"><a id="__codelineno-81-49" name="__codelineno-81-49" href="#__codelineno-81-49"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>For CSS, I went with a responsive design that works well on both desktop and mobile devices:</p>
<div class="language-css highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="p">:</span><span class="nd">root</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="w">    </span><span class="nv">--primary-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#0066cc</span><span class="p">;</span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="w">    </span><span class="nv">--secondary-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#f4f4f4</span><span class="p">;</span>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="w">    </span><span class="nv">--text-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#333</span><span class="p">;</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="w">    </span><span class="nv">--heading-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#222</span><span class="p">;</span>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="p">}</span>
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a>
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-82-9"><a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a><span class="w">    </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Segoe UI&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">Tahoma</span><span class="p">,</span><span class="w"> </span><span class="n">Geneva</span><span class="p">,</span><span class="w"> </span><span class="n">Verdana</span><span class="p">,</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
</span><span id="__span-82-10"><a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a><span class="w">    </span><span class="k">line-height</span><span class="p">:</span><span class="w"> </span><span class="mf">1.6</span><span class="p">;</span>
</span><span id="__span-82-11"><a id="__codelineno-82-11" name="__codelineno-82-11" href="#__codelineno-82-11"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="nv">--text-color</span><span class="p">);</span>
</span><span id="__span-82-12"><a id="__codelineno-82-12" name="__codelineno-82-12" href="#__codelineno-82-12"></a><span class="w">    </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">800</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-82-13"><a id="__codelineno-82-13" name="__codelineno-82-13" href="#__codelineno-82-13"></a><span class="w">    </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
</span><span id="__span-82-14"><a id="__codelineno-82-14" name="__codelineno-82-14" href="#__codelineno-82-14"></a><span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">rem</span><span class="p">;</span>
</span><span id="__span-82-15"><a id="__codelineno-82-15" name="__codelineno-82-15" href="#__codelineno-82-15"></a><span class="p">}</span>
</span><span id="__span-82-16"><a id="__codelineno-82-16" name="__codelineno-82-16" href="#__codelineno-82-16"></a>
</span><span id="__span-82-17"><a id="__codelineno-82-17" name="__codelineno-82-17" href="#__codelineno-82-17"></a><span class="nt">header</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-82-18"><a id="__codelineno-82-18" name="__codelineno-82-18" href="#__codelineno-82-18"></a><span class="w">    </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
</span><span id="__span-82-19"><a id="__codelineno-82-19" name="__codelineno-82-19" href="#__codelineno-82-19"></a><span class="w">    </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">rem</span><span class="p">;</span>
</span><span id="__span-82-20"><a id="__codelineno-82-20" name="__codelineno-82-20" href="#__codelineno-82-20"></a><span class="p">}</span>
</span><span id="__span-82-21"><a id="__codelineno-82-21" name="__codelineno-82-21" href="#__codelineno-82-21"></a>
</span><span id="__span-82-22"><a id="__codelineno-82-22" name="__codelineno-82-22" href="#__codelineno-82-22"></a><span class="nt">h1</span><span class="o">,</span><span class="w"> </span><span class="nt">h2</span><span class="o">,</span><span class="w"> </span><span class="nt">h3</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-82-23"><a id="__codelineno-82-23" name="__codelineno-82-23" href="#__codelineno-82-23"></a><span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="nv">--heading-color</span><span class="p">);</span>
</span><span id="__span-82-24"><a id="__codelineno-82-24" name="__codelineno-82-24" href="#__codelineno-82-24"></a><span class="p">}</span>
</span><span id="__span-82-25"><a id="__codelineno-82-25" name="__codelineno-82-25" href="#__codelineno-82-25"></a>
</span><span id="__span-82-26"><a id="__codelineno-82-26" name="__codelineno-82-26" href="#__codelineno-82-26"></a><span class="nt">section</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-82-27"><a id="__codelineno-82-27" name="__codelineno-82-27" href="#__codelineno-82-27"></a><span class="w">    </span><span class="k">margin-bottom</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">rem</span><span class="p">;</span>
</span><span id="__span-82-28"><a id="__codelineno-82-28" name="__codelineno-82-28" href="#__codelineno-82-28"></a><span class="p">}</span>
</span><span id="__span-82-29"><a id="__codelineno-82-29" name="__codelineno-82-29" href="#__codelineno-82-29"></a>
</span><span id="__span-82-30"><a id="__codelineno-82-30" name="__codelineno-82-30" href="#__codelineno-82-30"></a><span class="c">/* Responsive design */</span>
</span><span id="__span-82-31"><a id="__codelineno-82-31" name="__codelineno-82-31" href="#__codelineno-82-31"></a><span class="p">@</span><span class="k">media</span><span class="w"> </span><span class="o">(</span><span class="nt">max-width</span><span class="o">:</span><span class="w"> </span><span class="nt">600px</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-82-32"><a id="__codelineno-82-32" name="__codelineno-82-32" href="#__codelineno-82-32"></a><span class="w">    </span><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-82-33"><a id="__codelineno-82-33" name="__codelineno-82-33" href="#__codelineno-82-33"></a><span class="w">        </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="kt">rem</span><span class="p">;</span>
</span><span id="__span-82-34"><a id="__codelineno-82-34" name="__codelineno-82-34" href="#__codelineno-82-34"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-82-35"><a id="__codelineno-82-35" name="__codelineno-82-35" href="#__codelineno-82-35"></a><span class="p">}</span>
</span></code></pre></div>
<p>These files will be uploaded to our S3 bucket once we've provisioned it with Terraform.</p>
<h3 id="deploying-the-static-website-with-terraform"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#deploying-the-static-website-with-terraform">Deploying the Static Website with Terraform 🌐</a></h3>
<p>Now, let's implement the Terraform code for our frontend infrastructure. We'll create modules for each component, starting with S3.</p>
<h4 id="1-s3-module-for-website-hosting"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#1-s3-module-for-website-hosting">1. S3 Module for Website Hosting 📂</a></h4>
<p>Create a file at <code>modules/frontend/s3.tf</code>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.website_bucket_name</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Website&quot;</span>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="w">    </span><span class="na">Project</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cloud Resume Challenge&quot;</span>
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="p">}</span>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a>
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_website_configuration&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-12"><a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-83-13"><a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a>
</span><span id="__span-83-14"><a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a><span class="w">  </span><span class="nb">index_document</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-15"><a id="__codelineno-83-15" name="__codelineno-83-15" href="#__codelineno-83-15"></a><span class="w">    </span><span class="na">suffix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.html&quot;</span>
</span><span id="__span-83-16"><a id="__codelineno-83-16" name="__codelineno-83-16" href="#__codelineno-83-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-83-17"><a id="__codelineno-83-17" name="__codelineno-83-17" href="#__codelineno-83-17"></a>
</span><span id="__span-83-18"><a id="__codelineno-83-18" name="__codelineno-83-18" href="#__codelineno-83-18"></a><span class="w">  </span><span class="nb">error_document</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-19"><a id="__codelineno-83-19" name="__codelineno-83-19" href="#__codelineno-83-19"></a><span class="w">    </span><span class="na">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;error.html&quot;</span>
</span><span id="__span-83-20"><a id="__codelineno-83-20" name="__codelineno-83-20" href="#__codelineno-83-20"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-83-21"><a id="__codelineno-83-21" name="__codelineno-83-21" href="#__codelineno-83-21"></a><span class="p">}</span>
</span><span id="__span-83-22"><a id="__codelineno-83-22" name="__codelineno-83-22" href="#__codelineno-83-22"></a>
</span><span id="__span-83-23"><a id="__codelineno-83-23" name="__codelineno-83-23" href="#__codelineno-83-23"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_cors_configuration&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-24"><a id="__codelineno-83-24" name="__codelineno-83-24" href="#__codelineno-83-24"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-83-25"><a id="__codelineno-83-25" name="__codelineno-83-25" href="#__codelineno-83-25"></a>
</span><span id="__span-83-26"><a id="__codelineno-83-26" name="__codelineno-83-26" href="#__codelineno-83-26"></a><span class="w">  </span><span class="nb">cors_rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-27"><a id="__codelineno-83-27" name="__codelineno-83-27" href="#__codelineno-83-27"></a><span class="w">    </span><span class="na">allowed_headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span>
</span><span id="__span-83-28"><a id="__codelineno-83-28" name="__codelineno-83-28" href="#__codelineno-83-28"></a><span class="w">    </span><span class="na">allowed_methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;</span><span class="p">]</span>
</span><span id="__span-83-29"><a id="__codelineno-83-29" name="__codelineno-83-29" href="#__codelineno-83-29"></a><span class="w">    </span><span class="na">allowed_origins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span><span class="c1">  # In production, restrict to your domain</span>
</span><span id="__span-83-30"><a id="__codelineno-83-30" name="__codelineno-83-30" href="#__codelineno-83-30"></a><span class="w">    </span><span class="na">expose_headers</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;ETag&quot;</span><span class="p">]</span>
</span><span id="__span-83-31"><a id="__codelineno-83-31" name="__codelineno-83-31" href="#__codelineno-83-31"></a><span class="w">    </span><span class="na">max_age_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3000</span>
</span><span id="__span-83-32"><a id="__codelineno-83-32" name="__codelineno-83-32" href="#__codelineno-83-32"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-83-33"><a id="__codelineno-83-33" name="__codelineno-83-33" href="#__codelineno-83-33"></a><span class="p">}</span>
</span><span id="__span-83-34"><a id="__codelineno-83-34" name="__codelineno-83-34" href="#__codelineno-83-34"></a>
</span><span id="__span-83-35"><a id="__codelineno-83-35" name="__codelineno-83-35" href="#__codelineno-83-35"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_policy&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-36"><a id="__codelineno-83-36" name="__codelineno-83-36" href="#__codelineno-83-36"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-83-37"><a id="__codelineno-83-37" name="__codelineno-83-37" href="#__codelineno-83-37"></a><span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-83-38"><a id="__codelineno-83-38" name="__codelineno-83-38" href="#__codelineno-83-38"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-83-39"><a id="__codelineno-83-39" name="__codelineno-83-39" href="#__codelineno-83-39"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-83-40"><a id="__codelineno-83-40" name="__codelineno-83-40" href="#__codelineno-83-40"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-83-41"><a id="__codelineno-83-41" name="__codelineno-83-41" href="#__codelineno-83-41"></a><span class="w">        </span><span class="na">Sid</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PublicReadGetObject&quot;</span>
</span><span id="__span-83-42"><a id="__codelineno-83-42" name="__codelineno-83-42" href="#__codelineno-83-42"></a><span class="w">        </span><span class="na">Effect</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-83-43"><a id="__codelineno-83-43" name="__codelineno-83-43" href="#__codelineno-83-43"></a><span class="w">        </span><span class="na">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-83-44"><a id="__codelineno-83-44" name="__codelineno-83-44" href="#__codelineno-83-44"></a><span class="w">        </span><span class="na">Action</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;s3:GetObject&quot;</span>
</span><span id="__span-83-45"><a id="__codelineno-83-45" name="__codelineno-83-45" href="#__codelineno-83-45"></a><span class="w">        </span><span class="na">Resource</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${aws_s3_bucket.website.arn}/*&quot;</span>
</span><span id="__span-83-46"><a id="__codelineno-83-46" name="__codelineno-83-46" href="#__codelineno-83-46"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-83-47"><a id="__codelineno-83-47" name="__codelineno-83-47" href="#__codelineno-83-47"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-83-48"><a id="__codelineno-83-48" name="__codelineno-83-48" href="#__codelineno-83-48"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-83-49"><a id="__codelineno-83-49" name="__codelineno-83-49" href="#__codelineno-83-49"></a><span class="p">}</span>
</span><span id="__span-83-50"><a id="__codelineno-83-50" name="__codelineno-83-50" href="#__codelineno-83-50"></a>
</span><span id="__span-83-51"><a id="__codelineno-83-51" name="__codelineno-83-51" href="#__codelineno-83-51"></a><span class="c1"># Enable versioning for rollback capability</span>
</span><span id="__span-83-52"><a id="__codelineno-83-52" name="__codelineno-83-52" href="#__codelineno-83-52"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_versioning&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-53"><a id="__codelineno-83-53" name="__codelineno-83-53" href="#__codelineno-83-53"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-83-54"><a id="__codelineno-83-54" name="__codelineno-83-54" href="#__codelineno-83-54"></a><span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-55"><a id="__codelineno-83-55" name="__codelineno-83-55" href="#__codelineno-83-55"></a><span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Enabled&quot;</span>
</span><span id="__span-83-56"><a id="__codelineno-83-56" name="__codelineno-83-56" href="#__codelineno-83-56"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-83-57"><a id="__codelineno-83-57" name="__codelineno-83-57" href="#__codelineno-83-57"></a><span class="p">}</span>
</span><span id="__span-83-58"><a id="__codelineno-83-58" name="__codelineno-83-58" href="#__codelineno-83-58"></a>
</span><span id="__span-83-59"><a id="__codelineno-83-59" name="__codelineno-83-59" href="#__codelineno-83-59"></a><span class="c1"># Add encryption for security</span>
</span><span id="__span-83-60"><a id="__codelineno-83-60" name="__codelineno-83-60" href="#__codelineno-83-60"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_server_side_encryption_configuration&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-61"><a id="__codelineno-83-61" name="__codelineno-83-61" href="#__codelineno-83-61"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-83-62"><a id="__codelineno-83-62" name="__codelineno-83-62" href="#__codelineno-83-62"></a>
</span><span id="__span-83-63"><a id="__codelineno-83-63" name="__codelineno-83-63" href="#__codelineno-83-63"></a><span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-64"><a id="__codelineno-83-64" name="__codelineno-83-64" href="#__codelineno-83-64"></a><span class="w">    </span><span class="nb">apply_server_side_encryption_by_default</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-83-65"><a id="__codelineno-83-65" name="__codelineno-83-65" href="#__codelineno-83-65"></a><span class="w">      </span><span class="na">sse_algorithm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AES256&quot;</span>
</span><span id="__span-83-66"><a id="__codelineno-83-66" name="__codelineno-83-66" href="#__codelineno-83-66"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-83-67"><a id="__codelineno-83-67" name="__codelineno-83-67" href="#__codelineno-83-67"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-83-68"><a id="__codelineno-83-68" name="__codelineno-83-68" href="#__codelineno-83-68"></a><span class="p">}</span>
</span></code></pre></div>
<p>Notice that I've included CORS configuration, which will be essential later when we integrate with our API. I also added encryption and versioning for better security and disaster recovery.</p>
<h4 id="2-acm-certificate-module"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#2-acm-certificate-module">2. ACM Certificate Module 🔒</a></h4>
<p>Create a file at <code>modules/frontend/acm.tf</code>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_acm_certificate&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="w">  </span><span class="na">domain_name</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">var.domain_name</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="w">  </span><span class="na">validation_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DNS&quot;</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="w">  </span><span class="na">subject_alternative_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;www.${var.domain_name}&quot;</span><span class="p">]</span>
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="w">  </span><span class="nb">lifecycle</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="w">    </span><span class="na">create_before_destroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a>
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-12"><a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Website Certificate&quot;</span>
</span><span id="__span-84-13"><a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-84-14"><a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-84-15"><a id="__codelineno-84-15" name="__codelineno-84-15" href="#__codelineno-84-15"></a><span class="p">}</span>
</span><span id="__span-84-16"><a id="__codelineno-84-16" name="__codelineno-84-16" href="#__codelineno-84-16"></a>
</span><span id="__span-84-17"><a id="__codelineno-84-17" name="__codelineno-84-17" href="#__codelineno-84-17"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_acm_certificate_validation&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-18"><a id="__codelineno-84-18" name="__codelineno-84-18" href="#__codelineno-84-18"></a><span class="w">  </span><span class="na">certificate_arn</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_acm_certificate.website.arn</span>
</span><span id="__span-84-19"><a id="__codelineno-84-19" name="__codelineno-84-19" href="#__codelineno-84-19"></a><span class="w">  </span><span class="na">validation_record_fqdns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="err">for</span><span class="w"> </span><span class="err">record</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="nv">aws_route53_record.certificate_validation</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">record.fqdn</span><span class="p">]</span>
</span><span id="__span-84-20"><a id="__codelineno-84-20" name="__codelineno-84-20" href="#__codelineno-84-20"></a>
</span><span id="__span-84-21"><a id="__codelineno-84-21" name="__codelineno-84-21" href="#__codelineno-84-21"></a><span class="c1">  # Wait for DNS propagation</span>
</span><span id="__span-84-22"><a id="__codelineno-84-22" name="__codelineno-84-22" href="#__codelineno-84-22"></a><span class="w">  </span><span class="nb">timeouts</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-23"><a id="__codelineno-84-23" name="__codelineno-84-23" href="#__codelineno-84-23"></a><span class="w">    </span><span class="na">create</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;30m&quot;</span>
</span><span id="__span-84-24"><a id="__codelineno-84-24" name="__codelineno-84-24" href="#__codelineno-84-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-84-25"><a id="__codelineno-84-25" name="__codelineno-84-25" href="#__codelineno-84-25"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="3-route-53-for-dns-configuration"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#3-route-53-for-dns-configuration">3. Route 53 for DNS Configuration 📡</a></h4>
<p>Create a file at <code>modules/frontend/route53.tf</code>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="kr">data</span><span class="w"> </span><span class="nc">&quot;aws_route53_zone&quot;</span><span class="w"> </span><span class="nv">&quot;selected&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="w">  </span><span class="na">name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.root_domain_name</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="w">  </span><span class="na">private_zone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="p">}</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_record&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="w">  </span><span class="na">zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_route53_zone.selected.zone_id</span>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="w">  </span><span class="na">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">var.domain_name</span>
</span><span id="__span-85-9"><a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a><span class="w">  </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;A&quot;</span>
</span><span id="__span-85-10"><a id="__codelineno-85-10" name="__codelineno-85-10" href="#__codelineno-85-10"></a>
</span><span id="__span-85-11"><a id="__codelineno-85-11" name="__codelineno-85-11" href="#__codelineno-85-11"></a><span class="w">  </span><span class="nb">alias</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-85-12"><a id="__codelineno-85-12" name="__codelineno-85-12" href="#__codelineno-85-12"></a><span class="w">    </span><span class="na">name</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.domain_name</span>
</span><span id="__span-85-13"><a id="__codelineno-85-13" name="__codelineno-85-13" href="#__codelineno-85-13"></a><span class="w">    </span><span class="na">zone_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.hosted_zone_id</span>
</span><span id="__span-85-14"><a id="__codelineno-85-14" name="__codelineno-85-14" href="#__codelineno-85-14"></a><span class="w">    </span><span class="na">evaluate_target_health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-85-15"><a id="__codelineno-85-15" name="__codelineno-85-15" href="#__codelineno-85-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-85-16"><a id="__codelineno-85-16" name="__codelineno-85-16" href="#__codelineno-85-16"></a><span class="p">}</span>
</span><span id="__span-85-17"><a id="__codelineno-85-17" name="__codelineno-85-17" href="#__codelineno-85-17"></a>
</span><span id="__span-85-18"><a id="__codelineno-85-18" name="__codelineno-85-18" href="#__codelineno-85-18"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_record&quot;</span><span class="w"> </span><span class="nv">&quot;www&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-85-19"><a id="__codelineno-85-19" name="__codelineno-85-19" href="#__codelineno-85-19"></a><span class="w">  </span><span class="na">zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_route53_zone.selected.zone_id</span>
</span><span id="__span-85-20"><a id="__codelineno-85-20" name="__codelineno-85-20" href="#__codelineno-85-20"></a><span class="w">  </span><span class="na">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;www.${var.domain_name}&quot;</span>
</span><span id="__span-85-21"><a id="__codelineno-85-21" name="__codelineno-85-21" href="#__codelineno-85-21"></a><span class="w">  </span><span class="na">type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;A&quot;</span>
</span><span id="__span-85-22"><a id="__codelineno-85-22" name="__codelineno-85-22" href="#__codelineno-85-22"></a>
</span><span id="__span-85-23"><a id="__codelineno-85-23" name="__codelineno-85-23" href="#__codelineno-85-23"></a><span class="w">  </span><span class="nb">alias</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-85-24"><a id="__codelineno-85-24" name="__codelineno-85-24" href="#__codelineno-85-24"></a><span class="w">    </span><span class="na">name</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.domain_name</span>
</span><span id="__span-85-25"><a id="__codelineno-85-25" name="__codelineno-85-25" href="#__codelineno-85-25"></a><span class="w">    </span><span class="na">zone_id</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.hosted_zone_id</span>
</span><span id="__span-85-26"><a id="__codelineno-85-26" name="__codelineno-85-26" href="#__codelineno-85-26"></a><span class="w">    </span><span class="na">evaluate_target_health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-85-27"><a id="__codelineno-85-27" name="__codelineno-85-27" href="#__codelineno-85-27"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-85-28"><a id="__codelineno-85-28" name="__codelineno-85-28" href="#__codelineno-85-28"></a><span class="p">}</span>
</span><span id="__span-85-29"><a id="__codelineno-85-29" name="__codelineno-85-29" href="#__codelineno-85-29"></a>
</span><span id="__span-85-30"><a id="__codelineno-85-30" name="__codelineno-85-30" href="#__codelineno-85-30"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_record&quot;</span><span class="w"> </span><span class="nv">&quot;certificate_validation&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-85-31"><a id="__codelineno-85-31" name="__codelineno-85-31" href="#__codelineno-85-31"></a><span class="w">  </span><span class="nb">for_each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-85-32"><a id="__codelineno-85-32" name="__codelineno-85-32" href="#__codelineno-85-32"></a><span class="w">    </span><span class="err">for</span><span class="w"> </span><span class="err">dvo</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="nv">aws_acm_certificate.website.domain_validation_options</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">dvo.domain_name</span><span class="w"> </span><span class="p">=</span><span class="err">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-85-33"><a id="__codelineno-85-33" name="__codelineno-85-33" href="#__codelineno-85-33"></a><span class="w">      </span><span class="na">name</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">dvo.resource_record_name</span>
</span><span id="__span-85-34"><a id="__codelineno-85-34" name="__codelineno-85-34" href="#__codelineno-85-34"></a><span class="w">      </span><span class="na">record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dvo.resource_record_value</span>
</span><span id="__span-85-35"><a id="__codelineno-85-35" name="__codelineno-85-35" href="#__codelineno-85-35"></a><span class="w">      </span><span class="na">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">dvo.resource_record_type</span>
</span><span id="__span-85-36"><a id="__codelineno-85-36" name="__codelineno-85-36" href="#__codelineno-85-36"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-85-37"><a id="__codelineno-85-37" name="__codelineno-85-37" href="#__codelineno-85-37"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-85-38"><a id="__codelineno-85-38" name="__codelineno-85-38" href="#__codelineno-85-38"></a>
</span><span id="__span-85-39"><a id="__codelineno-85-39" name="__codelineno-85-39" href="#__codelineno-85-39"></a><span class="w">  </span><span class="na">allow_overwrite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-85-40"><a id="__codelineno-85-40" name="__codelineno-85-40" href="#__codelineno-85-40"></a><span class="w">  </span><span class="na">name</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">each.value.name</span>
</span><span id="__span-85-41"><a id="__codelineno-85-41" name="__codelineno-85-41" href="#__codelineno-85-41"></a><span class="w">  </span><span class="na">records</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">each.value.record</span><span class="p">]</span>
</span><span id="__span-85-42"><a id="__codelineno-85-42" name="__codelineno-85-42" href="#__codelineno-85-42"></a><span class="w">  </span><span class="na">ttl</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="m">60</span>
</span><span id="__span-85-43"><a id="__codelineno-85-43" name="__codelineno-85-43" href="#__codelineno-85-43"></a><span class="w">  </span><span class="na">type</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nv">each.value.type</span>
</span><span id="__span-85-44"><a id="__codelineno-85-44" name="__codelineno-85-44" href="#__codelineno-85-44"></a><span class="w">  </span><span class="na">zone_id</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_route53_zone.selected.zone_id</span>
</span><span id="__span-85-45"><a id="__codelineno-85-45" name="__codelineno-85-45" href="#__codelineno-85-45"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="4-cloudfront-distribution-for-cdn-and-https"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#4-cloudfront-distribution-for-cdn-and-https">4. CloudFront Distribution for CDN and HTTPS 🌍</a></h4>
<p>Create a file at <code>modules/frontend/cloudfront.tf</code>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudfront_distribution&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="w">  </span><span class="nb">origin</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="w">    </span><span class="na">domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.bucket_regional_domain_name</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="w">    </span><span class="na">origin_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S3-${var.website_bucket_name}&quot;</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="w">    </span><span class="nb">s3_origin_config</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a><span class="w">      </span><span class="na">origin_access_identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_origin_access_identity.website.cloudfront_access_identity_path</span>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="w">  </span><span class="na">enabled</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a><span class="w">  </span><span class="na">is_ipv6_enabled</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-86-13"><a id="__codelineno-86-13" name="__codelineno-86-13" href="#__codelineno-86-13"></a><span class="w">  </span><span class="na">default_root_object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.html&quot;</span>
</span><span id="__span-86-14"><a id="__codelineno-86-14" name="__codelineno-86-14" href="#__codelineno-86-14"></a><span class="w">  </span><span class="na">aliases</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">var.domain_name</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;www.${var.domain_name}&quot;</span><span class="p">]</span>
</span><span id="__span-86-15"><a id="__codelineno-86-15" name="__codelineno-86-15" href="#__codelineno-86-15"></a><span class="w">  </span><span class="na">price_class</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PriceClass_100&quot;</span>
</span><span id="__span-86-16"><a id="__codelineno-86-16" name="__codelineno-86-16" href="#__codelineno-86-16"></a>
</span><span id="__span-86-17"><a id="__codelineno-86-17" name="__codelineno-86-17" href="#__codelineno-86-17"></a><span class="w">  </span><span class="nb">default_cache_behavior</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-18"><a id="__codelineno-86-18" name="__codelineno-86-18" href="#__codelineno-86-18"></a><span class="w">    </span><span class="na">allowed_methods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;, &quot;OPTIONS&quot;</span><span class="p">]</span>
</span><span id="__span-86-19"><a id="__codelineno-86-19" name="__codelineno-86-19" href="#__codelineno-86-19"></a><span class="w">    </span><span class="na">cached_methods</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;</span><span class="p">]</span>
</span><span id="__span-86-20"><a id="__codelineno-86-20" name="__codelineno-86-20" href="#__codelineno-86-20"></a><span class="w">    </span><span class="na">target_origin_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S3-${var.website_bucket_name}&quot;</span>
</span><span id="__span-86-21"><a id="__codelineno-86-21" name="__codelineno-86-21" href="#__codelineno-86-21"></a>
</span><span id="__span-86-22"><a id="__codelineno-86-22" name="__codelineno-86-22" href="#__codelineno-86-22"></a><span class="w">    </span><span class="nb">forwarded_values</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-23"><a id="__codelineno-86-23" name="__codelineno-86-23" href="#__codelineno-86-23"></a><span class="w">      </span><span class="na">query_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-86-24"><a id="__codelineno-86-24" name="__codelineno-86-24" href="#__codelineno-86-24"></a><span class="w">      </span><span class="nb">cookies</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-25"><a id="__codelineno-86-25" name="__codelineno-86-25" href="#__codelineno-86-25"></a><span class="w">        </span><span class="na">forward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span>
</span><span id="__span-86-26"><a id="__codelineno-86-26" name="__codelineno-86-26" href="#__codelineno-86-26"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-86-27"><a id="__codelineno-86-27" name="__codelineno-86-27" href="#__codelineno-86-27"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-86-28"><a id="__codelineno-86-28" name="__codelineno-86-28" href="#__codelineno-86-28"></a>
</span><span id="__span-86-29"><a id="__codelineno-86-29" name="__codelineno-86-29" href="#__codelineno-86-29"></a><span class="w">    </span><span class="na">viewer_protocol_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;redirect-to-https&quot;</span>
</span><span id="__span-86-30"><a id="__codelineno-86-30" name="__codelineno-86-30" href="#__codelineno-86-30"></a><span class="w">    </span><span class="na">min_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-86-31"><a id="__codelineno-86-31" name="__codelineno-86-31" href="#__codelineno-86-31"></a><span class="w">    </span><span class="na">default_ttl</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="m">3600</span>
</span><span id="__span-86-32"><a id="__codelineno-86-32" name="__codelineno-86-32" href="#__codelineno-86-32"></a><span class="w">    </span><span class="na">max_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">86400</span>
</span><span id="__span-86-33"><a id="__codelineno-86-33" name="__codelineno-86-33" href="#__codelineno-86-33"></a><span class="w">    </span><span class="na">compress</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-86-34"><a id="__codelineno-86-34" name="__codelineno-86-34" href="#__codelineno-86-34"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-86-35"><a id="__codelineno-86-35" name="__codelineno-86-35" href="#__codelineno-86-35"></a>
</span><span id="__span-86-36"><a id="__codelineno-86-36" name="__codelineno-86-36" href="#__codelineno-86-36"></a><span class="c1">  # Cache behaviors for specific patterns</span>
</span><span id="__span-86-37"><a id="__codelineno-86-37" name="__codelineno-86-37" href="#__codelineno-86-37"></a><span class="w">  </span><span class="nb">ordered_cache_behavior</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-38"><a id="__codelineno-86-38" name="__codelineno-86-38" href="#__codelineno-86-38"></a><span class="w">    </span><span class="na">path_pattern</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*.js&quot;</span>
</span><span id="__span-86-39"><a id="__codelineno-86-39" name="__codelineno-86-39" href="#__codelineno-86-39"></a><span class="w">    </span><span class="na">allowed_methods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;, &quot;OPTIONS&quot;</span><span class="p">]</span>
</span><span id="__span-86-40"><a id="__codelineno-86-40" name="__codelineno-86-40" href="#__codelineno-86-40"></a><span class="w">    </span><span class="na">cached_methods</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;</span><span class="p">]</span>
</span><span id="__span-86-41"><a id="__codelineno-86-41" name="__codelineno-86-41" href="#__codelineno-86-41"></a><span class="w">    </span><span class="na">target_origin_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S3-${var.website_bucket_name}&quot;</span>
</span><span id="__span-86-42"><a id="__codelineno-86-42" name="__codelineno-86-42" href="#__codelineno-86-42"></a>
</span><span id="__span-86-43"><a id="__codelineno-86-43" name="__codelineno-86-43" href="#__codelineno-86-43"></a><span class="w">    </span><span class="nb">forwarded_values</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-44"><a id="__codelineno-86-44" name="__codelineno-86-44" href="#__codelineno-86-44"></a><span class="w">      </span><span class="na">query_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-86-45"><a id="__codelineno-86-45" name="__codelineno-86-45" href="#__codelineno-86-45"></a><span class="w">      </span><span class="nb">cookies</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-46"><a id="__codelineno-86-46" name="__codelineno-86-46" href="#__codelineno-86-46"></a><span class="w">        </span><span class="na">forward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span>
</span><span id="__span-86-47"><a id="__codelineno-86-47" name="__codelineno-86-47" href="#__codelineno-86-47"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-86-48"><a id="__codelineno-86-48" name="__codelineno-86-48" href="#__codelineno-86-48"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-86-49"><a id="__codelineno-86-49" name="__codelineno-86-49" href="#__codelineno-86-49"></a>
</span><span id="__span-86-50"><a id="__codelineno-86-50" name="__codelineno-86-50" href="#__codelineno-86-50"></a><span class="w">    </span><span class="na">viewer_protocol_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;redirect-to-https&quot;</span>
</span><span id="__span-86-51"><a id="__codelineno-86-51" name="__codelineno-86-51" href="#__codelineno-86-51"></a><span class="w">    </span><span class="na">min_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-86-52"><a id="__codelineno-86-52" name="__codelineno-86-52" href="#__codelineno-86-52"></a><span class="w">    </span><span class="na">default_ttl</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="m">86400</span>
</span><span id="__span-86-53"><a id="__codelineno-86-53" name="__codelineno-86-53" href="#__codelineno-86-53"></a><span class="w">    </span><span class="na">max_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">31536000</span>
</span><span id="__span-86-54"><a id="__codelineno-86-54" name="__codelineno-86-54" href="#__codelineno-86-54"></a><span class="w">    </span><span class="na">compress</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-86-55"><a id="__codelineno-86-55" name="__codelineno-86-55" href="#__codelineno-86-55"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-86-56"><a id="__codelineno-86-56" name="__codelineno-86-56" href="#__codelineno-86-56"></a>
</span><span id="__span-86-57"><a id="__codelineno-86-57" name="__codelineno-86-57" href="#__codelineno-86-57"></a><span class="w">  </span><span class="nb">ordered_cache_behavior</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-58"><a id="__codelineno-86-58" name="__codelineno-86-58" href="#__codelineno-86-58"></a><span class="w">    </span><span class="na">path_pattern</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*.css&quot;</span>
</span><span id="__span-86-59"><a id="__codelineno-86-59" name="__codelineno-86-59" href="#__codelineno-86-59"></a><span class="w">    </span><span class="na">allowed_methods</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;, &quot;OPTIONS&quot;</span><span class="p">]</span>
</span><span id="__span-86-60"><a id="__codelineno-86-60" name="__codelineno-86-60" href="#__codelineno-86-60"></a><span class="w">    </span><span class="na">cached_methods</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;, &quot;HEAD&quot;</span><span class="p">]</span>
</span><span id="__span-86-61"><a id="__codelineno-86-61" name="__codelineno-86-61" href="#__codelineno-86-61"></a><span class="w">    </span><span class="na">target_origin_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S3-${var.website_bucket_name}&quot;</span>
</span><span id="__span-86-62"><a id="__codelineno-86-62" name="__codelineno-86-62" href="#__codelineno-86-62"></a>
</span><span id="__span-86-63"><a id="__codelineno-86-63" name="__codelineno-86-63" href="#__codelineno-86-63"></a><span class="w">    </span><span class="nb">forwarded_values</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-64"><a id="__codelineno-86-64" name="__codelineno-86-64" href="#__codelineno-86-64"></a><span class="w">      </span><span class="na">query_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-86-65"><a id="__codelineno-86-65" name="__codelineno-86-65" href="#__codelineno-86-65"></a><span class="w">      </span><span class="nb">cookies</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-66"><a id="__codelineno-86-66" name="__codelineno-86-66" href="#__codelineno-86-66"></a><span class="w">        </span><span class="na">forward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span>
</span><span id="__span-86-67"><a id="__codelineno-86-67" name="__codelineno-86-67" href="#__codelineno-86-67"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-86-68"><a id="__codelineno-86-68" name="__codelineno-86-68" href="#__codelineno-86-68"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-86-69"><a id="__codelineno-86-69" name="__codelineno-86-69" href="#__codelineno-86-69"></a>
</span><span id="__span-86-70"><a id="__codelineno-86-70" name="__codelineno-86-70" href="#__codelineno-86-70"></a><span class="w">    </span><span class="na">viewer_protocol_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;redirect-to-https&quot;</span>
</span><span id="__span-86-71"><a id="__codelineno-86-71" name="__codelineno-86-71" href="#__codelineno-86-71"></a><span class="w">    </span><span class="na">min_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-86-72"><a id="__codelineno-86-72" name="__codelineno-86-72" href="#__codelineno-86-72"></a><span class="w">    </span><span class="na">default_ttl</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="m">86400</span>
</span><span id="__span-86-73"><a id="__codelineno-86-73" name="__codelineno-86-73" href="#__codelineno-86-73"></a><span class="w">    </span><span class="na">max_ttl</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">31536000</span>
</span><span id="__span-86-74"><a id="__codelineno-86-74" name="__codelineno-86-74" href="#__codelineno-86-74"></a><span class="w">    </span><span class="na">compress</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-86-75"><a id="__codelineno-86-75" name="__codelineno-86-75" href="#__codelineno-86-75"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-86-76"><a id="__codelineno-86-76" name="__codelineno-86-76" href="#__codelineno-86-76"></a>
</span><span id="__span-86-77"><a id="__codelineno-86-77" name="__codelineno-86-77" href="#__codelineno-86-77"></a><span class="c1">  # Restrict access to North America and Europe</span>
</span><span id="__span-86-78"><a id="__codelineno-86-78" name="__codelineno-86-78" href="#__codelineno-86-78"></a><span class="w">  </span><span class="nb">restrictions</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-79"><a id="__codelineno-86-79" name="__codelineno-86-79" href="#__codelineno-86-79"></a><span class="w">    </span><span class="nb">geo_restriction</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-80"><a id="__codelineno-86-80" name="__codelineno-86-80" href="#__codelineno-86-80"></a><span class="w">      </span><span class="na">restriction_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;whitelist&quot;</span>
</span><span id="__span-86-81"><a id="__codelineno-86-81" name="__codelineno-86-81" href="#__codelineno-86-81"></a><span class="w">      </span><span class="na">locations</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;US&quot;, &quot;CA&quot;, &quot;GB&quot;, &quot;DE&quot;, &quot;FR&quot;, &quot;ES&quot;, &quot;IT&quot;</span><span class="p">]</span>
</span><span id="__span-86-82"><a id="__codelineno-86-82" name="__codelineno-86-82" href="#__codelineno-86-82"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-86-83"><a id="__codelineno-86-83" name="__codelineno-86-83" href="#__codelineno-86-83"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-86-84"><a id="__codelineno-86-84" name="__codelineno-86-84" href="#__codelineno-86-84"></a>
</span><span id="__span-86-85"><a id="__codelineno-86-85" name="__codelineno-86-85" href="#__codelineno-86-85"></a><span class="w">  </span><span class="nb">viewer_certificate</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-86"><a id="__codelineno-86-86" name="__codelineno-86-86" href="#__codelineno-86-86"></a><span class="w">    </span><span class="na">acm_certificate_arn</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_acm_certificate.website.arn</span>
</span><span id="__span-86-87"><a id="__codelineno-86-87" name="__codelineno-86-87" href="#__codelineno-86-87"></a><span class="w">    </span><span class="na">ssl_support_method</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;sni-only&quot;</span>
</span><span id="__span-86-88"><a id="__codelineno-86-88" name="__codelineno-86-88" href="#__codelineno-86-88"></a><span class="w">    </span><span class="na">minimum_protocol_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;TLSv1.2_2021&quot;</span>
</span><span id="__span-86-89"><a id="__codelineno-86-89" name="__codelineno-86-89" href="#__codelineno-86-89"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-86-90"><a id="__codelineno-86-90" name="__codelineno-86-90" href="#__codelineno-86-90"></a>
</span><span id="__span-86-91"><a id="__codelineno-86-91" name="__codelineno-86-91" href="#__codelineno-86-91"></a><span class="c1">  # Add custom error response</span>
</span><span id="__span-86-92"><a id="__codelineno-86-92" name="__codelineno-86-92" href="#__codelineno-86-92"></a><span class="w">  </span><span class="nb">custom_error_response</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-93"><a id="__codelineno-86-93" name="__codelineno-86-93" href="#__codelineno-86-93"></a><span class="w">    </span><span class="na">error_code</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="m">404</span>
</span><span id="__span-86-94"><a id="__codelineno-86-94" name="__codelineno-86-94" href="#__codelineno-86-94"></a><span class="w">    </span><span class="na">response_code</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="m">404</span>
</span><span id="__span-86-95"><a id="__codelineno-86-95" name="__codelineno-86-95" href="#__codelineno-86-95"></a><span class="w">    </span><span class="na">response_page_path</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/error.html&quot;</span>
</span><span id="__span-86-96"><a id="__codelineno-86-96" name="__codelineno-86-96" href="#__codelineno-86-96"></a><span class="w">    </span><span class="na">error_caching_min_ttl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>
</span><span id="__span-86-97"><a id="__codelineno-86-97" name="__codelineno-86-97" href="#__codelineno-86-97"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-86-98"><a id="__codelineno-86-98" name="__codelineno-86-98" href="#__codelineno-86-98"></a>
</span><span id="__span-86-99"><a id="__codelineno-86-99" name="__codelineno-86-99" href="#__codelineno-86-99"></a><span class="w">  </span><span class="nb">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-100"><a id="__codelineno-86-100" name="__codelineno-86-100" href="#__codelineno-86-100"></a><span class="w">    </span><span class="na">Name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Resume Website CloudFront&quot;</span>
</span><span id="__span-86-101"><a id="__codelineno-86-101" name="__codelineno-86-101" href="#__codelineno-86-101"></a><span class="w">    </span><span class="na">Environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-86-102"><a id="__codelineno-86-102" name="__codelineno-86-102" href="#__codelineno-86-102"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-86-103"><a id="__codelineno-86-103" name="__codelineno-86-103" href="#__codelineno-86-103"></a>
</span><span id="__span-86-104"><a id="__codelineno-86-104" name="__codelineno-86-104" href="#__codelineno-86-104"></a><span class="w">  </span><span class="na">depends_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">aws_acm_certificate_validation.website</span><span class="p">]</span>
</span><span id="__span-86-105"><a id="__codelineno-86-105" name="__codelineno-86-105" href="#__codelineno-86-105"></a><span class="p">}</span>
</span><span id="__span-86-106"><a id="__codelineno-86-106" name="__codelineno-86-106" href="#__codelineno-86-106"></a>
</span><span id="__span-86-107"><a id="__codelineno-86-107" name="__codelineno-86-107" href="#__codelineno-86-107"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_cloudfront_origin_access_identity&quot;</span><span class="w"> </span><span class="nv">&quot;website&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-108"><a id="__codelineno-86-108" name="__codelineno-86-108" href="#__codelineno-86-108"></a><span class="w">  </span><span class="na">comment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Access identity for Resume Website CloudFront&quot;</span>
</span><span id="__span-86-109"><a id="__codelineno-86-109" name="__codelineno-86-109" href="#__codelineno-86-109"></a><span class="p">}</span>
</span><span id="__span-86-110"><a id="__codelineno-86-110" name="__codelineno-86-110" href="#__codelineno-86-110"></a>
</span><span id="__span-86-111"><a id="__codelineno-86-111" name="__codelineno-86-111" href="#__codelineno-86-111"></a><span class="c1"># Update S3 bucket policy to allow access from CloudFront</span>
</span><span id="__span-86-112"><a id="__codelineno-86-112" name="__codelineno-86-112" href="#__codelineno-86-112"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_policy&quot;</span><span class="w"> </span><span class="nv">&quot;cloudfront_access&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-113"><a id="__codelineno-86-113" name="__codelineno-86-113" href="#__codelineno-86-113"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-86-114"><a id="__codelineno-86-114" name="__codelineno-86-114" href="#__codelineno-86-114"></a><span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-86-115"><a id="__codelineno-86-115" name="__codelineno-86-115" href="#__codelineno-86-115"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-86-116"><a id="__codelineno-86-116" name="__codelineno-86-116" href="#__codelineno-86-116"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-86-117"><a id="__codelineno-86-117" name="__codelineno-86-117" href="#__codelineno-86-117"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-86-118"><a id="__codelineno-86-118" name="__codelineno-86-118" href="#__codelineno-86-118"></a><span class="w">        </span><span class="na">Sid</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AllowCloudFrontServicePrincipal&quot;</span>
</span><span id="__span-86-119"><a id="__codelineno-86-119" name="__codelineno-86-119" href="#__codelineno-86-119"></a><span class="w">        </span><span class="na">Effect</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span>
</span><span id="__span-86-120"><a id="__codelineno-86-120" name="__codelineno-86-120" href="#__codelineno-86-120"></a><span class="w">        </span><span class="nb">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-121"><a id="__codelineno-86-121" name="__codelineno-86-121" href="#__codelineno-86-121"></a><span class="w">          </span><span class="na">Service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cloudfront.amazonaws.com&quot;</span>
</span><span id="__span-86-122"><a id="__codelineno-86-122" name="__codelineno-86-122" href="#__codelineno-86-122"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-86-123"><a id="__codelineno-86-123" name="__codelineno-86-123" href="#__codelineno-86-123"></a><span class="w">        </span><span class="na">Action</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;s3:GetObject&quot;</span>
</span><span id="__span-86-124"><a id="__codelineno-86-124" name="__codelineno-86-124" href="#__codelineno-86-124"></a><span class="w">        </span><span class="na">Resource</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${aws_s3_bucket.website.arn}/*&quot;</span>
</span><span id="__span-86-125"><a id="__codelineno-86-125" name="__codelineno-86-125" href="#__codelineno-86-125"></a><span class="w">        </span><span class="nb">Condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-126"><a id="__codelineno-86-126" name="__codelineno-86-126" href="#__codelineno-86-126"></a><span class="w">          </span><span class="nb">StringEquals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-127"><a id="__codelineno-86-127" name="__codelineno-86-127" href="#__codelineno-86-127"></a><span class="w">            </span><span class="s2">&quot;AWS:SourceArn&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.arn</span>
</span><span id="__span-86-128"><a id="__codelineno-86-128" name="__codelineno-86-128" href="#__codelineno-86-128"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-86-129"><a id="__codelineno-86-129" name="__codelineno-86-129" href="#__codelineno-86-129"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-86-130"><a id="__codelineno-86-130" name="__codelineno-86-130" href="#__codelineno-86-130"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-86-131"><a id="__codelineno-86-131" name="__codelineno-86-131" href="#__codelineno-86-131"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-86-132"><a id="__codelineno-86-132" name="__codelineno-86-132" href="#__codelineno-86-132"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-86-133"><a id="__codelineno-86-133" name="__codelineno-86-133" href="#__codelineno-86-133"></a><span class="p">}</span>
</span></code></pre></div>
<p>I've implemented several security enhancements:</p>
<ul>
<li>Using origin access control for CloudFront</li>
<li>Restricting the content to specific geographic regions</li>
<li>Setting TLS to more modern protocols</li>
<li>Creating custom error pages</li>
<li>Adding better cache controls for different file types</li>
</ul>
<h4 id="5-variables-and-outputs"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#5-variables-and-outputs">5. Variables and Outputs 📝</a></h4>
<p>Create files at <code>modules/frontend/variables.tf</code> and <code>modules/frontend/outputs.tf</code>:</p>
<p><strong>variables.tf</strong>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;website_bucket_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Name of the S3 bucket to store website content&quot;</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="p">}</span>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;domain_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Domain name for the website&quot;</span>
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="p">}</span>
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a>
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;root_domain_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Root domain name to find Route 53 hosted zone&quot;</span>
</span><span id="__span-87-13"><a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-87-14"><a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a><span class="p">}</span>
</span><span id="__span-87-15"><a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a>
</span><span id="__span-87-16"><a id="__codelineno-87-16" name="__codelineno-87-16" href="#__codelineno-87-16"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;environment&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-17"><a id="__codelineno-87-17" name="__codelineno-87-17" href="#__codelineno-87-17"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Deployment environment (e.g., dev, prod)&quot;</span>
</span><span id="__span-87-18"><a id="__codelineno-87-18" name="__codelineno-87-18" href="#__codelineno-87-18"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-87-19"><a id="__codelineno-87-19" name="__codelineno-87-19" href="#__codelineno-87-19"></a><span class="w">  </span><span class="na">default</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dev&quot;</span>
</span><span id="__span-87-20"><a id="__codelineno-87-20" name="__codelineno-87-20" href="#__codelineno-87-20"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>outputs.tf</strong>:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;website_bucket_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Name of the S3 bucket hosting the website&quot;</span>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="p">}</span>
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a>
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;cloudfront_distribution_id&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ID of the CloudFront distribution&quot;</span>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.id</span>
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a><span class="p">}</span>
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a>
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;website_domain&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-88-12"><a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Domain name of the website&quot;</span>
</span><span id="__span-88-13"><a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">var.domain_name</span>
</span><span id="__span-88-14"><a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a><span class="p">}</span>
</span><span id="__span-88-15"><a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a>
</span><span id="__span-88-16"><a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a><span class="kr">output</span><span class="w"> </span><span class="nv">&quot;cloudfront_domain_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-88-17"><a id="__codelineno-88-17" name="__codelineno-88-17" href="#__codelineno-88-17"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;CloudFront domain name&quot;</span>
</span><span id="__span-88-18"><a id="__codelineno-88-18" name="__codelineno-88-18" href="#__codelineno-88-18"></a><span class="w">  </span><span class="na">value</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.domain_name</span>
</span><span id="__span-88-19"><a id="__codelineno-88-19" name="__codelineno-88-19" href="#__codelineno-88-19"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="6-main-module-configuration"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#6-main-module-configuration">6. Main Module Configuration 🔄</a></h4>
<p>Now, let's create the main configuration in <code>main.tf</code> that uses our frontend module:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="kr">provider</span><span class="w"> </span><span class="nv">&quot;aws&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="w">  </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="p">}</span>
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a>
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;frontend&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="w">  </span><span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./modules/frontend&quot;</span>
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a>
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="w">  </span><span class="na">website_bucket_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;my-resume-website-${var.environment}&quot;</span>
</span><span id="__span-89-9"><a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="w">  </span><span class="na">domain_name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.domain_name</span>
</span><span id="__span-89-10"><a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a><span class="w">  </span><span class="na">root_domain_name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">var.root_domain_name</span>
</span><span id="__span-89-11"><a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a><span class="w">  </span><span class="na">environment</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.environment</span>
</span><span id="__span-89-12"><a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a><span class="p">}</span>
</span></code></pre></div>
<p>In <code>variables.tf</code> at the root level:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;environment&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Deployment environment (e.g., dev, prod)&quot;</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="w">  </span><span class="na">default</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dev&quot;</span>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="p">}</span>
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a>
</span><span id="__span-90-7"><a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;domain_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Domain name for the website&quot;</span>
</span><span id="__span-90-9"><a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-90-10"><a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a><span class="p">}</span>
</span><span id="__span-90-11"><a id="__codelineno-90-11" name="__codelineno-90-11" href="#__codelineno-90-11"></a>
</span><span id="__span-90-12"><a id="__codelineno-90-12" name="__codelineno-90-12" href="#__codelineno-90-12"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;root_domain_name&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-90-13"><a id="__codelineno-90-13" name="__codelineno-90-13" href="#__codelineno-90-13"></a><span class="w">  </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Root domain name to find Route 53 hosted zone&quot;</span>
</span><span id="__span-90-14"><a id="__codelineno-90-14" name="__codelineno-90-14" href="#__codelineno-90-14"></a><span class="w">  </span><span class="na">type</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span>
</span><span id="__span-90-15"><a id="__codelineno-90-15" name="__codelineno-90-15" href="#__codelineno-90-15"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="7-uploading-content-to-s3"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#7-uploading-content-to-s3">7. Uploading Content to S3 📤</a></h4>
<p>We can use Terraform to upload our website files to S3:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="c1"># Add to modules/frontend/s3.tf</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_object&quot;</span><span class="w"> </span><span class="nv">&quot;html&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="w">  </span><span class="na">bucket</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="w">  </span><span class="na">key</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.html&quot;</span>
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="w">  </span><span class="na">source</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${path.module}/../../website/index.html&quot;</span>
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a><span class="w">  </span><span class="na">content_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;text/html&quot;</span>
</span><span id="__span-91-7"><a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a><span class="w">  </span><span class="na">etag</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nf">filemd5</span><span class="p">(</span><span class="s2">&quot;${path.module}/../../website/index.html&quot;</span><span class="p">)</span>
</span><span id="__span-91-8"><a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a><span class="p">}</span>
</span><span id="__span-91-9"><a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a>
</span><span id="__span-91-10"><a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_object&quot;</span><span class="w"> </span><span class="nv">&quot;css&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-11"><a id="__codelineno-91-11" name="__codelineno-91-11" href="#__codelineno-91-11"></a><span class="w">  </span><span class="na">bucket</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-91-12"><a id="__codelineno-91-12" name="__codelineno-91-12" href="#__codelineno-91-12"></a><span class="w">  </span><span class="na">key</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;styles.css&quot;</span>
</span><span id="__span-91-13"><a id="__codelineno-91-13" name="__codelineno-91-13" href="#__codelineno-91-13"></a><span class="w">  </span><span class="na">source</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${path.module}/../../website/styles.css&quot;</span>
</span><span id="__span-91-14"><a id="__codelineno-91-14" name="__codelineno-91-14" href="#__codelineno-91-14"></a><span class="w">  </span><span class="na">content_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;text/css&quot;</span>
</span><span id="__span-91-15"><a id="__codelineno-91-15" name="__codelineno-91-15" href="#__codelineno-91-15"></a><span class="w">  </span><span class="na">etag</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nf">filemd5</span><span class="p">(</span><span class="s2">&quot;${path.module}/../../website/styles.css&quot;</span><span class="p">)</span>
</span><span id="__span-91-16"><a id="__codelineno-91-16" name="__codelineno-91-16" href="#__codelineno-91-16"></a><span class="p">}</span>
</span><span id="__span-91-17"><a id="__codelineno-91-17" name="__codelineno-91-17" href="#__codelineno-91-17"></a>
</span><span id="__span-91-18"><a id="__codelineno-91-18" name="__codelineno-91-18" href="#__codelineno-91-18"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_object&quot;</span><span class="w"> </span><span class="nv">&quot;js&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-19"><a id="__codelineno-91-19" name="__codelineno-91-19" href="#__codelineno-91-19"></a><span class="w">  </span><span class="na">bucket</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-91-20"><a id="__codelineno-91-20" name="__codelineno-91-20" href="#__codelineno-91-20"></a><span class="w">  </span><span class="na">key</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;counter.js&quot;</span>
</span><span id="__span-91-21"><a id="__codelineno-91-21" name="__codelineno-91-21" href="#__codelineno-91-21"></a><span class="w">  </span><span class="na">source</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${path.module}/../../website/counter.js&quot;</span>
</span><span id="__span-91-22"><a id="__codelineno-91-22" name="__codelineno-91-22" href="#__codelineno-91-22"></a><span class="w">  </span><span class="na">content_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/javascript&quot;</span>
</span><span id="__span-91-23"><a id="__codelineno-91-23" name="__codelineno-91-23" href="#__codelineno-91-23"></a><span class="w">  </span><span class="na">etag</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nf">filemd5</span><span class="p">(</span><span class="s2">&quot;${path.module}/../../website/counter.js&quot;</span><span class="p">)</span>
</span><span id="__span-91-24"><a id="__codelineno-91-24" name="__codelineno-91-24" href="#__codelineno-91-24"></a><span class="p">}</span>
</span><span id="__span-91-25"><a id="__codelineno-91-25" name="__codelineno-91-25" href="#__codelineno-91-25"></a>
</span><span id="__span-91-26"><a id="__codelineno-91-26" name="__codelineno-91-26" href="#__codelineno-91-26"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_object&quot;</span><span class="w"> </span><span class="nv">&quot;error_page&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-91-27"><a id="__codelineno-91-27" name="__codelineno-91-27" href="#__codelineno-91-27"></a><span class="w">  </span><span class="na">bucket</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-91-28"><a id="__codelineno-91-28" name="__codelineno-91-28" href="#__codelineno-91-28"></a><span class="w">  </span><span class="na">key</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;error.html&quot;</span>
</span><span id="__span-91-29"><a id="__codelineno-91-29" name="__codelineno-91-29" href="#__codelineno-91-29"></a><span class="w">  </span><span class="na">source</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${path.module}/../../website/error.html&quot;</span>
</span><span id="__span-91-30"><a id="__codelineno-91-30" name="__codelineno-91-30" href="#__codelineno-91-30"></a><span class="w">  </span><span class="na">content_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;text/html&quot;</span>
</span><span id="__span-91-31"><a id="__codelineno-91-31" name="__codelineno-91-31" href="#__codelineno-91-31"></a><span class="w">  </span><span class="na">etag</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nf">filemd5</span><span class="p">(</span><span class="s2">&quot;${path.module}/../../website/error.html&quot;</span><span class="p">)</span>
</span><span id="__span-91-32"><a id="__codelineno-91-32" name="__codelineno-91-32" href="#__codelineno-91-32"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="testing-your-deployment"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#testing-your-deployment">Testing Your Deployment 🧪</a></h3>
<p>After applying these Terraform configurations, you'll want to test that everything is working correctly:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="c1"># Initialize Terraform</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>terraform<span class="w"> </span>init
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="c1"># Plan the deployment</span>
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a>terraform<span class="w"> </span>plan<span class="w"> </span>-var<span class="o">=</span><span class="s2">&quot;domain_name=resume.yourdomain.com&quot;</span><span class="w"> </span>-var<span class="o">=</span><span class="s2">&quot;root_domain_name=yourdomain.com&quot;</span><span class="w"> </span>-var<span class="o">=</span><span class="s2">&quot;environment=dev&quot;</span>
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a>
</span><span id="__span-92-7"><a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a><span class="c1"># Apply the changes</span>
</span><span id="__span-92-8"><a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a>terraform<span class="w"> </span>apply<span class="w"> </span>-var<span class="o">=</span><span class="s2">&quot;domain_name=resume.yourdomain.com&quot;</span><span class="w"> </span>-var<span class="o">=</span><span class="s2">&quot;root_domain_name=yourdomain.com&quot;</span><span class="w"> </span>-var<span class="o">=</span><span class="s2">&quot;environment=dev&quot;</span>
</span></code></pre></div>
<p>Once deployment is complete, verify:</p>
<ol>
<li>Your domain resolves to your CloudFront distribution</li>
<li>HTTPS is working correctly</li>
<li>Your resume appears as expected</li>
<li>The website is accessible from different locations</li>
</ol>
<h3 id="troubleshooting-common-issues"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#troubleshooting-common-issues">Troubleshooting Common Issues ⚠️</a></h3>
<p>During my implementation, I encountered several challenges:</p>
<ol>
<li>
<p><strong>ACM Certificate Validation Delays</strong>: It can take up to 30 minutes for certificate validation to complete. Be patient or use the AWS console to monitor progress.</p>
</li>
<li>
<p><strong>CloudFront Distribution Propagation</strong>: CloudFront changes can take 15-20 minutes to propagate globally. If your site isn't loading correctly, wait and try again.</p>
</li>
<li>
<p><strong>S3 Bucket Policy Conflicts</strong>: If you receive errors about conflicting bucket policies, ensure that you're not applying multiple policies to the same bucket.</p>
</li>
<li>
<p><strong>CORS Configuration</strong>: Without proper CORS headers, your JavaScript won't be able to communicate with your API when we build it in the next post.</p>
</li>
</ol>
<h3 id="cors-configuration-for-api-integration"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#cors-configuration-for-api-integration">CORS Configuration for API Integration 🔄</a></h3>
<p>The Cloud Resume Challenge requires a JavaScript visitor counter that communicates with an API. To prepare for this, I've added CORS configuration to our S3 bucket. When we implement the API in the next post, we'll need to ensure it allows requests from our domain.</p>
<p>Here's the JavaScript snippet we'll use for the counter (to be implemented fully in the next post):</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="c1">// counter.js</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="w">  </span><span class="c1">// We&#39;ll need to fetch from our API</span>
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="w">  </span><span class="c1">// Example: https://api.yourdomain.com/visitor-count</span>
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a>
</span><span id="__span-93-6"><a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a><span class="w">  </span><span class="c1">// For now, just a placeholder</span>
</span><span id="__span-93-7"><a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a><span class="w">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">).</span><span class="nx">innerText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Loading...&#39;</span><span class="p">;</span>
</span><span id="__span-93-8"><a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a>
</span><span id="__span-93-9"><a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a><span class="w">  </span><span class="c1">// This will be implemented fully when we create our API</span>
</span><span id="__span-93-10"><a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a><span class="w">  </span><span class="c1">// fetch(&#39;https://api.yourdomain.com/visitor-count&#39;)</span>
</span><span id="__span-93-11"><a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a><span class="w">  </span><span class="c1">//   .then(response =&gt; response.json())</span>
</span><span id="__span-93-12"><a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a><span class="w">  </span><span class="c1">//   .then(data =&gt; {</span>
</span><span id="__span-93-13"><a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a><span class="w">  </span><span class="c1">//     document.getElementById(&#39;count&#39;).innerText = data.count;</span>
</span><span id="__span-93-14"><a id="__codelineno-93-14" name="__codelineno-93-14" href="#__codelineno-93-14"></a><span class="w">  </span><span class="c1">//   })</span>
</span><span id="__span-93-15"><a id="__codelineno-93-15" name="__codelineno-93-15" href="#__codelineno-93-15"></a><span class="w">  </span><span class="c1">//   .catch(error =&gt; console.error(&#39;Error fetching visitor count:&#39;, error));</span>
</span><span id="__span-93-16"><a id="__codelineno-93-16" name="__codelineno-93-16" href="#__codelineno-93-16"></a><span class="p">});</span>
</span></code></pre></div>
<h3 id="lessons-learned"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#lessons-learned">Lessons Learned 💡</a></h3>
<ol>
<li>
<p><strong>Domain Verification</strong>: I initially struggled with ACM certificate validation. The key lesson was to ensure that the Route 53 hosted zone existed before attempting to create validation records.</p>
</li>
<li>
<p><strong>Terraform State Management</strong>: When modifying existing resources, it's important to understand how Terraform tracks state. A single typo can lead to resource recreation rather than updates.</p>
</li>
<li>
<p><strong>Performance Optimization</strong>: Adding specific cache behaviors for CSS and JS files significantly improved page load times. It's worth taking the time to optimize these settings.</p>
</li>
<li>
<p><strong>Security Considerations</strong>: Setting up proper bucket policies and CloudFront origin access identity is critical to prevent direct access to your S3 bucket while still allowing CloudFront to serve content.</p>
</li>
</ol>
<h3 id="enhancements-and-mods"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#enhancements-and-mods">Enhancements and Mods 🚀</a></h3>
<p>Here are some ways to extend this part of the challenge:</p>
<h4 id="developer-mod-static-site-generator"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#developer-mod-static-site-generator">Developer Mod: Static Site Generator</a></h4>
<p>Instead of writing plain HTML/CSS, consider using a static site generator like Hugo or Jekyll:</p>
<ol>
<li>Install Hugo: <code>brew install hugo</code> (on macOS) or equivalent for your OS</li>
<li>Create a new site: <code>hugo new site resume-site</code></li>
<li>Choose a theme or create your own</li>
<li>Generate the site: <code>hugo -D</code></li>
<li>Modify your Terraform to upload the <code>public</code> directory contents to S3</li>
</ol>
<p>This approach gives you templating capabilities, making it easier to update and maintain your resume.</p>
<h4 id="devops-mod-content-invalidation-lambda"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#devops-mod-content-invalidation-lambda">DevOps Mod: Content Invalidation Lambda</a></h4>
<p>Create a Lambda function that automatically invalidates CloudFront cache when new content is uploaded to S3:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_lambda_function&quot;</span><span class="w"> </span><span class="nv">&quot;invalidation&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="w">  </span><span class="na">filename</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lambda_function.zip&quot;</span>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="w">  </span><span class="na">function_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cloudfront-invalidation&quot;</span>
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="w">  </span><span class="na">role</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_iam_role.lambda_role.arn</span>
</span><span id="__span-94-5"><a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a><span class="w">  </span><span class="na">handler</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;index.handler&quot;</span>
</span><span id="__span-94-6"><a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a><span class="w">  </span><span class="na">runtime</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;nodejs14.x&quot;</span>
</span><span id="__span-94-7"><a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a>
</span><span id="__span-94-8"><a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a><span class="w">  </span><span class="nb">environment</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-94-9"><a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a><span class="w">    </span><span class="nb">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-94-10"><a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a><span class="w">      </span><span class="na">DISTRIBUTION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_cloudfront_distribution.website.id</span>
</span><span id="__span-94-11"><a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-94-12"><a id="__codelineno-94-12" name="__codelineno-94-12" href="#__codelineno-94-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-94-13"><a id="__codelineno-94-13" name="__codelineno-94-13" href="#__codelineno-94-13"></a><span class="p">}</span>
</span><span id="__span-94-14"><a id="__codelineno-94-14" name="__codelineno-94-14" href="#__codelineno-94-14"></a>
</span><span id="__span-94-15"><a id="__codelineno-94-15" name="__codelineno-94-15" href="#__codelineno-94-15"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_notification&quot;</span><span class="w"> </span><span class="nv">&quot;bucket_notification&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-94-16"><a id="__codelineno-94-16" name="__codelineno-94-16" href="#__codelineno-94-16"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.website.id</span>
</span><span id="__span-94-17"><a id="__codelineno-94-17" name="__codelineno-94-17" href="#__codelineno-94-17"></a>
</span><span id="__span-94-18"><a id="__codelineno-94-18" name="__codelineno-94-18" href="#__codelineno-94-18"></a><span class="w">  </span><span class="nb">lambda_function</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-94-19"><a id="__codelineno-94-19" name="__codelineno-94-19" href="#__codelineno-94-19"></a><span class="w">    </span><span class="na">lambda_function_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_lambda_function.invalidation.arn</span>
</span><span id="__span-94-20"><a id="__codelineno-94-20" name="__codelineno-94-20" href="#__codelineno-94-20"></a><span class="w">    </span><span class="na">events</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;s3:ObjectCreated:*&quot;, &quot;s3:ObjectRemoved:*&quot;</span><span class="p">]</span>
</span><span id="__span-94-21"><a id="__codelineno-94-21" name="__codelineno-94-21" href="#__codelineno-94-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-94-22"><a id="__codelineno-94-22" name="__codelineno-94-22" href="#__codelineno-94-22"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="security-mod-implement-dnssec"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#security-mod-implement-dnssec">Security Mod: Implement DNSSEC</a></h4>
<p>To prevent DNS spoofing attacks, implement DNSSEC for your domain:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_key_signing_key&quot;</span><span class="w"> </span><span class="nv">&quot;example&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="w">  </span><span class="na">hosted_zone_id</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="nv">data.aws_route53_zone.selected.id</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="w">  </span><span class="na">key_management_service_arn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_kms_key.dnssec.arn</span>
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="w">  </span><span class="na">name</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;example&quot;</span>
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="p">}</span>
</span><span id="__span-95-6"><a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a>
</span><span id="__span-95-7"><a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_route53_hosted_zone_dnssec&quot;</span><span class="w"> </span><span class="nv">&quot;example&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-8"><a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a><span class="w">  </span><span class="na">hosted_zone_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_route53_key_signing_key.example.hosted_zone_id</span>
</span><span id="__span-95-9"><a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a><span class="p">}</span>
</span><span id="__span-95-10"><a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a>
</span><span id="__span-95-11"><a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_kms_key&quot;</span><span class="w"> </span><span class="nv">&quot;dnssec&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-12"><a id="__codelineno-95-12" name="__codelineno-95-12" href="#__codelineno-95-12"></a><span class="w">  </span><span class="na">customer_master_key_spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ECC_NIST_P256&quot;</span>
</span><span id="__span-95-13"><a id="__codelineno-95-13" name="__codelineno-95-13" href="#__codelineno-95-13"></a><span class="w">  </span><span class="na">deletion_window_in_days</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">7</span>
</span><span id="__span-95-14"><a id="__codelineno-95-14" name="__codelineno-95-14" href="#__codelineno-95-14"></a><span class="w">  </span><span class="na">key_usage</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SIGN_VERIFY&quot;</span>
</span><span id="__span-95-15"><a id="__codelineno-95-15" name="__codelineno-95-15" href="#__codelineno-95-15"></a><span class="w">  </span><span class="na">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">jsonencode</span><span class="p">({</span>
</span><span id="__span-95-16"><a id="__codelineno-95-16" name="__codelineno-95-16" href="#__codelineno-95-16"></a><span class="w">    </span><span class="na">Statement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-95-17"><a id="__codelineno-95-17" name="__codelineno-95-17" href="#__codelineno-95-17"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-95-18"><a id="__codelineno-95-18" name="__codelineno-95-18" href="#__codelineno-95-18"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-95-19"><a id="__codelineno-95-19" name="__codelineno-95-19" href="#__codelineno-95-19"></a><span class="w">          </span><span class="s2">&quot;kms:DescribeKey&quot;</span><span class="p">,</span>
</span><span id="__span-95-20"><a id="__codelineno-95-20" name="__codelineno-95-20" href="#__codelineno-95-20"></a><span class="w">          </span><span class="s2">&quot;kms:GetPublicKey&quot;</span><span class="p">,</span>
</span><span id="__span-95-21"><a id="__codelineno-95-21" name="__codelineno-95-21" href="#__codelineno-95-21"></a><span class="w">          </span><span class="s2">&quot;kms:Sign&quot;</span><span class="p">,</span>
</span><span id="__span-95-22"><a id="__codelineno-95-22" name="__codelineno-95-22" href="#__codelineno-95-22"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-95-23"><a id="__codelineno-95-23" name="__codelineno-95-23" href="#__codelineno-95-23"></a><span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-95-24"><a id="__codelineno-95-24" name="__codelineno-95-24" href="#__codelineno-95-24"></a><span class="w">        </span><span class="nb">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-25"><a id="__codelineno-95-25" name="__codelineno-95-25" href="#__codelineno-95-25"></a><span class="w">          </span><span class="na">Service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dnssec-route53.amazonaws.com&quot;</span>
</span><span id="__span-95-26"><a id="__codelineno-95-26" name="__codelineno-95-26" href="#__codelineno-95-26"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-95-27"><a id="__codelineno-95-27" name="__codelineno-95-27" href="#__codelineno-95-27"></a><span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-95-28"><a id="__codelineno-95-28" name="__codelineno-95-28" href="#__codelineno-95-28"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-95-29"><a id="__codelineno-95-29" name="__codelineno-95-29" href="#__codelineno-95-29"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-95-30"><a id="__codelineno-95-30" name="__codelineno-95-30" href="#__codelineno-95-30"></a><span class="w">        </span><span class="na">Action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;kms:*&quot;</span><span class="p">,</span>
</span><span id="__span-95-31"><a id="__codelineno-95-31" name="__codelineno-95-31" href="#__codelineno-95-31"></a><span class="w">        </span><span class="na">Effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span id="__span-95-32"><a id="__codelineno-95-32" name="__codelineno-95-32" href="#__codelineno-95-32"></a><span class="w">        </span><span class="nb">Principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-95-33"><a id="__codelineno-95-33" name="__codelineno-95-33" href="#__codelineno-95-33"></a><span class="w">          </span><span class="na">AWS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-95-34"><a id="__codelineno-95-34" name="__codelineno-95-34" href="#__codelineno-95-34"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-95-35"><a id="__codelineno-95-35" name="__codelineno-95-35" href="#__codelineno-95-35"></a><span class="w">        </span><span class="na">Resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-95-36"><a id="__codelineno-95-36" name="__codelineno-95-36" href="#__codelineno-95-36"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-95-37"><a id="__codelineno-95-37" name="__codelineno-95-37" href="#__codelineno-95-37"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-95-38"><a id="__codelineno-95-38" name="__codelineno-95-38" href="#__codelineno-95-38"></a><span class="w">    </span><span class="na">Version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>
</span><span id="__span-95-39"><a id="__codelineno-95-39" name="__codelineno-95-39" href="#__codelineno-95-39"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-95-40"><a id="__codelineno-95-40" name="__codelineno-95-40" href="#__codelineno-95-40"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="next-steps"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-deploying-the-static-website/#next-steps">Next Steps ⏭️</a></h3>
<p>With our static website infrastructure in place, we now have a live resume hosted on AWS with a custom domain and HTTPS. In the next post, we'll build the <strong>backend API</strong> using <strong>API Gateway, Lambda, and DynamoDB</strong> to track visitor counts.</p>
<p>Stay tuned to see how we implement the serverless backend and connect it to our frontend!</p>
<hr />
<p><strong>Up Next:</strong> [Cloud Resume Challenge with Terraform: Building the Backend API] 🔗</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Cloud%20Resume%20Challenge%20with%20Terraform%3A%20Deploying%20the%20Static%20Website%0A&amp;url=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-deploying-the-static-website/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-deploying-the-static-website/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-17 00:00:00+00:00">March 17, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/aws/" class="md-meta__link">AWS</a>, 
              <a href="../../../../category/terraform/" class="md-meta__link">Terraform</a>, 
              <a href="../../../../category/devops/" class="md-meta__link">DevOps</a>, 
              <a href="../../../../category/cloud-resume-challenge/" class="md-meta__link">Cloud Resume Challenge</a></li>
        
        
          
          <li class="md-meta__item">
            
              5 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="cloud-resume-challenge-with-terraform-introduction-setup"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/">Cloud Resume Challenge with Terraform: Introduction &amp; Setup 🚀</a></h2>
<h3 id="introduction"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#introduction">Introduction 🌍</a></h3>
<p>The <strong>Cloud Resume Challenge</strong> is a hands-on project designed to build a <strong>real-world cloud application</strong> while showcasing your skills in <strong>AWS, serverless architecture, and automation</strong>. Many implementations of this challenge use AWS SAM or manual setup via the AWS console, but in this series, I will demonstrate how to <strong>build the entire infrastructure using Terraform</strong>. 💡</p>
<h4 id="my-journey-to-terraform"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#my-journey-to-terraform"><strong>My Journey to Terraform</strong> 🧰</a></h4>
<p>When I first discovered the Cloud Resume Challenge, I was immediately intrigued by the hands-on approach to learning cloud technologies. Having some experience with traditional IT but wanting to transition to a more cloud-focused role, I saw this challenge as the perfect opportunity to showcase my skills.</p>
<p>I chose Terraform over AWS SAM or CloudFormation because:</p>
<ol>
<li><strong>Multi-cloud flexibility</strong> - While this challenge focuses on AWS, Terraform skills transfer to Azure, GCP, and other providers</li>
<li><strong>Declarative approach</strong> - I find the HCL syntax more intuitive than YAML for defining infrastructure</li>
<li><strong>Industry adoption</strong> - In my research, I found that Terraform was highly sought after in job postings</li>
<li><strong>Strong community</strong> - The extensive module registry and community support made learning easier</li>
</ol>
<p>This series reflects my personal journey through the challenge, including the obstacles I overcame and the lessons I learned along the way.</p>
<h4 id="why-terraform"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#why-terraform"><strong>Why Terraform?</strong> 🛠️</a></h4>
<p>Terraform allows for <strong>Infrastructure as Code (IaC)</strong>, which:</p>
<ul>
<li><strong>Automates</strong> resource provisioning 🤖</li>
<li><strong>Ensures consistency</strong> across environments ✅</li>
<li><strong>Improves security</strong> by managing configurations centrally 🔒</li>
<li><strong>Enables version control</strong> for infrastructure changes 📝</li>
</ul>
<p>This series assumes <strong>basic knowledge of Terraform</strong> and will focus on <strong>highlighting key Terraform code snippets</strong> rather than full configuration files.</p>
<h3 id="project-overview"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#project-overview">Project Overview 🏗️</a></h3>
<p>Let's visualize the architecture we'll be building throughout this series:</p>
<p><img alt="Basic Project Diagram" src="../../../../crc-aws/CRCArchitecture.png" /></p>
<h4 id="aws-services-used"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#aws-services-used"><strong>AWS Services Used</strong> ☁️</a></h4>
<p>The project consists of the following AWS components:</p>
<ul>
<li><strong>Frontend:</strong> Static website hosted on <strong>S3</strong> and delivered via <strong>CloudFront</strong>.</li>
<li><strong>Backend API:</strong> API Gateway, Lambda, and DynamoDB to track visitor counts.</li>
<li><strong>Security:</strong> IAM roles, API Gateway security, and <strong>AWS Certificate Manager (ACM)</strong> for HTTPS 🔐.</li>
<li><strong>Automation:</strong> CI/CD with <strong>GitHub Actions</strong> to deploy infrastructure and update website content ⚡.</li>
</ul>
<h4 id="terraform-module-breakdown"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#terraform-module-breakdown"><strong>Terraform Module Breakdown</strong> 🧩</a></h4>
<p>To keep the infrastructure modular and maintainable, we will define Terraform modules for each major component:</p>
<ol>
<li><strong>S3 Module</strong> 📂: Manages the static website hosting.</li>
<li><strong>CloudFront Module</strong> 🌍: Ensures fast delivery and HTTPS encryption.</li>
<li><strong>Route 53 Module</strong> 📡: Handles DNS configuration.</li>
<li><strong>DynamoDB Module</strong> 📊: Stores visitor count data.</li>
<li><strong>Lambda Module</strong> 🏗️: Defines the backend API logic.</li>
<li><strong>API Gateway Module</strong> 🔗: Exposes the Lambda function via a REST API.</li>
<li><strong>ACM Module</strong> 🔒: Provides SSL/TLS certificates for secure communication.</li>
</ol>
<h3 id="setting-up-terraform"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#setting-up-terraform"><strong>Setting Up Terraform</strong> ⚙️</a></h3>
<p>Before deploying any resources, we need to set up <strong>Terraform and backend state management</strong> to store infrastructure changes securely.</p>
<h4 id="1-install-terraform-aws-cli"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#1-install-terraform-aws-cli"><strong>1. Install Terraform &amp; AWS CLI</strong> 🖥️</a></h4>
<p>Ensure you have the necessary tools installed:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># Install Terraform</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://apt.releases.hashicorp.com/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/usr/share/keyrings/hashicorp-archive-keyring.gpg
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/hashicorp.list
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>terraform
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="c1"># Install AWS CLI</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>curl<span class="w"> </span><span class="s2">&quot;https://awscli.amazonaws.com/AWSCLIV2.pkg&quot;</span><span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;AWSCLIV2.pkg&quot;</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>sudo<span class="w"> </span>installer<span class="w"> </span>-pkg<span class="w"> </span>AWSCLIV2.pkg<span class="w"> </span>-target<span class="w"> </span>/
</span></code></pre></div>
<h4 id="2-configure-aws-credentials-securely"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#2-configure-aws-credentials-securely"><strong>2. Configure AWS Credentials Securely</strong> 🔑</a></h4>
<p>Terraform interacts with AWS via credentials. Setting these up securely is crucial to avoid exposing sensitive information.</p>
<h5 id="setting-up-aws-account-structure"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#setting-up-aws-account-structure"><strong>Setting up AWS Account Structure</strong></a></h5>
<p>Following cloud security best practices, I recommend creating a proper AWS account structure:</p>
<ol>
<li><strong>Create a management AWS account</strong> for your organization</li>
<li><strong>Enable Multi-Factor Authentication (MFA)</strong> on the root account</li>
<li><strong>Create separate AWS accounts</strong> for development and production environments</li>
<li><strong>Set up AWS IAM Identity Center (formerly SSO)</strong> for secure access</li>
</ol>
<p>If you're just getting started, you can begin with a simpler setup:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># Configure AWS CLI with a dedicated IAM user (not root account)</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>aws<span class="w"> </span>configure
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="c1"># Test your configuration</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>aws<span class="w"> </span>sts<span class="w"> </span>get-caller-identity
</span></code></pre></div>
<p>Set up <strong>IAM permissions</strong> for Terraform by ensuring your IAM user has the necessary policies for provisioning resources. Start with a least privilege approach and add permissions as needed.</p>
<h4 id="3-set-up-remote-backend-for-terraform-state"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#3-set-up-remote-backend-for-terraform-state"><strong>3. Set Up Remote Backend for Terraform State</strong> 🏢</a></h4>
<p>Using a <strong>remote backend</strong> (such as an <strong>S3 bucket</strong>) prevents local state loss and enables collaboration.</p>
<h5 id="project-directory-structure"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#project-directory-structure"><strong>Project Directory Structure</strong></a></h5>
<p>Here's how I've organized my Terraform project:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>cloud-resume-challenge/
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>├── modules/
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>│   ├── frontend/
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>│   │   ├── main.tf
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>│   │   ├── variables.tf
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>│   │   └── outputs.tf
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>│   ├── backend/
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>│   │   ├── main.tf
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>│   │   ├── variables.tf
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>│   │   └── outputs.tf
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>│   └── networking/
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>│       ├── main.tf
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>│       ├── variables.tf
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>│       └── outputs.tf
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>├── environments/
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>│   ├── dev/
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a>│   │   └── main.tf
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>│   └── prod/
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a>│       └── main.tf
</span><span id="__span-32-20"><a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a>├── terraform.tf (backend config)
</span><span id="__span-32-21"><a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a>├── variables.tf
</span><span id="__span-32-22"><a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a>├── outputs.tf
</span><span id="__span-32-23"><a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a>└── main.tf
</span></code></pre></div>
<h5 id="define-the-backend-in-terraformtf"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#define-the-backend-in-terraformtf"><strong>Define the backend in <code>terraform.tf</code></strong></a></h5>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nb">terraform</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">  </span><span class="kr">backend</span><span class="w"> </span><span class="nv">&quot;s3&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">    </span><span class="na">bucket</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;my-terraform-state-bucket&quot;</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="na">key</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cloud-resume/state.tfstate&quot;</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">    </span><span class="na">region</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w">    </span><span class="na">encrypt</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w">    </span><span class="na">dynamodb_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-lock&quot;</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="w">  </span><span class="nb">required_providers</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="w">    </span><span class="nb">aws</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="w">      </span><span class="na">source</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hashicorp/aws&quot;</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w">      </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;~&gt; 4.16&quot;</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="w">  </span><span class="na">required_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&gt;= 1.2.0&quot;</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="p">}</span>
</span></code></pre></div>
<h5 id="create-s3-bucket-and-dynamodb-table-for-backend"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#create-s3-bucket-and-dynamodb-table-for-backend"><strong>Create S3 Bucket and DynamoDB Table for Backend</strong></a></h5>
<p>Before you can use an S3 backend, you need to create the bucket and DynamoDB table. I prefer to do this via Terraform as well, using a separate configuration:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># backend-setup/main.tf</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="kr">provider</span><span class="w"> </span><span class="nv">&quot;aws&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">  </span><span class="na">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;us-east-1&quot;</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="p">}</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="nv">&quot;terraform_state&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;my-terraform-state-bucket&quot;</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="p">}</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_versioning&quot;</span><span class="w"> </span><span class="nv">&quot;terraform_state&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.terraform_state.id</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">  </span><span class="nb">versioning_configuration</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="w">    </span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Enabled&quot;</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="p">}</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_s3_bucket_server_side_encryption_configuration&quot;</span><span class="w"> </span><span class="nv">&quot;terraform_state&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="w">  </span><span class="na">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">aws_s3_bucket.terraform_state.id</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="w">  </span><span class="nb">rule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="w">    </span><span class="nb">apply_server_side_encryption_by_default</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="w">      </span><span class="na">sse_algorithm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AES256&quot;</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="p">}</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;aws_dynamodb_table&quot;</span><span class="w"> </span><span class="nv">&quot;terraform_locks&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="w">  </span><span class="na">name</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-lock&quot;</span>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="w">  </span><span class="na">billing_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PAY_PER_REQUEST&quot;</span>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="w">  </span><span class="na">hash_key</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;LockID&quot;</span>
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a><span class="w">  </span><span class="nb">attribute</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a><span class="w">    </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;LockID&quot;</span>
</span><span id="__span-34-33"><a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a><span class="w">    </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S&quot;</span>
</span><span id="__span-34-34"><a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-35"><a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a><span class="p">}</span>
</span></code></pre></div>
<p>Run these commands to set up your backend:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="nb">cd</span><span class="w"> </span>backend-setup
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>terraform<span class="w"> </span>init
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>terraform<span class="w"> </span>apply
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="nb">cd</span><span class="w"> </span>..
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>terraform<span class="w"> </span>init<span class="w">  </span><span class="c1"># Initialize with the S3 backend</span>
</span></code></pre></div>
<h3 id="a-note-on-security"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#a-note-on-security"><strong>A Note on Security</strong> 🔒</a></h3>
<p>Throughout this series, I'll be emphasizing security best practices. Some key principles to keep in mind:</p>
<ol>
<li><strong>Never commit AWS credentials</strong> to your repository</li>
<li><strong>Use IAM roles with least privilege</strong> for all resources</li>
<li><strong>Enable encryption</strong> for sensitive data</li>
<li><strong>Implement proper security groups and network ACLs</strong></li>
<li><strong>Regularly rotate credentials and keys</strong></li>
</ol>
<p>These principles will be applied to our infrastructure as we build it in the upcoming posts.</p>
<h3 id="lessons-learned"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#lessons-learned"><strong>Lessons Learned</strong> 💡</a></h3>
<p>In my initial attempts at setting up the Terraform environment, I encountered several challenges:</p>
<ol>
<li>
<p><strong>State file management</strong>: I initially stored state locally, which caused problems when working from different computers. Switching to S3 backend solved this issue.</p>
</li>
<li>
<p><strong>Module organization</strong>: I tried several directory structures before settling on the current one. Organizing by component type rather than AWS service made the most sense for this project.</p>
</li>
<li>
<p><strong>Version constraints</strong>: Not specifying version constraints for providers led to unexpected behavior when Terraform updated. Always specify your provider versions!</p>
</li>
</ol>
<h3 id="next-steps"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#next-steps"><strong>Next Steps</strong> ⏭️</a></h3>
<p>In the next post, we'll build the <strong>static website infrastructure</strong> with <strong>S3, CloudFront, Route 53, and ACM</strong>. We'll create Terraform modules for each component and deploy them together to host our resume.</p>
<h4 id="developer-mod-advanced-terraform-techniques"><a class="toclink" href="../../../../cloud-resume-challenge-with-terraform-introduction--setup/#developer-mod-advanced-terraform-techniques"><strong>Developer Mod: Advanced Terraform Techniques</strong> 🚀</a></h4>
<p>If you're familiar with Terraform and want to take this challenge further, consider implementing these enhancements:</p>
<ol>
<li>
<p><strong>Terraform Cloud Integration</strong>: Connect your repository to Terraform Cloud for enhanced collaboration and run history.</p>
</li>
<li>
<p><strong>Terratest</strong>: Add infrastructure tests using the Terratest framework to validate your configurations.</p>
</li>
<li>
<p><strong>Custom Terraform Modules</strong>: Create reusable modules and publish them to the Terraform Registry.</p>
</li>
<li>
<p><strong>Terraform Workspaces</strong>: Use workspaces to manage multiple environments (dev, staging, prod) within the same Terraform configuration.</p>
</li>
</ol>
<hr />
<p><strong>Up Next:</strong> [Cloud Resume Challenge with Terraform: Deploying the Static Website] 🔗</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Cloud%20Resume%20Challenge%20with%20Terraform%3A%20Introduction%20%26%20Setup%0A&amp;url=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-introduction--setup/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/cloud-resume-challenge-with-terraform-introduction--setup/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-12 00:00:00+00:00">March 12, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/azure/" class="md-meta__link">Azure</a>, 
              <a href="../../../../category/iis/" class="md-meta__link">IIS</a>, 
              <a href="../../../../category/application-insights/" class="md-meta__link">Application Insights</a></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="monitoring-an-iis-based-web-farm-with-azure-application-insights"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/">📊 Monitoring an IIS-Based Web Farm with Azure Application Insights</a></h2>
<p>In this guide, you'll learn how to:</p>
<p>✅ Set up <strong>Application Insights</strong> on an IIS-based web farm.<br />
✅ Configure <strong>Log Analytics</strong>, <strong>Data Collection Rules</strong>, and <strong>Data Collection Endpoints</strong>.<br />
✅ Use <strong>PowerShell</strong> to install the Application Insights agent.<br />
✅ Monitor <strong>live metrics, failures, performance, and logs</strong> in real-time.  </p>
<p>By the end, you'll have a <strong>fully monitored</strong> IIS-based web farm using Azure! 🎯</p>
<hr />
<h3 id="step-1-enabling-application-insights-on-iis-servers"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#step-1-enabling-application-insights-on-iis-servers">🏗️ <strong>Step 1: Enabling Application Insights on IIS Servers</strong></a></h3>
<p>To effectively monitor your IIS-based application, you need to configure Azure Application Insights and ensure all required components are installed on your Azure VMs.</p>
<h4 id="prerequisites"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#prerequisites">🛠️ <strong>Prerequisites</strong></a></h4>
<p>Before proceeding, ensure you have:</p>
<ul>
<li><strong>An active Azure Subscription</strong> with permissions to create and manage resources.</li>
<li><strong>A Log Analytics Workspace (LAW)</strong> to store collected telemetry data.</li>
<li><strong>Azure Monitor Agent (AMA)</strong> installed on your IIS VMs.</li>
<li><strong>Necessary permissions</strong> to create Data Collection Rules (DCRs) and Data Collection Endpoints (DCEs).</li>
</ul>
<h4 id="create-a-log-analytics-workspace"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#create-a-log-analytics-workspace"><strong>Create a Log Analytics Workspace</strong></a></h4>
<ol>
<li>Go to <strong>Azure Portal</strong> → <strong>Search for "Log Analytics Workspaces"</strong> → <strong>Create</strong>.</li>
<li>Provide the following details:</li>
<li><strong>Subscription</strong>: Select your Azure subscription.</li>
<li><strong>Resource Group</strong>: Choose or create a new one.</li>
<li><strong>Name</strong>: Enter a unique name (e.g., <code>log-corpapp-prod-uksouth</code>).</li>
<li><strong>Region</strong>: Same as your IIS VMs.</li>
<li><strong>Click "Review + Create"</strong> and deploy the workspace.</li>
</ol>
<p>🔗 <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/logs/log-analytics-workspace-overview">Microsoft Learn: Log Analytics Workspace</a></p>
<h4 id="create-a-data-collection-endpoint-dce"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#create-a-data-collection-endpoint-dce"><strong>Create a Data Collection Endpoint (DCE)</strong></a></h4>
<ol>
<li>Navigate to <strong>Monitor</strong> → <strong>Data Collection Endpoints</strong>.</li>
<li>Click <strong>"+ Create"</strong> and provide:</li>
<li><strong>Name</strong>: e.g., <code>dce-corpapp-prod-uksouth</code>.</li>
<li><strong>Subscription &amp; Resource Group</strong>: Same as your IIS VMs.</li>
<li><strong>Region</strong>: Same as Log Analytics Workspace.</li>
<li><strong>Review &amp; create the endpoint</strong>.</li>
</ol>
<p>🔗 <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/data-collection-endpoint-overview">Microsoft Learn: Data Collection Endpoints</a></p>
<h4 id="create-a-data-collection-rule-dcr"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#create-a-data-collection-rule-dcr"><strong>Create a Data Collection Rule (DCR)</strong></a></h4>
<ol>
<li>Go to <strong>Monitor</strong> → <strong>Data Collection Rules</strong> → <strong>+ Create</strong>.</li>
<li>Configure:</li>
<li><strong>Name</strong>: <code>dcr-corpapp-iis-prod-uksouth</code></li>
<li><strong>Subscription &amp; Resource Group</strong>: Same as above.</li>
<li><strong>Region</strong>: Same as DCE &amp; LAW.</li>
<li><strong>Define data sources</strong>:</li>
<li><strong>Windows Event Logs</strong>: Add <code>System</code>, <code>Application</code>, etc.</li>
<li><strong>Log Levels</strong>: Select relevant levels (Error, Warning, Information).</li>
<li><strong>Set Destination</strong>:</li>
<li>Choose <strong>"Log Analytics Workspace"</strong> → Select the previously created workspace.</li>
<li><strong>Associate with IIS VMs</strong> (<code>WEB01</code> - <code>WEB05</code>).</li>
<li><strong>Review &amp; Create the rule</strong>.</li>
</ol>
<p>🔗 <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/agents/data-collection-rule-overview">Microsoft Learn: Data Collection Rules</a></p>
<h4 id="install-the-azure-monitor-agent-ama"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#install-the-azure-monitor-agent-ama"><strong>Install the Azure Monitor Agent (AMA)</strong></a></h4>
<ol>
<li>Navigate to each IIS VM.</li>
<li>Under <strong>"Monitoring"</strong>, select <strong>"Extensions"</strong>.</li>
<li>Click <strong>"+ Add"</strong> → <strong>AzureMonitorWindowsAgent</strong> → Install.</li>
<li>Repeat for all IIS VMs.</li>
</ol>
<p>🔗 <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/agents/azure-monitor-agent-overview">Microsoft Learn: Azure Monitor Agent</a></p>
<h4 id="enable-application-insights"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#enable-application-insights"><strong>Enable Application Insights</strong></a></h4>
<ol>
<li>Navigate to <strong>Azure Portal</strong> → <strong>Search for "Application Insights"</strong>.</li>
<li>Click <strong>"+ Create"</strong> → Provide:</li>
<li><strong>Subscription &amp; Resource Group</strong>: Same as VMs.</li>
<li><strong>Name</strong>: <code>insights-corpapp-prod-uksouth-001</code>.</li>
<li><strong>Region</strong>: Same as your IIS VMs.</li>
<li><strong>Application Type</strong>: <strong>ASP.NET Web Application</strong>.</li>
<li><strong>Click "Review + Create"</strong> and deploy.</li>
</ol>
<p>🔗 <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/app/asp-net">Microsoft Learn: Enable Application Insights</a></p>
<h4 id="install-the-application-insights-agent"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#install-the-application-insights-agent"><strong>Install the Application Insights Agent</strong></a></h4>
<p>Use the following <strong>PowerShell script</strong> to install the agent on all of the IIS servers:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c"># Install the Application Insights Agent</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nv">$instrumentationKey</span> <span class="p">=</span> <span class="s2">&quot;YOUR-INSTRUMENTATION-KEY&quot;</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="nb">Install-PackageProvider</span> <span class="n">-Name</span> <span class="n">NuGet</span> <span class="n">-Force</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">ApplicationInsightsWebTracking</span> <span class="n">-Force</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="nb">Enable-ApplicationInsightsMonitoring</span> <span class="n">-InstrumentationKey</span> <span class="nv">$instrumentationKey</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="nb">Restart-Service</span> <span class="n">W3SVC</span>
</span></code></pre></div>
<hr />
<h3 id="step-2-using-application-insights-for-monitoring"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#step-2-using-application-insights-for-monitoring">📊 <strong>Step 2: Using Application Insights for Monitoring</strong></a></h3>
<p>With everything set up, it's time to <strong>monitor and analyze</strong> application performance! 🔍</p>
<h4 id="overview-dashboard"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#overview-dashboard"><strong>📌 Overview Dashboard</strong></a></h4>
<ul>
<li>Displays high-level <strong>health metrics</strong>, failed requests, and response times.
📸 <strong><img alt="Insights Overview" src="../../../../azure-posts/app-insights/BO_Insights_Overview.png" /></strong></li>
</ul>
<h4 id="application-map"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#application-map"><strong>📌 Application Map</strong></a></h4>
<ul>
<li>Shows <strong>dependencies and interactions</strong> between components.
📸 <strong><img alt="Application Map" src="../../../../azure-posts/app-insights/BO_Insights_ApplicationMap.png" /></strong></li>
</ul>
<h4 id="live-metrics"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#live-metrics"><strong>📌 Live Metrics</strong></a></h4>
<ul>
<li>Monitor <strong>real-time requests, server performance, and failures</strong>.
📸 <strong><img alt="Live Metrics" src="../../../../azure-posts/app-insights/BO_Insights_LiveMetrics.png" /></strong></li>
</ul>
<h4 id="failures-exceptions"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#failures-exceptions"><strong>📌 Failures &amp; Exceptions</strong></a></h4>
<ul>
<li>Identify and diagnose <strong>failed requests &amp; top exceptions</strong>.
📸 <strong><img alt="Failures &amp; Exceptions" src="../../../../azure-posts/app-insights/BO_Insights_Failures.png" /></strong></li>
</ul>
<h4 id="performance-monitoring"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#performance-monitoring"><strong>📌 Performance Monitoring</strong></a></h4>
<ul>
<li>Analyze <strong>response times, dependencies &amp; bottlenecks</strong>.
📸 <strong><img alt="Performance Overview" src="../../../../azure-posts/app-insights/BO_Insights_Performance.png" /></strong></li>
</ul>
<h4 id="logs-queries"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#logs-queries"><strong>📌 Logs &amp; Queries</strong></a></h4>
<ul>
<li>Run <strong>Kusto Query Language (KQL)</strong> queries for deep insights.</li>
</ul>
<p>Example query to find failed requests:</p>
<div class="language-kusto highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">requests</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="n">ago</span><span class="p">(</span><span class="mi">24</span><span class="n">h</span><span class="p">)</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="n">false</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">resultCode</span><span class="p">,</span><span class="w"> </span><span class="n">url</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="n">desc</span>
</span></code></pre></div>
<p>📸 <strong><img alt="Query Results" src="../../../../azure-posts/app-insights/BO_Insights_Logs.png" /></strong></p>
<hr />
<h4 id="next-steps"><a class="toclink" href="../../../../monitoring-an-iis-based-web-farm-with-azure-application-insights/#next-steps">✅ <strong>Next Steps</strong></a></h4>
<p>🎯 Continue monitoring logs &amp; alerts for trends.<br />
🎯 Optimize Application Insights sampling to reduce telemetry costs.<br />
🎯 Automate reporting for key performance metrics.  </p>
<p>By following this guide, you'll have a <strong>robust, real-time monitoring setup</strong> for your IIS web farm, ensuring optimal performance and quick issue resolution! 🚀</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Monitoring%20an%20IIS-Based%20Web%20Farm%20with%20Azure%20Application%20Insights%0A&amp;url=https://blog.pollockweb.com/blog/monitoring-an-iis-based-web-farm-with-azure-application-insights/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/monitoring-an-iis-based-web-farm-with-azure-application-insights/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-11 00:00:00+00:00">March 11, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/intune/" class="md-meta__link">Intune</a>, 
              <a href="../../../../category/automation/" class="md-meta__link">Automation</a>, 
              <a href="../../../../category/scripting/" class="md-meta__link">Scripting</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="uninstalling-papercut-mf-client-via-intune-a-step-by-step-guide"><a class="toclink" href="../../../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/">📢 Uninstalling PaperCut MF Client via Intune – A Step-by-Step Guide 🚀</a></h2>
<h3 id="scenario-overview"><a class="toclink" href="../../../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#scenario-overview"><strong>🔍 Scenario Overview</strong></a></h3>
<p>Managing software across an enterprise can be a headache, especially when it comes to <strong>removing outdated applications</strong>. Recently, I needed to <strong>uninstall the PaperCut MF Client from multiple Windows PCs</strong> in my environment. The challenge? Ensuring a clean removal <strong>without user intervention</strong> and <strong>no leftover files</strong>.</p>
<p>Rather than relying on manual uninstallation, we used <strong>Microsoft Intune</strong> to deploy a <strong>PowerShell script</strong> that handles the removal automatically. This blog post details the full process, from <strong>script development to deployment and testing</strong>.</p>
<hr />
<h3 id="the-goal"><a class="toclink" href="../../../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#the-goal"><strong>🎯 The Goal</strong></a></h3>
<p>✅ Uninstall the PaperCut MF Client <strong>silently</strong><br />
✅ Ensure <strong>no residual files</strong> are left behind<br />
✅ Deploy the solution <strong>via Intune</strong> as a PowerShell script (NOT as a Win32 app)<br />
✅ Test both <strong>locally</strong> and <strong>remotely</strong> before large-scale deployment  </p>
<hr />
<h3 id="step-1-writing-the-uninstall-script"><a class="toclink" href="../../../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#step-1-writing-the-uninstall-script"><strong>🛠 Step 1: Writing the Uninstall Script</strong></a></h3>
<p>We first created a <strong>PowerShell script</strong> to:</p>
<ol>
<li><strong>Stop PaperCut-related processes</strong></li>
<li><strong>Run the built-in uninstaller (<code>unins000.exe</code>)</strong> if present</li>
<li><strong>Use MSIEXEC to remove the MSI-based install</strong></li>
<li><strong>Forcefully delete any remaining files and registry entries</strong></li>
</ol>
<h4 id="the-uninstall-script"><a class="toclink" href="../../../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#the-uninstall-script"><strong>📝 The Uninstall Script</strong></a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c"># Define variables</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="nv">$UninstallExePath</span> <span class="p">=</span> <span class="s2">&quot;C:\Program Files (x86)\PaperCut MF Client\unins000.exe&quot;</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="nv">$MsiProductCode</span> <span class="p">=</span> <span class="s2">&quot;{5B4B80DE-34C4-11E9-9CA9-F53BB8A68831}&quot;</span>  <span class="c"># Replace with actual Product Code</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="nv">$LogFile</span> <span class="p">=</span> <span class="s2">&quot;C:\ProgramData\Custom-Intune-Scripts\Papercut-Uninstall.log&quot;</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="nv">$InstallPath</span> <span class="p">=</span> <span class="s2">&quot;C:\Program Files (x86)\PaperCut MF Client&quot;</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="c"># Function to log output</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="k">Function</span> <span class="nb">Write-Log</span> <span class="p">{</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>    <span class="k">param</span> <span class="p">(</span><span class="no">[string]</span><span class="nv">$Message</span><span class="p">)</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    <span class="nv">$TimeStamp</span> <span class="p">=</span> <span class="nb">Get-Date</span> <span class="n">-Format</span> <span class="s2">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>    <span class="s2">&quot;$TimeStamp - $Message&quot;</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">-Append</span> <span class="n">-FilePath</span> <span class="nv">$LogFile</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="p">}</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="nb">Write-Log</span> <span class="s2">&quot;Starting PaperCut MF Client uninstallation process.&quot;</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="c"># Stop any running PaperCut processes before uninstalling</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="nv">$Processes</span> <span class="p">=</span> <span class="p">@(</span><span class="s2">&quot;pc-client&quot;</span><span class="p">,</span> <span class="s2">&quot;pc-client-java&quot;</span><span class="p">,</span> <span class="s2">&quot;pc-client-local-cache&quot;</span><span class="p">)</span>  <span class="c"># Common PaperCut processes</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$Process</span> <span class="k">in</span> <span class="nv">$Processes</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">Get-Process</span> <span class="n">-Name</span> <span class="nv">$Process</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>        <span class="nb">Write-Log</span> <span class="s2">&quot;Stopping process: $Process&quot;</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>        <span class="nb">Stop-Process</span> <span class="n">-Name</span> <span class="nv">$Process</span> <span class="n">-Force</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>    <span class="p">}</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="p">}</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="c"># Check if unins000.exe exists</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a><span class="k">if</span> <span class="p">(</span><span class="nb">Test-Path</span> <span class="nv">$UninstallExePath</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>    <span class="nb">Write-Log</span> <span class="s2">&quot;Found unins000.exe at $UninstallExePath. Initiating uninstallation.&quot;</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>    <span class="nb">Start-Process</span> <span class="n">-FilePath</span> <span class="nv">$UninstallExePath</span> <span class="n">-ArgumentList</span> <span class="s2">&quot;/SILENT&quot;</span> <span class="n">-NoNewWindow</span> <span class="n">-Wait</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>    <span class="nb">Write-Log</span> <span class="s2">&quot;Uninstallation process completed using unins000.exe.&quot;</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a>    <span class="nb">Write-Log</span> <span class="s2">&quot;unins000.exe not found. Attempting MSI uninstallation using Product Code $MsiProductCode.&quot;</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a>    <span class="nb">Start-Process</span> <span class="n">-FilePath</span> <span class="s2">&quot;msiexec.exe&quot;</span> <span class="n">-ArgumentList</span> <span class="s2">&quot;/x $MsiProductCode /qn /norestart&quot;</span> <span class="n">-NoNewWindow</span> <span class="n">-Wait</span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a><span class="p">}</span>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a><span class="c"># Forcefully delete the remaining installation folder</span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a><span class="k">if</span> <span class="p">(</span><span class="nb">Test-Path</span> <span class="nv">$InstallPath</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a>    <span class="nb">Write-Log</span> <span class="s2">&quot;Residual files found at $InstallPath. Attempting to remove forcefully.&quot;</span>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a>    <span class="n">takeown</span> <span class="p">/</span><span class="n">F</span> <span class="s2">&quot;$InstallPath&quot;</span> <span class="p">/</span><span class="nb">R </span><span class="p">/</span><span class="n">D</span> <span class="n">Y</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a>    <span class="n">icacls</span> <span class="s2">&quot;$InstallPath&quot;</span> <span class="p">/</span><span class="n">grant</span> <span class="n">Administrators</span><span class="p">:</span><span class="n">F</span> <span class="p">/</span><span class="n">T</span> <span class="p">/</span><span class="n">C</span> <span class="p">/</span><span class="n">Q</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a>    <span class="nb">Remove-Item</span> <span class="n">-Path</span> <span class="nv">$InstallPath</span> <span class="n">-Recurse</span> <span class="n">-Force</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a>    <span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="p">(</span><span class="nb">Test-Path</span> <span class="nv">$InstallPath</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a>        <span class="nb">Write-Log</span> <span class="s2">&quot;SUCCESS: Residual files successfully removed.&quot;</span>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a>        <span class="nb">Write-Log</span> <span class="s2">&quot;ERROR: Failed to remove residual files. Manual intervention may be required.&quot;</span>
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a>    <span class="p">}</span>
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46" href="#__codelineno-12-46"></a><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47" href="#__codelineno-12-47"></a>    <span class="nb">Write-Log</span> <span class="s2">&quot;No residual files found.&quot;</span>
</span><span id="__span-12-48"><a id="__codelineno-12-48" name="__codelineno-12-48" href="#__codelineno-12-48"></a><span class="p">}</span>
</span><span id="__span-12-49"><a id="__codelineno-12-49" name="__codelineno-12-49" href="#__codelineno-12-49"></a>
</span><span id="__span-12-50"><a id="__codelineno-12-50" name="__codelineno-12-50" href="#__codelineno-12-50"></a><span class="nb">Write-Log</span> <span class="s2">&quot;PaperCut MF Client uninstallation script execution finished.&quot;</span>
</span></code></pre></div>
<hr />
<h3 id="step-2-testing-the-script-locally"><a class="toclink" href="../../../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#step-2-testing-the-script-locally"><strong>🧪 Step 2: Testing the Script Locally</strong></a></h3>
<p>Before deploying via Intune, it's best to <strong>test locally</strong>:</p>
<ol>
<li><strong>Open PowerShell as Administrator</strong></li>
<li><strong>Run the script manually</strong>:</li>
</ol>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">powershell</span><span class="p">.</span><span class="n">exe</span> <span class="n">-ExecutionPolicy</span> <span class="n">Bypass</span> <span class="o">-File</span> <span class="s2">&quot;C:\Path\To\Script.ps1&quot;</span>
</span></code></pre></div>
<ol>
<li><strong>Verify</strong>:</li>
<li>Check <code>C:\Program Files (x86)\PaperCut MF Client</code> to confirm deletion</li>
<li>Check <code>C:\ProgramData\AXA-Custom-Intune-Scripts\Papercut-Uninstall.log</code> for success logs</li>
</ol>
<hr />
<h3 id="step-3-running-the-script-on-a-remote-pc"><a class="toclink" href="../../../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#step-3-running-the-script-on-a-remote-pc"><strong>🌍 Step 3: Running the Script on a Remote PC</strong></a></h3>
<p>If you need to test the script remotely before deploying via Intune:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nv">$RemotePC</span> <span class="p">=</span> <span class="s2">&quot;COMPUTER-NAME&quot;</span>  <span class="c"># Change this to the target PC name</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="nb">Invoke-Command</span> <span class="n">-ComputerName</span> <span class="nv">$RemotePC</span> <span class="n">-FilePath</span> <span class="s2">&quot;C:\Path\To\Script.ps1&quot;</span> <span class="n">-Credential</span> <span class="p">(</span><span class="nb">Get-Credential</span><span class="p">)</span>
</span></code></pre></div>
<hr />
<h3 id="step-4-deploying-via-intune"><a class="toclink" href="../../../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#step-4-deploying-via-intune"><strong>📡 Step 4: Deploying via Intune</strong></a></h3>
<p>Instead of packaging the script as a <code>.intunewin</code> file, we will deploy it <strong>as a PowerShell script in Intune</strong>.</p>
<h4 id="steps-to-deploy-in-intune"><a class="toclink" href="../../../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#steps-to-deploy-in-intune"><strong>🎯 Steps to Deploy in Intune</strong></a></h4>
<ol>
<li><strong>Go to</strong> Microsoft Endpoint Manager admin center (<strong>endpoint.microsoft.com</strong>)</li>
<li>Navigate to <strong>Devices &gt; Scripts</strong></li>
<li>Click <strong>Add &gt; Windows 10 and later</strong></li>
<li><strong>Upload the PowerShell script</strong> (<code>Papercut-Uninstall.ps1</code>)</li>
<li>Configure settings:</li>
<li><strong>Run script using the logged-on credentials?</strong> → <strong>No</strong> (runs as SYSTEM)</li>
<li><strong>Enforce script signature check?</strong> → <strong>No</strong></li>
<li><strong>Run script in 64-bit PowerShell Host?</strong> → <strong>Yes</strong></li>
<li><strong>Assign the script to device groups</strong> (not users)</li>
<li><strong>Monitor deployment logs</strong> in Intune</li>
</ol>
<hr />
<h3 id="final-thoughts"><a class="toclink" href="../../../../uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/#final-thoughts"><strong>📌 Final Thoughts</strong></a></h3>
<p>By using <strong>Intune and PowerShell</strong>, we successfully automated the <strong>silent uninstallation</strong> of PaperCut MF Client. This approach ensures a <strong>zero-touch removal</strong> with <strong>no residual files</strong>, keeping endpoints clean and manageable. 🚀</p>
<p>Got questions or need enhancements? Drop them in the comments! 😊</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Uninstalling%20PaperCut%20MF%20Client%20via%20Intune%20%E2%80%93%20A%20Step-by-Step%20Guide%0A&amp;url=https://blog.pollockweb.com/blog/uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/uninstalling-papercut-mf-client-via-intune--a-step-by-step-guide/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-09 00:00:00+00:00">March 9, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/devops/" class="md-meta__link">DevOps</a>, 
              <a href="../../../../category/microsoft-certifications/" class="md-meta__link">Microsoft Certifications</a>, 
              <a href="../../../../category/ai--study-techniques/" class="md-meta__link">AI &amp; Study Techniques</a></li>
        
        
          
          <li class="md-meta__item">
            
              16 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/">How I Used ChatGPT to Create AZ-400 Exam Prep Notes from MSLearn</a></h2>
<h3 id="tldr-results-first"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#tldr-results-first">🚀 TL;DR - Results First</a></h3>
<p>Using the method detailed in this post, I successfully <strong>passed the AZ-400 exam</strong> while creating a reusable study system. This approach helped me transform <strong>34+ hours of MSLearn content</strong> into structured, searchable revision notes that I could quickly reference during my exam preparation.</p>
<p>Let me walk you through how I developed this system and how you can apply it to your own certification journey.</p>
<h3 id="the-challenge"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#the-challenge">The Challenge</a></h3>
<p>Studying for Microsoft certification exams like <strong>AZ-400</strong> can be overwhelming due to the vast amount of content available. Microsoft Learn alone provides <strong>over 34 hours of recommended reading</strong>, making it difficult to retain everything effectively.</p>
<p>To tackle this challenge, I developed a <strong>structured method</strong> using <strong>MSLearn, third-party exam questions, and ChatGPT</strong> to create a comprehensive <strong>revision guide</strong>. This method helped me <strong>organize knowledge into concise notes, cheat sheets, glossaries, and knowledge checks</strong>, ultimately leading to a successful exam pass!</p>
<p>This guide documents my <strong>step-by-step process</strong> so that you can replicate or adapt it for your own Microsoft exam preparation.</p>
<h3 id="goals-of-this-study-approach"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#goals-of-this-study-approach">🏆 Goals of This Study Approach</a></h3>
<p>My main objectives were:</p>
<ul>
<li>📌 <strong>Summarize each MSLearn module</strong> into easily digestible revision notes.</li>
<li>📌 <strong>Create a structured, searchable reference</strong> for later review.</li>
<li>📌 <strong>Store my notes in GitHub</strong> using Markdown for easy access.</li>
<li>📌 <strong>Use AI (ChatGPT) to extract and summarize key information</strong>.</li>
<li>📌 <strong>Supplement with third-party practice exams</strong> to test my knowledge.</li>
</ul>
<p>This method is <strong>not a quick win</strong> but provides an efficient, <strong>structured, and reusable</strong> way to prepare for any MSLearn-based exam.</p>
<h4 id="mslearn-collections-used"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#mslearn-collections-used">🔹 MSLearn Collections Used</a></h4>
<p>To ensure comprehensive coverage of the exam syllabus, I structured my studies around the <strong>official Microsoft Learn learning paths</strong>. Each path covers a key topic required for AZ-400 certification, including DevOps principles, CI/CD, infrastructure as code, and security best practices. I systematically worked through these collections, summarizing important concepts, capturing key insights, and using ChatGPT to refine the content into structured notes.</p>
<p>Below are the <strong>learning paths</strong> I followed, each linking directly to its respective Microsoft Learn module:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-work-git-for-enterprise-devops/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Development for Enterprise DevOps</a> – Covers Git workflows, branch strategies, and repository management.</li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-implement-ci-azure-pipelines-github-actions/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Implement CI with Azure Pipelines and GitHub Actions</a> – Focuses on automating build and release processes with Azure Pipelines and GitHub Actions.</li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-design-implement-release-strategy/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Design and Implement a Release Strategy</a> – Covers feature flagging, blue-green deployments, and release management.</li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-implement-secure-continuous-deployment/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Implement Secure Continuous Deployment</a> – Discusses security measures for CI/CD pipelines.</li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-manage-infrastructure-as-code-using-azure/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Manage Infrastructure as Code Using Azure</a> – Focuses on managing cloud resources with Terraform, Bicep, and ARM templates.</li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-design-implement-dependency-management-strategy/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Design and Implement a Dependency Management Strategy</a> – Covers artifact management and dependency security.</li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-implement-continuous-feedback/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Implement Continuous Feedback</a> – Discusses monitoring and feedback loops for DevOps processes.</li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-implement-security-validate-code-bases-compliance/?username=MattPollock-7884&amp;section=activity&amp;ns-enrollment-type=Collection&amp;ns-enrollment-id=7w1eik156rweq7">AZ-400 Implement Security and Validate Code Bases for Compliance</a> – Focuses on DevSecOps principles and compliance validation.</li>
</ul>
<p>These resources formed the foundation of my study plan, ensuring alignment with the <strong>official exam objectives</strong>. I used these collections as the basis for my <strong>revision notes, AI-generated summaries, and knowledge checks</strong>.</p>
<hr />
<h3 id="process-overview"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#process-overview">📊 Process Overview</a></h3>
<p>Before diving into the detailed steps, here's an overview of the complete workflow:</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>MSLearn Content → Link Collection → ChatGPT Summarization → GitHub Storage → Practice Testing → Final Review
</span></code></pre></div>
<p>Estimated time investment per module:</p>
<ul>
<li>Manual link collection: ~15 minutes</li>
<li>AI summarization and refinement: ~30-60 minutes</li>
<li>Review and validation: ~30 minutes</li>
<li>Total per module: ~1-1.75 hours (compared to 3-4 hours of traditional study)</li>
</ul>
<p>These estimates are based on my experience after processing several modules. As you'll see in the learning curve section below, your first few modules might take longer as you refine your workflow.</p>
<p>Let's dive into each step of the process in detail.</p>
<hr />
<h3 id="step-1-collecting-and-organizing-mslearn-content"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#step-1-collecting-and-organizing-mslearn-content">📌 Step 1: Collecting and Organizing MSLearn Content</a></h3>
<p>MSLearn provides <strong>structured learning paths</strong>, but I needed a way to track important links and content. Here's how I manually compiled everything:</p>
<h4 id="manual-link-collection-process"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#manual-link-collection-process">🔹 Manual Link Collection Process</a></h4>
<ol>
<li>
<p><strong>Initial Setup</strong>: I created a dedicated folder structure on my computer with sub-folders for each learning path, mirroring the eventual GitHub repository structure.</p>
</li>
<li>
<p><strong>After each lesson</strong>: Captured all relevant <strong>hyperlinks</strong> and stored them in a <code>.txt</code> file within the appropriate folder. This was as simple as copy-pasting links while reading.</p>
</li>
<li>
<p><strong>At the end of each module</strong>: Consolidated all links into the text file and organized them by topic.</p>
</li>
<li>
<p><strong>Mapped content to official exam objectives</strong>: Fed the exam study guide into ChatGPT to check alignment, ensuring I wasn't missing critical areas.</p>
</li>
</ol>
<p>📸 <strong><img alt="Screenshot of collected links in text file" src="../../../../study-docs/MSLearn-links-example.png" /></strong></p>
<h5 id="before-after-example"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#before-after-example">Before &amp; After Example</a></h5>
<p><strong>Raw MSLearn Content:</strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>Unit Title: Implement branch policies in Azure Repos
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="k">-</span><span class="w"> </span>Configure branch policies
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="k">-</span><span class="w"> </span>Implement pull request approval processes
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="k">-</span><span class="w"> </span>Manage branch policy bypasses
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="k">-</span><span class="w"> </span>Configure auto-complete pull requests
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="k">-</span><span class="w"> </span>Configure branch policy permissions
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="k">-</span><span class="w"> </span>Configure build validation
</span></code></pre></div>
<p><strong>Transformed into Structured Notes:</strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="gu">## Branch Policies in Azure Repos</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>Branch policies help teams protect important branches by:
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="k">-</span><span class="w"> </span>Requiring code reviews before merging
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="k">-</span><span class="w"> </span>Setting minimum number of reviewers (typically 2+)
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="k">-</span><span class="w"> </span>Enforcing build validation to prevent broken code
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="k">-</span><span class="w"> </span>Restricting direct pushes to protected branches
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="gu">### Key Configuration Options:</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>| Policy | Purpose | Real-world Usage |
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>|--------|---------|------------------|
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>| Minimum reviewers | Ensures code quality | Set to 2+ for production code |
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>| Build validation | Prevents broken builds | Configure with main CI pipeline |
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a>| Comment resolution | Tracks issue fixes | Require resolution before merge |
</span></code></pre></div>
<p><strong>Lesson Learned</strong>: Consistent link collection during the learning process is much more efficient than trying to gather everything after completing a module. I developed a habit of copying links as I encountered them, which saved significant time later.</p>
<blockquote>
<p>💡 <em>Future Improvement</em>: Automating this process via a script could save time. A PowerShell or Python script could potentially scrape MSLearn modules for relevant links.</p>
</blockquote>
<hr />
<h3 id="step-2-using-ai-chatgpt-to-summarize-content"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#step-2-using-ai-chatgpt-to-summarize-content">📌 Step 2: Using AI (ChatGPT) to Summarize Content</a></h3>
<p>To turn raw MSLearn material into usable study notes, I <strong>fed collected links into ChatGPT</strong> and asked it to <strong>scrape and summarize key points</strong>.</p>
<p>I used <strong>ChatGPT 4</strong> for this process, as it provided better context handling and more accurate summaries than earlier versions.</p>
<p>The summarization workflow consisted of the following steps:</p>
<p>1️⃣ <strong>Collected MSLearn Links</strong> – Compiled all module-related links into a text file.
2️⃣ <strong>Fed the Links into ChatGPT</strong> – Asked ChatGPT to analyze and summarize key information.
3️⃣ <strong>Refined the Output Iteratively</strong> – Adjusted prompts to enhance clarity and completeness.</p>
<h4 id="crafting-effective-chatgpt-prompts"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#crafting-effective-chatgpt-prompts">🔹 Crafting Effective ChatGPT Prompts</a></h4>
<p>Well-structured prompts were essential for generating <strong>clear and accurate</strong> summaries. Below is an example of my <strong>initial prompt</strong>:</p>
<div class="language-markdown highlight"><span class="filename">prompt - ChatGPT first iteration</span><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>Please create a .md file in the same format as the previous ones and include the following:
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>Summarize key information within each unit, including diagrams, tables, and exercises and labs.
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>List steps performed and order of steps/workflow, where applicable.
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>Use tables primarily for comparing differences between items.
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>Include:
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>Key exam points.
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>Points to remember.
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a>Prerequisite information.
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a>Include any service limits - maximum minutes per month for a particular tier, difference services available in varying tiers/services/SKUs for example
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a>Permissions required for activities.
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a>Provide real-world applications, troubleshooting scenarios, and advanced tips.
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a>Highlight common pitfalls or mistakes to avoid.
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a>Review the canvas and add/remove any relevant information.
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a>Use the web to search for supplementary material where necessary, and summarize this information within the notes.
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a>Avoid external links—include all relevant information directly in the notes.
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a>Ensure all &quot;Learning objectives&quot; in Unit 1 are met by the material included in the output .md file(s)
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a>Ensure no content is included that doesn&#39;t have a real-world example or exam related reference included
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a>Review the output you have created at the end, and make any further improvements automatically be manually revising the file or implementing your comments.
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a>Here is a list of the links contained in this module.
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a>Using the parameters outlined above create a comprehensive exam cram resource cheat sheet, that can be used for my AZ-400 exam prep.
</span><span id="__span-39-23"><a id="__codelineno-39-23" name="__codelineno-39-23" href="#__codelineno-39-23"></a>The resulting output needs contain material relevant to the AZ-400 study guide:
</span><span id="__span-39-24"><a id="__codelineno-39-24" name="__codelineno-39-24" href="#__codelineno-39-24"></a>
</span><span id="__span-39-25"><a id="__codelineno-39-25" name="__codelineno-39-25" href="#__codelineno-39-25"></a>https://learn.microsoft.com/en-us/credentials/certifications/resources/study-guides/az-400
</span><span id="__span-39-26"><a id="__codelineno-39-26" name="__codelineno-39-26" href="#__codelineno-39-26"></a>
</span><span id="__span-39-27"><a id="__codelineno-39-27" name="__codelineno-39-27" href="#__codelineno-39-27"></a>Let me know when you are ready for the module links?
</span></code></pre></div>
<p>While this prompt worked initially, I found it had several limitations:</p>
<ul>
<li>It was too lengthy and complex for ChatGPT to consistently follow all instructions</li>
<li>It lacked specific formatting guidance</li>
<li>It didn't emphasize accuracy and relevance enough</li>
</ul>
<h4 id="prompt-evolution"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#prompt-evolution">🔹 Prompt Evolution</a></h4>
<p>I refined the prompt through several iterations to address these issues. The key improvements included:</p>
<ol>
<li><strong>Adding a clear word count limit</strong> (750 words per file) to prevent overly lengthy outputs</li>
<li><strong>Explicitly prohibiting generic statements</strong> like "understand X" and "know how to..."</li>
<li><strong>Requiring concrete examples for each concept</strong> rather than theoretical explanations</li>
<li><strong>Creating a more structured format</strong> with clear section headings and organization</li>
<li><strong>Adding a final validation step</strong> to ensure content aligned with learning objectives</li>
</ol>
<h5 id="initial-results-vs-refined-results"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#initial-results-vs-refined-results">Initial Results vs. Refined Results</a></h5>
<p><strong>First Iteration Output (Excerpt):</strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="gu">## Key Exam Points</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="k">-</span><span class="w"> </span>Understand the different branch policies in Azure Repos
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="k">-</span><span class="w"> </span>Know how to configure pull request approvals
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="k">-</span><span class="w"> </span>Understand branch policy permissions
</span></code></pre></div>
<p><strong>Problems:</strong></p>
<ul>
<li>Too generic with "understand" and "know how" statements</li>
<li>Lacks specific examples and actionable information</li>
<li>No clear formatting structure</li>
</ul>
<p><strong>Refined Output (After Improved Prompt):</strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="gu">## Branch Policies in Azure DevOps</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="gu">### Key Exam Points</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="k">-</span><span class="w"> </span>Branch policies in Azure Repos protect branches by enforcing code review and build validation
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="k">-</span><span class="w"> </span>Required reviewers policy must be configured with minimum count (2+ recommended for production)
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="k">-</span><span class="w"> </span>Build validation policy links CI pipeline to PR process, ensuring code builds successfully
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="k">-</span><span class="w"> </span>Policy bypasses can be granted to specific users or groups (Project Administrators have bypass by default)
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="k">-</span><span class="w"> </span>Branch policies are set at repository level under Branches → [...] → Branch Policies
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="gu">### Common Scenarios</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a>When setting up branch policies for a large team:
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="k">1.</span> Configure minimum 2 reviewers for main branch
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="k">2.</span> Enable &quot;Comment resolution&quot; to require addressing feedback
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="k">3.</span> Link build validation to prevent broken builds
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="k">4.</span> Set reset votes when new changes are pushed
</span></code></pre></div>
<h4 id="challenges-solutions"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#challenges-solutions">🔹 Challenges &amp; Solutions</a></h4>
<p>Using AI to generate structured content wasn't always seamless. Here are some <strong>key challenges and how I addressed them</strong>:</p>
<table>
<thead>
<tr>
<th><strong>Challenge</strong></th>
<th><strong>Solution</strong></th>
<th><strong>Example</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ChatGPT lost context in long sessions</td>
<td>Processed module-by-module instead of bulk inputs</td>
<td>Split "Azure Pipelines" module into 3 separate prompts</td>
</tr>
<tr>
<td>Overwrote useful content in iterations</td>
<td>Manually saved outputs before requesting refinements</td>
<td>Created checkpoint files labeled v1, v2, etc.</td>
</tr>
<tr>
<td>Large data inputs led to incomplete summaries</td>
<td>Used <strong>multiple iterations</strong>, focusing on <strong>key areas</strong> of each module</td>
<td>First pass: core concepts; Second pass: examples and scenarios</td>
</tr>
<tr>
<td>Hallucinations on technical details</td>
<td>Cross-validated against official documentation</td>
<td>Corrected service limits and permission details</td>
</tr>
<tr>
<td>Generic "understand X" statements</td>
<td>Explicitly requested specific actionable information</td>
<td>Replaced "Understand CI/CD" with actual pipeline YAML examples</td>
</tr>
</tbody>
</table>
<p>Breaking down content into <strong>smaller chunks</strong> and applying <strong>manual validation</strong> helped ensure better results.</p>
<p><strong>Learning Curve</strong>: My first module took nearly 2 hours to process completely, as I was still figuring out the optimal prompt structure and workflow. By my fifth module, I had reduced this to about 45 minutes through improved prompting and a more streamlined approach.</p>
<hr />
<h4 id="refining-the-output"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#refining-the-output">🔹 Refining the Output</a></h4>
<p>To improve <strong>content accuracy</strong>, I introduced an additional <strong>review prompt</strong>:</p>
<div class="language-markdown highlight"><span class="filename">ChatGPT prompt - second iteration</span><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>Objective:
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>Create a .md file that acts as a comprehensive AZ-400 exam cram resource cheat sheet.
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>Instructions:
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>Act as my Azure DevOps training expert with a focus on preparing me for the AZ-400 exam.
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>The output must adhere to the structure and content requirements outlined below:
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>Content Requirements:
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>Each file should contain no more than 750 words (excluding text that make up hyperlinks)
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>Summarize Key Information:
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>Include summaries for each unit, diagram, table, exercise, and lab where applicable.
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a>Use clear and concise explanations.
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a>List Steps/Workflows:
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a>Summarize steps performed in labs/exercises and the order of steps/workflows where applicable.
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a>
</span><span id="__span-42-19"><a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a>Use Tables:
</span><span id="__span-42-20"><a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a>Create tables primarily for comparing differences between items (examples, but not limited to - features, tiers, SKUs etc ).
</span><span id="__span-42-21"><a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a>
</span><span id="__span-42-22"><a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a>Key Exam Points: Highlight crucial information likely to appear in the exam and provide actual examples. 
</span><span id="__span-42-23"><a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a>Do not use generic phrases like &quot;Understand....&quot; and  &quot;Know how to....&quot;. 
</span><span id="__span-42-24"><a id="__codelineno-42-24" name="__codelineno-42-24" href="#__codelineno-42-24"></a>I need you to provide the information I need to know for each exam tip.
</span><span id="__span-42-25"><a id="__codelineno-42-25" name="__codelineno-42-25" href="#__codelineno-42-25"></a>
</span><span id="__span-42-26"><a id="__codelineno-42-26" name="__codelineno-42-26" href="#__codelineno-42-26"></a>Points to Remember: Provide concise, high-priority notes for studying.
</span><span id="__span-42-27"><a id="__codelineno-42-27" name="__codelineno-42-27" href="#__codelineno-42-27"></a>
</span><span id="__span-42-28"><a id="__codelineno-42-28" name="__codelineno-42-28" href="#__codelineno-42-28"></a>Prerequisite Information: Mention anything needed to understand or implement concepts.
</span><span id="__span-42-29"><a id="__codelineno-42-29" name="__codelineno-42-29" href="#__codelineno-42-29"></a>
</span><span id="__span-42-30"><a id="__codelineno-42-30" name="__codelineno-42-30" href="#__codelineno-42-30"></a>Service Limits: Include tier limitations (e.g., maximum minutes per month), service availability by SKU, etc.
</span><span id="__span-42-31"><a id="__codelineno-42-31" name="__codelineno-42-31" href="#__codelineno-42-31"></a>
</span><span id="__span-42-32"><a id="__codelineno-42-32" name="__codelineno-42-32" href="#__codelineno-42-32"></a>Permissions Required: Specify roles/permissions necessary for activities.
</span><span id="__span-42-33"><a id="__codelineno-42-33" name="__codelineno-42-33" href="#__codelineno-42-33"></a>
</span><span id="__span-42-34"><a id="__codelineno-42-34" name="__codelineno-42-34" href="#__codelineno-42-34"></a>Practical Applications:
</span><span id="__span-42-35"><a id="__codelineno-42-35" name="__codelineno-42-35" href="#__codelineno-42-35"></a>Provide real-world applications, troubleshooting scenarios, and advanced tips.
</span><span id="__span-42-36"><a id="__codelineno-42-36" name="__codelineno-42-36" href="#__codelineno-42-36"></a>Highlight common pitfalls or mistakes to avoid.
</span><span id="__span-42-37"><a id="__codelineno-42-37" name="__codelineno-42-37" href="#__codelineno-42-37"></a>
</span><span id="__span-42-38"><a id="__codelineno-42-38" name="__codelineno-42-38" href="#__codelineno-42-38"></a>Relevance:
</span><span id="__span-42-39"><a id="__codelineno-42-39" name="__codelineno-42-39" href="#__codelineno-42-39"></a>Ensure the output aligns with the Microsoft AZ-400 study guide 
</span><span id="__span-42-40"><a id="__codelineno-42-40" name="__codelineno-42-40" href="#__codelineno-42-40"></a>(https://learn.microsoft.com/en-us/credentials/certifications/resources/study-guides/az-400)
</span><span id="__span-42-41"><a id="__codelineno-42-41" name="__codelineno-42-41" href="#__codelineno-42-41"></a>Exclude any content that lacks real-world examples or exam-related references.
</span><span id="__span-42-42"><a id="__codelineno-42-42" name="__codelineno-42-42" href="#__codelineno-42-42"></a>
</span><span id="__span-42-43"><a id="__codelineno-42-43" name="__codelineno-42-43" href="#__codelineno-42-43"></a>Final Review:
</span><span id="__span-42-44"><a id="__codelineno-42-44" name="__codelineno-42-44" href="#__codelineno-42-44"></a>Evaluate the output to ensure all &quot;Learning Objectives&quot; in Unit 1 are met.
</span><span id="__span-42-45"><a id="__codelineno-42-45" name="__codelineno-42-45" href="#__codelineno-42-45"></a>Automatically revise the file manually if needed to enhance clarity and completeness.
</span><span id="__span-42-46"><a id="__codelineno-42-46" name="__codelineno-42-46" href="#__codelineno-42-46"></a>
</span><span id="__span-42-47"><a id="__codelineno-42-47" name="__codelineno-42-47" href="#__codelineno-42-47"></a>
</span><span id="__span-42-48"><a id="__codelineno-42-48" name="__codelineno-42-48" href="#__codelineno-42-48"></a>Prompt me for a list of URL&#39;s or an existing .md file when you have understood the instructions.
</span></code></pre></div>
<h4 id="iterative-refinement-technique"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#iterative-refinement-technique">🔹 Iterative Refinement Technique</a></h4>
<p>Depending on the results, I would often break the prompt up further, and just use a specific part.
For example, once I was happy with the results of a certain output I would re-enter the "Final Review:
Evaluate the output to ensure all "Learning Objectives" in Unit 1 are met."
Automatically revise the file manually if needed to enhance clarity and completeness." prompt, once or maybe several times until was happy with the finished output.</p>
<p>A typical module would go through 2-3 iterations:</p>
<ol>
<li><strong>Initial generation</strong> - Creates the basic structure and content</li>
<li><strong>Content enhancement</strong> - Adds real-world examples and specifics</li>
<li><strong>Final validation</strong> - Checks against learning objectives and improves clarity</li>
</ol>
<p>For complex topics like Azure Pipelines, I might need 4-5 iterations to fully refine the content.</p>
<h5 id="workflow-integration"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#workflow-integration">Workflow Integration</a></h5>
<p>I integrated this process into my daily study routine by:</p>
<ol>
<li>Reading a module in the morning</li>
<li>Collecting links as I went</li>
<li>Processing with ChatGPT during lunch break or after work</li>
<li>Reviewing and committing to GitHub in the evening</li>
</ol>
<p>This approach allowed me to maintain consistent progress without feeling overwhelmed.</p>
<h5 id="time-saving-tip"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#time-saving-tip">Time-Saving Tip</a></h5>
<p>A full module processing cycle typically took about 30-45 minutes, compared to 2-3 hours of traditional study and note-taking. The time investment was front-loaded, but paid dividends during revision.</p>
<hr />
<h3 id="step-3-integrating-third-party-exam-resources"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#step-3-integrating-third-party-exam-resources">📌 Step 3: Integrating Third-Party Exam Resources</a></h3>
<p>While MSLearn is great for structured content, <strong>real-world practice questions</strong> are crucial for exam success. I incorporated:</p>
<ul>
<li>✅ <strong>MSLearn Official Practice Questions</strong></li>
<li>✅ <strong>Third-Party Providers</strong>: Tutorials Dojo, MeasureUp</li>
<li>✅ <strong>Exam Explanation Links</strong> (to validate answers)</li>
</ul>
<h4 id="how-i-validated-third-party-questions"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#how-i-validated-third-party-questions">🔹 How I Validated Third-Party Questions</a></h4>
<ul>
<li>Checked explanations for <strong>links to MSLearn documentation</strong>.</li>
<li>Manually cross-referenced answers with <strong>official study material</strong>.</li>
<li>Used my GitHub repo's search function to quickly verify concepts.</li>
</ul>
<h4 id="identifying-valuable-practice-questions"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#identifying-valuable-practice-questions">🔹 Identifying Valuable Practice Questions</a></h4>
<p>Not all practice questions are created equal. I prioritized questions that:</p>
<ol>
<li>Included detailed explanations with documentation links</li>
<li>Covered scenarios rather than simple definition recall</li>
<li>Tested practical knowledge rather than obscure facts</li>
<li>Referenced multiple concepts in a single question</li>
</ol>
<p>📸 <strong><img alt="TutorialsDojo example" src="../../../../study-docs/TD-example.png" title="TutorialsDojo exam question example" /></strong></p>
<h4 id="supplementary-resources-worth-the-investment"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#supplementary-resources-worth-the-investment">🔹 Supplementary Resources Worth The Investment</a></h4>
<p>Based on my experience, these additional resources provided the best value:</p>
<ol>
<li><strong>Tutorials Dojo Practice Exams</strong> - Excellent explanations and documentation links</li>
<li><strong>MeasureUp Official Practice Tests</strong> - Most similar to actual exam format</li>
<li><strong>WhizLabs Labs</strong> - Hands-on practice for key scenarios</li>
</ol>
<p>The combination of AI-summarized MSLearn content and targeted practice questions created a comprehensive exam preparation strategy.</p>
<p><strong>Real-World Application Example</strong>: During a practice exam, I encountered a question about configuring branch policies with required reviewers. Using my GitHub repository's search function, I quickly found the related notes I had created, which included the exact setting location and recommended configuration values. This allowed me to answer correctly and understand the underlying concept, rather than just memorizing an answer.</p>
<hr />
<h3 id="step-4-storing-notes-in-github-for-easy-reference"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#step-4-storing-notes-in-github-for-easy-reference">📌 Step 4: Storing Notes in GitHub for Easy Reference</a></h3>
<p>One key advantage of this method was <strong>storing all notes in a GitHub repository</strong>, allowing easy searchability.</p>
<h4 id="initial-github-repository-setup"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#initial-github-repository-setup">🔹 Initial GitHub Repository Setup</a></h4>
<ol>
<li><strong>Created a new GitHub repository</strong> specifically for my AZ-400 exam notes</li>
<li><strong>Established a folder structure</strong> that mirrored the MSLearn learning paths</li>
<li><strong>Set up a README</strong> with quick navigation links to major sections</li>
<li><strong>Created a consistent file naming convention</strong> (numbered by sequence in the learning path)</li>
</ol>
<h4 id="how-i-structured-my-notes"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#how-i-structured-my-notes">🔹 How I Structured My Notes</a></h4>
<p><strong>(VS Code folder structure represented in Markdown)</strong></p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>📂 AZ-400 - MS LEARN - EXAM NOTES/
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a> ├── 📁 .github/
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a> │
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a> ├── 📁 1. AZ-400 Development for Enterprise DevOps/
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a> │    ├── 1. Introduction to DevOps.md
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a> │    ├── 2. Plan Agile with GitHub Projects and Azure Boards.md
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a> │    ├── 3. Design and implement branch strategies and workflows.md
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a> │    ├── 4. Collaborate with pull requests in Azure Repos.md
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a> │    ├── 5. Explore Git hooks.md
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a> │    ├── 6. Plan foster inner source.md
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a> │    ├── 7. Manage and configure repositories.md
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a> │    ├── 8. Identify technical debt.md
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a> │
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a> ├── 📁 2. AZ-400 Implement CI with Azure Pipelines and GitHub Actions/
</span><span id="__span-43-15"><a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a> │    ├── 1. Explore Azure Pipelines.md
</span><span id="__span-43-16"><a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a> │    ├── 2. Manage Azure Pipeline agents and pools.md
</span><span id="__span-43-17"><a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a> │    ├── 3. Describe pipelines and concurrency.md
</span><span id="__span-43-18"><a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a> │    ├── 4. Design and implement a pipeline strategy.md
</span><span id="__span-43-19"><a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a> │    ├── 5. Integrate with Azure Pipelines.md
</span><span id="__span-43-20"><a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a> │    ├── 6. Introduction to GitHub Actions.md
</span><span id="__span-43-21"><a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a> │    ├── 7. Learn continuous integration with GitHub Actions.md
</span><span id="__span-43-22"><a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a> │    ├── 8. Design Container Build Strategy.md
</span><span id="__span-43-23"><a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a> ├── 📁 3. AZ-400 Design and Implement a Release Strategy/
</span><span id="__span-43-24"><a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a> ├── ...
</span><span id="__span-43-25"><a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a> ├── 📁 4. AZ-400 Implement a Secure Continuous Deployment using Azure Pipelines/
</span><span id="__span-43-26"><a id="__codelineno-43-26" name="__codelineno-43-26" href="#__codelineno-43-26"></a> ├── ...
</span><span id="__span-43-27"><a id="__codelineno-43-27" name="__codelineno-43-27" href="#__codelineno-43-27"></a> ├── 📁 5. AZ-400 Manage Infrastructure as Code using Azure and DSC/
</span><span id="__span-43-28"><a id="__codelineno-43-28" name="__codelineno-43-28" href="#__codelineno-43-28"></a> ├── ...
</span><span id="__span-43-29"><a id="__codelineno-43-29" name="__codelineno-43-29" href="#__codelineno-43-29"></a> ├── 📁 6. AZ-400 Design and Implement a Dependency Management Strategy/
</span><span id="__span-43-30"><a id="__codelineno-43-30" name="__codelineno-43-30" href="#__codelineno-43-30"></a> ├── ...
</span><span id="__span-43-31"><a id="__codelineno-43-31" name="__codelineno-43-31" href="#__codelineno-43-31"></a> ├── 📁 7. AZ-400 Implement Continuous Feedback
</span><span id="__span-43-32"><a id="__codelineno-43-32" name="__codelineno-43-32" href="#__codelineno-43-32"></a> ├── ...
</span><span id="__span-43-33"><a id="__codelineno-43-33" name="__codelineno-43-33" href="#__codelineno-43-33"></a> ├── 📁 8. AZ-400 Implement Security and Validate Code Bases for Compliance/
</span><span id="__span-43-34"><a id="__codelineno-43-34" name="__codelineno-43-34" href="#__codelineno-43-34"></a> ├── ...
</span><span id="__span-43-35"><a id="__codelineno-43-35" name="__codelineno-43-35" href="#__codelineno-43-35"></a> ├── 📁 AZ-400 Tutorials Dojo - Exam Notes/
</span><span id="__span-43-36"><a id="__codelineno-43-36" name="__codelineno-43-36" href="#__codelineno-43-36"></a> │    ├── Azure DevOps - Terms and Definitions - Pt 1.md
</span><span id="__span-43-37"><a id="__codelineno-43-37" name="__codelineno-43-37" href="#__codelineno-43-37"></a> │    ├── Azure DevOps - Terms and Definitions - Pt 2.md
</span><span id="__span-43-38"><a id="__codelineno-43-38" name="__codelineno-43-38" href="#__codelineno-43-38"></a> │    ├── Azure DevOps - Terms and Definitions - Pt 3.md
</span></code></pre></div>
<p>📸 <strong><img alt="GitHub repo structure" src="../../../../study-docs/GitHub-repo-structure.png" title="GitHub Repo structure" /></strong></p>
<h4 id="workflow-for-adding-new-notes"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#workflow-for-adding-new-notes">🔹 Workflow for Adding New Notes</a></h4>
<ol>
<li><strong>Create new markdown file</strong> in the appropriate folder</li>
<li><strong>Paste ChatGPT-generated content</strong> and review for accuracy</li>
<li><strong>Commit changes</strong> with descriptive commit messages (e.g., "Add Azure Pipelines agents notes")</li>
<li><strong>Push to GitHub</strong> to make available for searching during study sessions</li>
</ol>
<p>🔍 <strong>Searching Notes Efficiently</strong></p>
<ul>
<li>Used <strong>GitHub's search function</strong> to quickly find terms (e.g., <code>MendBolt</code>).</li>
<li>This allowed me to <strong>cross-check answers during study sessions</strong>.</li>
</ul>
<h5 id="example-search-workflow"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#example-search-workflow">Example Search Workflow</a></h5>
<ol>
<li>Practice question mentions "Which Azure DevOps deployment strategy minimizes downtime during releases?"</li>
<li>One of the answers mnetions "Blue/Green" deployment</li>
<li>Search repository for "Blue/Green"</li>
<li>Results show multiple matching files.</li>
<li>Quickly identify that "Blue/Green deployment" is the correct answer based on my notes.</li>
<li>Verify with documentation reference that Blue/Green deployments maintain two identical production environments, allowing for instant switching between versions.</li>
</ol>
<p>📸 <strong><img alt="GitHub search in action" src="../../../../study-docs/GitHub-search.png" title="GitHub repo search example" /></strong></p>
<h4 id="real-world-performance-impact"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#real-world-performance-impact">🔹 Real-World Performance Impact</a></h4>
<p>During practice exams, I could typically locate key information in <strong>under 30 seconds</strong> using this method, compared to several minutes when using traditional notes or searching documentation directly.</p>
<hr />
<h3 id="results-key-takeaways"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#results-key-takeaways">📌 Results &amp; Key Takeaways</a></h3>
<p>🎯 <strong>Outcome:</strong></p>
<ul>
<li>✅ Passed the AZ-400 exam! 🎉</li>
<li>✅ Created a <strong>structured, reusable</strong> study guide.</li>
<li>✅ Used AI efficiently to <strong>save time and condense information</strong>.</li>
<li>✅ Reduced overall study time by approximately 40% compared to traditional methods.</li>
</ul>
<h4 id="time-investment-analysis"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#time-investment-analysis">🔹 Time Investment Analysis</a></h4>
<table>
<thead>
<tr>
<th>Activity</th>
<th>Traditional Approach</th>
<th>AI-Enhanced Approach</th>
<th>Time Savings</th>
</tr>
</thead>
<tbody>
<tr>
<td>Reading MSLearn</td>
<td>34+ hours</td>
<td>8-10 hours</td>
<td>~70%</td>
</tr>
<tr>
<td>Note-taking</td>
<td>10-15 hours</td>
<td>5-7 hours</td>
<td>~50%</td>
</tr>
<tr>
<td>Organization</td>
<td>3-5 hours</td>
<td>2-3 hours</td>
<td>~40%</td>
</tr>
<tr>
<td>Practice &amp; Review</td>
<td>15-20 hours</td>
<td>15-20 hours</td>
<td>0%</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td><strong>62-74 hours</strong></td>
<td><strong>30-40 hours</strong></td>
<td><strong>~45%</strong></td>
</tr>
</tbody>
</table>
<p>These figures are based on my own experience and tracking of study time. Your results may vary depending on your familiarity with the subject matter and the tools involved. The key insight is that the most significant time savings came from condensing the initial reading phase while maintaining or even improving knowledge retention through structured notes.</p>
<h4 id="what-id-do-differently-next-time"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#what-id-do-differently-next-time">🔹 What I'd Do Differently Next Time</a></h4>
<p>🔹 Further <strong>break down</strong> the ChatGPT input process into <strong>smaller steps</strong><br />
🔹 Explore <strong>alternative AI tools</strong> like Claude or Bard to compare summary quality<br />
🔹 Consider <strong>automating link collection</strong> from MSLearn using a simple web scraper<br />
🔹 Create a <strong>standardized template</strong> for each module type from the beginning<br />
🔹 Add more <strong>visual elements</strong> like diagrams to represent complex relationships  </p>
<h4 id="would-i-recommend-this-approach"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#would-i-recommend-this-approach">🔹 Would I Recommend This Approach?</a></h4>
<p>✅ Yes—but only if you're prepared for an <strong>iterative, hands-on</strong> study process.</p>
<p>The greatest benefits were:</p>
<ol>
<li>Structured organization of complex information</li>
<li>Quick searchability during practice tests</li>
<li>Forced engagement with the material (rather than passive reading)</li>
<li>Creation of a reusable resource for future reference</li>
</ol>
<hr />
<h3 id="how-to-get-started-yourself"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#how-to-get-started-yourself">🚀 How to Get Started Yourself</a></h3>
<h4 id="initial-setup-steps"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#initial-setup-steps">Initial Setup Steps</a></h4>
<p>Before diving into the content summarization, take these important setup steps:</p>
<ol>
<li><strong>Create your repository structure</strong>:</li>
<li>Set up a GitHub repository with appropriate folder structure</li>
<li>Create a README.md with navigation links</li>
<li>
<p>Establish a consistent file naming convention</p>
</li>
<li>
<p><strong>Set up a local workflow</strong>:</p>
</li>
<li>Create a folder structure on your computer mirroring your GitHub repo</li>
<li>Establish a system for collecting and storing links as you study</li>
<li>
<p>Set up a template for your ChatGPT prompts</p>
</li>
<li>
<p><strong>Gather your resources</strong>:</p>
</li>
<li>Bookmark all relevant MSLearn collections</li>
<li>Organize them according to the exam objectives</li>
<li>Create a schedule for working through them systematically</li>
</ol>
<h4 id="quick-start-template"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#quick-start-template">Quick Start Template</a></h4>
<p>Here's a simplified prompt template to get you started:</p>
<div class="language-markdown highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>I&#39;m studying for the [EXAM CODE] certification. Please help me create concise, exam-focused notes for the following module: [MODULE NAME]
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>For each key concept, please:
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="k">1.</span> Explain it in 1-2 sentences
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="k">2.</span> Provide a real-world example or scenario
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="k">3.</span> Note any configuration options or limitations
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="k">4.</span> Mention if it&#39;s likely to appear on the exam
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a>Please format your response in Markdown with clear headings and avoid generic &quot;understand X&quot; statements.
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>Here are the links to the module content:
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>[PASTE LINKS HERE]
</span></code></pre></div>
<h4 id="complete-process"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#complete-process">Complete Process</a></h4>
<p>1️⃣ <strong>Set up a GitHub repo</strong> for your notes.<br />
2️⃣ <strong>Manually collect</strong> MSLearn hyperlinks as you study.<br />
3️⃣ <strong>Use ChatGPT</strong> to summarize module-by-module.<br />
4️⃣ <strong>Validate third-party questions</strong> with official docs.<br />
5️⃣ <strong>Store and search</strong> your notes in GitHub for quick reference.  </p>
<hr />
<h3 id="frequently-asked-questions"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#frequently-asked-questions">❓ Frequently Asked Questions</a></h3>
<p><strong>Q: Is this approach considered cheating?</strong>
A: No. This method enhances learning by actively engaging with the material rather than replacing study. You're creating custom notes by directing AI to extract and organize information you need to know.</p>
<p><strong>Q: How much technical knowledge do I need to implement this approach?</strong>
A: Basic GitHub knowledge and familiarity with markdown formatting are helpful but not essential. The core process can be adapted to use any note-taking system.</p>
<p><strong>Q: Does this work for all Microsoft certification exams?</strong>
A: Yes, this approach works well for any exam with structured MSLearn paths.</p>
<p><strong>Q: How do you handle inaccurate information from AI?</strong>
A: Always verify key technical details against official documentation. When in doubt, trust Microsoft's documentation over AI-generated content.</p>
<p><strong>Q: How long did it take you to become proficient with this workflow?</strong>
A: After completing about 3-4 modules, I had established an efficient workflow. The learning curve is relatively quick if you're already familiar with GitHub and ChatGPT.</p>
<hr />
<h3 id="final-thoughts"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#final-thoughts">💬 Final Thoughts</a></h3>
<p>This method made my <strong>exam prep structured and efficient</strong>, though it required <strong>significant manual effort</strong>. If you're preparing for a Microsoft certification, consider trying this approach!</p>
<p>The combination of <strong>AI-powered summarization</strong>, <strong>structured GitHub storage</strong>, and <strong>focused practice testing</strong> created a powerful study system that both saved time and improved retention.</p>
<p>The most valuable aspect wasn't just passing the exam, but creating a reusable knowledge base that continues to serve as a reference in my professional work. While traditional study methods might help you pass an exam, this approach helps build a lasting resource.</p>
<p>💡 <strong>Have you used AI tools for exam prep? Share your thoughts in the comments!</strong></p>
<hr />
<h3 id="additional-resources"><a class="toclink" href="../../../../how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/#additional-resources">🔗 Additional Resources</a></h3>
<ul>
<li><a href="https://github.com/cloudlabmp/AZ-400---MS-Learn---Exam-Notes">My GitHub Repository Link</a></li>
<li><a href="https://learn.microsoft.com/en-us/training/paths/az-400-work-git-for-enterprise-devops/">Microsoft Learn AZ-400 Path</a></li>
<li><a href="https://learn.microsoft.com/en-us/credentials/certifications/devops-engineer/">Official AZ-400 Exam Page</a></li>
<li><a href="https://docs.github.com/">GitHub Documentation</a></li>
<li><a href="https://help.openai.com/">ChatGPT Documentation</a></li>
</ul>
<p><a class="md-button" href="https://x.com/intent/tweet?text=How%20I%20used%20ChatGPT%20to%20create%20AZ-400%20exam%20prep%20notes%20from%20MSLearn%0A&amp;url=https://blog.pollockweb.com/blog/how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/how-i-used-chatgpt-to-create-az-400-exam-prep-notes-from-mslearn/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  <a class="md-pagination__link" href="../../">1</a> <span class="md-pagination__current">2</span> <a class="md-pagination__link" href="../3/">3</a>
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        
  <div class="custom-footer">
    <div class="custom-footer-left">
      <p>Copyright &copy; 2025 Matthew Pollock</p>
    </div>
    <div class="custom-footer-right">
      <a href="https://github.com/cloudlabmp" target="_blank" title="GitHub">
        <i class="fab fa-github"></i>
      </a>
      <a href="https://linkedin.com/in/matthew-pollock-76831920/" target="_blank" title="LinkedIn">
        <i class="fab fa-linkedin"></i>
      </a>
      <a href="https://profile.pollockweb.com" target="_blank" title="profile.pollockweb.com">
        <i class="fas fa-globe"></i>
      </a>
      <a href="https://blog.pollockweb.com/feed_rss_created.xml" target="_blank" title="RSS Feed">
        <i class="fa-solid fa-rss"></i>
      </a>
    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.indexes", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "content.code.select", "content.code.copy", "announce.dismiss"], "search": "../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>