<head>
    <!-- Other head elements -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>

  
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A blog about tech stuff">
      
      
        <meta name="author" content="matt.pollock@outlook.com">
      
      
        <link rel="canonical" href="https://blog.pollockweb.com/blog/archive/2025/">
      
      
        <link rel="prev" href="../../category/windows/">
      
      
        <link rel="next" href="../../../learn/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../assets/icons/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>2025 - cloudlabmp</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-800NGKWBYL"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-800NGKWBYL",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-800NGKWBYL",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="2025 - cloudlabmp" >
      
        <meta  property="og:description"  content="A blog about tech stuff" >
      
        <meta  property="og:image"  content="https://blog.pollockweb.com/assets/images/social/blog/archive/2025.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://blog.pollockweb.com/blog/archive/2025/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="2025 - cloudlabmp" >
      
        <meta  name="twitter:description"  content="A blog about tech stuff" >
      
        <meta  name="twitter:image"  content="https://blog.pollockweb.com/assets/images/social/blog/archive/2025.png" >
      
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-orange" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2025" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
              </button>
            
            
    <div class="announcement-content">
      <p>Welcome to my blog! Connect with me:</p>
      <a href="https://www.linkedin.com/in/matthew-pollock-76831920/" target="_blank" title="LinkedIn">
        <i class="fab fa-linkedin fa-2x"></i>
      </a>
      <a href="https://profile.pollockweb.com" target="_blank" title="profile.pollockweb.com">
        <i class="fas fa-globe fa-2x"></i>
      </a>
      <a href="https://github.com/cloudlabmp" target="_blank" title="GitHub">
        <i class="fab fa-github fa-2x"></i>
      </a>
      <a href="https://blog.pollockweb.com/feed_rss_created.xml" target="_blank" title="RSS Feed">
        <i class="fa-solid fa-rss fa-2x"></i>
      </a>
    </div>
  
          </div>
          
            <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://blog.pollockweb.com/blog/" title="cloudlabmp" class="md-header__button md-logo" aria-label="cloudlabmp" data-md-component="logo">
      
  <img src="../../../assets/icons/logo-48x48.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            cloudlabmp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2025
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-orange" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/cloudlabmp/project-blog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    cloudlabmp/project-blog
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../learn/" class="md-tabs__link">
        
  
    
  
  Learn

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../about/" class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../work/" class="md-tabs__link">
        
  
    
  
  Work

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://blog.pollockweb.com/blog/" title="cloudlabmp" class="md-nav__button md-logo" aria-label="cloudlabmp" data-md-component="logo">
      
  <img src="../../../assets/icons/logo-48x48.png" alt="logo">

    </a>
    cloudlabmp
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cloudlabmp/project-blog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    cloudlabmp/project-blog
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tags
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Posts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Posts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
      
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    2025
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    2025
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant" class="md-nav__link">
    <span class="md-ellipsis">
      📚 From PDF Overload to AI Clarity: Building an AI RAG Assistant
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vibe-coding-my-way-to-ai-connected-infra-claude-terraform-cloud-native-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      🔥 Vibe Coding My Way to AI Connected Infra: Claude, Terraform &amp; Cloud-Native Monitoring
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production" class="md-nav__link">
    <span class="md-ellipsis">
      🍓 Building AI-Powered Infrastructure Monitoring: From Home Lab to Cloud Production
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos" class="md-nav__link">
    <span class="md-ellipsis">
      🤖 First Steps into AI Automation: My Journey from Trial to Self-Hosted Chaos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager" class="md-nav__link">
    <span class="md-ellipsis">
      🔄 Bringing Patch Management In-House: Migrating from MSP to Azure Update Manager
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azure-bcdr-review-turning-inherited-cloud-infrastructure-into-a-resilient-recovery-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      ⚙️ Azure BCDR Review – Turning Inherited Cloud Infrastructure into a Resilient Recovery Strategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azure-bcdr-how-i-turned-a-dr-review-into-a-strategic-recovery-plan" class="md-nav__link">
    <span class="md-ellipsis">
      🧾 Azure BCDR – How I Turned a DR Review into a Strategic Recovery Plan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks" class="md-nav__link">
    <span class="md-ellipsis">
      💰 Saving Azure Costs with Scheduled VM Start/Stop using Custom Azure Automation Runbooks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      ⌚Enforcing Time Zone and DST Compliance on Windows Servers Using GPO and Scheduled Tasks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-uk-regional-settings-on-windows-servers-with-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      ⏲️ Configuring UK Regional Settings on Windows Servers with PowerShell
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/ai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/ai--study-techniques/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AI &amp; Study Techniques
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/ai-integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AI Integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/aws/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/application-insights/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application Insights
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/automation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/azure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/azure-openai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure OpenAI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/bcdr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BCDR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/blogging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blogging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/cicd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI/CD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/career-development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Career Development
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/claude-code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Claude Code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/cloud-architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/cloud-engineering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud Engineering
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/cloud-resume-challenge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud Resume Challenge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Containers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/customization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/devops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DevOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/finops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FinOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/gitops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/group-policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Group Policy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/iis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IIS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/iac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IaC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/identity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Identity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/infrastructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infrastructure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/intune/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intune
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/learning-projects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learning Projects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/life-update/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Life Update
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/microsoft-certifications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Microsoft Certifications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/mkdocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MkDocs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/patch-management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Patch Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/powershell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PowerShell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/projects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Projects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/rag/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RAG
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/regional-settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Regional Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/sql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/scripting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scripting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/self-hosting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Self-Hosting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/serverless/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serverless
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/tech/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tech
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/terraform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terraform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/time-settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/vector-databases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vector Databases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/vibe-coding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vibe Coding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/web-hosting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web Hosting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/windows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../learn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learn
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../work/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Work
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant" class="md-nav__link">
    <span class="md-ellipsis">
      📚 From PDF Overload to AI Clarity: Building an AI RAG Assistant
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vibe-coding-my-way-to-ai-connected-infra-claude-terraform-cloud-native-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      🔥 Vibe Coding My Way to AI Connected Infra: Claude, Terraform &amp; Cloud-Native Monitoring
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production" class="md-nav__link">
    <span class="md-ellipsis">
      🍓 Building AI-Powered Infrastructure Monitoring: From Home Lab to Cloud Production
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos" class="md-nav__link">
    <span class="md-ellipsis">
      🤖 First Steps into AI Automation: My Journey from Trial to Self-Hosted Chaos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager" class="md-nav__link">
    <span class="md-ellipsis">
      🔄 Bringing Patch Management In-House: Migrating from MSP to Azure Update Manager
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azure-bcdr-review-turning-inherited-cloud-infrastructure-into-a-resilient-recovery-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      ⚙️ Azure BCDR Review – Turning Inherited Cloud Infrastructure into a Resilient Recovery Strategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azure-bcdr-how-i-turned-a-dr-review-into-a-strategic-recovery-plan" class="md-nav__link">
    <span class="md-ellipsis">
      🧾 Azure BCDR – How I Turned a DR Review into a Strategic Recovery Plan
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks" class="md-nav__link">
    <span class="md-ellipsis">
      💰 Saving Azure Costs with Scheduled VM Start/Stop using Custom Azure Automation Runbooks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      ⌚Enforcing Time Zone and DST Compliance on Windows Servers Using GPO and Scheduled Tasks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-uk-regional-settings-on-windows-servers-with-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      ⏲️ Configuring UK Regional Settings on Windows Servers with PowerShell
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="2025">2025</h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-08-18 00:00:00+00:00">August 18, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/ai/" class="md-meta__link">AI</a>, 
              <a href="../../category/rag/" class="md-meta__link">RAG</a>, 
              <a href="../../category/projects/" class="md-meta__link">Projects</a>, 
              <a href="../../category/containers/" class="md-meta__link">Containers</a>, 
              <a href="../../category/docker/" class="md-meta__link">Docker</a></li>
        
        
          
          <li class="md-meta__item">
            
              10 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/">📚 From PDF Overload to AI Clarity: Building an AI RAG Assistant</a></h2>
<h3 id="introduction"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#introduction">Introduction</a></h3>
<p>If you’ve ever tried to dig a single obscure fact out of a massive technical manual, you’ll know the frustration 😩: you <em>know</em> it’s in there somewhere, you just can’t remember the exact wording, cmdlet name, or property that will get you there.</p>
<p>For me, this pain point came from <em>Office 365 for IT Pros</em> — a constantly updated, encyclopaedic PDF covering Microsoft cloud administration. It’s a superb resource… but not exactly quick to search when you can’t remember the magic keyword.<br />
Often I know exactly what I want to achieve — say, <em>add copies of sent emails to the sender’s mailbox when using a shared mailbox</em> — but I can’t quite recall the right cmdlet or property to Ctrl+F my way to the answer.</p>
<p>That’s when I thought: what if I could take this PDF (and others in my archive), drop them into a centralised app, and use AI as the conductor and translator 🎼🤖 to retrieve the exact piece of information I need — just by asking naturally in plain English.</p>
<p>This project also doubled as a test bed for <a href="https://claude.ai/">Claude Code</a>, which I’d been using since recently completing a GenAI Bootcamp 🚀.<br />
I wanted to see how it fared when building something from scratch in an IDE, rather than in a chat window.  </p>
<p>👉 In this post, I’ll give a very high level overview of the four iterations (v1–v4) - what worked, what failed, and what I learned along the way.</p>
<hr />
<h3 id="version-comparison-at-a-glance"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#version-comparison-at-a-glance">Version Comparison at a Glance 🗂️</a></h3>
<table>
<thead>
<tr>
<th>Version</th>
<th>Stack / Interface</th>
<th>Vector DB(s)</th>
<th>Outcome</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>v1</strong></td>
<td>Python + Gradio UI</td>
<td><a href="https://www.pinecone.io/">Pinecone</a></td>
<td>Uploaded PDFs fine, but no usable retrieval. Abandoned.</td>
</tr>
<tr>
<td><strong>v2</strong></td>
<td>FastAPI + React (Dockerised)</td>
<td>Pinecone + <a href="https://qdrant.tech/">Qdrant</a></td>
<td>Cleaner setup, partial functionality. Containers failed often.</td>
</tr>
<tr>
<td><strong>v3</strong></td>
<td>Python CLI (dual pipeline: PDF + Markdown)</td>
<td><a href="https://docs.trychroma.com/">ChromaDB</a></td>
<td>More stable retrieval, dropped UI, faster iteration. Still config headaches.</td>
</tr>
<tr>
<td><strong>v4</strong></td>
<td>Enterprise-style CLI</td>
<td>Azure OpenAI + <a href="https://ollama.ai/">Ollama</a>, Chroma</td>
<td>Usable tool: caching, reranking, analytics, model switching. I actually use this daily.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="architecture-evolution-v1-v4"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#architecture-evolution-v1-v4">Architecture Evolution (v1 → v4)</a></h3>
<p><img alt="Architecture Flowchart" src="../../ai-rag-pdf/v4/PDF%20RAG%20Assistant%20v4.jpg" />  </p>
<p>This single diagram captures the arc of the project 🛠️.  </p>
<hr />
<h3 id="version-1-pinecone-rag-test-application"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#version-1-pinecone-rag-test-application">Version 1 – Pinecone RAG Test Application</a></h3>
<p><img alt="Version 1 Screenshot" src="../../ai-rag-pdf/v1/PDF%20RAG%20Assistant%20v1.jpg" /></p>
<p>The first attempt was… short lived 🪦.  </p>
<p>I gave Claude clear instructions, and to its credit, it produced a functional backend and frontend pretty quickly. I uploaded a PDF into <a href="https://www.pinecone.io/">Pinecone</a>, successfully chunked it, and then… nothing.  </p>
<p>This first attempt was a non-starter 🚫.<br />
Despite uploading the PDF successfully to Pinecone, the app was unable to retrieve any usable results for whatever reason. I spent a day troubleshooting before calling it a day and moving on.<br />
I had kind of being following a YouTube tutorial for this project, but even though the tutorial was less than a year old, much of the content didn't map to what I was seeing - especially in the Pinecone UI.<br />
Evidence of how quickly the AI landscape and products are changing I guess.😲</p>
<p>💡 <em>Lesson learned: I should've known the steps I was following in the tutorial were likely to have changed.
  I do afterall work with Microsoft Cloud on a daily basis, where product interfaces seem to change between browser refreshes!</em>😎  </p>
<p>👉 Which led me to v2: if I was going to try again, I wanted a cleaner, containerised architecture from the start.  </p>
<hr />
<h3 id="version-2-it-assistant-fastapi-react"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#version-2-it-assistant-fastapi-react">Version 2 – IT Assistant (FastAPI + React)</a></h3>
<p><img alt="Version 2 Screenshot" src="../../ai-rag-pdf/v2/PDF%20RAG%20Assistant%20v2.jpg" /></p>
<p>For round two, I decided to start cleaner 🧹.  </p>
<p>The first attempt had been a sprawl of Python files, with Claude spinning up new scripts left, right, and centre. So I thought: let’s containerise from the start 🐳.  </p>
<ul>
<li><strong>Stack:</strong> FastAPI backend, Next.js frontend, Dockerised deployment  </li>
<li><strong>Vector Stores:</strong> Pinecone and <a href="https://qdrant.tech/">Qdrant</a>  </li>
<li><strong>Features:</strong> Modular vector store interface, PDF + Markdown parsing, a React chat UI with source display  </li>
</ul>
<p>On paper, it looked solid. In practice: the containers refused to start, health checks failed — meaning the services never even got to the point of talking to each other — and ports (3030, 8000) were dead 💀.  </p>
<p>In short, the project got a bit further in terms of useful results and functionality, but ultimately I parked it and went back to the drawing board.  </p>
<p>💡 <em>Lesson learned: Dockerising from day one helps with clean deployments, but only if the containers actually run.</em>  </p>
<p>By this point, I genuinely wondered if I was wasting my time and that I might be missing some huge bit of fundamental knowledge that was grounding the project before it had started 🫠.<br />
Still, I knew I wanted to strip things back and simplify.<br />
So, before ordering a copy of <em>"The Big Book of AI: Seniors Edition"</em> off of Amazon, I thought I would try a different tack.</p>
<p>👉 Which led directly to v3: drop the UI, keep it lean, focus on retrieval.</p>
<hr />
<h3 id="version-3-rag-agent-dual-pipeline-cli"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#version-3-rag-agent-dual-pipeline-cli">Version 3 – RAG Agent (Dual-Pipeline, CLI)</a></h3>
<p><img alt="Version 3 Screenshot" src="../../ai-rag-pdf/v3/PDF%20RAG%20Assistant%20v3.jpg" /></p>
<p>By this point, I realised the frontend was becoming a distraction 🎭. I’d spent too long wrestling with UX issues, which were getting in the way of the real meat and potatoes of the project — so I ditched the UI and went full CLI.  </p>
<ul>
<li><strong>Stack:</strong> Python CLI, dual pipelines for PDF + Markdown  </li>
<li><strong>Vector Store:</strong> <a href="https://docs.trychroma.com/">ChromaDB</a>  </li>
<li><strong>Features:</strong> PDF-to-Markdown converter, deduplication, metadata enrichment, batch processing, incremental updates, output logging, rich terminal formatting  </li>
</ul>
<p>Chroma proved more successful than Pinecone, and the CLI gave me a faster dev loop ⚡.<br />
But misaligned environment variables and Azure credential mismatches caused repeated headaches 🤯.</p>
<p>💡 <em>Lesson learned: simplifying the interface let me focus on the retrieval logic — but configuration discipline was just as important. During issue debugging Claude will spin up numerous different python files to fix the issue(s) at hand. I had to remember to get Claude to roll the fixes into the new container builds each time, to ensure the project structure stayed clean and tidy</em></p>
<p>At this stage, I had a functioning app, but the results of retrival were pretty poor, and the functionality was lacking.</p>
<p>👉 Which led naturally into v4: keep the CLI, tune the retriaval process, and add the features that would make the app useable.</p>
<hr />
<h3 id="version-4-pdf-rag-assistant-v20-enterprise"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#version-4-pdf-rag-assistant-v20-enterprise">Version 4 – PDF RAG Assistant v2.0 Enterprise</a></h3>
<p><img alt="Version 4 Screenshot" src="../../ai-rag-pdf/v4/PDF%20RAG%20Assistant%20v4.jpg" />
After three rewrites, I finally had something that looked and felt like a useable tool 🎉.</p>
<p>This is the version I still use today 🎉. It wasn’t a quick win: v4 took a long time to fettle into shape with many hours of trying different things to improve the results, testing, re-testing, and testing again 🔄.  </p>
<p>The app is in pretty good shape now, with some good features added along the way. Most importantly, the results returned via query are good enough for me to use ✅.
Don’t get me wrong, the “final” version of the app (for now) is pretty usable — but I don’t think I’ll be troubling any AI startup finance backers any time soon 💸🙃.  </p>
<hr />
<h4 id="the-guided-tour-v4-screenshots"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#the-guided-tour-v4-screenshots">The Guided Tour (v4 Screenshots)</a></h4>
<h5 id="1-startup-menu"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#1-startup-menu">1. Startup &amp; Menu</a></h5>
<p><img alt="v4 Menu" src="../../ai-rag-pdf/v4/v4-menu-commands.png" /><br />
<em>Finally felt like a tool instead of just another Python script 🛠️.</em></p>
<h5 id="2-query-processing-pipeline"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#2-query-processing-pipeline">2. Query Processing Pipeline</a></h5>
<p><img alt="v4 Pipeline" src="../../ai-rag-pdf/v4/v4-query-processing-pipeline.png" /><br />
<em>For the first time, everything was working together instead of fighting me ⚔️.</em></p>
<h5 id="3a-model-switching-azure"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#3a-model-switching-azure">3a. Model Switching – Azure</a></h5>
<p><img alt="v4 Model Switch 1" src="../../ai-rag-pdf/v4/v4-model-switching-interface-1.png" /><br />
<em>Azure OpenAI was quicker ⚡ and free with my Dev subscription.</em>  </p>
<h5 id="3b-model-switching-ollama"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#3b-model-switching-ollama">3b. Model Switching – Ollama</a></h5>
<p><img alt="v4 Model Switch 2" src="../../ai-rag-pdf/v4/v4-model-switching-interface-2.png" /><br />
<em><a href="https://ollama.ai/">Ollama</a> gave me a safety net offline 🌐, even if slower.</em>  </p>
<h5 id="4-start-page-status"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#4-start-page-status">4. Start Page &amp; Status</a></h5>
<p><img alt="v4 Start Page" src="../../ai-rag-pdf/v4/v4-pdf-rag-start-page.png" /><br />
<em>Reassuring after so many broken starts — just seeing a healthy status page felt like progress.</em> 😅</p>
<h5 id="5a-query-results-simple"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#5a-query-results-simple">5a. Query Results – Simple</a></h5>
<p><img alt="v4 Simple Response" src="../../ai-rag-pdf/v4/v4-simple-rag-response.png" />  </p>
<h5 id="5b-query-results-detailed"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#5b-query-results-detailed">5b. Query Results – Detailed</a></h5>
<p><img alt="v4 Detailed Response" src="../../ai-rag-pdf/v4/v4-detailed-rag-response.png" /><br />
<em>Detailed mode felt like the first time the assistant could teach me back, not just parrot text.</em> 📖</p>
<h5 id="6-response-quality-reports"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#6-response-quality-reports">6. Response Quality Reports</a></h5>
<p><img alt="v4 Quality Report" src="../../ai-rag-pdf/v4/v4-response-quality-report.png" /><br />
<em>Handy both as a sanity check ✅ and as a reminder that it’s not perfect — but at least it knows it.</em> 🤷</p>
<h5 id="7-query-history"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#7-query-history">7. Query History</a></h5>
<p><img alt="v4 History" src="../../ai-rag-pdf/v4/v4-query-history.png" /><br />
<em>At this point, it wasn’t just answering questions — it was helping me build knowledge over time.</em> 📚</p>
<hr />
<h4 id="what-made-v4-different"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#what-made-v4-different">What Made v4 Different</a></h4>
<p>Here’s what finally tipped the balance from “prototype” to “usable assistant”:  </p>
<ul>
<li><strong>Semantic caching 🧠</strong> – the assistant remembers previous queries and responses, so it doesn’t waste time (or tokens) re-answering the same thing.  </li>
<li><strong>ColBERT reranking 🎯</strong> – instead of trusting the first vector search result, ColBERT reorders the results by semantic similarity, surfacing the most relevant chunks.  </li>
<li><strong>Analytics 📊</strong> – lightweight stats on query quality and hit rates. Not a dashboard, more like reassurance that the retrieval pipeline is behaving.  </li>
<li><strong>Dynamic model control 🔀</strong> – being able to switch between <a href="https://azure.microsoft.com/en-us/products/ai-services/openai-service">Azure OpenAI</a> (fast, cloud-based) and Ollama (slow, local fallback) directly in the CLI.  </li>
</ul>
<p>💡 <em>Lesson learned: retrieval accuracy isn’t just about the database — caching, reranking, and model flexibility all compound to make the experience better.</em>  </p>
<hr />
<h3 id="losing-my-rag-pun-intended"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#losing-my-rag-pun-intended">Losing my RAG 🧵 (Pun Intended)</a></h3>
<p>There were definitely points where frustration levels were high enough to make me question why I’d even started  — four rewrites will do that to you. Pinecone that wouldn’t retrieve, Docker containers that wouldn’t start, environment variables that wouldn’t line up.  </p>
<p>Each dead end was frustrating in the moment, but in hindsight, as we all know, the failures are where the learning is. Every wrong turn taught me something that made the next version a little better.  </p>
<hr />
<h3 id="experimentation-debugging"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#experimentation-debugging">Experimentation &amp; Debugging</a></h3>
<ul>
<li><strong>Pinecone:</strong> I created two or three different DBs and successfully chunked the data each time. But v1 and v2 couldn’t pull anything useful back out 🪫.  </li>
<li><strong>Azure:</strong> The only real issue was needing a fairly low chunk size (256) to avoid breaching my usage quota ⚖️.  </li>
<li><strong>Iteration habit:</strong> If I hit a roadblock with Claude Code that seemed to be taking me further away from the goal, I’d pause ⏸️, step away 🚶, then revisit 🔄. Sometimes it was worth troubleshooting; other times it was better to start fresh.  </li>
</ul>
<hr />
<h3 id="lessons-learned"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#lessons-learned">Lessons Learned</a></h3>
<p>💡 Start with a CLI before adding a UI — it keeps you focused on retrieval.<br />
💡 Always check embedding/vector dimensions for compatibility.<br />
💡 Dockerising helps with clean deployments, but rebuilds can be brittle.<br />
💡 Small chunk sizes often work better with Azure OpenAI quotas.<br />
💡 RAG accuracy depends on multiple layers — not just the vector DB.  </p>
<hr />
<h3 id="if-i-were-starting-again"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#if-i-were-starting-again">If I Were Starting Again</a></h3>
<p>With hindsight, I’d probably:  </p>
<ul>
<li>Begin directly with <a href="https://docs.trychroma.com/">ChromaDB</a> instead of Pinecone.  </li>
<li>Skip the frontend until retrieval was nailed down.  </li>
<li>Spend more time upfront on embedding/vector compatibility.  </li>
<li>Put more time into researching retrievability improvements.  </li>
</ul>
<hr />
<h3 id="whats-next-v5"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#whats-next-v5">What’s Next (v5?)</a></h3>
<p>Future directions might include:  </p>
<ul>
<li>🧪 <strong>Testing new embedding models and vector DBs</strong> – different models could improve retrieval precision, especially for domain-specific PDFs.  </li>
<li>🎯 <strong>Improving pinpoint retrieval accuracy</strong> – because even in v4, it sometimes still “gets close” rather than “spot on.”  </li>
<li>💬 <strong>MCP Server integration</strong> – so the app can query multiple data sources, not just local files.  </li>
<li>📊 <strong>Adding Guardrails</strong> – edging it closer toward an enterprise-ready assistant.  </li>
</ul>
<p>If I can improve the results in v4 or with v5, then that would be a real win 🏆.  </p>
<hr />
<h3 id="things-i-liked-about-claude-code"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#things-i-liked-about-claude-code">Things I Liked About Claude Code 🖥️</a></h3>
<p>One of the constants across the project was working inside <a href="https://claude.ai/">Claude Code</a>, and there were some things I really liked about the experience:  </p>
<ul>
<li>✅ <strong>Automatic chat compaction</strong> – no endless scrolling or need to copy/paste old snippets  </li>
<li>🗂️ <strong>Chat history</strong> – the ability to pick up where I left off in a previous session  </li>
<li>🔢 <strong>On-screen token counter</strong> – knowing exactly how much context I was burning through  </li>
<li>👀 <strong>Realtime query view</strong> – watching Claude process step-by-step, with expand/collapse options for analysis  </li>
</ul>
<p>Compared to a browser-based UI, these felt like small but meaningful quality-of-life upgrades. For a coding-heavy project, those workflow improvements really mattered.  </p>
<hr />
<h3 id="final-thoughts"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#final-thoughts">Final Thoughts</a></h3>
<p>This project started with the frustration of not being able to remember which cmdlet to search for in a 1,000-page PDF 😤. Four rewrites later, I have a tool that can answer those questions directly.  </p>
<p>It’s far from perfect. There are limitations to how well the data can be processed and subsequently how accurately it can be retrieved — at least with the models and resources I used ⚖️. But it’s functional enough that I actually use it — which is more than I could say for versions one through three.  </p>
<p>Overall, though, this wasn’t just about the app. It was about getting hands-on with a code editor in the terminal and IDE, instead of being stuck in a chat-based UI 💻. In that regard, the project goal was achieved. Using Claude Code (other CLI-based AI assistants are available 😎) was a much better experience for a coding-heavy project.  </p>
<p>I did briefly try OpenAI’s Codex at the very start, just to see which editor I preferred. It didn’t take long to see that Codex didn’t really have the chops ❌. Claude felt sharper, more capable ✨, and it became clear why it has the reputation as the current CLI editor sweetheart 💖 — while Codex has barely made a ripple 🌊.  </p>
<hr />
<h3 id="reader-takeaway"><a class="toclink" href="../../from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/#reader-takeaway">Reader Takeaway 📦</a></h3>
<p>If you’re thinking about building your own RAG assistant:  </p>
<ul>
<li>Expect dead ends — each failed attempt will teach you something.  </li>
<li>Keep it simple early (CLI + local DB) before adding shiny extras.  </li>
<li>Focus on retrieval quality, not just the vector DB.  </li>
<li>Treat AI assistants as copilots, not magicians.  </li>
</ul>
<p>At the end of the day, my assistant works well enough for me (for now) — and that was the whole point.  </p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=From%20PDF%20Overload%20to%20AI%20Clarity%3A%20Building%20an%20AI%20RAG%20Assistant%0A&amp;url=https://blog.pollockweb.com/blog/from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/from-pdf-overload-to-ai-clarity-building-an-ai-rag-assistant/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-07-18 00:00:00+00:00">July 18, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/infrastructure/" class="md-meta__link">Infrastructure</a>, 
              <a href="../../category/ai-integration/" class="md-meta__link">AI Integration</a>, 
              <a href="../../category/cloud-engineering/" class="md-meta__link">Cloud Engineering</a>, 
              <a href="../../category/learning-projects/" class="md-meta__link">Learning Projects</a></li>
        
        
          
          <li class="md-meta__item">
            
              22 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="vibe-coding-my-way-to-ai-connected-infra-claude-terraform-cloud-native-monitoring"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/">🔥 Vibe Coding My Way to AI Connected Infra: Claude, Terraform &amp; Cloud-Native Monitoring</a></h2>
<h3 id="tldr-what-this-post-covers"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#tldr-what-this-post-covers">📖 TL;DR – What This Post Covers</a></h3>
<ul>
<li>How I used AI tools to build an Azure-based monitoring solution from scratch  </li>
<li>Lessons learned from developing two full versions (manual vs. Terraform)  </li>
<li>The good, bad, and wandering of GenAI for infrastructure engineers  </li>
<li>A working, cost-effective, and fully redeployable AI monitoring stack</li>
</ul>
<h3 id="introduction"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#introduction">Introduction</a></h3>
<p>This project began, as many of mine do, with a career planning conversation. During a discussion with ChatGPT about professional development and emerging skill areas for 2025, one suggestion stuck with me:</p>
<blockquote>
<p>"You should become an Infrastructure AI Integration Engineer."</p>
</blockquote>
<p>It’s a role that doesn’t really exist yet — but probably should.</p>
<p>What followed was a journey to explore whether such a role could be real. I set out to build an AI-powered infrastructure monitoring solution in Azure, without any formal development background and using nothing but conversations with Claude. This wasn’t just about building something cool — it was about testing whether a seasoned infra engineer could:</p>
<ul>
<li>Use GenAI to design and deploy a full solution</li>
<li>Embrace the unknown and lean into the chaos of LLM-based workflows</li>
<li>Create something reusable, repeatable, and useful</li>
</ul>
<p>The first phase of the journey was a local prototype using my Pi5 and n8n for AI workflow automation (see my previous post for that). It worked — but it was local, limited, and not exactly enterprise-ready.</p>
<p>So began the cloud migration.</p>
<h4 id="why-this-project-mattered"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#why-this-project-mattered">Why this project mattered</a></h4>
<p>I had two goals:</p>
<ul>
<li>✅ Prove that “vibe coding” — using GenAI with limited pre-planning — could produce something deployable</li>
<li>✅ Build a portfolio project for the emerging intersection of AI and infrastructure engineering</li>
</ul>
<p>This isn’t a tutorial on AI monitoring. Instead, it’s a behind-the-scenes look at what happens when you try to:</p>
<ul>
<li>Build something real using AI chat alone</li>
<li>Translate a messy, manual deployment into clean Infrastructure as Code</li>
<li>Learn <em>with</em> the AI, not just from it</li>
</ul>
<p>The Terraform modules prove it works.<br />
The chat logs show how we got there.<br />
The dashboard screenshots demonstrate the outcome.</p>
<blockquote>
<p><em>The next sections cover the journey in two parts: first, the vibe-coded v1; then the Terraform-powered refactor in v2.</em></p>
</blockquote>
<hr />
<h3 id="table-of-contents"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#table-of-contents">📚 Table of Contents</a></h3>
<ul>
<li><a href="../../vibe-coding-my-way-to-ai-infra/#introduction">Introduction</a></li>
<li><a href="../../vibe-coding-my-way-to-ai-infra/#table-of-contents">📚 Table of Contents</a></li>
<li><a href="../../vibe-coding-my-way-to-ai-infra/#part-1-the-prototype">Part 1: The Prototype</a></li>
<li><a href="../../vibe-coding-my-way-to-ai-infra/#version-1-the-manual-deployment-marathon">Version 1: The Manual Deployment Marathon</a></li>
<li><a href="../../vibe-coding-my-way-to-ai-infra/#platform-and-genai-choices">Platform and GenAI Choices</a></li>
<li><a href="../../vibe-coding-my-way-to-ai-infra/#phase-1-foundation">🧱 Phase 1: Foundation</a></li>
<li><a href="../../vibe-coding-my-way-to-ai-infra/#phase-2-intelligence-layer">🧠 Phase 2: Intelligence Layer</a></li>
<li><a href="../../vibe-coding-my-way-to-ai-infra/#phase-3-the-user-experience">🎨 Phase 3: The User Experience</a></li>
<li><a href="../../vibe-coding-my-way-to-ai-infra/#part-2-why-terraform-why-now">🌍 Part 2: Why Terraform? Why Now?</a></li>
<li><a href="../../vibe-coding-my-way-to-ai-infra/#part-3-working-with-genai-the-good-the-bad-and-the-wandering">🧠 Part 3: Working with GenAI – The Good, the Bad, and the Wandering</a></li>
<li><a href="../../vibe-coding-my-way-to-ai-infra/#part-4-building-the-stack-what-got-built">🏗️ Part 4: Building the Stack – What Got Built</a></li>
<li><a href="../../vibe-coding-my-way-to-ai-infra/#part-5-the-result-a-portable-reusable-ai-monitoring-stack">🧾 Part 5: The Result - A Portable, Reusable AI Monitoring Stack</a></li>
<li><a href="../../vibe-coding-my-way-to-ai-infra/#part-6-reflections-and-lessons-learned">🧠 Part 6: Reflections and Lessons Learned</a></li>
<li><a href="../../vibe-coding-my-way-to-ai-infra/#conclusion">✅ Conclusion</a></li>
</ul>
<h3 id="part-1-the-prototype"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#part-1-the-prototype">Part 1: The Prototype</a></h3>
<p><em>(Stage 1 – Manual AI-Assisted Deployment)</em> The Birth of a Vibe-Coded Project</p>
<p>The project didn’t start with a business requirement — it started with curiosity. One evening, mid-career reflection turned into a late-night conversation with ChatGPT:</p>
<blockquote>
<p>"You should become an Infrastructure AI Integration Engineer."</p>
</blockquote>
<p>I’d never heard the term, but it sparked something. With 20+ years in IT infrastructure and the growing presence of AI in tooling, it felt like a direction worth exploring.</p>
<h4 id="the-thought-experiment"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#the-thought-experiment">The Thought Experiment</a></h4>
<p>Could I — an infrastructure engineer, not a dev — build an AI-driven cloud monitoring solution:</p>
<ul>
<li>End-to-end, using only AI assistance</li>
<li>Without dictating the architecture</li>
<li>With minimal manual planning</li>
</ul>
<p>The rules were simple:</p>
<ul>
<li>❌ No specifying what resources to use</li>
<li>❌ No formal design documents</li>
<li>✅ Just tell the AI the <em>outcome</em> I wanted, and let it choose the path</li>
</ul>
<p>The result: pure "vibe coding." Or as I now call it: <strong>AI Slop-Ops</strong>.</p>
<h4 id="what-is-vibe-coding-aka-slop-ops"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#what-is-vibe-coding-aka-slop-ops">What is Vibe Coding (a.k.a. Slop-Ops)?</a></h4>
<p>For this project, "vibe coding" meant:</p>
<ul>
<li>🤖 Generating all infrastructure and app code using natural language prompts</li>
<li>🧠 Letting Claude decide how to structure everything</li>
<li>🪵 Learning through experimentation and iteration</li>
</ul>
<blockquote>
<p>My starting prompt was something like:<br />
<em>"I want to build an AI monitoring solution in Azure that uses Azure OpenAI to analyze infrastructure metrics."</em></p>
</blockquote>
<p>Claude replied:</p>
<blockquote>
<p>"Let’s start with a simple architecture: Azure Container Apps for the frontend, Azure Functions for the AI processing, and Azure OpenAI for the intelligence. We'll build it in phases."</p>
</blockquote>
<p>That one sentence kicked off a 4–5 week journey involving:</p>
<ul>
<li>~40–50 hours of evening and weekend effort 🧵</li>
<li>Dozens of chats, scripts, and browser tabs</li>
<li>An unpredictable mix of brilliance and bafflement</li>
</ul>
<p>And the whole thing started to work.</p>
<hr />
<h3 id="version-1-the-manual-deployment-marathon"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#version-1-the-manual-deployment-marathon">Version 1: The Manual Deployment Marathon</a></h3>
<p>The first build was fully manual — a mix of PowerShell scripts, Azure portal clicks, and Claude-prompting marathons. Claude suggested a phased approach, which turned out to be the only way to keep it manageable.</p>
<p>💬 <em>Claude liked PowerShell. I honestly can’t remember if that was my idea or if I just went along with it.</em> 🤷‍♂️</p>
<hr />
<h3 id="platform-and-genai-choices"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#platform-and-genai-choices">Platform and GenAI Choices</a></h3>
<h4 id="why-azure"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#why-azure">🌐 Why Azure?</a></h4>
<p>The platform decision was pragmatic:</p>
<ul>
<li>I already had a <a href="https://learn.microsoft.com/en-us/visualstudio/subscriptions/">Visual Studio Developer Subscription</a> with £120/month of Azure credits.</li>
<li>Azure is the cloud provider I work with day-to-day, so it made sense to double down.</li>
<li>Using Azure OpenAI gave me hands-on experience with <strong>Azure AI Foundry</strong> – increasingly relevant in modern infrastructure roles.</li>
</ul>
<p>In short: low cost, high familiarity, and useful upskilling.</p>
<hr />
<h4 id="why-claude"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#why-claude">🧠 Why Claude?</a></h4>
<p>This project was built almost entirely through chat with <strong>Claude</strong>, Anthropic’s conversational AI. I’ve found:</p>
<p>✅ <strong>Claude is better at structured technical responses</strong>, particularly with IaC and shell scripting.<br />
❌ <strong>ChatGPT tends to hallucinate more often</strong> in my experience when writing infrastructure code.</p>
<p>But Claude had its own quirks too:</p>
<ul>
<li>No memory between chats — every session required reloading context.</li>
<li>Occasional focus issues — drifting from task or overcomplicating simple requests.</li>
<li>Tendency to suggest hardcoded values when debugging — needing constant vigilance to maintain DRY principles.</li>
</ul>
<blockquote>
<p>⚠️ Reality check: Claude isn't a Terraform expert. It's a language model that <em>guesses well</em> based on input. The human still needs to guide architecture, validate outputs, and ensure everything actually works.</p>
</blockquote>
<hr />
<h4 id="prompt-engineering-principles"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#prompt-engineering-principles">🤖 Prompt Engineering Principles</a></h4>
<p>I used a consistent framework to keep Claude focused and productive:</p>
<ul>
<li><strong>ROLE</strong>: Define Claude's purpose (e.g., “You are a Terraform expert”)</li>
<li><strong>INPUT</strong>: What files or context is provided</li>
<li><strong>OUTPUT</strong>: What should Claude return (e.g., a module, refactored block, explanation)</li>
<li><strong>CONSTRAINTS</strong>: e.g., “No hardcoded values”, “Use locals not repeated variables”</li>
<li><strong>TASK</strong>: Specific action or generation requested</li>
<li><strong>REMINDERS</strong>: Extra nudges — “Use comments”, “Output in markdown”, “Use Azure CLI not PowerShell”</li>
</ul>
<blockquote>
<p>This approach reduced misunderstandings and helped prevent “solution drift” during long iterative sessions.</p>
</blockquote>
<hr />
<h3 id="phase-1-foundation"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#phase-1-foundation">🧱 Phase 1: Foundation</a></h3>
<p>This first phase set up the core infrastructure that everything else would build upon.</p>
<h4 id="what-got-built"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#what-got-built">🔧 What Got Built</a></h4>
<ul>
<li><strong>Resource Groups</strong> – Logical container for resources  </li>
<li><strong>Storage Accounts</strong> – Persistent storage for logs, state, and AI interaction data  </li>
<li><strong>Log Analytics Workspace</strong> – Centralized logging for observability  </li>
<li><strong>Application Insights</strong> – Telemetry and performance monitoring for apps</li>
</ul>
<p>These services created the backbone of the environment, enabling both operational and analytical insight.</p>
<hr />
<h4 id="powershell-verification-script"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#powershell-verification-script">🖥️ PowerShell Verification Script</a></h4>
<p>This example script was used during v1 to manually verify deployment success:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c"># Verify everything is working</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nb">Write-Host</span> <span class="s2">&quot;🔍 Verifying Step 1.1 completion...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="c"># Check resource group</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="nv">$rg</span> <span class="p">=</span> <span class="nb">Get-AzResourceGroup</span> <span class="n">-Name</span> <span class="s2">&quot;rg-ai-monitoring-dev&quot;</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$rg</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;✅ Resource Group exists&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;❌ Resource Group not found&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="p">}</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="c"># Check workspace</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="nv">$ws</span> <span class="p">=</span> <span class="nb">Get-AzOperationalInsightsWorkspace</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;rg-ai-monitoring-dev&quot;</span> <span class="n">-Name</span> <span class="s2">&quot;law-ai-monitoring-dev&quot;</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$ws</span> <span class="o">-and</span> <span class="nv">$ws</span><span class="p">.</span><span class="n">ProvisioningState</span> <span class="o">-eq</span> <span class="s2">&quot;Succeeded&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;✅ Log Analytics Workspace is ready&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;❌ Log Analytics Workspace not ready. State: </span><span class="p">$(</span><span class="nv">$ws</span><span class="p">.</span><span class="n">ProvisioningState</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="p">}</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="c"># Check config file</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="k">if</span> <span class="p">(</span><span class="nb">Test-Path</span> <span class="s2">&quot;.\phase1-step1-config.json&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;✅ Configuration file created&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;❌ Configuration file missing&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="phase-2-intelligence-layer"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#phase-2-intelligence-layer">🧠 Phase 2: Intelligence Layer</a></h3>
<p>With the foundation in place, the next step was to add the brainpower — the AI and automation components that turn infrastructure data into actionable insights.</p>
<h4 id="key-components"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#key-components">🧩 Key Components</a></h4>
<ul>
<li><strong>Azure OpenAI Service</strong></li>
<li>Deployed with <code>gpt-4o-mini</code> to balance cost and performance</li>
<li>
<p>Powers the natural language analysis and recommendation engine</p>
</li>
<li>
<p><strong>Azure Function App</strong></p>
</li>
<li>Hosts the core AI processing logic</li>
<li>Parses data from monitoring tools and feeds it to OpenAI</li>
<li>
<p>Returns interpreted insights in a format suitable for dashboards and alerts</p>
</li>
<li>
<p><strong>Logic Apps</strong></p>
</li>
<li>Automates data ingestion and flow between services</li>
<li>Orchestrates the processing of logs, telemetry, and alert conditions</li>
<li>Acts as glue between Function Apps, OpenAI, and supporting services</li>
</ul>
<hr />
<h4 id="ai-integration-philosophy"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#ai-integration-philosophy">🗣️ AI Integration Philosophy</a></h4>
<p>This stage wasn’t about building complex AI logic — it was about using OpenAI to interpret patterns in infrastructure data and return intelligent summaries or recommendations in natural language.</p>
<blockquote>
<p>Example prompt fed to OpenAI from within a Function App:</p>
<p>“Based on this log stream, are there any signs of service degradation or performance issues in the last 15 minutes?”</p>
</blockquote>
<p>The response would be embedded in a monitoring dashboard or sent via alert workflows, giving human-readable insights without manual interpretation.</p>
<hr />
<h4 id="why-this-setup"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#why-this-setup">⚙️ Why This Setup?</a></h4>
<p>Each component in this layer was chosen for a specific reason:</p>
<ul>
<li><strong>OpenAI</strong> for flexible, contextual intelligence  </li>
<li><strong>Function Apps</strong> for scalable, event-driven execution  </li>
<li><strong>Logic Apps</strong> for orchestration without writing custom backend code  </li>
</ul>
<p>This approach removed the need for always-on VMs or bespoke integrations — and kept things lean.</p>
<hr />
<p>📌 <em>By the end of Phase 2, the system had a functioning AI backend that could interpret infrastructure metrics in plain English and respond in near real-time.</em></p>
<h3 id="phase-3-the-user-experience"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#phase-3-the-user-experience">🎨 Phase 3: The User Experience</a></h3>
<p>With the core infrastructure and AI processing in place, it was time to build the frontend — the visible interface for users to interact with the AI-powered monitoring system.</p>
<p>This phase focused on deploying a set of containerized applications, each responsible for a specific role in the monitoring workflow.</p>
<hr />
<h4 id="components-deployed"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#components-deployed">🧱 Components Deployed</a></h4>
<p>The solution was built around <strong>Azure Container Apps</strong>, with a four-container ecosystem designed to work in harmony:</p>
<ul>
<li>
<p><strong>FastAPI Backend</strong><br />
  Handles API requests, routes data to the correct services, and acts as the core orchestrator behind the scenes.</p>
</li>
<li>
<p><strong>React Dashboard</strong><br />
  A clean, responsive frontend displaying infrastructure metrics, system health, and AI-generated insights.</p>
</li>
<li>
<p><strong>Background Processor</strong><br />
  Continuously monitors incoming data and triggers AI evaluations when certain thresholds or patterns are detected.</p>
</li>
<li>
<p><strong>Load Generator</strong><br />
  Provides synthetic traffic and test metrics to simulate real usage patterns and help validate system behavior.</p>
</li>
</ul>
<hr />
<h4 id="why-this-architecture"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#why-this-architecture">🔄 Why This Architecture?</a></h4>
<p>Each container serves a focused purpose, allowing for:</p>
<ul>
<li><strong>Isolation of concerns</strong> — easier debugging and development</li>
<li><strong>Scalable deployment</strong> — each component scales independently</li>
<li><strong>Separation of UI and logic</strong> — keeping the AI and logic layers decoupled from the frontend</li>
</ul>
<blockquote>
<p>“Claude recommended this separation early on — the decision to use Container Apps instead of AKS or App Services kept costs down and complexity low, while still providing a modern cloud-native experience.”</p>
</blockquote>
<hr />
<h4 id="deployment-highlights"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#deployment-highlights">⚙️ Deployment Highlights</a></h4>
<p>Container Apps were provisioned via CLI in the manual version, and later through Terraform in v2. The deployment process involved:</p>
<ul>
<li>Registering a <strong>Container Apps Environment</strong></li>
<li>Creating the four separate app containers</li>
<li>Passing environment variables for API endpoints, keys, and settings</li>
<li>Enabling diagnostics and logging via Application Insights</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>az<span class="w"> </span>containerapp<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span>--name<span class="w"> </span>react-dashboard<span class="w"> </span><span class="se">\</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span>--image<span class="w"> </span>myregistry.azurecr.io/dashboard:latest<span class="w"> </span><span class="se">\</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span>--env-vars<span class="w"> </span><span class="nv">REACT_APP_API_URL</span><span class="o">=</span>https://api.example.com
</span></code></pre></div>
<h4 id="final-result"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#final-result">📊 Final Result</a></h4>
<p>Once deployed, the user-facing layer provided:</p>
<ul>
<li>🔍 <strong>Real-time visual metrics</strong></li>
<li>💡 <strong>AI-generated recommendations</strong></li>
<li>🧠 <strong>Interactive analysis via chat</strong></li>
<li>📈 <strong>Infrastructure performance summaries</strong></li>
<li>💬 <strong>Stakeholder-friendly reporting</strong></li>
</ul>
<p>This phase brought the system to life — from backend AI logic to a polished, interactive dashboard.</p>
<h4 id="the-reality-of-ai-assisted-development"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#the-reality-of-ai-assisted-development">🤖 The Reality of AI-Assisted Development</a></h4>
<p>Here's what the success story doesn’t capture: the relentless battles with Claude’s limitations.</p>
<p>Despite its capabilities, working with GenAI in a complex, multi-phase project revealed real friction points — especially when continuity and context were critical.</p>
<h5 id="daily-frustrations-included"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#daily-frustrations-included">😫 Daily Frustrations Included</a></h5>
<ul>
<li>🧱 <strong>Hitting chat length limits daily</strong> — even with Claude Pro</li>
<li>🧭 <strong>AI meandering off-topic</strong>, despite carefully structured prompts</li>
<li>📚 <strong>Over-analysis</strong> — asking for one thing and receiving a detailed architectural breakdown</li>
<li>⚙️ <strong>Token burn during troubleshooting</strong> — Claude often provided five-step fixes when a one-liner was needed</li>
<li>❌ <strong>No persistent memory or project history</strong></li>
<li>This meant manually copy/pasting prior chats into a <code>.txt</code> file just to refeed them back in</li>
<li>🔁 <strong>Starting new chats daily</strong> — and re-establishing context from scratch every time</li>
<li>📏 <strong>Scope creep</strong> — Claude regularly expanded simple requests into full architectural reviews without being asked</li>
</ul>
<p>Despite these pain points, the experience was still a net positive — but only because I was prepared to steer the conversation firmly and frequently.
<img alt="Chat length limit warning" src="../../terraform-ai-monitoring/Claude_ChatLengthLImit.png" /></p>
<h5 id="from-real-world-troubleshooting"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#from-real-world-troubleshooting">🧪 From Real-World Troubleshooting</a></h5>
<p>Sometimes, working with Claude felt like pair programming with a colleague who had perfect recall — until they completely wiped their memory overnight.</p>
<blockquote>
<p>🧵 <strong>From an actual troubleshooting session:</strong></p>
<p>“The dashboard is calling the wrong function URL again.<br />
It’s trying to reach <code>func-tf-ai-monitoring-dev-ai</code>,<br />
but the actual function is at <code>func-ai-monitoring-dev-ask6868-ai</code>.”</p>
</blockquote>
<p>It was a recurring theme: great memory during a session, zero continuity the next day.</p>
<blockquote>
<p><strong>Me:</strong> “Right, shall we pick up where we left off yesterday then?”<br />
<strong>Claude:</strong> “I literally have no idea what you're talking about, mate.”<br />
<strong>Claude:</strong> “Wait, who are you again?”</p>
</blockquote>
<p>Every failure taught <em>both</em> me and Claude something — but the learning curve was steep, and the iteration cycles could be genuinely exhausting.</p>
<h4 id="version-1-deployed-working"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#version-1-deployed-working">Version 1 - Deployed &amp; Working</a></h4>
<p><img alt="AI Monitoring Dashboard V1" src="../../terraform-ai-monitoring/AIMonitoringDashboardV1.png" /></p>
<h4 id="what-i-learned-from-part-1"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#what-i-learned-from-part-1">🧠 What I Learned from Part 1</a></h4>
<p>Reflecting on the first phase of this project — the manual, vibe-coded deployment — several key takeaways emerged.</p>
<h5 id="what-worked-well"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#what-worked-well">✅ What Worked Well</a></h5>
<ul>
<li>⚡ <strong>Rapid prototyping</strong> — quickly turned ideas into functioning infrastructure</li>
<li>💬 <strong>Natural language problem-solving</strong> — great for tackling Azure’s complex service interactions</li>
<li>🧾 <strong>Syntactically sound code generation</strong> — most outputs worked with minimal tweaks</li>
<li>⏱️ <strong>Massive time savings</strong> — tasks that might take days manually were completed in hours</li>
</ul>
<h5 id="what-needed-constant-oversight"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#what-needed-constant-oversight">🔍 What Needed Constant Oversight</a></h5>
<ul>
<li>🧠 <strong>Keeping the AI focused</strong> — drift and distraction were constant threats</li>
<li>🔗 <strong>Managing dependencies and naming</strong> — conflicts and collisions needed manual intervention</li>
<li>🐛 <strong>Debugging runtime issues</strong> — particularly frustrating when errors only manifested in Azure</li>
<li>🧭 <strong>Architectural decisions</strong> — strategic direction still had to come from me</li>
<li>⚠️ <strong>Knowing when “it works” wasn’t “production-ready”</strong> — validation remained a human job</li>
</ul>
<h5 id="language-tooling-choices"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#language-tooling-choices">🛠️ Language &amp; Tooling Choices</a></h5>
<p>Interestingly, <strong>Claude dictated the stack</strong> more than I did.</p>
<ul>
<li><strong>Version 1</strong> leaned heavily on <strong>PowerShell</strong></li>
<li><strong>Version 2</strong> shifted to <strong>Azure CLI and Bash</strong></li>
</ul>
<p>Despite years of experience with PowerShell, I found Claude was significantly more confident (and accurate) when generating Azure CLI or Bash-based commands. This influenced the eventual choice to move away from PowerShell in the second iteration.</p>
<hr />
<p>By the end of Part 1, I had a functional AI monitoring solution — but it was fragile, inconsistent, and impossible to redeploy without repeating all the manual steps.</p>
<p>That realisation led directly to <strong>Version 2</strong> — a full rebuild using Infrastructure as Code.</p>
<hr />
<h3 id="part-2-why-terraform-why-now"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#part-2-why-terraform-why-now">🌍 Part 2: Why Terraform? Why Now?</a></h3>
<p>After several weeks of manual deployments, the <strong>limitations of version 1</strong> became unmissable.</p>
<p>Yes — the system <em>worked</em> — but only just:</p>
<ul>
<li>Scripts were fragmented and inconsistent  </li>
<li>Fixes required custom, ad-hoc scripts created on the fly  </li>
<li>Dependencies weren’t tracked, and naming conflicts crept in  </li>
<li>Reproducibility? Practically zero  </li>
</ul>
<p>🚨 The deployment process had become <strong>unwieldy</strong> — a sprawl of folders, partial fixes, and manual interventions. Functional? Sure. Maintainable? Absolutely not.</p>
<hr />
<p>That’s when the <strong>Infrastructure as Code (IaC)</strong> mindset kicked in.</p>
<blockquote>
<p><em>“Anything worth building once is worth building repeatably.”</em></p>
</blockquote>
<p>The question was simple:<br />
💡 <em>Could I rebuild everything from scratch — but this time, using AI assistance to create clean, modular, production-ready Terraform code?</em></p>
<hr />
<h4 id="the-terraform-challenge"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#the-terraform-challenge">🧱 The Terraform Challenge</a></h4>
<p>Rebuilding in Terraform wasn’t just a choice of tooling — it was a <strong>challenge to see how far AI-assisted development could go</strong> when held to production-level standards.</p>
<h5 id="goals-of-the-terraform-rewrite"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#goals-of-the-terraform-rewrite">🎯 Goals of the Terraform Rewrite</a></h5>
<ul>
<li><strong>Modularity</strong><br />
  Break down the monolithic structure into <strong>reusable, isolated modules</strong>  </li>
<li><strong>Portability</strong><br />
  Enable consistent deployment <strong>across environments and subscriptions</strong></li>
<li><strong>DRY Principles</strong><br />
  Absolutely <strong>no hardcoded values</strong> or duplicate code</li>
<li><strong>Documentation</strong><br />
  Ensure the code was <strong>clear, self-documenting</strong>, and reusable by others</li>
</ul>
<hr />
<p>Terraform wasn’t just a tech choice — it became the <strong>refinement phase</strong>.<br />
A chance to take what I’d learned from the vibe-coded version and bake that insight into clean, structured infrastructure-as-code.</p>
<p>Next: how AI and I tackled that rebuild, and the (sometimes surprising) choices we made.</p>
<h4 id="the-structured-prompt-approach"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#the-structured-prompt-approach">🧠 The Structured Prompt Approach</a></h4>
<p>The <strong>prompt engineering</strong> approach became absolutely crucial during the Terraform refactoring phase.</p>
<p>Rather than relying on vague questions or “do what I mean” instructions, I adopted a structured briefing style — the kind you might use when assigning work to a consultant:</p>
<ul>
<li>Define the <strong>role</strong></li>
<li>Set the <strong>goals</strong></li>
<li>Describe the <strong>inputs</strong></li>
<li>Outline the <strong>method</strong></li>
<li>Impose <strong>constraints</strong></li>
</ul>
<hr />
<p>Here’s the <strong>actual instruction prompt</strong> I used to initiate the Terraform rebuild 👇</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>🔧<span class="w"> </span>Enhanced<span class="w"> </span>Prompt:<span class="w"> </span>AI<span class="w"> </span>Monitoring<span class="w"> </span>Solution<span class="w"> </span>IaC<span class="w"> </span>Refactoring<span class="w"> </span>Project
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>👤<span class="w"> </span>Role<span class="w"> </span>Definition
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>You<span class="w"> </span>are<span class="w"> </span>acting<span class="w"> </span>as:
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>•<span class="w"> </span>An<span class="w"> </span>Infrastructure<span class="w"> </span>as<span class="w"> </span>Code<span class="w"> </span><span class="o">(</span>IaC<span class="o">)</span><span class="w"> </span>specialist<span class="w"> </span>with<span class="w"> </span>deep<span class="w"> </span>expertise<span class="w"> </span><span class="k">in</span><span class="w"> </span>Terraform
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>•<span class="w"> </span>An<span class="w"> </span>AI<span class="w"> </span>integration<span class="w"> </span>engineer,<span class="w"> </span>experienced<span class="w"> </span><span class="k">in</span><span class="w"> </span>deploying<span class="w"> </span>Azure-based<span class="w"> </span>AI<span class="w"> </span>workloads
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>Your<span class="w"> </span>responsibilities<span class="w"> </span>are:
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>•<span class="w"> </span>To<span class="w"> </span>refactor<span class="w"> </span>an<span class="w"> </span>existing<span class="w"> </span>AI<span class="w"> </span>Monitoring<span class="w"> </span>solution<span class="w"> </span>from<span class="w"> </span>a<span class="w"> </span>manually<span class="w"> </span>built<span class="w"> </span>prototype<span class="w"> </span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">  </span>into<span class="w"> </span>a<span class="w"> </span>modular,<span class="w"> </span>efficient,<span class="w"> </span>and<span class="w"> </span>portable<span class="w"> </span>Terraform<span class="w"> </span>project
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>•<span class="w"> </span>To<span class="w"> </span>minimize<span class="w"> </span>bloat,<span class="w"> </span>ensure<span class="w"> </span>code<span class="w"> </span>reusability,<span class="w"> </span>and<span class="w"> </span>produce<span class="w"> </span>clear<span class="w"> </span>documentation<span class="w"> </span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">  </span>to<span class="w"> </span>allow<span class="w"> </span>redeployment<span class="w"> </span>with<span class="w"> </span>minimal<span class="w"> </span>changes
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>🎯<span class="w"> </span>Project<span class="w"> </span>Goals
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>•<span class="w"> </span>Rebuild<span class="w"> </span>the<span class="w"> </span>existing<span class="w"> </span>AI<span class="w"> </span>Monitoring<span class="w"> </span>solution<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>fully<span class="w"> </span>modular,<span class="w"> </span>DRY-compliant<span class="w"> </span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">  </span>Terraform<span class="w"> </span>deployment
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>•<span class="w"> </span>Modularize<span class="w"> </span>resources<span class="w"> </span><span class="o">(</span>OpenAI,<span class="w"> </span>Function<span class="w"> </span>Apps,<span class="w"> </span>Logic<span class="w"> </span>Apps,<span class="w"> </span>Container<span class="w"> </span>Apps<span class="o">)</span><span class="w"> </span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="w">  </span>into<span class="w"> </span>reusable<span class="w"> </span>components
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>•<span class="w"> </span>Provide<span class="w"> </span>clear,<span class="w"> </span>concise<span class="w"> </span>README.md<span class="w"> </span>files<span class="w"> </span><span class="k">for</span><span class="w"> </span>each<span class="w"> </span>module<span class="w"> </span>describing<span class="w"> </span>usage,<span class="w"> </span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="w">  </span>input/output<span class="w"> </span>variables,<span class="w"> </span>and<span class="w"> </span>deployment<span class="w"> </span>steps
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>📁<span class="w"> </span>Project<span class="w"> </span>Artifacts<span class="w"> </span><span class="o">(</span>Input<span class="o">)</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>The<span class="w"> </span>following<span class="w"> </span>components<span class="w"> </span>are<span class="w"> </span>part<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>original<span class="w"> </span>Azure-hosted<span class="w"> </span>AI<span class="w"> </span>Monitoring<span class="w"> </span>solution:
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>•<span class="w"> </span>Azure<span class="w"> </span>OpenAI<span class="w"> </span>service
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>•<span class="w"> </span>Azure<span class="w"> </span>Function<span class="w"> </span>App
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>•<span class="w"> </span>Logic<span class="w"> </span>App
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>•<span class="w"> </span>Web<span class="w"> </span>Dashboard
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>•<span class="w"> </span>Container<span class="w"> </span>Apps<span class="w"> </span>Environment
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>•<span class="w"> </span>Supporting<span class="w"> </span>components<span class="w"> </span><span class="o">(</span>Key<span class="w"> </span>Vaults,<span class="w"> </span>App<span class="w"> </span>Insights,<span class="w"> </span>Storage,<span class="w"> </span>etc.<span class="o">)</span>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>🛠️<span class="w"> </span>Approach<span class="w"> </span>/<span class="w"> </span>Methodology
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>For<span class="w"> </span>each<span class="w"> </span>module:
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>•<span class="w"> </span>Use<span class="w"> </span>minimal<span class="w"> </span>but<span class="w"> </span><span class="nb">complete</span><span class="w"> </span>resource<span class="w"> </span>blocks
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>•<span class="w"> </span>Include<span class="w"> </span>only<span class="w"> </span>essential<span class="w"> </span>variables<span class="w"> </span>with<span class="w"> </span>sensible<span class="w"> </span>defaults
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>•<span class="w"> </span>Use<span class="w"> </span>output<span class="w"> </span>values<span class="w"> </span>to<span class="w"> </span><span class="nb">export</span><span class="w"> </span>key<span class="w"> </span>resource<span class="w"> </span>properties
</span><span id="__span-7-36"><a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>•<span class="w"> </span>Follow<span class="w"> </span>DRY<span class="w"> </span>principles<span class="w"> </span>using<span class="w"> </span>locals<span class="w"> </span>or<span class="w"> </span>reusable<span class="w"> </span>variables<span class="w"> </span>where<span class="w"> </span>possible
</span><span id="__span-7-37"><a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a>
</span><span id="__span-7-38"><a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a>📌<span class="w"> </span>Additional<span class="w"> </span>Guidelines
</span><span id="__span-7-39"><a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a>•<span class="w"> </span>Efficiency<span class="w"> </span>first:<span class="w"> </span>Avoid<span class="w"> </span>code<span class="w"> </span>repetition<span class="p">;</span><span class="w"> </span>prefer<span class="w"> </span>reusability,<span class="w"> </span>locals,<span class="w"> </span>and<span class="w"> </span>input<span class="w"> </span>variables
</span><span id="__span-7-40"><a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a>•<span class="w"> </span>Practical<span class="w"> </span>defaults:<span class="w"> </span>Pre-fill<span class="w"> </span>variables<span class="w"> </span>with<span class="w"> </span>production-safe,<span class="w"> </span>but<span class="w"> </span>general-purpose<span class="w"> </span>values
</span><span id="__span-7-41"><a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a>•<span class="w"> </span>Keep<span class="w"> </span>it<span class="w"> </span>modular:<span class="w"> </span>No<span class="w"> </span>monolithic<span class="w"> </span>deployment<span class="w"> </span>blocks—use<span class="w"> </span>modules<span class="w"> </span><span class="k">for</span><span class="w"> </span>all<span class="w"> </span>core<span class="w"> </span>resources
</span><span id="__span-7-42"><a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a>•<span class="w"> </span>Strict<span class="w"> </span>adherence:<span class="w"> </span>Do<span class="w"> </span>not<span class="w"> </span>expand<span class="w"> </span>scope<span class="w"> </span>unless<span class="w"> </span>confirmed
</span></code></pre></div>
<p>This structured approach helped maintain focus and provided clear boundaries for the AI to work within — though, as you'll see, <strong>constant reinforcement was still required</strong> throughout the process.</p>
<hr />
<h4 id="the-refactoring-process"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#the-refactoring-process">🔄 The Refactoring Process</a></h4>
<p>The Terraform rebuild became a <strong>different kind of AI collaboration</strong>.</p>
<p>Where version 1 was about vibing ideas into reality, version 2 was about <strong>methodically translating a messy prototype into clean, modular, production-friendly code</strong>.</p>
<hr />
<h5 id="key-modules-created"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#key-modules-created">🧩 Key Modules Created</a></h5>
<ul>
<li>
<p><code>foundation</code><br />
  Core infrastructure — resource groups, storage accounts, logging, etc.</p>
</li>
<li>
<p><code>openai</code><br />
  Azure OpenAI resource and model deployment — central to the intelligent analysis pipeline</p>
</li>
<li>
<p><code>function-app</code><br />
  Azure Functions for AI processing — connecting telemetry with insights</p>
</li>
<li>
<p><code>container-apps</code><br />
  Four-container ecosystem — the user-facing UI and visualization layers</p>
</li>
<li>
<p><code>monitoring</code><br />
  Application Insights + alerting — keeping the system observable and maintainable</p>
</li>
</ul>
<hr />
<h5 id="modular-structure-overview"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#modular-structure-overview">📁 Modular Structure Overview</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>terraform-ai-monitoring/
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>├──<span class="w"> </span>modules/
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>│<span class="w">   </span>├──<span class="w"> </span>foundation/
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>│<span class="w">   </span>├──<span class="w"> </span>openai/
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>│<span class="w">   </span>├──<span class="w"> </span><span class="k">function</span>-app/
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>│<span class="w">   </span>└──<span class="w"> </span>container-apps/
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>├──<span class="w"> </span>main.tf
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>└──<span class="w"> </span>terraform.tfvars
</span></code></pre></div>
<p>Each module went through <strong>multiple refinement cycles</strong>. The goal wasn’t just to get it working — it was to ensure:</p>
<ul>
<li>Clean, reusable Terraform code</li>
<li>Explicit configuration</li>
<li>DRY principles throughout</li>
<li>Reproducible, idempotent deployments</li>
</ul>
<hr />
<h5 id="iterative-refinement-in-practice"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#iterative-refinement-in-practice">🔧 Iterative Refinement in Practice</a></h5>
<p>A typical troubleshooting session went something like this:</p>
<ul>
<li>I’d run the code or attempt a terraform plan or apply.</li>
<li>If there were no errors, I’d verify the outcome and move on.</li>
<li>If there were errors, I’d copy the output into Claude and we’d go back and forth trying to fix the problem.</li>
</ul>
<p>This is where things often got tricky. Claude would sometimes suggest hardcoded values despite earlier instructions to avoid them, or propose overly complex fixes instead of the simple, obvious one. Even with clear guidance in the prompt, it was a constant effort to keep the AI focused and within scope.</p>
<p>The process wasn’t just code generation — it was troubleshooting, adjusting, and rechecking until things finally worked as expected.</p>
<p><img alt="Terraform schema correction" src="../../terraform-ai-monitoring/Claude_Terraform_Chat_Error_Example.png" /></p>
<p>The process revealed both the strengths and limitations of AI-assisted Infrastructure as Code development.</p>
<hr />
<h3 id="part-3-working-with-genai-the-good-the-bad-and-the-wandering"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#part-3-working-with-genai-the-good-the-bad-and-the-wandering">🧠 Part 3: Working with GenAI – The Good, the Bad, and the Wandering</a></h3>
<p>Building two versions of the same project entirely through AI conversations provided unique insights into the <strong>practical realities of AI-assisted development</strong>.</p>
<p>This wasn’t the utopian "AI will do everything" fantasy — nor was it the cynical "AI can’t do anything useful" view.<br />
It was somewhere in between: <strong>messy, human, instructive</strong>.</p>
<hr />
<h4 id="the-good-where-ai-excelled"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#the-good-where-ai-excelled">✅ The Good: Where AI Excelled</a></h4>
<p><strong>⚡ Rapid prototyping and iteration</strong><br />
Claude could produce working infrastructure code faster than I could even open the Azure documentation.<br />
Need a Container App with specific environment variables? ✅ Done.<br />
Modify the OpenAI integration logic? ✅ Updated in seconds.</p>
<p><strong>🧩 Pattern recognition and consistency</strong><br />
Once Claude grasped the structure of the project, it stuck with it.<br />
Variable names, tagging conventions, module layout — it stayed consistent without me needing to babysit every decision.</p>
<p><strong>🛠️ Boilerplate generation</strong><br />
Claude churned out huge volumes of code across Terraform, PowerShell, React, and Python — all <strong>syntactically correct and logically structured</strong>, freeing me from repetitive coding.</p>
<hr />
<h4 id="the-bad-where-ai-struggled"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#the-bad-where-ai-struggled">❌ The Bad: Where AI Struggled</a></h4>
<p><strong>🧠 Context drift and prompt guardrails</strong><br />
Even with structured, detailed instructions, Claude would sometimes go rogue:  </p>
<ul>
<li>Proposing solutions for problems I hadn’t asked about  </li>
<li>Rewriting things that didn’t need fixing  </li>
<li>Suggesting complete redesigns for simple tweaks  </li>
</ul>
<p><strong>🎉 Over-enthusiasm</strong><br />
Claude would often blurt out things like:  </p>
<blockquote>
<p><em>“CONGRATULATIONS!! 🎉 You now have a production-ready AI Monitoring platform!”</em><br />
To which I’d reply:<br />
<em>“Er, no bro. We're nowhere near done here. Still Cuz.”</em></p>
</blockquote>
<p>(Okay, I don’t <em>really</em> talk to Claude like a GenZ wannabe Roadman — but you get the idea 😂)</p>
<p><strong>🐛 Runtime debugging limitations</strong><br />
Claude could <em>write</em> the code. But fixing things like:  </p>
<ul>
<li>Azure authentication issues  </li>
<li>Misconfigured private endpoints  </li>
<li>Resource naming collisions<br />
…was always on me. These weren’t things AI could reliably troubleshoot on its own.</li>
</ul>
<p><strong>🔁 Project continuity fail</strong><br />
There’s no persistent memory.<br />
Every new session meant reloading context from scratch — usually by copy-pasting yesterday’s chat into a new one.<br />
Tedious, error-prone, and inefficient.</p>
<hr />
<h4 id="the-wandering-managing-ai-attention"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#the-wandering-managing-ai-attention">🌀 The Wandering: Managing AI Attention</a></h4>
<p><strong>⚠️ Fundamental challenge: No memory</strong><br />
Claude has no memory beyond the current chat. Even structured prompts didn’t prevent “chat drift” unless I constantly reinforced boundaries.
This is where ChatGPT has an edge in my opiion.
If I ask about previous chats, ChatGPT can give me examples and context about chats we had previously if prompted.</p>
<p><strong>🎯 The specificity requirement</strong><br />
Vague:  </p>
<blockquote>
<p>"Fix the container deployment"<br />
Resulted in:<br />
"Let’s rebuild the entire architecture from scratch" 😬  </p>
</blockquote>
<p>Precise:  </p>
<blockquote>
<p>"Update the environment variable <code>REACT_APP_API_URL</code> in <code>container-apps</code> module"<br />
Got the job done.</p>
</blockquote>
<p><strong>🚫 The hardcoded value trap</strong><br />
Claude loved quick fixes — often hardcoding values just to “make it work”.<br />
I had to go back and <strong>de-hardcode</strong> everything to stay true to the DRY principles I set from day one.</p>
<p>**⏳ Time impact for non-devs
Both stages of the project took longer than they probably should have — not because of any one flaw, but because of the nature of working with AI-generated infrastructure code.</p>
<p>A seasoned DevOps engineer might have moved faster by spotting bugs earlier and validating logic more confidently. But a pure developer? Probably not. They’d likely struggle with the Azure-specific infrastructure decisions, access policies, and platform configuration that were second nature to me.</p>
<p>This kind of work sits in a grey area — it needs both engineering fluency and platform experience. The real takeaway? GenAI can bridge that gap in either direction, but whichever way you’re coming from, there’s a learning curve.</p>
<p>The cost: higher validation effort.<br />
The reward: greater independence and accelerated learning.</p>
<hr />
<h3 id="part-4-building-the-stack-what-got-built"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#part-4-building-the-stack-what-got-built">🏗️ Part 4: Building The Stack - What Got Built</a></h3>
<p>The final Terraform solution creates a fully integrated AI monitoring ecosystem in Azure — one that’s modular, intelligent, and <em>almost</em> production-ready.<br />
Here’s what was actually built — and why.</p>
<hr />
<h4 id="core-architecture"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#core-architecture">🔧 Core Architecture</a></h4>
<p><strong>🧠 Azure OpenAI Integration</strong><br />
At the heart of the system is GPT-4o-mini, providing infrastructure analysis and recommendations at a significantly lower cost than GPT-4 — without compromising on quality for this use case.</p>
<p><strong>📦 Container Apps Environment</strong><br />
Four lightweight, purpose-driven containers manage the monitoring workflow:</p>
<ul>
<li>⚙️ <strong>FastAPI backend</strong> – Data ingestion and processing</li>
<li>📊 <strong>React dashboard</strong> – Front-end UI and live telemetry</li>
<li>🔄 <strong>Background processor</strong> – Continuously monitors resource health</li>
<li>🚀 <strong>Load generator</strong> – Simulates traffic for stress testing and metrics</li>
</ul>
<p><strong>⚡ Azure Function Apps for AI Processing</strong><br />
Serverless compute bridges raw telemetry with OpenAI for analysis.<br />
Functions scale on demand, keeping costs low and architecture lean.</p>
<blockquote>
<p>⚠️ The only part of the project not handled in Terraform was the custom dashboard container build.
That's by design — Terraform isn’t meant for image building or pushing.
Instead, I handled that manually (or via CI pipeline), which aligns with Hashicorps <img alt="best practices" src="https://developer.hashicorp.com/terraform/docs/language/resources/externally-managed" />.</p>
</blockquote>
<hr />
<h4 id="supporting-infrastructure"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#supporting-infrastructure">🧰 Supporting Infrastructure</a></h4>
<ul>
<li><strong>Application Insights</strong> – Real-time telemetry for diagnostics</li>
<li><strong>Log Analytics</strong> – Centralised logging and query aggregation</li>
<li><strong>Azure Container Registry (ACR)</strong> – Stores and serves custom container images</li>
<li><strong>Key Vault</strong> – Secrets management for safe credential handling</li>
</ul>
<hr />
<h4 id="key-technical-decisions"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#key-technical-decisions">🤔 Key Technical Decisions</a></h4>
<p><strong>🆚 Why Container Apps instead of AKS?</strong><br />
Honestly? Claude made the call.<br />
When I described what I needed (multi-container orchestration without complex ops), Claude recommended <strong>Container Apps over AKS</strong>, citing:  </p>
<ul>
<li>Lower cost  </li>
<li>Simpler deployment  </li>
<li>Sufficient capability for this workload  </li>
</ul>
<p>And… Claude was right. AKS would have been overkill.</p>
<p><strong>💸 Why GPT-4o-mini over GPT-4?</strong><br />
This was a no-brainer. GPT-4o-mini gave near-identical results for our monitoring analysis — at a <strong>fraction of the cost</strong>.<br />
Perfect balance of performance and budget.</p>
<p><strong>📦 Why modular Terraform over monolithic deployment?</strong><br />
Because chaos is not a deployment strategy.<br />
Modular code = clean boundaries, reusable components, and simple environment customization.<br />
It’s easier to debug, update, and scale.</p>
<hr />
<h4 id="visual-reference"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#visual-reference">🧮 Visual Reference</a></h4>
<p>Below are visuals captured during project development and testing:</p>
<p><strong>🔹 VS Code project structure</strong><br />
<img alt="VS Code project structure" src="../../terraform-ai-monitoring/VSCode_Terraform_Project_Structure.png" /></p>
<p><strong>🔹 Claude Projects interface</strong><br />
<img alt="Claude Projects interface" src="../../terraform-ai-monitoring/Claude_Project_Screenshot.png" /></p>
<hr />
<h4 id="what-the-dashboard-shows"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#what-the-dashboard-shows">📊 What the Dashboard Shows</a></h4>
<p>The final React-based dashboard delivers:</p>
<ul>
<li>✅ <strong>Real-time API health checks</strong></li>
<li>🧠 <strong>AI-generated infrastructure insights</strong></li>
<li>📈 <strong>Performance metrics + trend analysis</strong></li>
<li>💬 <strong>Interactive chat with OpenAI</strong></li>
<li>📤 <strong>Exportable chats for analysis</strong></li>
</ul>
<p><strong>🔹 Dashboard – Full view</strong><br />
<img alt="Dashboard Full View" src="../../terraform-ai-monitoring/AIMonitoringDashboard_Final.png" /></p>
<p><strong>🔹 AI analysis in progress</strong><br />
<img alt="Dashboard AI analysis 2" src="../../terraform-ai-monitoring/AIMonitoringDashboard_2.png" /></p>
<p><strong>🔹 OpenAI response card</strong><br />
<img alt="OpenAI response" src="../../terraform-ai-monitoring/AIMonitoringDashboard.png" /></p>
<hr />
<h3 id="part-5-the-result-a-portable-reusable-ai-monitoring-stack"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#part-5-the-result-a-portable-reusable-ai-monitoring-stack">🧾 Part 5: The Result - A Portable, Reusable AI Monitoring Stack</a></h3>
<p>The final Terraform deployment delivers a <strong>complete, modular, and production-friendly AI monitoring solution</strong> — fully reproducible across environments. More importantly, it <strong>demonstrates that AI-assisted infrastructure creation is not just viable, but effective</strong> when paired with good practices and human oversight.</p>
<hr />
<h4 id="deployment-experience"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#deployment-experience">🚀 Deployment Experience</a></h4>
<p><strong>From zero to running dashboard:</strong><br />
~ <strong>15 minutes (give or take 30-40 hours 😂)</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>terraform<span class="w"> </span>init
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>terraform<span class="w"> </span>plan
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>terraform<span class="w"> </span>apply
</span></code></pre></div>
<p>Minimal configuration required:</p>
<ul>
<li>✅ Azure subscription credentials</li>
<li>📄 Terraform variables (project name, region, container image names, etc.)</li>
<li>🐳 Container image references (can use defaults or custom builds)</li>
</ul>
<hr />
<h4 id="infrastructure-overview"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#infrastructure-overview">🗺️ Infrastructure Overview</a></h4>
<p>The final deployment provisions a complete, AI-driven monitoring stack — built entirely with Infrastructure as Code and connected through modular Terraform components.</p>
<p><strong>🔹 Azure Resource Visualizer</strong><br />
<img alt="Azure Resource Visualizer" src="../../terraform-ai-monitoring/Azure_Resources.png" /></p>
<hr />
<h4 id="cost-optimization"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#cost-optimization">💰 Cost Optimization</a></h4>
<p>This solution costs <strong>~£15 per month</strong> for a dev/test deployment (even cheaper if you remember to turn the container apps off!😲) — vastly cheaper than typical enterprise-grade monitoring tools (which can range £50–£200+ per month).</p>
<p><strong>Key savings come from:</strong></p>
<ul>
<li>⚡ Serverless Functions instead of always-on compute</li>
<li>📦 Container Apps that scale to zero during idle time</li>
<li>🤖 GPT-4o-mini instead of GPT-4 (with negligible accuracy trade-off)</li>
</ul>
<hr />
<h4 id="portability-validation"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#portability-validation">🔁 Portability Validation</a></h4>
<p>The real benefit of this solution is in its <strong>repeatability</strong>:</p>
<p>✅ <strong>Dev environment</strong><br />
UK South, full-feature stack</p>
<p>✅ <strong>Test deployment</strong><br />
New resource group, same subscription — <strong>identical results</strong></p>
<p>✅ <strong>Clean subscription test</strong><br />
Fresh environment, zero config drift</p>
<p><strong>Conclusion:</strong><br />
No matter where or how it's deployed, the <strong>stack just works</strong>.</p>
<hr />
<h3 id="part-6-reflections-and-lessons-learned"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#part-6-reflections-and-lessons-learned">🧠 Part 6: Reflections and Lessons Learned</a></h3>
<p>Building the same solution twice — once manually, once using Infrastructure as Code — offered a unique lens through which to view both <strong>AI-assisted development</strong> and <strong>modern infrastructure practices</strong>.</p>
<hr />
<h4 id="on-ai-assisted-development"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#on-ai-assisted-development">🤖 On AI-Assisted Development</a></h4>
<p><strong>🔎 The reality check</strong><br />
AI-assisted development is <strong>powerful but not autonomous</strong>. It still relies on:</p>
<ul>
<li>Human oversight</li>
<li>Strategic decisions</li>
<li>Recognizing when the AI is confidently wrong</li>
</ul>
<p><strong>⚡ Speed vs. Quality</strong><br />
AI can produce working code fast — sometimes scarily fast — but:</p>
<ul>
<li>The <strong>validation/debugging</strong> can take <em>longer</em> than traditional coding</li>
<li>The real power lies in <strong>architectural iteration</strong>, not production-readiness</li>
</ul>
<p><strong>📚 The learning curve</strong><br />
Truthfully, both v1 and v2 took <strong>much longer than they should have</strong>.<br />
A seasoned developer with better validation skills could likely complete either project in <strong>half the time</strong> — by catching subtle issues earlier.</p>
<hr />
<h4 id="on-infrastructure-as-code"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#on-infrastructure-as-code">🛠️ On Infrastructure as Code</a></h4>
<p><strong>📐 The transformation</strong><br />
Switching to Terraform wasn’t just about reusability:</p>
<ul>
<li>It encouraged <strong>cleaner design</strong>, <strong>logical resource grouping</strong>, and <strong>explicit dependencies</strong></li>
<li>It <em>forced</em> better decisions</li>
</ul>
<p><strong>🧩 The hidden complexity</strong><br />
What looked simple in Terraform:</p>
<ul>
<li>Revealed just how <strong>messy</strong> the manual deployment had been</li>
<li>Every implicit assumption, naming decision, and “just click here” moment had to become <strong>codified and reproducible</strong></li>
</ul>
<hr />
<h4 id="on-vibe-coding-as-a-methodology"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#on-vibe-coding-as-a-methodology">🎭 On Vibe Coding as a Methodology</a></h4>
<p><strong>✅ What worked:</strong></p>
<ul>
<li>Rapid architectural exploration</li>
<li>Solving problems in plain English</li>
<li>Iterative builds based on feedback</li>
<li>AI-assisted speed gains (things built in hours, not days)</li>
</ul>
<p><strong>❌ What didn’t:</strong></p>
<ul>
<li>Continuity across chat sessions</li>
<li>Preserving project context</li>
<li>Runtime debugging in Azure</li>
<li>Keeping the agent focused on scoped tasks</li>
</ul>
<hr />
<h4 id="things-id-do-differently"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#things-id-do-differently">🔁 Things I’d Do Differently</a></h4>
<p><strong>🧾 Better structured prompting from the outset</strong><br />
While I used a defined structure for the AI prompt, I learned:</p>
<ul>
<li>Even good prompts <strong>require ongoing reinforcement</strong></li>
<li>Claude needed regular reminders to stay on track during long sessions</li>
</ul>
<p><strong>✅ Regular resource validation</strong><br />
A recurring challenge:</p>
<ul>
<li>Claude often <strong>over-provisioned</strong> services</li>
<li>Periodic reviews of what we were building helped cut waste and simplify architecture</li>
</ul>
<p><strong>🧠 The reality of AI memory limitations</strong><br />
No, the AI does not “remember” anything meaningful between sessions:</p>
<ul>
<li>Every day required <strong>rebuilding the conversation context</strong></li>
<li>Guardrails had to be <strong>restated</strong> often</li>
</ul>
<p><strong>🎯 The extreme specificity requirement</strong><br />
Vague asks = vague solutions<br />
But:</p>
<ul>
<li><strong>Precise requests</strong> like “update <code>REACT_APP_API_URL</code> in <code>container-apps</code> module” yielded laser-targeted results</li>
</ul>
<hr />
<h3 id="conclusion"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#conclusion">✅ Conclusion</a></h3>
<p>This project started as a career thought experiment — <em>“What if there was a role focused on AI-integrated infrastructure?”</em> — and ended with a fully functional AI monitoring solution deployed in Azure.</p>
<p>What began as a prototype on a local Pi5 evolved into a robust, modular Terraform deployment. Over 4–5 weeks, it generated <strong>thousands of lines of infrastructure code</strong>, countless iterations, and a treasure trove of insights into AI-assisted development.</p>
<hr />
<h4 id="the-technical-outcome"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#the-technical-outcome">🚀 The Technical Outcome</a></h4>
<p>The result is a <strong>portable, cost-effective, AI-powered monitoring system</strong> that doesn’t just work — it <em>proves a point</em>. It's not quite enterprise-ready, but it’s a solid proof-of-concept and a foundation for learning, experimentation, and future iteration.</p>
<hr />
<h4 id="key-takeaways"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#key-takeaways">🧠 Key Takeaways</a></h4>
<ol>
<li>
<p><strong>AI-assisted development is powerful — but not autonomous.</strong><br />
   It requires constant direction, critical oversight, and the ability to spot when the AI is confidently wrong.</p>
</li>
<li>
<p><strong>Infrastructure as Code changes how you architect.</strong><br />
   Writing Terraform forces discipline: clean structure, explicit dependencies, and reproducible builds.</p>
</li>
<li>
<p><strong>Vibe coding has a learning curve.</strong><br />
   Both versions took longer than expected. A seasoned developer could likely move faster — but for infra pros, this is how we learn.</p>
</li>
<li>
<p><strong>Context management is still a major limitation.</strong><br />
   The inability to persist AI session memory made long-term projects harder than they should have been.</p>
</li>
<li>
<p><strong>The role of “Infrastructure AI Integration Engineer” is real — and emerging.</strong><br />
   This project sketches out what that future job might involve: blending IaC, AI, automation, and architecture.</p>
</li>
</ol>
<hr />
<h4 id="whats-next"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#whats-next">🧭 What’s Next?</a></h4>
<p>Version 3 is already brewing ☕ — ideas include:</p>
<ul>
<li>Monitoring more Azure services</li>
<li>Improving the dashboard’s AI output formatting</li>
<li>Experimenting with newer tools like <strong>Claude Code</strong> and <strong>ChatGPT Codex</strong></li>
<li>Trying AI-native IDEs and inline assistants to streamline the workflow</li>
</ul>
<p>And let’s not forget the rise of <strong>“Slop-Ops”</strong> — that beautiful mess where AI, infrastructure, and vibe-based engineering collide 😎</p>
<hr />
<h4 id="final-thoughts"><a class="toclink" href="../../vibe-coding-my-way-to-ai-infra/#final-thoughts">💡 Final Thoughts</a></h4>
<p>If you're an infrastructure engineer looking to explore AI integration, here’s the reality:</p>
<ul>
<li>The tools are ready.</li>
<li>The method works.</li>
<li>But it’s not magic — <strong>it takes effort, patience, and curiosity</strong>.</li>
</ul>
<p>The future of infrastructure might be conversational — but it’s not (yet) automatic.</p>
<hr />
<blockquote>
<p>If you’ve read this far — thanks. 🙏
I’d love feedback from anyone experimenting with AI-assisted IaC or Terraform refactors.
Find me on [LinkedIn] or leave a comment.</p>
</blockquote>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Vibe%20Coding%20My%20Way%20to%20AI%20Infra%0A&amp;url=https://blog.pollockweb.com/blog/vibe-coding-my-way-to-ai-infra/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/vibe-coding-my-way-to-ai-infra/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-06-16 00:00:00+00:00">June 16, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/infrastructure/" class="md-meta__link">Infrastructure</a>, 
              <a href="../../category/ai-integration/" class="md-meta__link">AI Integration</a>, 
              <a href="../../category/monitoring/" class="md-meta__link">Monitoring</a>, 
              <a href="../../category/learning-projects/" class="md-meta__link">Learning Projects</a></li>
        
        
          
          <li class="md-meta__item">
            
              18 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/">🍓 Building AI-Powered Infrastructure Monitoring: From Home Lab to Cloud Production</a></h2>
<p>After successfully diving into AI automation with n8n (and surviving the OAuth battles), I decided to tackle a more ambitious learning project: exploring how to integrate AI into infrastructure monitoring systems. The goal was to understand how AI can transform traditional monitoring from simple threshold alerts into intelligent analysis that provides actionable insights—all while experimenting in a safe home lab environment before applying these concepts to production cloud infrastructure.</p>
<p><strong>What you'll discover in this post:</strong></p>
<ul>
<li>Complete monitoring stack deployment using Docker Compose</li>
<li>Prometheus and Grafana setup for metrics collection</li>
<li>n8n workflow automation for data processing and AI analysis</li>
<li>Azure OpenAI integration for intelligent infrastructure insights</li>
<li>Professional email reporting with HTML templates</li>
<li>Lessons learned for transitioning to production cloud environments</li>
<li>Practical skills for integrating AI into traditional monitoring workflows</li>
</ul>
<p>Here's how I built a home lab monitoring system to explore AI integration patterns that can be applied to production cloud infrastructure.</p>
<p><em>Full disclosure: I'm using a Visual Studio Enterprise subscription which provides £120 monthly Azure credits. This makes Azure OpenAI experimentation cost-effective for learning purposes. I found direct OpenAI API connections too expensive for extensive experimentation.</em></p>
<hr />
<h3 id="prerequisites-planning"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#prerequisites-planning">🎯 Prerequisites &amp; Planning</a></h3>
<p>Before diving into the implementation, let's establish what you'll need and the realistic time investment required for this learning project.</p>
<h4 id="realistic-learning-prerequisites"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#realistic-learning-prerequisites"><strong>Realistic Learning Prerequisites</strong></a></h4>
<p><strong>Essential Background Knowledge:</strong></p>
<p><strong>Docker &amp; Containerization:</strong></p>
<ul>
<li>Can deploy multi-container applications with Docker Compose</li>
<li>Understand container networking and volume management</li>
<li>Can debug why containers can't communicate with each other</li>
<li>Familiar with basic Docker commands (logs, exec, inspect)</li>
<li><strong>Learning Resource:</strong> <a href="https://docs.docker.com/get-started/">Docker Official Tutorial</a> - Comprehensive introduction to containerization</li>
</ul>
<p><strong>API Integration:</strong></p>
<ul>
<li>Comfortable making HTTP requests with authentication headers</li>
<li>Can read and debug JSON responses</li>
<li>Understand REST API concepts and error handling</li>
<li>Experience with tools like curl or Postman for API testing</li>
<li><strong>Learning Resource:</strong> <a href="https://restfulapi.net/">REST API Tutorial</a> - Complete guide to RESTful services</li>
</ul>
<p><strong>Infrastructure Monitoring Concepts:</strong></p>
<ul>
<li>Know what CPU, memory, and disk metrics actually represent</li>
<li>Understand the difference between metrics, logs, and traces</li>
<li>Familiar with the concept of time-series data</li>
<li>Basic understanding of what constitutes "normal" vs "problematic" system behavior</li>
<li><strong>Learning Resource:</strong> <a href="https://prometheus.io/docs/introduction/overview/">Prometheus Documentation</a> - Monitoring fundamentals and concepts</li>
</ul>
<p><strong>Skills You'll Develop During This Project:</strong></p>
<ul>
<li>AI prompt engineering for infrastructure analysis</li>
<li>Workflow automation with complex orchestration</li>
<li>Integration of traditional monitoring with modern AI services</li>
<li>Business communication of technical metrics</li>
<li>Cost-conscious AI service usage and optimization</li>
</ul>
<p><strong>Community Learning Resources:</strong></p>
<ul>
<li><strong>n8n Community:</strong> <a href="https://community.n8n.io">community.n8n.io</a> - Workflow automation support and examples</li>
<li><strong>Prometheus Community:</strong> <a href="https://prometheus.io/community">prometheus.io/community</a> - Monitoring best practices and troubleshooting</li>
<li><strong>Azure OpenAI Documentation:</strong> <a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/">Azure AI Services</a> - Official API documentation and examples</li>
<li><strong>Docker Learning:</strong> <a href="https://dockerlabs.collabnix.com/">Docker Labs</a> - Hands-on container tutorials</li>
</ul>
<h4 id="honest-time-investment-expectations"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#honest-time-investment-expectations"><strong>Honest Time Investment Expectations</strong></a></h4>
<p><strong>If you have all prerequisites:</strong> 1-2 weeks for complete implementation</p>
<ul>
<li>Basic setup: 2-3 hours</li>
<li>AI integration: 4-6 hours</li>
<li>Customization and optimization: 6-8 hours</li>
<li>Cloud transition planning: 4-6 hours</li>
</ul>
<p><strong>If missing Docker skills:</strong> Add 2-3 weeks for learning fundamentals</p>
<ul>
<li>Docker basics course: 1-2 weeks</li>
<li>Hands-on container practice: 1 week</li>
<li><strong>Recommended Learning:</strong> <a href="https://docs.docker.com/get-started/">Docker Official Tutorial</a> and <a href="https://labs.play-with-docker.com/">Play with Docker</a></li>
<li>Then proceed with main project</li>
</ul>
<p><strong>If new to monitoring:</strong> Add 1-2 weeks for infrastructure concepts</p>
<ul>
<li>Prometheus/Grafana tutorials: 1 week</li>
<li>Understanding metrics and alerting: 1 week</li>
<li><strong>Recommended Learning:</strong> <a href="https://prometheus.io/docs/prometheus/latest/getting_started/">Prometheus Getting Started</a> and <a href="https://grafana.com/tutorials/grafana-fundamentals/">Grafana Fundamentals</a></li>
<li>Then integrate AI capabilities</li>
</ul>
<p><strong>If unfamiliar with APIs:</strong> Add 1 week for HTTP/JSON basics</p>
<ul>
<li>REST API fundamentals: 3-4 days</li>
<li>JSON manipulation practice: 2-3 days</li>
<li>Authentication concepts: 1-2 days</li>
<li><strong>Recommended Learning:</strong> <a href="https://restfulapi.net/">HTTP/REST API Tutorial</a> and hands-on practice with <a href="https://jsonplaceholder.typicode.com/">JSONPlaceholder</a></li>
</ul>
<h4 id="hardware-service-requirements"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#hardware-service-requirements"><strong>Hardware &amp; Service Requirements</strong></a></h4>
<p><strong>Minimum Configuration:</strong></p>
<ul>
<li><strong>Hardware</strong>: 8GB+ RAM (Pi 5 8GB or standard x86 machine)</li>
<li><strong>Storage</strong>: 100GB+ available space (containers + metrics retention)</li>
<li><strong>Network</strong>: Stable internet connection with static IP preferred</li>
<li><strong>Software</strong>: Docker 20.10+, Docker Compose 2.0+</li>
</ul>
<p><strong>Service Account Setup for Learning:</strong></p>
<ul>
<li><strong>Azure OpenAI</strong>: Azure subscription with OpenAI access (Visual Studio Enterprise subscription provides excellent experimentation credits)</li>
<li><strong>Email Provider</strong>: Gmail App Password works perfectly for testing</li>
<li><strong>Cloud Account</strong>: AWS/Azure free tier for eventual cloud transition</li>
<li><strong>Monitoring Tools</strong>: All open-source options used in this project</li>
</ul>
<p><strong>Learning Environment Costs:</strong></p>
<ul>
<li><strong>Azure OpenAI</strong>: Covered by Visual Studio Enterprise subscription credits</li>
<li><strong>Infrastructure</strong>: Minimal electricity costs for Pi 5 operation</li>
<li><strong>Email</strong>: £0 (using Gmail App Password)</li>
<li><strong>Total out-of-pocket</strong>: Essentially £0 for extensive experimentation</li>
</ul>
<p><em>Note: Without subscription benefits, AI analysis costs should be carefully monitored as they can accumulate with frequent polling.</em></p>
<h4 id="my-learning-setup"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#my-learning-setup"><strong>My Learning Setup</strong></a></h4>
<blockquote>
<p><strong>🖥️ Home Lab Environment</strong></p>
<ul>
<li><strong>Primary system:</strong> Raspberry Pi 5, 8GB RAM (24/7 learning host)</li>
<li><strong>Development approach:</strong> Iterative experimentation with immediate feedback</li>
<li><strong>Network setup:</strong> Standard home lab environment</li>
<li><strong>Learning support:</strong> Anthropic Claude for debugging and optimization</li>
</ul>
</blockquote>
<hr />
<h3 id="phase-1-foundation-the-monitoring-stack"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#phase-1-foundation-the-monitoring-stack">🏗️ Phase 1: Foundation - The Monitoring Stack</a></h3>
<p>Building any intelligent monitoring system starts with having something intelligent to monitor. Enter the classic Prometheus + Grafana combo, containerized for easy deployment and scalability.</p>
<p>The foundation phase establishes reliable metric collection before adding intelligence layers. This approach ensures we have clean, consistent data to feed into AI analysis rather than trying to retrofit intelligence into poorly designed monitoring systems.</p>
<h3 id="learning-checkpoint-before-you-begin"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#learning-checkpoint-before-you-begin">✅ Learning Checkpoint: Before You Begin</a></h3>
<p>Before starting this project, verify you can:</p>
<ul>
<li>[ ] Deploy a multi-container application with Docker Compose</li>
<li>[ ] Debug why a container can't reach another container  </li>
<li>[ ] Make API calls with authentication headers using curl</li>
<li>[ ] Read and understand JSON data structures</li>
<li>[ ] Explain what CPU and memory metrics actually mean for system health</li>
</ul>
<p><strong>Quick Test:</strong> Can you deploy a simple web application stack (nginx + database) using Docker Compose and troubleshoot networking issues? If not, spend time with Docker fundamentals first.</p>
<p><strong>Common Issue at This Stage:</strong> Container networking problems are the most frequent stumbling block. If containers can't communicate, review Docker Compose networking documentation and practice with simple multi-container applications before proceeding.</p>
<h4 id="docker-compose-infrastructure"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#docker-compose-infrastructure">🐳 Docker Compose Infrastructure</a></h4>
<p>The entire monitoring stack deploys through a single Docker Compose file. This approach ensures consistent environments from home lab development through cloud production.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">  </span><span class="nt">prometheus</span><span class="p">:</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prom/prometheus:latest</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9090:9090&quot;</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus_data:/prometheus</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/prometheus.yml:/etc/prometheus/prometheus.yml:ro</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--config.file=/etc/prometheus/prometheus.yml&#39;</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--storage.tsdb.path=/prometheus&#39;</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--storage.tsdb.retention.time=7d&#39;</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--web.console.libraries=/etc/prometheus/console_libraries&#39;</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--web.console.templates=/etc/prometheus/consoles&#39;</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--web.enable-lifecycle&#39;</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="w">  </span><span class="nt">grafana</span><span class="p">:</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana/grafana-oss:latest</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GF_SECURITY_ADMIN_USER=admin</span>
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GF_SECURITY_ADMIN_PASSWORD=aimonitoring123</span>
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GF_USERS_ALLOW_SIGN_UP=false</span>
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana_data:/var/lib/grafana</span>
</span><span id="__span-14-35"><a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config/grafana/provisioning:/etc/grafana/provisioning:ro</span>
</span><span id="__span-14-36"><a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-14-37"><a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-14-38"><a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a>
</span><span id="__span-14-39"><a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a><span class="w">  </span><span class="nt">node-exporter</span><span class="p">:</span>
</span><span id="__span-14-40"><a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prom/node-exporter:latest</span>
</span><span id="__span-14-41"><a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node-exporter</span>
</span><span id="__span-14-42"><a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-14-43"><a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-14-44"><a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9100:9100&quot;</span>
</span><span id="__span-14-45"><a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-14-46"><a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/proc:/host/proc:ro</span>
</span><span id="__span-14-47"><a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/sys:/host/sys:ro</span>
</span><span id="__span-14-48"><a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/:/rootfs:ro</span>
</span><span id="__span-14-49"><a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span>
</span><span id="__span-14-50"><a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--path.procfs=/host/proc&#39;</span>
</span><span id="__span-14-51"><a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--path.rootfs=/rootfs&#39;</span>
</span><span id="__span-14-52"><a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--path.sysfs=/host/sys&#39;</span>
</span><span id="__span-14-53"><a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)&#39;</span>
</span><span id="__span-14-54"><a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-14-55"><a id="__codelineno-14-55" name="__codelineno-14-55" href="#__codelineno-14-55"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-14-56"><a id="__codelineno-14-56" name="__codelineno-14-56" href="#__codelineno-14-56"></a>
</span><span id="__span-14-57"><a id="__codelineno-14-57" name="__codelineno-14-57" href="#__codelineno-14-57"></a><span class="w">  </span><span class="nt">n8n</span><span class="p">:</span>
</span><span id="__span-14-58"><a id="__codelineno-14-58" name="__codelineno-14-58" href="#__codelineno-14-58"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">n8nio/n8n:latest</span>
</span><span id="__span-14-59"><a id="__codelineno-14-59" name="__codelineno-14-59" href="#__codelineno-14-59"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">n8n</span>
</span><span id="__span-14-60"><a id="__codelineno-14-60" name="__codelineno-14-60" href="#__codelineno-14-60"></a><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-14-61"><a id="__codelineno-14-61" name="__codelineno-14-61" href="#__codelineno-14-61"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-14-62"><a id="__codelineno-14-62" name="__codelineno-14-62" href="#__codelineno-14-62"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5678:5678&quot;</span>
</span><span id="__span-14-63"><a id="__codelineno-14-63" name="__codelineno-14-63" href="#__codelineno-14-63"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-14-64"><a id="__codelineno-14-64" name="__codelineno-14-64" href="#__codelineno-14-64"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">N8N_BASIC_AUTH_ACTIVE=true</span>
</span><span id="__span-14-65"><a id="__codelineno-14-65" name="__codelineno-14-65" href="#__codelineno-14-65"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">N8N_BASIC_AUTH_USER=admin</span>
</span><span id="__span-14-66"><a id="__codelineno-14-66" name="__codelineno-14-66" href="#__codelineno-14-66"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">N8N_BASIC_AUTH_PASSWORD=aimonitoring123</span>
</span><span id="__span-14-67"><a id="__codelineno-14-67" name="__codelineno-14-67" href="#__codelineno-14-67"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">N8N_HOST=0.0.0.0</span>
</span><span id="__span-14-68"><a id="__codelineno-14-68" name="__codelineno-14-68" href="#__codelineno-14-68"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">N8N_PORT=5678</span>
</span><span id="__span-14-69"><a id="__codelineno-14-69" name="__codelineno-14-69" href="#__codelineno-14-69"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">N8N_PROTOCOL=http</span>
</span><span id="__span-14-70"><a id="__codelineno-14-70" name="__codelineno-14-70" href="#__codelineno-14-70"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-14-71"><a id="__codelineno-14-71" name="__codelineno-14-71" href="#__codelineno-14-71"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">n8n_data:/home/node/.n8n</span>
</span><span id="__span-14-72"><a id="__codelineno-14-72" name="__codelineno-14-72" href="#__codelineno-14-72"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-14-73"><a id="__codelineno-14-73" name="__codelineno-14-73" href="#__codelineno-14-73"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-14-74"><a id="__codelineno-14-74" name="__codelineno-14-74" href="#__codelineno-14-74"></a>
</span><span id="__span-14-75"><a id="__codelineno-14-75" name="__codelineno-14-75" href="#__codelineno-14-75"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-14-76"><a id="__codelineno-14-76" name="__codelineno-14-76" href="#__codelineno-14-76"></a><span class="w">  </span><span class="nt">prometheus_data</span><span class="p">:</span>
</span><span id="__span-14-77"><a id="__codelineno-14-77" name="__codelineno-14-77" href="#__codelineno-14-77"></a><span class="w">  </span><span class="nt">grafana_data</span><span class="p">:</span>
</span><span id="__span-14-78"><a id="__codelineno-14-78" name="__codelineno-14-78" href="#__codelineno-14-78"></a><span class="w">  </span><span class="nt">n8n_data</span><span class="p">:</span>
</span><span id="__span-14-79"><a id="__codelineno-14-79" name="__codelineno-14-79" href="#__codelineno-14-79"></a>
</span><span id="__span-14-80"><a id="__codelineno-14-80" name="__codelineno-14-80" href="#__codelineno-14-80"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-14-81"><a id="__codelineno-14-81" name="__codelineno-14-81" href="#__codelineno-14-81"></a><span class="w">  </span><span class="nt">monitoring</span><span class="p">:</span>
</span><span id="__span-14-82"><a id="__codelineno-14-82" name="__codelineno-14-82" href="#__codelineno-14-82"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span></code></pre></div>
<h4 id="prometheus-configuration"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#prometheus-configuration">⚙️ Prometheus Configuration</a></h4>
<p>The heart of metric collection needs careful configuration to balance comprehensive monitoring with resource efficiency:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># config/prometheus.yml</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="nt">global</span><span class="p">:</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">  </span><span class="nt">scrape_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15s</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">  </span><span class="nt">evaluation_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15s</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="nt">rule_files</span><span class="p">:</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;rules/*.yml&quot;</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="nt">scrape_configs</span><span class="p">:</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;prometheus&#39;</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;localhost:9090&#39;</span><span class="p p-Indicator">]</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;node-exporter&#39;</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;node-exporter:9100&#39;</span><span class="p p-Indicator">]</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">    </span><span class="nt">scrape_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">    </span><span class="nt">metrics_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/metrics</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;grafana&#39;</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">    </span><span class="nt">static_configs</span><span class="p">:</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;grafana:3000&#39;</span><span class="p p-Indicator">]</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">    </span><span class="nt">scrape_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="nt">alerting</span><span class="p">:</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">  </span><span class="nt">alertmanagers</span><span class="p">:</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">static_configs</span><span class="p">:</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">targets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
</span></code></pre></div>
<h4 id="deployment-and-initial-setup"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#deployment-and-initial-setup">🚀 Deployment and Initial Setup</a></h4>
<p>Launch your monitoring foundation with a single command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># Create project structure</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>mkdir<span class="w"> </span>ai-monitoring-lab<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>ai-monitoring-lab
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>config/grafana/provisioning/<span class="o">{</span>datasources,dashboards<span class="o">}</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>data<span class="w"> </span>logs
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="c1"># Deploy the stack</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="c1"># Verify deployment</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>prometheus
</span></code></pre></div>
<ul>
<li><strong>Access your new monitoring stack:</strong></li>
<li><strong>Prometheus</strong>: <a href="http://localhost:9090">http://localhost:9090</a></li>
<li><strong>Grafana</strong>: <a href="http://localhost:3000">http://localhost:3000</a> (admin/aimonitoring123)</li>
<li><strong>Node Exporter</strong>: <a href="http://localhost:9100/metrics">http://localhost:9100/metrics</a></li>
</ul>
<p><img alt="Home lab Grafana dashboard showing real system metrics with proper visualization and alerting thresholds" src="../../ai-monitoring/grafana-dashboard-metrics.png" /></p>
<p>Within minutes, you'll have comprehensive system metrics flowing through Prometheus and visualized in Grafana. But pretty graphs are just the beginning—the real transformation happens when we add AI analysis.</p>
<h3 id="learning-checkpoint-monitoring-foundation"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#learning-checkpoint-monitoring-foundation">✅ Learning Checkpoint: Monitoring Foundation</a></h3>
<p>Before proceeding to workflow automation, verify you can:</p>
<ul>
<li>[ ] Access Prometheus at localhost:9090 and see targets as "UP"</li>
<li>[ ] View system metrics in Grafana dashboards</li>
<li>[ ] Write basic PromQL queries (like <code>node_memory_MemAvailable_bytes</code>)</li>
<li>[ ] Understand what the metrics represent in business terms</li>
<li>[ ] Create a custom Grafana panel showing memory usage as a percentage</li>
</ul>
<p><strong>Quick Test:</strong> Create a dashboard panel that shows "Memory utilization is healthy/concerning" based on percentage thresholds. If you can't do this easily, spend more time with Prometheus queries and Grafana visualization.</p>
<p><strong>Common Issues at This Stage:</strong></p>
<ul>
<li><strong>Prometheus targets showing as "DOWN"</strong> - Usually container networking or firewall issues</li>
<li><strong>Grafana showing "No data"</strong> - Often datasource URL configuration problems  </li>
<li><strong>PromQL query errors</strong> - Syntax issues with metric names or functions</li>
</ul>
<p><img alt="Prometheus targets page demonstrating successful metric collection from all configured endpoints" src="../../ai-monitoring/prometheus-targets-status.png" /></p>
<hr />
<h3 id="bridging-to-intelligence-why-traditional-monitoring-isnt-enough"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#bridging-to-intelligence-why-traditional-monitoring-isnt-enough">🔗 Bridging to Intelligence: Why Traditional Monitoring Isn't Enough</a></h3>
<p>Traditional monitoring tells you <em>what</em> happened (CPU is at 85%) but not <em>why</em> it matters or <em>what</em> you should do about it. Most alerts are just noise without context about whether that 85% CPU usage is normal for your workload or a sign of impending system failure.</p>
<p>This is where workflow automation and AI analysis bridge the gap between raw metrics and actionable insights.</p>
<p><strong>What n8n brings to the solution:</strong></p>
<ul>
<li><strong>Orchestrates data collection</strong> from multiple sources beyond just Prometheus</li>
<li><strong>Transforms raw metrics</strong> into structured data suitable for AI analysis  </li>
<li><strong>Handles error scenarios</strong> and fallbacks gracefully without custom application development</li>
<li><strong>Enables complex logic</strong> through visual workflows rather than scripting</li>
<li><strong>Provides integration capabilities</strong> with email, chat systems, and other tools</li>
</ul>
<p><strong>Why AI analysis matters:</strong></p>
<ul>
<li><strong>Adds context:</strong> "85% CPU usage is normal for this workload during business hours"</li>
<li><strong>Predicts trends:</strong> "Memory usage trending upward, recommend capacity review in 2 weeks"  </li>
<li><strong>Communicates impact:</strong> "System operating efficiently with no immediate business impact"</li>
<li><strong>Reduces noise:</strong> Only alert on situations that actually require attention</li>
</ul>
<p>The combination creates a monitoring system that doesn't just detect problems—it explains them in business terms and recommends specific actions.</p>
<hr />
<h3 id="phase-2-n8n-workflow-automation-the-intelligence-orchestrator"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#phase-2-n8n-workflow-automation-the-intelligence-orchestrator">🤖 Phase 2: n8n Workflow Automation - The Intelligence Orchestrator</a></h3>
<p>n8n transforms our basic monitoring stack into an intelligent analysis system. Through visual workflow design, we can create complex logic without writing extensive custom code.</p>
<p><img alt="Complete n8n workflow canvas displaying both alert and scheduled reporting paths with visible node connections" src="../../ai-monitoring/n8n-workflow-complete.png" /></p>
<h4 id="data-collection-the-foundation-nodes"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#data-collection-the-foundation-nodes">⏰ Data Collection: The Foundation Nodes</a></h4>
<p>The workflow begins with intelligent data collection that fetches exactly the metrics needed for AI analysis:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1">// Schedule Trigger Node Configuration</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="p">{</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span><span class="s2">&quot;rule&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">    </span><span class="s2">&quot;interval&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">        </span><span class="s2">&quot;field&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;cronExpression&quot;</span><span class="p">,</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">        </span><span class="s2">&quot;value&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0 */1 * * *&quot;</span><span class="w">  </span><span class="c1">// Every hour</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Prometheus Query Node</strong> (HTTP Request):</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="p">{</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">  </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://prometheus:9090/api/v1/query&quot;</span><span class="p">,</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">  </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">  </span><span class="nt">&quot;qs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">    </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;((node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes) * 100&quot;</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">  </span><span class="nt">&quot;options&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">    </span><span class="nt">&quot;timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="process-metrics-the-data-transformation"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#process-metrics-the-data-transformation">🔄 Process Metrics: The Data Transformation</a></h4>
<p>The magic happens in the data processing node, which transforms Prometheus's JSON responses into clean, AI-friendly data structures. This step is crucial—AI analysis is only as good as the data you feed it.</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1">// Process Metrics Node - JavaScript Code</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$input</span><span class="p">.</span><span class="nx">first</span><span class="p">();</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">  </span><span class="c1">// Extract metric values from Prometheus response</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">memoryData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">result</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">memoryPercent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">memoryData</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="mf">1</span><span class="p">]).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">  </span><span class="c1">// Determine system health status</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">alertLevel</span><span class="p">,</span><span class="w"> </span><span class="nx">alertStatus</span><span class="p">,</span><span class="w"> </span><span class="nx">systemHealth</span><span class="p">;</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">memoryPercent</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">    </span><span class="nx">alertLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;LOW&#39;</span><span class="p">;</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">    </span><span class="nx">alertStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;HEALTHY&#39;</span><span class="p">;</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">    </span><span class="nx">systemHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;optimal&#39;</span><span class="p">;</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">memoryPercent</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">80</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="w">    </span><span class="nx">alertLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MEDIUM&#39;</span><span class="p">;</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="w">    </span><span class="nx">alertStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;WATCH&#39;</span><span class="p">;</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="w">    </span><span class="nx">systemHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;elevated but manageable&#39;</span><span class="p">;</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="w">    </span><span class="nx">alertLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;HIGH&#39;</span><span class="p">;</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="w">    </span><span class="nx">alertStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CRITICAL&#39;</span><span class="p">;</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="w">    </span><span class="nx">systemHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;requires immediate attention&#39;</span><span class="p">;</span>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="w">  </span><span class="c1">// Structure data for AI analysis</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">processedData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a><span class="w">    </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a><span class="w">    </span><span class="nx">memory_percent</span><span class="o">:</span><span class="w"> </span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">memoryPercent</span><span class="p">),</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a><span class="w">    </span><span class="nx">alert_level</span><span class="o">:</span><span class="w"> </span><span class="nx">alertLevel</span><span class="p">,</span>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a><span class="w">    </span><span class="nx">alert_status</span><span class="o">:</span><span class="w"> </span><span class="nx">alertStatus</span><span class="p">,</span>
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a><span class="w">    </span><span class="nx">system_health</span><span class="o">:</span><span class="w"> </span><span class="nx">systemHealth</span><span class="p">,</span>
</span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a><span class="w">    </span><span class="nx">collection_source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span><span class="p">,</span>
</span><span id="__span-19-34"><a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a><span class="w">    </span><span class="nx">analysis_ready</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-19-35"><a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-19-36"><a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a>
</span><span id="__span-19-37"><a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="nx">processedData</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-19-38"><a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a>
</span><span id="__span-19-39"><a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-40"><a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Metrics processing failed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-19-41"><a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-19-42"><a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a><span class="w">    </span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-19-43"><a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a><span class="w">      </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-19-44"><a id="__codelineno-19-44" name="__codelineno-19-44" href="#__codelineno-19-44"></a><span class="w">      </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unable to process metrics data&#39;</span><span class="p">,</span>
</span><span id="__span-19-45"><a id="__codelineno-19-45" name="__codelineno-19-45" href="#__codelineno-19-45"></a><span class="w">      </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">()</span>
</span><span id="__span-19-46"><a id="__codelineno-19-46" name="__codelineno-19-46" href="#__codelineno-19-46"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
</span><span id="__span-19-47"><a id="__codelineno-19-47" name="__codelineno-19-47" href="#__codelineno-19-47"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-19-48"><a id="__codelineno-19-48" name="__codelineno-19-48" href="#__codelineno-19-48"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="learning-checkpoint-n8n-workflow-fundamentals"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#learning-checkpoint-n8n-workflow-fundamentals">✅ Learning Checkpoint: n8n Workflow Fundamentals</a></h3>
<p>Before adding AI analysis, verify you can:</p>
<ul>
<li>[ ] Create a basic n8n workflow that fetches Prometheus data</li>
<li>[ ] Process the JSON response and extract specific metrics</li>
<li>[ ] Send a test email with the processed data</li>
<li>[ ] Handle basic error scenarios (API timeout, malformed response)</li>
<li>[ ] Understand the data flow from Prometheus → n8n → Email</li>
</ul>
<p><strong>Quick Test:</strong> Build a simple workflow that emails you the current memory percentage every hour. If this seems challenging, spend more time understanding n8n's HTTP request and JavaScript processing nodes.</p>
<p><strong>Common Issues at This Stage:</strong></p>
<ul>
<li><strong>n8n workflow execution failures</strong> - Usually authentication or API endpoint problems</li>
<li><strong>JavaScript node errors</strong> - Often due to missing error handling or incorrect data parsing</li>
<li><strong>Email delivery failures</strong> - SMTP configuration or authentication issues</li>
</ul>
<p><strong>Debugging Tip:</strong> Use console.log() extensively in JavaScript nodes and check the execution logs for detailed error information.</p>
<hr />
<h3 id="phase-3-azure-openai-integration-adding-intelligence"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#phase-3-azure-openai-integration-adding-intelligence">🧠 Phase 3: Azure OpenAI Integration - Adding Intelligence</a></h3>
<p>This is where the system evolves from "automated alerting" to "intelligent analysis." Azure OpenAI takes our clean metrics and transforms them into actionable insights that even non-technical stakeholders can understand and act upon.</p>
<p>The transition from raw monitoring data to business intelligence happens here—transforming "Memory usage is 76%" into "The system is operating efficiently with healthy resource utilization, indicating well-balanced workloads with adequate capacity for current business requirements."</p>
<p><strong>Why this transformation matters:</strong></p>
<ul>
<li><strong>Technical teams</strong> get context about whether metrics indicate real problems</li>
<li><strong>Business stakeholders</strong> understand impact without needing to interpret technical details</li>
<li><strong>Decision makers</strong> receive actionable recommendations rather than just status updates</li>
</ul>
<h4 id="ai-analysis-configuration"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#ai-analysis-configuration">🎯 AI Analysis Configuration</a></h4>
<p>The AI analysis node sends structured data to Azure OpenAI with carefully crafted prompts:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1">// Azure OpenAI Analysis Node - HTTP Request Configuration</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="p">{</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">  </span><span class="s2">&quot;url&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://YOUR_RESOURCE.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-02-15-preview&quot;</span><span class="p">,</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">  </span><span class="s2">&quot;method&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">  </span><span class="s2">&quot;headers&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">    </span><span class="s2">&quot;Content-Type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">    </span><span class="s2">&quot;api-key&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;YOUR_AZURE_OPENAI_API_KEY&quot;</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">  </span><span class="s2">&quot;body&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">    </span><span class="s2">&quot;messages&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">        </span><span class="s2">&quot;role&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;system&quot;</span><span class="p">,</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">        </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;You are an infrastructure monitoring AI assistant. Analyze system metrics and provide clear, actionable insights for both technical teams and business stakeholders. Focus on business impact, recommendations, and next steps.&quot;</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="w">        </span><span class="s2">&quot;role&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="w">        </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Analyze this system data: Memory usage: {{$json.memory_percent}}%, Status: {{$json.alert_status}}, Health: {{$json.system_health}}. Provide business context, technical assessment, and specific recommendations.&quot;</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="w">    </span><span class="s2">&quot;max_tokens&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">500</span><span class="p">,</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="w">    </span><span class="s2">&quot;temperature&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0.3</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="report-generation-and-formatting"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#report-generation-and-formatting">📊 Report Generation and Formatting</a></h4>
<p>The AI response gets structured into professional reports suitable for email distribution:</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1">// Create Report Node - JavaScript Code</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$input</span><span class="p">.</span><span class="nx">first</span><span class="p">();</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">  </span><span class="c1">// Handle potential API errors</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">input</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">choices</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">choices</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;No AI response received&#39;</span><span class="p">);</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">  </span><span class="c1">// Extract AI analysis from Azure OpenAI response</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">aiAnalysis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">choices</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">message</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">metricsData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;Process Metrics&#39;</span><span class="p">).</span><span class="nx">item</span><span class="p">.</span><span class="nx">json</span><span class="p">;</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w">  </span><span class="c1">// Calculate token usage for monitoring</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">tokenUsage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">usage</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">usage</span><span class="p">.</span><span class="nx">total_tokens</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">    </span><span class="nx">report_id</span><span class="o">:</span><span class="w"> </span><span class="sb">`AI-MONITOR-</span><span class="si">${</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="mf">10</span><span class="p">)</span><span class="si">}</span><span class="sb">-</span><span class="si">${</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w">    </span><span class="nx">generated_at</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="w">    </span><span class="nx">ai_insights</span><span class="o">:</span><span class="w"> </span><span class="nx">aiAnalysis</span><span class="p">,</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="w">    </span><span class="nx">system_metrics</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w">      </span><span class="nx">memory_usage</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">metricsData</span><span class="p">.</span><span class="nx">memory_percent</span><span class="si">}</span><span class="sb">%`</span><span class="p">,</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="w">      </span><span class="nx">cpu_usage</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">metricsData</span><span class="p">.</span><span class="nx">cpu_percent</span><span class="si">}</span><span class="sb">%`</span><span class="p">,</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="w">      </span><span class="nx">alert_status</span><span class="o">:</span><span class="w"> </span><span class="nx">metricsData</span><span class="p">.</span><span class="nx">alert_status</span><span class="p">,</span>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="w">      </span><span class="nx">system_health</span><span class="o">:</span><span class="w"> </span><span class="nx">metricsData</span><span class="p">.</span><span class="nx">system_health</span>
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="w">    </span><span class="nx">usage_tracking</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a><span class="w">      </span><span class="nx">tokens_used</span><span class="o">:</span><span class="w"> </span><span class="nx">tokenUsage</span><span class="p">,</span>
</span><span id="__span-21-29"><a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="w">      </span><span class="nx">model_used</span><span class="o">:</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">model</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;gpt-4o-mini&#39;</span>
</span><span id="__span-21-30"><a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-21-31"><a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a><span class="w">    </span><span class="nx">metadata</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-32"><a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a><span class="w">      </span><span class="nx">next_check</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">5</span><span class="o">*</span><span class="mf">60</span><span class="o">*</span><span class="mf">1000</span><span class="p">).</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-21-33"><a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a><span class="w">      </span><span class="nx">report_type</span><span class="o">:</span><span class="w"> </span><span class="nx">metricsData</span><span class="p">.</span><span class="nx">alert_level</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;LOW&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;routine&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;alert&#39;</span><span class="p">,</span>
</span><span id="__span-21-34"><a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a><span class="w">      </span><span class="nx">confidence_score</span><span class="o">:</span><span class="w"> </span><span class="mf">0.95</span><span class="w"> </span><span class="c1">// Based on data quality</span>
</span><span id="__span-21-35"><a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-36"><a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-21-37"><a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a>
</span><span id="__span-21-38"><a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="nx">report</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-21-39"><a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a>
</span><span id="__span-21-40"><a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-41"><a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a><span class="w">  </span><span class="c1">// Fallback report without AI analysis</span>
</span><span id="__span-21-42"><a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">metricsData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;Process Metrics&#39;</span><span class="p">).</span><span class="nx">item</span><span class="p">.</span><span class="nx">json</span><span class="p">;</span>
</span><span id="__span-21-43"><a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a>
</span><span id="__span-21-44"><a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-21-45"><a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a><span class="w">    </span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-21-46"><a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a><span class="w">      </span><span class="nx">report_id</span><span class="o">:</span><span class="w"> </span><span class="sb">`AI-MONITOR-ERROR-</span><span class="si">${</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-21-47"><a id="__codelineno-21-47" name="__codelineno-21-47" href="#__codelineno-21-47"></a><span class="w">      </span><span class="nx">generated_at</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-21-48"><a id="__codelineno-21-48" name="__codelineno-21-48" href="#__codelineno-21-48"></a><span class="w">      </span><span class="nx">ai_insights</span><span class="o">:</span><span class="w"> </span><span class="sb">`System analysis unavailable due to AI service error. Raw metrics: Memory </span><span class="si">${</span><span class="nx">metricsData</span><span class="p">.</span><span class="nx">memory_percent</span><span class="si">}</span><span class="sb">%, CPU </span><span class="si">${</span><span class="nx">metricsData</span><span class="p">.</span><span class="nx">cpu_percent</span><span class="si">}</span><span class="sb">%. Status: </span><span class="si">${</span><span class="nx">metricsData</span><span class="p">.</span><span class="nx">alert_status</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-21-49"><a id="__codelineno-21-49" name="__codelineno-21-49" href="#__codelineno-21-49"></a><span class="w">      </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-21-50"><a id="__codelineno-21-50" name="__codelineno-21-50" href="#__codelineno-21-50"></a><span class="w">      </span><span class="nx">error_message</span><span class="o">:</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span>
</span><span id="__span-21-51"><a id="__codelineno-21-51" name="__codelineno-21-51" href="#__codelineno-21-51"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
</span><span id="__span-21-52"><a id="__codelineno-21-52" name="__codelineno-21-52" href="#__codelineno-21-52"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-21-53"><a id="__codelineno-21-53" name="__codelineno-21-53" href="#__codelineno-21-53"></a><span class="p">}</span>
</span></code></pre></div>
<p>This transforms the AI response into a structured report with tracking information, token usage monitoring, and timestamps—everything needed for understanding resource utilization and system performance.</p>
<h3 id="learning-checkpoint-ai-integration"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#learning-checkpoint-ai-integration">✅ Learning Checkpoint: AI Integration</a></h3>
<p>Before moving to production thinking, verify you can:</p>
<ul>
<li>[ ] Successfully call Azure OpenAI API with authentication</li>
<li>[ ] Create prompts that generate useful infrastructure analysis</li>
<li>[ ] Handle API errors and implement fallback behavior</li>
<li>[ ] Monitor token usage to understand resource consumption</li>
<li>[ ] Generate reports that are readable by non-technical stakeholders</li>
</ul>
<p><strong>Quick Test:</strong> Can you send sample metrics to Azure OpenAI and get back analysis that your manager could understand and act upon? If the analysis feels generic or unhelpful, focus on prompt engineering improvement.</p>
<p><strong>Common Issues at This Stage:</strong></p>
<ul>
<li><strong>Azure OpenAI authentication failures</strong> - API key or endpoint URL problems</li>
<li><strong>Rate limiting errors (HTTP 429)</strong> - Too frequent API calls or quota exceeded</li>
<li><strong>Generic AI responses</strong> - Prompts lack specificity or context</li>
<li><strong>Token usage escalation</strong> - Inefficient prompts or too frequent analysis</li>
</ul>
<p><img alt="Azure portal cost analysis showing actual token usage, costs, and optimization opportunities from home lab experimentation" src="../../ai-monitoring/azure-openai-cost-analysis.png" /></p>
<hr />
<h3 id="phase-4-professional-email-reporting"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#phase-4-professional-email-reporting">📧 Phase 4: Professional Email Reporting</a></h3>
<p>The final component transforms AI insights into professional stakeholder communications that drive business decisions.</p>
<h4 id="html-email-template-design"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#html-email-template-design">🎨 HTML Email Template Design</a></h4>
<div class="language-html highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="cm">&lt;!-- Email Template Node - HTML Content --&gt;</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Infrastructure Intelligence Report<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="nt">body</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;Segoe UI&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">Tahoma</span><span class="p">,</span><span class="w"> </span><span class="n">Geneva</span><span class="p">,</span><span class="w"> </span><span class="n">Verdana</span><span class="p">,</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span><span class="w"> </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#f5f5f5</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="p">.</span><span class="nc">container</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">800</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span><span class="w"> </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span><span class="w"> </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">box-shadow</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">2</span><span class="kt">px</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="p">.</span><span class="nc">header</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="nb">linear-gradient</span><span class="p">(</span><span class="mi">135</span><span class="kt">deg</span><span class="p">,</span><span class="w"> </span><span class="mh">#667eea</span><span class="w"> </span><span class="mi">0</span><span class="kt">%</span><span class="p">,</span><span class="w"> </span><span class="mh">#764ba2</span><span class="w"> </span><span class="mi">100</span><span class="kt">%</span><span class="p">);</span><span class="w"> </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span><span class="w"> </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="p">.</span><span class="nc">content</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="p">.</span><span class="nc">metric-card</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#f8f9fa</span><span class="p">;</span><span class="w"> </span><span class="k">border-left</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="mh">#007bff</span><span class="p">;</span><span class="w"> </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="kt">px</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="p">.</span><span class="nc">ai-analysis</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#e8f4fd</span><span class="p">;</span><span class="w"> </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="mh">#bee5eb</span><span class="p">;</span><span class="w"> </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="p">.</span><span class="nc">footer</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#f8f9fa</span><span class="p">;</span><span class="w"> </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span><span class="w"> </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="mh">#6c757d</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;header&quot;</span><span class="p">&gt;</span>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>🤖 AI Infrastructure Intelligence Report<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Automated analysis and recommendations • {{ $json.generated_at }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;content&quot;</span><span class="p">&gt;</span>
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>🧠 AI-Powered Analysis<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
</span><span id="__span-22-27"><a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;ai-analysis&quot;</span><span class="p">&gt;</span>
</span><span id="__span-22-28"><a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a><span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>System Intelligence Summary:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span><span id="__span-22-29"><a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a>{{ $json.ai_insights }}
</span><span id="__span-22-30"><a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-22-31"><a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a>
</span><span id="__span-22-32"><a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>📊 Current System Metrics<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
</span><span id="__span-22-33"><a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;metric-card&quot;</span><span class="p">&gt;</span>
</span><span id="__span-22-34"><a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a><span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Memory Utilization:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> {{ $json.system_metrics.memory_usage }}<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span><span id="__span-22-35"><a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a><span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>System Status:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> {{ $json.system_metrics.alert_status }}<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span><span id="__span-22-36"><a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a><span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Health Assessment:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> {{ $json.system_metrics.system_health }}
</span><span id="__span-22-37"><a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-22-38"><a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a>
</span><span id="__span-22-39"><a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>💰 Token Usage Analysis<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
</span><span id="__span-22-40"><a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;background-color: #d1ecf1; padding: 10px; border-radius: 5px;&quot;</span><span class="p">&gt;</span>
</span><span id="__span-22-41"><a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
</span><span id="__span-22-42"><a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a><span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Tokens Used This Report:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> {{ $json.usage_tracking.tokens_used }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span><span id="__span-22-43"><a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a><span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>AI Model:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> {{ $json.usage_tracking.model_used }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span><span id="__span-22-44"><a id="__codelineno-22-44" name="__codelineno-22-44" href="#__codelineno-22-44"></a><span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Analysis Frequency:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> Configurable based on monitoring requirements<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span><span id="__span-22-45"><a id="__codelineno-22-45" name="__codelineno-22-45" href="#__codelineno-22-45"></a><span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Note:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> Token usage varies based on metric complexity and prompt length<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span><span id="__span-22-46"><a id="__codelineno-22-46" name="__codelineno-22-46" href="#__codelineno-22-46"></a><span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</span><span id="__span-22-47"><a id="__codelineno-22-47" name="__codelineno-22-47" href="#__codelineno-22-47"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-22-48"><a id="__codelineno-22-48" name="__codelineno-22-48" href="#__codelineno-22-48"></a>
</span><span id="__span-22-49"><a id="__codelineno-22-49" name="__codelineno-22-49" href="#__codelineno-22-49"></a><span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>⏰ Report Metadata<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
</span><span id="__span-22-50"><a id="__codelineno-22-50" name="__codelineno-22-50" href="#__codelineno-22-50"></a><span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
</span><span id="__span-22-51"><a id="__codelineno-22-51" name="__codelineno-22-51" href="#__codelineno-22-51"></a><span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Report ID:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> {{ $json.report_id }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span><span id="__span-22-52"><a id="__codelineno-22-52" name="__codelineno-22-52" href="#__codelineno-22-52"></a><span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Generated:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> {{ $json.generated_at }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span><span id="__span-22-53"><a id="__codelineno-22-53" name="__codelineno-22-53" href="#__codelineno-22-53"></a><span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Next Check:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> {{ $json.metadata.next_check }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span><span id="__span-22-54"><a id="__codelineno-22-54" name="__codelineno-22-54" href="#__codelineno-22-54"></a><span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Report Type:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> {{ $json.metadata.report_type }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span><span id="__span-22-55"><a id="__codelineno-22-55" name="__codelineno-22-55" href="#__codelineno-22-55"></a><span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</span><span id="__span-22-56"><a id="__codelineno-22-56" name="__codelineno-22-56" href="#__codelineno-22-56"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-22-57"><a id="__codelineno-22-57" name="__codelineno-22-57" href="#__codelineno-22-57"></a>
</span><span id="__span-22-58"><a id="__codelineno-22-58" name="__codelineno-22-58" href="#__codelineno-22-58"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;footer&quot;</span><span class="p">&gt;</span>
</span><span id="__span-22-59"><a id="__codelineno-22-59" name="__codelineno-22-59" href="#__codelineno-22-59"></a><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Generated by AI-Powered Infrastructure Monitoring System<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span><span id="__span-22-60"><a id="__codelineno-22-60" name="__codelineno-22-60" href="#__codelineno-22-60"></a>Home Lab Implementation • Learning Project for Cloud Production Application<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-22-61"><a id="__codelineno-22-61" name="__codelineno-22-61" href="#__codelineno-22-61"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-22-62"><a id="__codelineno-22-62" name="__codelineno-22-62" href="#__codelineno-22-62"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-22-63"><a id="__codelineno-22-63" name="__codelineno-22-63" href="#__codelineno-22-63"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-22-64"><a id="__codelineno-22-64" name="__codelineno-22-64" href="#__codelineno-22-64"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div>
<h4 id="email-delivery-configuration"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#email-delivery-configuration">📮 Email Delivery Configuration</a></h4>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1">// Email Delivery Node - SMTP Configuration</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="p">{</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">  </span><span class="s2">&quot;host&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">  </span><span class="s2">&quot;port&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">587</span><span class="p">,</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">  </span><span class="s2">&quot;secure&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">  </span><span class="s2">&quot;auth&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">    </span><span class="s2">&quot;user&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;your-email@gmail.com&quot;</span><span class="p">,</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">    </span><span class="s2">&quot;pass&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;your-app-password&quot;</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">  </span><span class="s2">&quot;from&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AI Infrastructure Monitor &lt;your-email@gmail.com&gt;&quot;</span><span class="p">,</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">  </span><span class="s2">&quot;to&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;stakeholders@company.com&quot;</span><span class="p">,</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">  </span><span class="s2">&quot;subject&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;🤖 Infrastructure Intelligence Report - {{ $json.system_metrics.alert_status }}&quot;</span><span class="p">,</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">  </span><span class="s2">&quot;html&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;{{ $(&#39;HTML Template&#39;).item.json.html_content }}&quot;</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="p">}</span>
</span></code></pre></div>
<p>The difference between this and traditional monitoring emails is remarkable—instead of "CPU is at 85%," stakeholders get "The system is operating within optimal parameters with excellent resource efficiency, suggesting current workloads are well-balanced and no immediate action is required."</p>
<p><img alt="Professional HTML email showing AI analysis, formatted metrics, and business impact summary" src="../../ai-monitoring/email-report-example.png" /></p>
<hr />
<h3 id="my-learning-journey-what-actually-happened"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#my-learning-journey-what-actually-happened">🎯 My Learning Journey: What Actually Happened</a></h3>
<p>Understanding the real progression of this project helps set realistic expectations for your own learning experience.</p>
<p><strong>Week 1: Foundation Building</strong>
I started by getting the basic monitoring stack working. The Docker Compose approach made deployment straightforward, but understanding <em>why</em> each component was needed took time. I spent several days just exploring Prometheus queries and Grafana dashboards—this foundational understanding proved essential for later AI integration.</p>
<p><strong>Week 2: Workflow Automation Discovery</strong><br />
Adding n8n was where things got interesting. The visual workflow builder made complex logic manageable, but I quickly learned that proper error handling isn't optional—it's essential. Using Anthropic Claude to debug JavaScript issues in workflows saved hours of frustration and accelerated my learning significantly.</p>
<p><strong>Week 3: AI Integration Breakthrough</strong>
This is where the real magic happened. Seeing raw metrics transformed into business-relevant insights was genuinely exciting. The key insight: prompt engineering for infrastructure is fundamentally different from general AI use—specificity about your environment and context matters enormously.</p>
<p><strong>Week 4: Production Thinking</strong>
The final week focused on understanding how these patterns would apply to real cloud infrastructure. This home lab approach meant I could experiment safely and make mistakes without impact, while building knowledge directly applicable to production environments.</p>
<hr />
<h3 id="home-lab-performance-observations"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#home-lab-performance-observations">📊 Home Lab Performance Observations</a></h3>
<p>After running the system continuously in my home lab environment:</p>
<p><strong>System Reliability:</strong></p>
<ul>
<li><strong>Uptime</strong>: 99.2% (brief restarts for updates and one power outage)</li>
<li><strong>Data collection reliability</strong>: 99.8% (missed 3 collection cycles due to network issues)</li>
<li><strong>AI analysis success rate</strong>: 97.1% (some Azure throttling during peak hours)</li>
<li><strong>Email delivery</strong>: 100% (SMTP proved reliable for testing purposes)</li>
</ul>
<p><strong>Resource Utilization on Pi 5:</strong></p>
<ul>
<li><strong>Memory usage</strong>: 68% peak, 45% average (acceptable for home lab testing)</li>
<li><strong>CPU usage</strong>: 15% peak, 8% average (monitoring has minimal impact)</li>
<li><strong>Storage growth</strong>: 120MB/week (Prometheus data with 7-day retention and compression)</li>
</ul>
<p><strong>Response Times in Home Lab:</strong></p>
<ul>
<li><strong>Metric collection</strong>: 2.3 seconds average</li>
<li><strong>AI analysis response</strong>: 8.7 seconds average (Azure OpenAI)</li>
<li><strong>End-to-end report generation</strong>: 12.4 seconds</li>
<li><strong>Email delivery</strong>: 3.1 seconds average</li>
</ul>
<p><strong>Token Usage Observations:</strong></p>
<ul>
<li><strong>Average tokens per analysis</strong>: ~507 tokens</li>
<li><strong>Analysis frequency</strong>: Hourly during active testing</li>
<li><strong>Model efficiency</strong>: GPT-4o-mini provided excellent analysis quality for infrastructure metrics</li>
<li><strong>Optimization</strong>: Prompt refinement reduced token usage by ~20% over time</li>
</ul>
<p><em>Note: These are home lab observations for learning purposes. Production cloud deployments would have different performance characteristics and scaling requirements.</em></p>
<hr />
<h3 id="challenges-and-learning-points"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#challenges-and-learning-points">⚠️ Challenges and Learning Points</a></h3>
<p><strong>Prometheus query optimization is critical:</strong> Inefficient queries can overwhelm the Pi 5, especially during high-cardinality metric collection. Always validate queries against realistic datasets and implement appropriate rate limiting. Complex aggregation queries should be pre-computed where possible.</p>
<p><strong>n8n workflow complexity escalates quickly:</strong> What starts as simple data collection becomes complex orchestration with error handling, retries, and fallbacks. Start simple and add features incrementally. I found that using Anthropic Claude to help debug workflow issues significantly accelerated problem resolution.</p>
<p><strong>AI prompt engineering requires iteration:</strong> Generic prompts produce generic insights that add little value over traditional alerting. Tailoring prompts for specific infrastructure contexts, stakeholder audiences, and business objectives dramatically improves output quality and relevance.</p>
<p><strong>Network reliability affects everything:</strong> Since the system depends on multiple external APIs (Azure OpenAI, SMTP), network connectivity issues cascade through the entire workflow. Implementing proper timeout handling and offline modes is essential for production reliability.</p>
<p><strong>Token usage visibility drives optimization:</strong> Monitoring token consumption in real-time helped optimize prompt design and understand the resource implications of different analysis frequencies. This transparency enabled informed decisions about monitoring granularity versus AI resource usage.</p>
<hr />
<h3 id="common-issues-and-solutions"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#common-issues-and-solutions">🛠️ Common Issues and Solutions</a></h3>
<p>Based on practical experience running this system, here are the most frequent challenges and their resolutions:</p>
<h4 id="prometheus-connection-issues"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#prometheus-connection-issues"><strong>Prometheus Connection Issues</strong></a></h4>
<p><strong>Symptom</strong>: Targets showing as "DOWN" in Prometheus interface</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># Check Prometheus targets status</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>curl<span class="w"> </span>http://localhost:9090/api/v1/targets
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="c1"># Verify container networking</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>docker<span class="w"> </span>network<span class="w"> </span>inspect<span class="w"> </span>ai-monitoring-lab_monitoring
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="c1"># Check if services can reach each other</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>prometheus<span class="w"> </span>ping<span class="w"> </span>node-exporter
</span></code></pre></div>
<h4 id="n8n-workflow-execution-failures"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#n8n-workflow-execution-failures"><strong>n8n Workflow Execution Failures</strong></a></h4>
<p><strong>Symptom</strong>: HTTP 500 errors in workflow execution logs</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1">// Add comprehensive error handling to JavaScript nodes</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">processMetrics</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Processing failed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w">    </span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">      </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">      </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">      </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">()</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="azure-openai-rate-limiting"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#azure-openai-rate-limiting"><strong>Azure OpenAI Rate Limiting</strong></a></h4>
<p><strong>Symptom</strong>: Sporadic HTTP 429 errors</p>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1">// Implement exponential backoff for API calls</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">retryWithBackoff</span><span class="p">(</span><span class="nx">apiCall</span><span class="p">,</span><span class="w"> </span><span class="nx">maxRetries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">attempt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">attempt</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">maxRetries</span><span class="p">;</span><span class="w"> </span><span class="nx">attempt</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">apiCall</span><span class="p">();</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">429</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">500</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">backoffDelay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="mf">1000</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">attempt</span><span class="p">),</span><span class="w"> </span><span class="mf">30000</span><span class="p">);</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">backoffDelay</span><span class="p">));</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`API call failed after </span><span class="si">${</span><span class="nx">maxRetries</span><span class="si">}</span><span class="sb"> attempts`</span><span class="p">);</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="memory-management-on-raspberry-pi"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#memory-management-on-raspberry-pi"><strong>Memory Management on Raspberry Pi</strong></a></h4>
<p><strong>Symptom</strong>: System becomes unresponsive under load</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># Add memory limits to docker-compose.yml</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">  </span><span class="nt">prometheus</span><span class="p">:</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">    </span><span class="nt">mem_limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1g</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">    </span><span class="nt">mem_reservation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512m</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">  </span><span class="nt">grafana</span><span class="p">:</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">    </span><span class="nt">mem_limit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512m</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="w">    </span><span class="nt">mem_reservation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256m</span>
</span></code></pre></div>
<hr />
<h3 id="whats-next-after-this-project"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#whats-next-after-this-project">🎯 What's Next After This Project?</a></h3>
<p>Having successfully built an AI-powered monitoring system in your home lab, you've developed transferable skills for larger infrastructure projects:</p>
<p><strong>Immediate Next Steps:</strong></p>
<ul>
<li>Apply these patterns to cloud infrastructure (AWS EC2, Azure VMs)</li>
<li>Expand monitoring to cover application metrics, not just system metrics</li>
<li>Explore other AI models and prompt engineering techniques</li>
</ul>
<p><strong>Future Learning Projects:</strong></p>
<ul>
<li><strong>Security Event Analysis</strong>: Use similar AI integration patterns for log analysis</li>
<li><strong>Cost Optimization</strong>: Apply AI analysis to cloud billing and usage data</li>
<li><strong>Capacity Planning</strong>: Extend monitoring for predictive resource planning</li>
</ul>
<p><strong>Skills You Can Now Confidently Apply:</strong></p>
<ul>
<li>Integrating AI services with traditional monitoring tools</li>
<li>Creating business-relevant reports from technical metrics</li>
<li>Building automated workflows for infrastructure management</li>
<li>Designing scalable monitoring architectures</li>
</ul>
<hr />
<h3 id="additional-resources"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#additional-resources">📚 Additional Resources</a></h3>
<h4 id="official-documentation"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#official-documentation">🛠️ Official Documentation</a></h4>
<p><strong>Container and Orchestration:</strong></p>
<ul>
<li><a href="https://docs.docker.com/compose/compose-file/">Docker Compose File Reference</a> — Complete YAML schema validation</li>
<li><a href="https://docs.docker.com/network/">Docker Networking Guide</a> — Container communication and troubleshooting</li>
</ul>
<p><strong>Monitoring and Observability:</strong></p>
<ul>
<li><a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/">Prometheus Configuration</a> — Official configuration reference</li>
<li><a href="https://github.com/prometheus/node_exporter#enabled-by-default">Node Exporter Metrics</a> — Available system metrics</li>
<li><a href="https://grafana.com/docs/grafana/latest/administration/provisioning/">Grafana Provisioning</a> — Automated setup documentation</li>
</ul>
<p><strong>Workflow Automation:</strong></p>
<ul>
<li><a href="https://docs.n8n.io/integrations/builtin/">n8n Node Documentation</a> — Complete node reference</li>
<li><a href="https://docs.n8n.io/workflows/examples/">n8n Workflow Examples</a> — Official workflow patterns</li>
</ul>
<p><strong>AI Integration:</strong></p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/reference">Azure OpenAI REST API</a> — Complete API specification</li>
<li><a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/quickstart">Azure OpenAI Quickstart</a> — Getting started guide</li>
</ul>
<h4 id="learning-resources"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#learning-resources">🎓 Learning Resources</a></h4>
<p><strong>Docker and Containerization:</strong></p>
<ul>
<li><a href="https://docs.docker.com/get-started/">Docker Getting Started</a> — Official tutorial</li>
<li><a href="https://labs.play-with-docker.com/">Play with Docker</a> — Interactive learning environment</li>
</ul>
<p><strong>Monitoring Fundamentals:</strong></p>
<ul>
<li><a href="https://prometheus.io/docs/prometheus/latest/getting_started/">Prometheus Getting Started</a> — Official introduction</li>
<li><a href="https://grafana.com/tutorials/grafana-fundamentals/">Grafana Fundamentals</a> — Hands-on tutorial</li>
</ul>
<p><strong>AI and Prompt Engineering:</strong></p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/training/paths/develop-ai-solutions-azure-openai/">Azure OpenAI Learning Path</a> — Microsoft Learn modules</li>
<li><a href="https://www.promptingguide.ai/">Prompt Engineering Guide</a> — Best practices and examples</li>
</ul>
<hr />
<h3 id="conclusion-ai-enhanced-monitoring-success"><a class="toclink" href="../../building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/#conclusion-ai-enhanced-monitoring-success">🎯 Conclusion: AI-Enhanced Monitoring Success</a></h3>
<p>This home lab project successfully demonstrates how AI can transform traditional infrastructure monitoring from simple threshold alerts into intelligent, actionable insights. The structured approach—from Docker fundamentals through AI integration—provides a practical learning path for developing production-ready skills in a cost-effective environment.</p>
<p><strong>Key Achievements:</strong></p>
<ul>
<li><strong>Technical Integration</strong>: Successfully combined Prometheus, Grafana, n8n, and Azure OpenAI into a cohesive monitoring system</li>
<li><strong>AI Prompt Engineering</strong>: Developed context-specific prompts that transform raw metrics into business-relevant insights</li>
<li><strong>Professional Communication</strong>: Created stakeholder-ready reports that bridge technical data and business impact</li>
<li><strong>Cost-Conscious Development</strong>: Leveraged subscription benefits for extensive AI experimentation</li>
</ul>
<p><strong>Most Valuable Insights:</strong></p>
<ul>
<li><strong>AI analysis quality depends on data structure and prompt engineering</strong> - generic prompts produce generic insights</li>
<li><strong>Visual workflow tools dramatically reduce development complexity</strong> while maintaining flexibility</li>
<li><strong>Home lab experimentation provides a safe environment</strong> for expensive AI service optimization</li>
<li><strong>Business context and stakeholder communication</strong> are as important as technical implementation</li>
</ul>
<p><strong>Professional Development Impact:</strong>
The patterns learned in this project—intelligent data collection, contextual analysis, and automated communication—scale directly to enterprise monitoring requirements. For infrastructure professionals exploring AI integration, this home lab approach provides hands-on experience with real tools and challenges that translate to immediate career value.</p>
<p>The investment in learning these integration patterns delivers improved monitoring effectiveness, reduced alert noise, and enhanced stakeholder communication—essential skills for modern infrastructure teams working with AI-augmented systems.</p>
<hr />
<p><a class="md-button" href="https://x.com/intent/tweet?text=Building%20AI-Powered%20Infrastructure%20Monitoring%3A%20From%20Home%20Lab%20to%20Cloud%20Production%0A&amp;url=https://blog.pollockweb.com/blog/building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/building-ai-powered-infrastructure-monitoring-from-home-lab-to-cloud-production/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-06-09 00:00:00+00:00">June 9, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/ai/" class="md-meta__link">AI</a>, 
              <a href="../../category/automation/" class="md-meta__link">Automation</a>, 
              <a href="../../category/self-hosting/" class="md-meta__link">Self-Hosting</a></li>
        
        
          
          <li class="md-meta__item">
            
              14 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/">🤖 First Steps into AI Automation: My Journey from Trial to Self-Hosted Chaos</a></h2>
<blockquote>
<p>What started as 'let me just automate some emails' somehow turned into a comprehensive exploration of every AI automation platform and deployment method known to mankind...</p>
</blockquote>
<p>After months of reading about AI automation tools and watching everyone else's productivity skyrocket with clever workflows, I finally decided to stop being a spectator and dive in myself. What started as a simple "let's automate job alert emails" experiment quickly became a week-long journey through cloud trials, self-hosted deployments, OAuth authentication battles, and enough Docker containers to power a small data centre.</p>
<p><strong>In this post, you'll discover:</strong></p>
<ul>
<li>Real costs of AI automation experimentation ($10-50 range)</li>
<li>Why self-hosted OAuth2 is significantly harder than cloud versions</li>
<li>Performance differences: Pi 5 vs. desktop hardware for local AI</li>
<li>When to choose local vs. cloud AI models</li>
<li>Time investment reality: ~10 hours over 1 week for this project</li>
</ul>
<p>Here's how my first real foray into AI automation unfolded — spoiler alert: it involved more container migrations than I initially planned.</p>
<p><strong>Hardware baseline for this project:</strong></p>
<blockquote>
<p><strong>💻 Development Environment</strong></p>
<ul>
<li><strong>Primary machine:</strong> AMD Ryzen 7 5800X, 32GB DDR4, NVMe SSD</li>
<li><strong>Pi 5 setup:</strong> 8GB RAM, microSD storage  </li>
<li><strong>Network:</strong> Standard home broadband (important for cloud API performance)</li>
</ul>
</blockquote>
<hr />
<h3 id="the-mission-taming-job-alert-email-chaos"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#the-mission-taming-job-alert-email-chaos">🎯 The Mission: Taming Job Alert Email Chaos</a></h3>
<p>Let's set the scene. If you're drowning in recruitment emails like I was, spending 30+ minutes daily parsing through multiple job listings scattered across different emails, you'll understand the frustration. Each recruitment platform has its own format, some emails contain 5-10 different opportunities, and manually extracting the relevant URLs was becoming a productivity killer.</p>
<p><strong>The vision:</strong> Create an automated workflow that would:</p>
<ul>
<li>Scrape job-related emails from my Outlook.com inbox</li>
<li>Extract and clean the job data using AI</li>
<li>Generate a neat summary email with all the job URLs in one place</li>
<li>Send it back to me in a digestible format</li>
</ul>
<p>Simple enough, right? <em>Famous last words.</em></p>
<hr />
<h3 id="phase-1-the-n8n-cloud-trial-adventure"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#phase-1-the-n8n-cloud-trial-adventure">🔄 Phase 1: The n8n Cloud Trial Adventure</a></h3>
<p>My research pointed to <a href="https://n8n.io/">n8n</a> as the go-to tool for this kind of automation workflow. Being sensible, I started with their 14-day cloud trial rather than jumping straight into self-hosting complexities.</p>
<h4 id="initial-setup-first-success"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#initial-setup-first-success">⚙️ Initial Setup &amp; First Success</a></h4>
<p>The n8n cloud interface is genuinely impressive — drag-and-drop workflow building with a proper visual editor that actually makes sense. Within a couple of hours, I had:</p>
<p>✅ <strong>Connected to Outlook.com</strong> via their built-in connector<br />
✅ <strong>Set up email filtering</strong> to grab job-related messages<br />
✅ <strong>Configured basic data processing</strong> to extract text content<br />
✅ <strong>Integrated OpenAI API</strong> for intelligent job URL extraction  </p>
<p><img alt="n8n jobs workflow with OpenAI API integration" src="../../ai-automation/n8n-jobs-workflow-openai.png" /></p>
<h4 id="the-ai-integration-challenge"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#the-ai-integration-challenge">🤖 The AI Integration Challenge</a></h4>
<p>This is where things got interesting. Initially, I connected the workflow to my <a href="https://openai.com/api/">OpenAI API</a> account, using GPT-4 to parse email content and extract job URLs. The AI component worked brilliantly — almost too well, since I managed to burn through my $10 worth of token credits in just two days of testing.</p>
<p><strong>The cost reality:</strong> Those "just testing a few prompts" sessions add up fast. A single complex email with multiple job listings processed through GPT-4 was costing around $0.15-0.30 per API call. When you're iterating on prompts and testing edge cases, those costs compound quickly.</p>
<p><strong>Lesson learned:</strong> Test with smaller models first, then scale up. GPT-4 is excellent but not cheap for experimental workflows.</p>
<h4 id="partial-success-the-classic-it-story"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#partial-success-the-classic-it-story">🎯 Partial Success (The Classic IT Story)</a></h4>
<p>The workflow was <em>partially</em> successful — and in true IT fashion, "partially" is doing some heavy lifting here. While the automation successfully processed emails and generated summaries, it had one glaring limitation: <strong>it only extracted one job URL per email</strong>, when most recruitment emails contain multiple opportunities.</p>
<p><strong>What this actually meant:</strong> A typical recruitment email might contain 5-7 job listings with individual URLs, but my workflow would only capture the first one it encountered. This wasn't a parsing issue — the AI was correctly identifying all the URLs in its response, but the n8n workflow was only processing the first result from the AI output.</p>
<p><strong>Why this limitation exists:</strong> The issue stemmed from how I'd configured the data processing nodes in n8n. The workflow was treating the AI response as a single data item rather than an array of multiple URLs. This is a common beginner mistake when working with structured data outputs.</p>
<p>This became the recurring theme of my experimentation week: <em>everything works, just not quite how you want it to.</em></p>
<h4 id="enter-azure-openai"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#enter-azure-openai">💡 Enter Azure OpenAI</a></h4>
<p>Rather than continue burning through OpenAI credits, I pivoted to <a href="https://azure.microsoft.com/en-gb/products/ai-services/openai-service">Azure OpenAI</a>. This turned out to be a smart move for several reasons:</p>
<ul>
<li><strong>Cost control:</strong> Better integration with my existing Azure credits</li>
<li><strong>Familiar environment:</strong> Already comfortable with Azure resource management  </li>
<li><strong>Testing flexibility:</strong> My Visual Studio Developer subscription gives me £120 monthly credits</li>
</ul>
<p>I deployed a <strong>GPT-4 Mini</strong> model in my test lab Azure tenant — perfect for experimentation without breaking the bank.</p>
<p><img alt="Azure OpenAI GPT-4 Mini deployment configuration" src="../../ai-automation/azure-openai-deployment.png" /></p>
<p>The Azure OpenAI integration worked seamlessly with n8n, and I successfully redirected my workflow to use the new endpoint. <em>Finally, something that worked first time.</em></p>
<p><img alt="n8n jobs workflow with Azure OpenAI integration" src="../../ai-automation/n8n-jobs-workflow-azure.png" /></p>
<hr />
<h3 id="phase-2-self-hosting-ambitions-container-edition-1"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#phase-2-self-hosting-ambitions-container-edition-1">🐳 Phase 2: Self-Hosting Ambitions (Container Edition #1)</a></h3>
<p>With the n8n cloud trial clocking ticking down, I faced the classic build-vs-buy decision. The cloud version was excellent, but I wanted full control and the ability to experiment without subscription constraints. The monthly $20 cost wasn't prohibitive, but the learning opportunity of self-hosting was too appealing to pass up.</p>
<p>Enter self-hosting with Docker containers — specifically, targeting my Raspberry Pi 5 setup.</p>
<h4 id="the-openmediavault-experiment"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#the-openmediavault-experiment">🏠 The OpenMediaVault Experiment</a></h4>
<p>My first attempt involved deploying n8n as a self-hosted Docker container on my <a href="https://www.openmediavault.org/">OpenMediaVault (OMV)</a> setup. For those unfamiliar, OMV is a network-attached storage (NAS) solution built on Debian, perfect for home lab environments where you want proper storage management with container capabilities.</p>
<p><strong>Why the Pi 5 + OMV route:</strong></p>
<ul>
<li><strong>Always-on availability:</strong> Unlike my main PC, the Pi runs 24/7</li>
<li><strong>Low power consumption:</strong> Perfect for continuous automation workflows</li>
<li><strong>Storage integration:</strong> OMV provides excellent Docker volume management</li>
<li><strong>Learning opportunity:</strong> Understanding self-hosted deployment challenges</li>
</ul>
<p><strong>The setup:</strong></p>
<ul>
<li><strong>Host:</strong> Raspberry Pi 5 running OpenMediaVault</li>
<li><strong>Backend storage:</strong> NAS device for persistent data</li>
<li><strong>Database:</strong> PostgreSQL container for n8n's backend</li>
<li><strong>Edition:</strong> n8n Community Edition (self-hosted)</li>
</ul>
<p><img alt="OpenMediaVault Docker container management interface" src="../../ai-automation/omv-docker-n8n-containers.png" /></p>
<h4 id="the-great-oauth-authentication-battle"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#the-great-oauth-authentication-battle">😤 The Great OAuth Authentication Battle</a></h4>
<p>This is where my self-hosting dreams met reality with a resounding thud.</p>
<p>I quickly discovered that replicating my cloud workflow wasn't going to be straightforward. The self-hosted community edition has functionality restrictions compared to the cloud version, but more frustratingly, I couldn't get OAuth2 authentication working properly.</p>
<p><strong>Why OAuth2 is trickier with self-hosted setups:</strong></p>
<ul>
<li><strong>Redirect URI complexity:</strong> Cloud services handle callback URLs automatically, but self-hosted instances need manually configured redirect URIs</li>
<li><strong>App registration headaches:</strong> Azure app registrations expect specific callback patterns that don't align well with dynamic self-hosted URLs</li>
<li><strong>Token management:</strong> Cloud versions handle OAuth token refresh automatically; self-hosted requires manual configuration</li>
<li><strong>Security certificate requirements:</strong> Many OAuth providers now require HTTPS callbacks, adding SSL certificate management complexity</li>
</ul>
<p><strong>The specific challenges I hit:</strong></p>
<ul>
<li><strong>Outlook.com authentication:</strong> Couldn't configure OAuth2 credentials using an app registration from my test lab Azure tenant</li>
<li><strong>Exchange Online integration:</strong> Also failed to connect via app registration — kept getting "invalid redirect URI" errors</li>
<li><strong>Documentation gaps:</strong> Self-hosting authentication setup felt less polished than the cloud version</li>
</ul>
<p>After several hours over two days debugging OAuth flows and Azure app registrations, I admitted defeat on the email integration front. <em>Sometimes retreat is the better part of valour.</em></p>
<h4 id="simple-success-weather-api-workflow"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#simple-success-weather-api-workflow">🌤️ Simple Success: Weather API Workflow</a></h4>
<p>Rather than abandon the entire self-hosting experiment, I pivoted to a simpler proof-of-concept. I created a basic workflow using:</p>
<ul>
<li><strong><a href="https://openweathermap.org/api">OpenWeatherMap API</a></strong> for weather data</li>
<li><strong>Gmail integration</strong> with app passwords (much simpler than OAuth2)</li>
<li><strong>Basic data processing</strong> and email generation</li>
</ul>
<p>This worked perfectly and proved that the self-hosted n8n environment was functional — the issue was specifically with the more complex authentication requirements of my original workflow.</p>
<p><img alt="Simple n8n weather workflow using OpenAI API" src="../../ai-automation/n8n-weather-workflow.png" /></p>
<hr />
<h3 id="phase-3-the-wsl-migration-container-migration-2"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#phase-3-the-wsl-migration-container-migration-2">🐳 Phase 3: The WSL Migration (Container Migration #2)</a></h3>
<p>While the Pi 5 setup was working fine for simple workflows, I started feeling the hardware limitations when testing more complex operations. Loading even smaller AI models was painfully slow, and memory constraints meant I couldn't experiment with anything approaching production-scale workflows.</p>
<p>Time for <strong>Container Migration #2</strong>.</p>
<h4 id="moving-to-wsl-docker-desktop"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#moving-to-wsl-docker-desktop">🖥️ Moving to WSL + Docker Desktop</a></h4>
<p>With the Pi 5 hitting performance limits, I decided to experiment with local AI models using Ollama (a local LLM hosting platform) and OpenWebUI (a web interface for interacting with AI models). This required more computational resources than the Pi could provide, so I deployed these tools using Docker Compose inside Ubuntu running on Windows WSL (Windows Subsystem for Linux).</p>
<p>This setup offered several advantages:</p>
<p><strong>Why WSL over the Pi 5:</strong></p>
<ul>
<li><strong>Better hardware resources:</strong> Access to my Windows PC's 32GB RAM and 8-core CPU vs. Pi 5's 8GB RAM limitation</li>
<li><strong>Docker Desktop integration:</strong> Visual container management through familiar interface</li>
<li><strong>Development flexibility:</strong> Easier to iterate and debug workflows with full IDE access</li>
<li><strong>Performance reality:</strong> Local LLM model loading went from 1+ minutes on Pi 5 to under 30 seconds</li>
</ul>
<p><strong>My development machine specs:</strong></p>
<ul>
<li><strong>CPU:</strong> AMD Ryzen 7 5800H with Radeon Graphics</li>
<li><strong>RAM:</strong> 32GB DDR4</li>
<li><strong>Storage:</strong> NVMe SSD for fast model loading</li>
<li><strong>GPU:</strong> None (pure CPU inference)</li>
</ul>
<p><strong>Time Investment Reality:</strong></p>
<ul>
<li><strong>n8n cloud setup:</strong> 2-3 hours (including initial workflow creation)</li>
<li><strong>OAuth2 debugging:</strong> 3+ hours over 2 days (ongoing challenge)</li>
<li><strong>Pi 5 container setup:</strong> 2+ hours</li>
<li><strong>Docker Desktop container set up:</strong> 2+ hours</li>
<li><strong>Total project time:</strong> ~10 hours over 1 week</li>
</ul>
<p><strong>The new stack:</strong></p>
<ul>
<li><strong>Host:</strong> Ubuntu in WSL2 on Windows</li>
<li><strong>Container orchestration:</strong> Docker Compose</li>
<li><strong>Management:</strong> Docker Desktop for Windows</li>
<li><strong>Models:</strong> <a href="https://ollama.ai/">Ollama</a> for local LLM hosting</li>
<li><strong>Interface:</strong> <a href="https://openwebui.com/">OpenWebUI</a> for model interaction</li>
</ul>
<p><img alt="Docker Desktop showing Ollama containers running" src="../../ai-automation/docker-desktop-ollama.png" /></p>
<h4 id="local-llm-experimentation"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#local-llm-experimentation">🧠 Local LLM Experimentation</a></h4>
<p>This is where the project took an interesting turn. Rather than continuing to rely on cloud APIs, I started experimenting with local language models through Ollama.</p>
<p><strong>Why local LLMs?</strong></p>
<ul>
<li><strong>Cost control:</strong> No per-token charges for experimentation</li>
<li><strong>Privacy:</strong> Sensitive data stays on local infrastructure</li>
<li><strong>Learning opportunity:</strong> Understanding how different models perform</li>
</ul>
<p>The Docker Compose setup made it trivial to spin up different model combinations and test their performance on my email processing use case.</p>
<h4 id="reality-check-local-vs-cloud-performance"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#reality-check-local-vs-cloud-performance">⚠️ Reality Check: Local vs. Cloud Performance</a></h4>
<p>Let's be honest here — <strong>using an LLM locally is never going to be a fully featured replacement for the likes of ChatGPT or Claude</strong>. This became apparent pretty quickly during my testing.</p>
<p><strong>Performance realities:</strong></p>
<ul>
<li><strong>Speed:</strong> Unless you're running some serious hardware, the performance will be a lot slower than the online AI counterparts</li>
<li><strong>Model capabilities:</strong> Local models (especially smaller ones that run on consumer hardware) lack the sophisticated reasoning of GPT-4 or Claude</li>
<li><strong>Resource constraints:</strong> My standard PC setup meant I was limited to smaller model variants</li>
<li><strong>Response quality:</strong> Noticeably less nuanced and accurate responses compared to cloud services</li>
</ul>
<p><strong>Where local LLMs do shine:</strong></p>
<ul>
<li><strong>Privacy-sensitive tasks:</strong> When you can't send data to external APIs</li>
<li><strong>Development and testing:</strong> Iterating on prompts without burning through API credits</li>
<li><strong>Learning and experimentation:</strong> Understanding how different model architectures behave</li>
<li><strong>Offline scenarios:</strong> When internet connectivity is unreliable</li>
</ul>
<p>The key insight: <strong>local LLMs are a complement to cloud services, not a replacement</strong>. Use them when privacy, cost, or learning are the primary concerns, but stick with cloud APIs when you need reliable, high-quality results.</p>
<h4 id="hybrid-approach-best-of-both-worlds"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#hybrid-approach-best-of-both-worlds">🔗 Hybrid Approach: Best of Both Worlds</a></h4>
<p>The final configuration became a hybrid approach:</p>
<ul>
<li><strong>OpenWebUI connected to Azure OpenAI</strong> for production-quality responses</li>
<li><strong>Local Ollama models</strong> for development and privacy-sensitive testing</li>
<li><strong>Docker containers</strong> exposed through Docker Desktop for easy management</li>
</ul>
<p>This gave me the flexibility to choose the right tool for each task — cloud APIs when I need reliability and performance, local models when I want to experiment or maintain privacy.</p>
<p><img alt="OpenWebUI local interface with model selection" src="../../ai-automation/openwebui-local.png" /></p>
<h4 id="cost-reality-check"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#cost-reality-check">💰 Cost Reality Check</a></h4>
<p>After a week of experimentation, here's how the costs actually broke down:</p>
<table>
<thead>
<tr>
<th><strong>Service</strong></th>
<th><strong>Trial Period</strong></th>
<th><strong>Monthly Cost</strong></th>
<th><strong>My Usage</strong></th>
<th><strong>Notes</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>n8n Cloud</td>
<td>14 days free</td>
<td>€20/month</td>
<td>2 weeks testing</td>
<td>Full OAuth2 features</td>
</tr>
<tr>
<td>OpenAI API</td>
<td>Pay-per-use</td>
<td>Variable</td>
<td>$10 in 2 days</td>
<td>Expensive for testing</td>
</tr>
<tr>
<td>Azure OpenAI</td>
<td>Free credits</td>
<td>£120/month budget</td>
<td>~£15 used</td>
<td>Better for experimentation</td>
</tr>
<tr>
<td>Self-hosted</td>
<td>Free</td>
<td>Hardware + time</td>
<td>2 days setup</td>
<td>OAuth2 complexity</td>
</tr>
</tbody>
</table>
<p><strong>Key insight:</strong> The "free" self-hosted option came with a significant time cost — debugging authentication issues for hours vs. having things work immediately in the cloud version.</p>
<hr />
<h3 id="current-state-lessons-learned-next-steps"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#current-state-lessons-learned-next-steps">📊 Current State: Lessons Learned &amp; Next Steps</a></h3>
<p>After a week of container deployments, OAuth battles, and API integrations, here's where I've landed:</p>
<h4 id="whats-working-well"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#whats-working-well">✅ What's Working Well</a></h4>
<p><strong>Technical Stack:</strong></p>
<ul>
<li><strong>n8n self-hosted:</strong> Currently running 2 active workflows (weather alerts, basic data processing)</li>
<li><strong>Azure OpenAI integration:</strong> Reliable and cost-effective for AI processing — saving ~£25/month vs. direct OpenAI API</li>
<li><strong>Docker containerisation:</strong> Easy deployment and management across different environments</li>
<li><strong>WSL environment:</strong> 10x performance improvement over Pi 5 for local AI model loading</li>
</ul>
<p><strong>Process Improvements:</strong></p>
<ul>
<li><strong>Iterative approach:</strong> Start simple, add complexity gradually — this saved significant debugging time</li>
<li><strong>Hybrid cloud/local strategy:</strong> Use the right tool for each requirement rather than forcing one solution</li>
<li><strong>Container flexibility:</strong> Easy to migrate and scale across different hosts when hardware constraints appear</li>
</ul>
<p><strong>Daily productivity impact:</strong> While the original job email automation isn't fully solved, the weather automation saves ~10 minutes daily, and the learning has already paid dividends in other automation projects.</p>
<h4 id="ongoing-challenges-the-work-in-progress-list"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#ongoing-challenges-the-work-in-progress-list">⚠️ Ongoing Challenges (The Work-in-Progress List)</a></h4>
<p><strong>Authentication Issues:</strong></p>
<ul>
<li>OAuth2 integration with Outlook.com/Exchange Online still unresolved</li>
<li>Need to explore alternative authentication methods or different email providers</li>
<li>May require diving deeper into Azure app registration configurations</li>
</ul>
<p><strong>Workflow Limitations:</strong></p>
<ul>
<li>Original job email processing goal partially achieved but needs refinement</li>
<li>Multiple job URL extraction per email still needs work</li>
<li>Error handling and retry logic need improvement</li>
</ul>
<p><strong>Infrastructure Decisions:</strong></p>
<ul>
<li>Balancing local vs. cloud resources for different use cases</li>
<li>Determining optimal Docker deployment strategy for production workflows</li>
<li>Managing costs across multiple AI service providers</li>
</ul>
<p><strong>Decision-making process during failures:</strong> When something doesn't work, I typically: (1) Troubleshoot the exact error using ChatGPT or Anthropic Claude, (2) Search for similar issues in community forums, (3) Try a simpler alternative approach, (4) If still stuck after 2-3 hours, pivot to a different method rather than continuing to debug indefinitely.</p>
<h4 id="next-steps-future-experiments"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#next-steps-future-experiments">🚀 Next Steps &amp; Future Experiments</a></h4>
<p><strong>Short-term goals (next 2-4 weeks):</strong></p>
<ol>
<li><strong>Resolve OAuth2 authentication</strong> for proper email integration</li>
<li><strong>Improve job URL extraction accuracy</strong> — tackle the multiple URLs per email challenge</li>
<li><strong>Add error handling and logging</strong> to existing workflows</li>
<li><strong>Explore alternative email providers</strong> if Outlook.com integration remains problematic</li>
</ol>
<p><strong>Medium-term exploration (next 2-3 months):</strong></p>
<ol>
<li><strong>Local LLM performance tuning</strong> for specific use cases</li>
<li><strong>Workflow templates</strong> for common automation patterns</li>
<li><strong>Integration with other productivity tools</strong> (calendar, task management)</li>
<li><strong>Monitoring and alerting</strong> for automated workflows</li>
</ol>
<h4 id="quick-wins-for-beginners"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#quick-wins-for-beginners">🛠️ Quick Wins for Beginners</a></h4>
<p>If you're just starting your AI automation journey, here are the lessons learned that could save you time:</p>
<blockquote>
<p><strong>🎯 Start Simple First</strong></p>
<ul>
<li>Begin with n8n cloud trial to understand the platform without authentication headaches</li>
<li>Use simple APIs (weather, RSS feeds) before tackling complex ones (email OAuth2)</li>
<li>Test with smaller AI models before jumping to GPT-4</li>
</ul>
<p><strong>💡 Budget for Experimentation</strong></p>
<ul>
<li>Set aside $20-50 for API testing — it goes faster than you think</li>
<li>Azure OpenAI credits can be more cost-effective than direct OpenAI API for learning</li>
<li>Factor in time costs when choosing self-hosted vs. cloud solutions</li>
</ul>
<p><strong>🔧 Have Fallback Options Ready</strong></p>
<ul>
<li>Plan alternative authentication methods (app passwords vs. OAuth2)</li>
<li>Keep both cloud and local AI options available</li>
<li>Document what works and what doesn't for future reference</li>
</ul>
</blockquote>
<hr />
<h3 id="technical-resources-documentation"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#technical-resources-documentation">🔧 Technical Resources &amp; Documentation</a></h3>
<p>For anyone inspired to start their own AI automation journey, here are the key resources that proved invaluable:</p>
<h4 id="core-tools-platforms"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#core-tools-platforms">🛠️ Core Tools &amp; Platforms</a></h4>
<ul>
<li><strong><a href="https://n8n.io/">n8n</a></strong> — Visual workflow automation platform</li>
<li><strong><a href="https://www.docker.com/">Docker</a></strong> — Containerisation platform</li>
<li><strong><a href="https://docs.docker.com/compose/">Docker Compose</a></strong> — Multi-container orchestration tool</li>
<li><strong><a href="https://www.openmediavault.org/">OpenMediaVault</a></strong> — NAS/storage management solution</li>
</ul>
<h4 id="ai-llm-resources"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#ai-llm-resources">🤖 AI &amp; LLM Resources</a></h4>
<ul>
<li><strong><a href="https://ollama.ai/">Ollama</a></strong> — Local LLM hosting platform</li>
<li><strong><a href="https://openwebui.com/">OpenWebUI</a></strong> — Web interface for local LLM interaction</li>
<li><strong><a href="https://azure.microsoft.com/en-gb/products/ai-services/openai-service">Azure OpenAI Service</a></strong> — Enterprise AI API platform</li>
<li><strong><a href="https://openai.com/api/">OpenAI API</a></strong> — Direct API access to GPT models</li>
</ul>
<h4 id="setup-guides-documentation"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#setup-guides-documentation">📚 Setup Guides &amp; Documentation</a></h4>
<ul>
<li><strong><a href="https://docs.n8n.io/hosting/">n8n Self-Hosting Guide</a></strong></li>
<li><strong><a href="https://docs.docker.com/get-docker/">Docker Installation Documentation</a></strong></li>
<li><strong><a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/quickstart">Azure OpenAI Quickstart</a></strong> — Getting started with Azure OpenAI</li>
<li><strong><a href="https://docs.microsoft.com/en-us/windows/wsl/install">WSL Installation Guide</a></strong> — Windows Subsystem for Linux setup</li>
</ul>
<h4 id="troubleshooting-common-issues"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#troubleshooting-common-issues">🔧 Troubleshooting Common Issues</a></h4>
<p>Based on my week of trial and error, here are the most common problems you'll likely encounter:</p>
<p><strong>🔐 OAuth2 Authentication Failures</strong></p>
<p><em>Symptoms:</em> "Invalid redirect URI" or "Authentication failed" errors when connecting to email services.</p>
<p><em>Likely causes:</em></p>
<ul>
<li>Redirect URI mismatch between app registration and n8n configuration</li>
<li>Self-hosted instance not using HTTPS for callbacks</li>
<li>App registration missing required API permissions</li>
</ul>
<p><em>Solutions to try:</em></p>
<ul>
<li>Use app passwords instead of OAuth2 where possible (Gmail, Outlook.com) — <strong>Note:</strong> App passwords are simpler username/password credentials that bypass OAuth2 complexity but offer less security</li>
<li>Ensure your n8n instance is accessible via HTTPS with valid SSL certificate</li>
<li>Double-check app registration redirect URIs match exactly (including trailing slashes)</li>
<li>Start with cloud trial to verify workflow logic before self-hosting</li>
</ul>
<p><strong>🐳 Container Performance Issues</strong></p>
<p><em>Symptoms:</em> Slow model loading, container crashes, high memory usage.</p>
<p><em>Likely causes:</em></p>
<ul>
<li>Insufficient RAM allocation to Docker</li>
<li>CPU-intensive models running on inadequate hardware</li>
<li>Competing containers for limited resources</li>
</ul>
<p><em>Solutions to try:</em></p>
<ul>
<li>Increase Docker memory limits in Docker Desktop settings</li>
<li>Use smaller model variants (7B instead of 13B+ parameters)</li>
<li>Monitor resource usage with <code>docker stats</code> command</li>
<li>Consider migrating from Pi to x86 hardware for better performance</li>
</ul>
<p><strong>💸 API Rate Limiting and Costs</strong></p>
<p><em>Symptoms:</em> API calls failing, unexpected high costs, token limits exceeded.</p>
<p><em>Likely causes:</em></p>
<ul>
<li>Testing with expensive models (GPT-4) instead of cheaper alternatives</li>
<li>No rate limiting in workflow configurations</li>
<li>Inefficient prompt design causing high token usage</li>
</ul>
<p><em>Solutions to try:</em></p>
<ul>
<li>Start testing with GPT-3.5-turbo or GPT-4-mini models</li>
<li>Implement workflow rate limiting and retry logic</li>
<li>Optimize prompts to reduce token consumption</li>
<li>Set API spending alerts in provider dashboards</li>
</ul>
<p><strong>💻 Resource Requirements Summary</strong></p>
<p><em>Minimum Requirements for Recreation:</em></p>
<ul>
<li><strong>Cloud approach:</strong> n8n trial account + $20-50 API experimentation budget</li>
<li><strong>Self-hosted approach:</strong> 8GB+ RAM, Docker knowledge, 2-3 days setup time</li>
<li><strong>Local AI experimentation:</strong> 16GB+ RAM recommended, considerable patience, NVMe storage preferred</li>
<li><strong>Network:</strong> Stable broadband connection for cloud API performance</li>
</ul>
<hr />
<h3 id="final-thoughts-the-joy-of-controlled-chaos"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#final-thoughts-the-joy-of-controlled-chaos">💭 Final Thoughts: The Joy of Controlled Chaos</a></h3>
<p>What started as a simple email automation project became a comprehensive exploration of modern AI automation tools. While I didn't achieve my original goal completely (yet), the journey provided invaluable hands-on experience with:</p>
<ul>
<li><strong>Container orchestration</strong> across different environments</li>
<li><strong>AI service integration</strong> patterns and best practices  </li>
<li><strong>Authentication complexity</strong> in self-hosted vs. cloud environments</li>
<li><strong>Hybrid deployment strategies</strong> for flexibility and cost control</li>
</ul>
<p>The beauty of this approach is that each "failed" experiment taught me something valuable about the tools and processes involved. The OAuth2 authentication issues, while frustrating, highlighted the importance of proper authentication design. The container migrations demonstrated the flexibility of modern deployment approaches.</p>
<p><strong>Most importantly:</strong> I now have a functional foundation for AI automation experiments, with both cloud and local capabilities at my disposal.</p>
<p>Is it overengineered for a simple email processing task? Absolutely. Was it worth the learning experience? Without question.</p>
<p><em>Have you tackled similar AI automation projects?</em> I'd particularly love to hear from anyone who's solved the OAuth2 self-hosting puzzle or found creative workarounds for email processing limitations. Drop me a line if you've found better approaches to any of these challenges.</p>
<hr />
<h4 id="image-requirements-summary"><a class="toclink" href="../../first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/#image-requirements-summary">📸 Image Requirements Summary</a></h4>
<p><strong>For anyone recreating this setup, here are the key screenshots included in this post:</strong></p>
<ol>
<li><strong>n8n-jobs-workflow-openai.png</strong> — Original workflow using direct OpenAI API (the expensive version that burned through $10 in 2 days)</li>
<li><strong>azure-openai-deployment.png</strong> — Azure OpenAI Studio showing GPT-4 Mini deployment configuration  </li>
<li><strong>n8n-jobs-workflow-azure.png</strong> — Improved workflow using Azure OpenAI integration (the cost-effective version)</li>
<li><strong>omv-docker-n8n-containers.png</strong> — OpenMediaVault interface showing Docker container management on Pi 5</li>
<li><strong>n8n-weather-workflow.png</strong> — Simple weather API to Gmail workflow demonstrating successful self-hosted setup</li>
<li><strong>docker-desktop-ollama.png</strong> — Docker Desktop showing Ollama and OpenWebUI containers running on WSL</li>
<li><strong>openwebui-local.png</strong> — OpenWebUI interface showing both Azure OpenAI and local model selection options</li>
</ol>
<p>Each image demonstrates the practical implementation rather than theoretical concepts, helping readers visualize the actual tools and interfaces involved in the automation journey.</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=First%20Steps%20into%20AI%20Automation%3A%20My%20Journey%20from%20Trial%20to%20Self-Hosted%20Chaos%0A&amp;url=https://blog.pollockweb.com/blog/first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/first-steps-into-ai-automation-my-journey-from-trial-to-self-hosted-chaos/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-05-29 00:00:00+00:00">May 29, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/azure/" class="md-meta__link">Azure</a>, 
              <a href="../../category/automation/" class="md-meta__link">Automation</a>, 
              <a href="../../category/patch-management/" class="md-meta__link">Patch Management</a></li>
        
        
          
          <li class="md-meta__item">
            
              21 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/">🔄 Bringing Patch Management In-House: Migrating from MSP to Azure Update Manager</a></h2>
<blockquote>
<p>It's all fun and games until the MSP contract expires and you realise 90 VMs still need their patching schedules sorted…</p>
</blockquote>
<p>With our MSP contract winding down, the time had come to bring VM patching <em>back in house</em>. Our third-party provider had been handling it with their own tooling, which would no longer be used when the service contract expired.</p>
<p>Enter <a href="https://learn.microsoft.com/en-us/azure/update-manager/overview">Azure Update Manager</a> — the modern, agentless way to manage patching schedules across your Azure VMs. Add a bit of PowerShell, sprinkle in some Azure Policy, and you've got yourself a scalable, policy-driven solution that's more visible, auditable, and way more maintainable.</p>
<p>Here's how I made the switch — and managed to avoid a patching panic.</p>
<hr />
<h3 id="prerequisites-permissions"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#prerequisites-permissions">⚙️ Prerequisites &amp; Permissions</a></h3>
<p>Let's get the plumbing sorted before diving in.</p>
<p>You'll need:</p>
<ul>
<li>The right <strong>PowerShell modules</strong>:</li>
</ul>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nb">Install-Module</span> <span class="n">Az</span> <span class="n">-Scope</span> <span class="n">CurrentUser</span> <span class="n">-Force</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="nb">Import-Module</span> <span class="n">Az</span><span class="p">.</span><span class="n">Maintenance</span><span class="p">,</span> <span class="n">Az</span><span class="p">.</span><span class="n">Resources</span><span class="p">,</span> <span class="n">Az</span><span class="p">.</span><span class="n">Compute</span>
</span></code></pre></div>
<ul>
<li>An account with <strong>Contributor</strong> permissions (or higher)</li>
<li>Registered providers to avoid mysterious error messages:</li>
</ul>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nb">Register-AzResourceProvider</span> <span class="n">-ProviderNamespace</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">Maintenance</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="nb">Register-AzResourceProvider</span> <span class="n">-ProviderNamespace</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">GuestConfiguration</span>
</span></code></pre></div>
<blockquote>
<p><strong>Why Resource Providers?</strong> Azure Update Manager needs these registered to create the necessary API endpoints and resource types in your subscription. Without them, you'll get cryptic "resource type not found" errors.</p>
</blockquote>
<p><a href="https://learn.microsoft.com/en-us/azure/update-manager/overview#prerequisites">Official documentation on Azure Update Manager prerequisites</a></p>
<hr />
<h3 id="step-1-audit-the-current-setup"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#step-1-audit-the-current-setup">🕵️ Step 1 – Audit the Current Setup</a></h3>
<p>First order of business: collect the patching summary data from the MSP — which, helpfully, came in the form of multiple weekly CSV exports.</p>
<p>I used GenAI to wrangle the mess into a structured format. The result was a clear categorisation of VMs based on the day and time they were typically patched — a solid foundation to work from.</p>
<hr />
<h3 id="step-2-create-seven-new-maintenance-configurations"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#step-2-create-seven-new-maintenance-configurations">🧱 Step 2 – Create Seven New Maintenance Configurations</a></h3>
<p>This is the foundation of Update Manager — define your recurring patch windows.</p>
<details>
<summary>Click to expand: Create Maintenance Configurations (Sample Script)</summary>

<div class="language-powershell highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c"># Azure Update Manager - Create Weekly Maintenance Configurations</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="c"># Pure PowerShell syntax</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="c"># Define parameters</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="nv">$resourceGroupName</span> <span class="p">=</span> <span class="s2">&quot;rg-maintenance-uksouth-001&quot;</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="nv">$location</span> <span class="p">=</span> <span class="s2">&quot;uksouth&quot;</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="nv">$timezone</span> <span class="p">=</span> <span class="s2">&quot;GMT Standard Time&quot;</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="nv">$startDateTime</span> <span class="p">=</span> <span class="s2">&quot;2024-06-01 21:00&quot;</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="nv">$duration</span> <span class="p">=</span> <span class="s2">&quot;03:00&quot;</span>  <span class="c"># 3 hours - meets minimum requirement</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="c"># Day mapping for config naming (3-letter lowercase)</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="nv">$dayMap</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>    <span class="s2">&quot;Monday&quot;</span>    <span class="p">=</span> <span class="s2">&quot;mon&quot;</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>    <span class="s2">&quot;Tuesday&quot;</span>   <span class="p">=</span> <span class="s2">&quot;tue&quot;</span> 
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>    <span class="s2">&quot;Wednesday&quot;</span> <span class="p">=</span> <span class="s2">&quot;wed&quot;</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>    <span class="s2">&quot;Thursday&quot;</span>  <span class="p">=</span> <span class="s2">&quot;thu&quot;</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>    <span class="s2">&quot;Friday&quot;</span>    <span class="p">=</span> <span class="s2">&quot;fri&quot;</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>    <span class="s2">&quot;Saturday&quot;</span>  <span class="p">=</span> <span class="s2">&quot;sat&quot;</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>    <span class="s2">&quot;Sunday&quot;</span>    <span class="p">=</span> <span class="s2">&quot;sun&quot;</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="p">}</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="c"># Create maintenance configurations for each day</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$day</span> <span class="k">in</span> <span class="nv">$dayMap</span><span class="p">.</span><span class="n">Keys</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a>    <span class="nv">$shortDay</span> <span class="p">=</span> <span class="nv">$dayMap</span><span class="p">[</span><span class="nv">$day</span><span class="p">]</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>    <span class="nv">$configName</span> <span class="p">=</span> <span class="s2">&quot;contoso-maintenance-config-vms-$shortDay&quot;</span>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;Creating: $configName for $day...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a>        <span class="nv">$result</span> <span class="p">=</span> <span class="nb">New-AzMaintenanceConfiguration</span> <span class="p">`</span>
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a>            <span class="n">-ResourceGroupName</span> <span class="nv">$resourceGroupName</span> <span class="p">`</span>
</span><span id="__span-16-32"><a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a>            <span class="n">-Name</span> <span class="nv">$configName</span> <span class="p">`</span>
</span><span id="__span-16-33"><a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a>            <span class="n">-MaintenanceScope</span> <span class="s2">&quot;InGuestPatch&quot;</span> <span class="p">`</span>
</span><span id="__span-16-34"><a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a>            <span class="n">-Location</span> <span class="nv">$location</span> <span class="p">`</span>
</span><span id="__span-16-35"><a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a>            <span class="n">-StartDateTime</span> <span class="nv">$startDateTime</span> <span class="p">`</span>
</span><span id="__span-16-36"><a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a>            <span class="n">-Timezone</span> <span class="nv">$timezone</span> <span class="p">`</span>
</span><span id="__span-16-37"><a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a>            <span class="n">-Duration</span> <span class="nv">$duration</span> <span class="p">`</span>
</span><span id="__span-16-38"><a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a>            <span class="n">-RecurEvery</span> <span class="s2">&quot;Week $day&quot;</span> <span class="p">`</span>
</span><span id="__span-16-39"><a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a>            <span class="n">-InstallPatchRebootSetting</span> <span class="s2">&quot;IfRequired&quot;</span> <span class="p">`</span>
</span><span id="__span-16-40"><a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a>            <span class="n">-ExtensionProperty</span> <span class="p">@{</span><span class="s2">&quot;InGuestPatchMode&quot;</span> <span class="p">=</span> <span class="s2">&quot;User&quot;</span><span class="p">}</span> <span class="p">`</span>
</span><span id="__span-16-41"><a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a>            <span class="n">-WindowParameterClassificationToInclude</span> <span class="p">@(</span><span class="s2">&quot;Critical&quot;</span><span class="p">,</span> <span class="s2">&quot;Security&quot;</span><span class="p">)</span> <span class="p">`</span>
</span><span id="__span-16-42"><a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a>            <span class="n">-LinuxParameterClassificationToInclude</span> <span class="p">@(</span><span class="s2">&quot;Critical&quot;</span><span class="p">,</span> <span class="s2">&quot;Security&quot;</span><span class="p">)</span> <span class="p">`</span>
</span><span id="__span-16-43"><a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a>            <span class="n">-Tag</span> <span class="p">@{</span>
</span><span id="__span-16-44"><a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a>                <span class="s2">&quot;Application&quot;</span>  <span class="p">=</span> <span class="s2">&quot;Azure Update Manager&quot;</span>
</span><span id="__span-16-45"><a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a>                <span class="s2">&quot;Owner&quot;</span>        <span class="p">=</span> <span class="s2">&quot;Contoso&quot;</span>
</span><span id="__span-16-46"><a id="__codelineno-16-46" name="__codelineno-16-46" href="#__codelineno-16-46"></a>                <span class="s2">&quot;PatchWindow&quot;</span>  <span class="p">=</span> <span class="nv">$shortDay</span>
</span><span id="__span-16-47"><a id="__codelineno-16-47" name="__codelineno-16-47" href="#__codelineno-16-47"></a>            <span class="p">}</span> <span class="p">`</span>
</span><span id="__span-16-48"><a id="__codelineno-16-48" name="__codelineno-16-48" href="#__codelineno-16-48"></a>            <span class="n">-ErrorAction</span> <span class="n">Stop</span>
</span><span id="__span-16-49"><a id="__codelineno-16-49" name="__codelineno-16-49" href="#__codelineno-16-49"></a>
</span><span id="__span-16-50"><a id="__codelineno-16-50" name="__codelineno-16-50" href="#__codelineno-16-50"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;✓ SUCCESS: $configName&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-16-51"><a id="__codelineno-16-51" name="__codelineno-16-51" href="#__codelineno-16-51"></a>
</span><span id="__span-16-52"><a id="__codelineno-16-52" name="__codelineno-16-52" href="#__codelineno-16-52"></a>        <span class="c"># Quick validation</span>
</span><span id="__span-16-53"><a id="__codelineno-16-53" name="__codelineno-16-53" href="#__codelineno-16-53"></a>        <span class="nv">$createdConfig</span> <span class="p">=</span> <span class="nb">Get-AzMaintenanceConfiguration</span> <span class="n">-ResourceGroupName</span> <span class="nv">$resourceGroupName</span> <span class="n">-Name</span> <span class="nv">$configName</span>
</span><span id="__span-16-54"><a id="__codelineno-16-54" name="__codelineno-16-54" href="#__codelineno-16-54"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;  Validated: </span><span class="p">$(</span><span class="nv">$createdConfig</span><span class="p">.</span><span class="n">RecurEvery</span><span class="p">)</span><span class="s2"> schedule confirmed&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-16-55"><a id="__codelineno-16-55" name="__codelineno-16-55" href="#__codelineno-16-55"></a>
</span><span id="__span-16-56"><a id="__codelineno-16-56" name="__codelineno-16-56" href="#__codelineno-16-56"></a>    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-16-57"><a id="__codelineno-16-57" name="__codelineno-16-57" href="#__codelineno-16-57"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;✗ FAILED: $configName - </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-16-58"><a id="__codelineno-16-58" name="__codelineno-16-58" href="#__codelineno-16-58"></a>        <span class="k">continue</span>
</span><span id="__span-16-59"><a id="__codelineno-16-59" name="__codelineno-16-59" href="#__codelineno-16-59"></a>    <span class="p">}</span>
</span><span id="__span-16-60"><a id="__codelineno-16-60" name="__codelineno-16-60" href="#__codelineno-16-60"></a><span class="p">}</span>
</span></code></pre></div>

</details>

<blockquote>
<p>⚠️ <em>Don't forget: duration format is ISO 8601, not "2 hours" — and start time has to match the day it's tied to.</em></p>
</blockquote>
<p><a href="https://learn.microsoft.com/en-us/powershell/module/az.maintenance/new-azmaintenanceconfiguration">Learn more about New-AzMaintenanceConfiguration</a></p>
<hr />
<h3 id="step-3-tweak-the-maintenance-configs"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#step-3-tweak-the-maintenance-configs">🛠️ Step 3 – Tweak the Maintenance Configs</a></h3>
<p>Some patch windows felt too tight — and, just as importantly, I needed to avoid overlaps with existing backup jobs. Rather than let a large CU fail halfway through or run headlong into an Azure Backup job, I extended the duration on select configs and staggered them across the week:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nv">$config</span> <span class="p">=</span> <span class="nb">Get-AzMaintenanceConfiguration</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;rg-maintenance-uksouth-001&quot;</span> <span class="n">-Name</span> <span class="s2">&quot;contoso-maintenance-config-vms-sun&quot;</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nv">$config</span><span class="p">.</span><span class="n">Duration</span> <span class="p">=</span> <span class="s2">&quot;04:00&quot;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="nb">Update-AzMaintenanceConfiguration</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;rg-maintenance-uksouth-001&quot;</span> <span class="n">-Name</span> <span class="s2">&quot;contoso-maintenance-config-vms-sun&quot;</span> <span class="n">-Configuration</span> <span class="nv">$config</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="c"># Verify the change</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="nv">$updatedConfig</span> <span class="p">=</span> <span class="nb">Get-AzMaintenanceConfiguration</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;rg-maintenance-uksouth-001&quot;</span> <span class="n">-Name</span> <span class="s2">&quot;contoso-maintenance-config-vms-sun&quot;</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Sunday window now: </span><span class="p">$(</span><span class="nv">$updatedConfig</span><span class="p">.</span><span class="n">Duration</span><span class="p">)</span><span class="s2"> duration&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span></code></pre></div>
<p><a href="https://learn.microsoft.com/en-us/powershell/module/az.maintenance/update-azmaintenanceconfiguration?view=azps-14.0.0&amp;viewFallbackFrom=azps-13.5.0">Learn more about Update-AzMaintenanceConfiguration</a></p>
<hr />
<h3 id="step-4-use-ai-to-group-vms-by-patch-activity"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#step-4-use-ai-to-group-vms-by-patch-activity">🤖 Step 4 – Use AI to Group VMs by Patch Activity</a></h3>
<p>Armed with CSV exports of the latest patching summaries, I got AI to do the grunt work and make sense of the contents.</p>
<p><strong>What I did:</strong></p>
<ol>
<li><strong>Exported MSP data:</strong> Weekly CSV reports showing patch installation timestamps for each VM</li>
<li>
<p><strong>Used Gen AI</strong> with various iterative prompts, starting the conversation with this:</p>
<blockquote>
<p>"Attached is an export summary of the current patching activity from our incumbent MSP who currently look after the patching of the VM's in Azure
I need you to review timestamps and work out which maintenance window each vm is currently in, and then match that to the appropriate maintenance config that we have just created.
If there are mis matches in new and current schedule then we may need to tweak the settings of the new configs"</p>
</blockquote>
</li>
<li>
<p><strong>AI analysis revealed:</strong></p>
</li>
<li>60% of VMs were patching on one weekday evening</li>
<li>Several critical systems patching simultaneously</li>
<li>
<p>No consideration for application dependencies</p>
</li>
<li>
<p><strong>AI recommendation:</strong> Spread VMs across weekdays based on:</p>
</li>
<li><strong>Criticality:</strong> Domain controllers on different days</li>
<li><strong>Function:</strong> Similar servers on different days (avoid single points of failure)  </li>
<li><strong>Dependencies:</strong> Database servers before application servers</li>
</ol>
<p><strong>The result:</strong> A logical rebalancing that avoided "all our eggs in Sunday 1AM" basket and considered business impact.</p>
<blockquote>
<p><strong>Why this matters:</strong> The current patching schedule was not optimized for business continuity. AI helped identify risks we hadn't considered.</p>
</blockquote>
<hr />
<h3 id="step-5-discover-all-vms-and-identify-gaps"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#step-5-discover-all-vms-and-identify-gaps">🔍 Step 5 – Discover All VMs and Identify Gaps</a></h3>
<p>Before diving into bulk tagging, I needed to understand what we were working with across all subscriptions.</p>
<p><strong>First, let's see what VMs we have:</strong></p>
<details>
<summary>Click to expand: Discover Untagged VMs (Sample Script)</summary>

<div class="language-powershell highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c"># Discover Untagged VMs Script for Azure Update Manager</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="c"># This script identifies VMs that are missing Azure Update Manager tags</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="nv">$scriptStart</span> <span class="p">=</span> <span class="nb">Get-Date</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== Azure Update Manager - Discover Untagged VMs ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Scanning all accessible subscriptions for VMs missing maintenance tags...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="c"># Function to check if VM has Azure Update Manager tags</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="k">function</span> <span class="nb">Test-VMHasMaintenanceTags</span> <span class="p">{</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>    <span class="k">param</span><span class="p">(</span><span class="nv">$VM</span><span class="p">)</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>    <span class="c"># Check for the three required tags</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>    <span class="nv">$hasOwnerTag</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">Tags</span> <span class="o">-and</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">Tags</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s2">&quot;Owner&quot;</span><span class="p">)</span> <span class="o">-and</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">Tags</span><span class="p">[</span><span class="s2">&quot;Owner&quot;</span><span class="p">]</span> <span class="o">-eq</span> <span class="s2">&quot;Contoso&quot;</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>    <span class="nv">$hasUpdatesTag</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">Tags</span> <span class="o">-and</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">Tags</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s2">&quot;Updates&quot;</span><span class="p">)</span> <span class="o">-and</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">Tags</span><span class="p">[</span><span class="s2">&quot;Updates&quot;</span><span class="p">]</span> <span class="o">-eq</span> <span class="s2">&quot;Azure Update Manager&quot;</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>    <span class="nv">$hasPatchWindowTag</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">Tags</span> <span class="o">-and</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">Tags</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="s2">&quot;PatchWindow&quot;</span><span class="p">)</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>    <span class="k">return</span> <span class="nv">$hasOwnerTag</span> <span class="o">-and</span> <span class="nv">$hasUpdatesTag</span> <span class="o">-and</span> <span class="nv">$hasPatchWindowTag</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="p">}</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="c"># Function to get VM details for reporting</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="k">function</span> <span class="nb">Get-VMDetails</span> <span class="p">{</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>    <span class="k">param</span><span class="p">(</span><span class="nv">$VM</span><span class="p">,</span> <span class="nv">$SubscriptionName</span><span class="p">)</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a>    <span class="k">return</span> <span class="no">[PSCustomObject]</span><span class="p">@{</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a>        <span class="n">Name</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a>        <span class="n">ResourceGroup</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">ResourceGroupName</span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a>        <span class="n">Location</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">Location</span>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a>        <span class="n">Subscription</span> <span class="p">=</span> <span class="nv">$SubscriptionName</span>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a>        <span class="n">SubscriptionId</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">SubscriptionId</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a>        <span class="n">PowerState</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">PowerState</span>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a>        <span class="n">OsType</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">StorageProfile</span><span class="p">.</span><span class="n">OsDisk</span><span class="p">.</span><span class="n">OsType</span>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>        <span class="n">VmSize</span> <span class="p">=</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">HardwareProfile</span><span class="p">.</span><span class="n">VmSize</span>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a>        <span class="n">Tags</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$VM</span><span class="p">.</span><span class="n">Tags</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="nv">$VM</span><span class="p">.</span><span class="n">Tags</span><span class="p">.</span><span class="n">Keys</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span> <span class="s2">&quot;$_=</span><span class="p">$(</span><span class="nv">$VM</span><span class="p">.</span><span class="n">Tags</span><span class="p">[</span><span class="nv">$_</span><span class="p">])</span><span class="s2">&quot;</span> <span class="p">})</span> <span class="n">-join</span> <span class="s2">&quot;; &quot;</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="s2">&quot;No tags&quot;</span> <span class="p">}</span>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a>    <span class="p">}</span>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a><span class="p">}</span>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a><span class="c"># Initialize collections</span>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a><span class="nv">$taggedVMs</span> <span class="p">=</span> <span class="p">@()</span>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a><span class="nv">$untaggedVMs</span> <span class="p">=</span> <span class="p">@()</span>
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a><span class="nv">$allVMs</span> <span class="p">=</span> <span class="p">@()</span>
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a><span class="nv">$subscriptionSummary</span> <span class="p">=</span> <span class="p">@{}</span>
</span><span id="__span-18-44"><a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a>
</span><span id="__span-18-45"><a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== DISCOVERING VMs ACROSS ALL SUBSCRIPTIONS ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-18-46"><a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a>
</span><span id="__span-18-47"><a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a><span class="c"># Get all accessible subscriptions</span>
</span><span id="__span-18-48"><a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a><span class="nv">$subscriptions</span> <span class="p">=</span> <span class="nb">Get-AzSubscription</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">State</span> <span class="o">-eq</span> <span class="s2">&quot;Enabled&quot;</span> <span class="p">}</span>
</span><span id="__span-18-49"><a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Found </span><span class="p">$(</span><span class="nv">$subscriptions</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> accessible subscriptions&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-50"><a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a>
</span><span id="__span-18-51"><a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$subscription</span> <span class="k">in</span> <span class="nv">$subscriptions</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-18-52"><a id="__codelineno-18-52" name="__codelineno-18-52" href="#__codelineno-18-52"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-18-53"><a id="__codelineno-18-53" name="__codelineno-18-53" href="#__codelineno-18-53"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">Scanning subscription: </span><span class="p">$(</span><span class="nv">$subscription</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2"> (</span><span class="p">$(</span><span class="nv">$subscription</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span><span class="s2">)&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Magenta</span>
</span><span id="__span-18-54"><a id="__codelineno-18-54" name="__codelineno-18-54" href="#__codelineno-18-54"></a>        <span class="nv">$null</span> <span class="p">=</span> <span class="nb">Set-AzContext</span> <span class="n">-SubscriptionId</span> <span class="nv">$subscription</span><span class="p">.</span><span class="n">Id</span> <span class="n">-ErrorAction</span> <span class="n">Stop</span>
</span><span id="__span-18-55"><a id="__codelineno-18-55" name="__codelineno-18-55" href="#__codelineno-18-55"></a>
</span><span id="__span-18-56"><a id="__codelineno-18-56" name="__codelineno-18-56" href="#__codelineno-18-56"></a>        <span class="c"># Get all VMs in this subscription</span>
</span><span id="__span-18-57"><a id="__codelineno-18-57" name="__codelineno-18-57" href="#__codelineno-18-57"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;  Retrieving VMs...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-18-58"><a id="__codelineno-18-58" name="__codelineno-18-58" href="#__codelineno-18-58"></a>        <span class="nv">$vms</span> <span class="p">=</span> <span class="nb">Get-AzVM</span> <span class="n">-Status</span> <span class="n">-ErrorAction</span> <span class="k">Continue</span>
</span><span id="__span-18-59"><a id="__codelineno-18-59" name="__codelineno-18-59" href="#__codelineno-18-59"></a>
</span><span id="__span-18-60"><a id="__codelineno-18-60" name="__codelineno-18-60" href="#__codelineno-18-60"></a>        <span class="nv">$subTagged</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-18-61"><a id="__codelineno-18-61" name="__codelineno-18-61" href="#__codelineno-18-61"></a>        <span class="nv">$subUntagged</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-18-62"><a id="__codelineno-18-62" name="__codelineno-18-62" href="#__codelineno-18-62"></a>        <span class="nv">$subTotal</span> <span class="p">=</span> <span class="nv">$vms</span><span class="p">.</span><span class="n">Count</span>
</span><span id="__span-18-63"><a id="__codelineno-18-63" name="__codelineno-18-63" href="#__codelineno-18-63"></a>
</span><span id="__span-18-64"><a id="__codelineno-18-64" name="__codelineno-18-64" href="#__codelineno-18-64"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;  Found $subTotal VMs in this subscription&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-65"><a id="__codelineno-18-65" name="__codelineno-18-65" href="#__codelineno-18-65"></a>
</span><span id="__span-18-66"><a id="__codelineno-18-66" name="__codelineno-18-66" href="#__codelineno-18-66"></a>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$vm</span> <span class="k">in</span> <span class="nv">$vms</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-18-67"><a id="__codelineno-18-67" name="__codelineno-18-67" href="#__codelineno-18-67"></a>            <span class="nv">$vmDetails</span> <span class="p">=</span> <span class="nb">Get-VMDetails</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-SubscriptionName</span> <span class="nv">$subscription</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-18-68"><a id="__codelineno-18-68" name="__codelineno-18-68" href="#__codelineno-18-68"></a>            <span class="nv">$allVMs</span> <span class="p">+=</span> <span class="nv">$vmDetails</span>
</span><span id="__span-18-69"><a id="__codelineno-18-69" name="__codelineno-18-69" href="#__codelineno-18-69"></a>
</span><span id="__span-18-70"><a id="__codelineno-18-70" name="__codelineno-18-70" href="#__codelineno-18-70"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">Test-VMHasMaintenanceTags</span> <span class="n">-VM</span> <span class="nv">$vm</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-18-71"><a id="__codelineno-18-71" name="__codelineno-18-71" href="#__codelineno-18-71"></a>                <span class="nv">$taggedVMs</span> <span class="p">+=</span> <span class="nv">$vmDetails</span>
</span><span id="__span-18-72"><a id="__codelineno-18-72" name="__codelineno-18-72" href="#__codelineno-18-72"></a>                <span class="nv">$subTagged</span><span class="p">++</span>
</span><span id="__span-18-73"><a id="__codelineno-18-73" name="__codelineno-18-73" href="#__codelineno-18-73"></a>                <span class="nb">Write-Host</span> <span class="s2">&quot;    ✓ Tagged: </span><span class="p">$(</span><span class="nv">$vm</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-18-74"><a id="__codelineno-18-74" name="__codelineno-18-74" href="#__codelineno-18-74"></a>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-18-75"><a id="__codelineno-18-75" name="__codelineno-18-75" href="#__codelineno-18-75"></a>                <span class="nv">$untaggedVMs</span> <span class="p">+=</span> <span class="nv">$vmDetails</span>
</span><span id="__span-18-76"><a id="__codelineno-18-76" name="__codelineno-18-76" href="#__codelineno-18-76"></a>                <span class="nv">$subUntagged</span><span class="p">++</span>
</span><span id="__span-18-77"><a id="__codelineno-18-77" name="__codelineno-18-77" href="#__codelineno-18-77"></a>                <span class="nb">Write-Host</span> <span class="s2">&quot;    ⚠️ Untagged: </span><span class="p">$(</span><span class="nv">$vm</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-18-78"><a id="__codelineno-18-78" name="__codelineno-18-78" href="#__codelineno-18-78"></a>            <span class="p">}</span>
</span><span id="__span-18-79"><a id="__codelineno-18-79" name="__codelineno-18-79" href="#__codelineno-18-79"></a>        <span class="p">}</span>
</span><span id="__span-18-80"><a id="__codelineno-18-80" name="__codelineno-18-80" href="#__codelineno-18-80"></a>
</span><span id="__span-18-81"><a id="__codelineno-18-81" name="__codelineno-18-81" href="#__codelineno-18-81"></a>        <span class="c"># Store subscription summary</span>
</span><span id="__span-18-82"><a id="__codelineno-18-82" name="__codelineno-18-82" href="#__codelineno-18-82"></a>        <span class="nv">$subscriptionSummary</span><span class="p">[</span><span class="nv">$subscription</span><span class="p">.</span><span class="n">Name</span><span class="p">]</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-18-83"><a id="__codelineno-18-83" name="__codelineno-18-83" href="#__codelineno-18-83"></a>            <span class="n">Total</span> <span class="p">=</span> <span class="nv">$subTotal</span>
</span><span id="__span-18-84"><a id="__codelineno-18-84" name="__codelineno-18-84" href="#__codelineno-18-84"></a>            <span class="n">Tagged</span> <span class="p">=</span> <span class="nv">$subTagged</span>
</span><span id="__span-18-85"><a id="__codelineno-18-85" name="__codelineno-18-85" href="#__codelineno-18-85"></a>            <span class="n">Untagged</span> <span class="p">=</span> <span class="nv">$subUntagged</span>
</span><span id="__span-18-86"><a id="__codelineno-18-86" name="__codelineno-18-86" href="#__codelineno-18-86"></a>            <span class="n">SubscriptionId</span> <span class="p">=</span> <span class="nv">$subscription</span><span class="p">.</span><span class="n">Id</span>
</span><span id="__span-18-87"><a id="__codelineno-18-87" name="__codelineno-18-87" href="#__codelineno-18-87"></a>        <span class="p">}</span>
</span><span id="__span-18-88"><a id="__codelineno-18-88" name="__codelineno-18-88" href="#__codelineno-18-88"></a>
</span><span id="__span-18-89"><a id="__codelineno-18-89" name="__codelineno-18-89" href="#__codelineno-18-89"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;  Subscription Summary - Total: $subTotal | Tagged: $subTagged | Untagged: $subUntagged&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-18-90"><a id="__codelineno-18-90" name="__codelineno-18-90" href="#__codelineno-18-90"></a>
</span><span id="__span-18-91"><a id="__codelineno-18-91" name="__codelineno-18-91" href="#__codelineno-18-91"></a>    <span class="p">}</span>
</span><span id="__span-18-92"><a id="__codelineno-18-92" name="__codelineno-18-92" href="#__codelineno-18-92"></a>    <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-18-93"><a id="__codelineno-18-93" name="__codelineno-18-93" href="#__codelineno-18-93"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;  ✗ Error scanning subscription </span><span class="p">$(</span><span class="nv">$subscription</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2">: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-18-94"><a id="__codelineno-18-94" name="__codelineno-18-94" href="#__codelineno-18-94"></a>        <span class="nv">$subscriptionSummary</span><span class="p">[</span><span class="nv">$subscription</span><span class="p">.</span><span class="n">Name</span><span class="p">]</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-18-95"><a id="__codelineno-18-95" name="__codelineno-18-95" href="#__codelineno-18-95"></a>            <span class="n">Total</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-18-96"><a id="__codelineno-18-96" name="__codelineno-18-96" href="#__codelineno-18-96"></a>            <span class="n">Tagged</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-18-97"><a id="__codelineno-18-97" name="__codelineno-18-97" href="#__codelineno-18-97"></a>            <span class="n">Untagged</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-18-98"><a id="__codelineno-18-98" name="__codelineno-18-98" href="#__codelineno-18-98"></a>            <span class="n">Error</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span>
</span><span id="__span-18-99"><a id="__codelineno-18-99" name="__codelineno-18-99" href="#__codelineno-18-99"></a>        <span class="p">}</span>
</span><span id="__span-18-100"><a id="__codelineno-18-100" name="__codelineno-18-100" href="#__codelineno-18-100"></a>    <span class="p">}</span>
</span><span id="__span-18-101"><a id="__codelineno-18-101" name="__codelineno-18-101" href="#__codelineno-18-101"></a><span class="p">}</span>
</span><span id="__span-18-102"><a id="__codelineno-18-102" name="__codelineno-18-102" href="#__codelineno-18-102"></a>
</span><span id="__span-18-103"><a id="__codelineno-18-103" name="__codelineno-18-103" href="#__codelineno-18-103"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-18-104"><a id="__codelineno-18-104" name="__codelineno-18-104" href="#__codelineno-18-104"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== OVERALL DISCOVERY SUMMARY ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-18-105"><a id="__codelineno-18-105" name="__codelineno-18-105" href="#__codelineno-18-105"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Total VMs found: </span><span class="p">$(</span><span class="nv">$allVMs</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-106"><a id="__codelineno-18-106" name="__codelineno-18-106" href="#__codelineno-18-106"></a><span class="nb">Write-Host</span> <span class="s2">&quot;VMs with maintenance tags: </span><span class="p">$(</span><span class="nv">$taggedVMs</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-18-107"><a id="__codelineno-18-107" name="__codelineno-18-107" href="#__codelineno-18-107"></a><span class="nb">Write-Host</span> <span class="s2">&quot;VMs missing maintenance tags: </span><span class="p">$(</span><span class="nv">$untaggedVMs</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-18-108"><a id="__codelineno-18-108" name="__codelineno-18-108" href="#__codelineno-18-108"></a>
</span><span id="__span-18-109"><a id="__codelineno-18-109" name="__codelineno-18-109" href="#__codelineno-18-109"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$untaggedVMs</span><span class="p">.</span><span class="n">Count</span> <span class="o">-eq</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-18-110"><a id="__codelineno-18-110" name="__codelineno-18-110" href="#__codelineno-18-110"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;� ALL VMs ARE ALREADY TAGGED! �&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-18-111"><a id="__codelineno-18-111" name="__codelineno-18-111" href="#__codelineno-18-111"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;No further action required.&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-112"><a id="__codelineno-18-112" name="__codelineno-18-112" href="#__codelineno-18-112"></a>    <span class="n">exit</span> <span class="n">0</span>
</span><span id="__span-18-113"><a id="__codelineno-18-113" name="__codelineno-18-113" href="#__codelineno-18-113"></a><span class="p">}</span>
</span><span id="__span-18-114"><a id="__codelineno-18-114" name="__codelineno-18-114" href="#__codelineno-18-114"></a>
</span><span id="__span-18-115"><a id="__codelineno-18-115" name="__codelineno-18-115" href="#__codelineno-18-115"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-18-116"><a id="__codelineno-18-116" name="__codelineno-18-116" href="#__codelineno-18-116"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== SUBSCRIPTION BREAKDOWN ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-18-117"><a id="__codelineno-18-117" name="__codelineno-18-117" href="#__codelineno-18-117"></a><span class="nv">$subscriptionSummary</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">()</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Name</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-18-118"><a id="__codelineno-18-118" name="__codelineno-18-118" href="#__codelineno-18-118"></a>    <span class="nv">$sub</span> <span class="p">=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Value</span>
</span><span id="__span-18-119"><a id="__codelineno-18-119" name="__codelineno-18-119" href="#__codelineno-18-119"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$sub</span><span class="p">.</span><span class="n">Error</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-18-120"><a id="__codelineno-18-120" name="__codelineno-18-120" href="#__codelineno-18-120"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Key</span><span class="p">)</span><span class="s2">: ERROR - </span><span class="p">$(</span><span class="nv">$sub</span><span class="p">.</span><span class="n">Error</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-18-121"><a id="__codelineno-18-121" name="__codelineno-18-121" href="#__codelineno-18-121"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-18-122"><a id="__codelineno-18-122" name="__codelineno-18-122" href="#__codelineno-18-122"></a>        <span class="nv">$percentage</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$sub</span><span class="p">.</span><span class="n">Total</span> <span class="o">-gt</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span> <span class="no">[math]</span><span class="p">::</span><span class="n">Round</span><span class="p">((</span><span class="nv">$sub</span><span class="p">.</span><span class="n">Tagged</span> <span class="p">/</span> <span class="nv">$sub</span><span class="p">.</span><span class="n">Total</span><span class="p">)</span> <span class="p">*</span> <span class="n">100</span><span class="p">,</span> <span class="n">1</span><span class="p">)</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">0</span> <span class="p">}</span>
</span><span id="__span-18-123"><a id="__codelineno-18-123" name="__codelineno-18-123" href="#__codelineno-18-123"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Key</span><span class="p">)</span><span class="s2">: </span><span class="p">$(</span><span class="nv">$sub</span><span class="p">.</span><span class="n">Tagged</span><span class="p">)</span><span class="s2">/</span><span class="p">$(</span><span class="nv">$sub</span><span class="p">.</span><span class="n">Total</span><span class="p">)</span><span class="s2"> tagged ($percentage%)&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-124"><a id="__codelineno-18-124" name="__codelineno-18-124" href="#__codelineno-18-124"></a>    <span class="p">}</span>
</span><span id="__span-18-125"><a id="__codelineno-18-125" name="__codelineno-18-125" href="#__codelineno-18-125"></a><span class="p">}</span>
</span><span id="__span-18-126"><a id="__codelineno-18-126" name="__codelineno-18-126" href="#__codelineno-18-126"></a>
</span><span id="__span-18-127"><a id="__codelineno-18-127" name="__codelineno-18-127" href="#__codelineno-18-127"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-18-128"><a id="__codelineno-18-128" name="__codelineno-18-128" href="#__codelineno-18-128"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== UNTAGGED VMs DETAILED LIST ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-18-129"><a id="__codelineno-18-129" name="__codelineno-18-129" href="#__codelineno-18-129"></a><span class="nb">Write-Host</span> <span class="s2">&quot;The following </span><span class="p">$(</span><span class="nv">$untaggedVMs</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> VMs are missing Azure Update Manager maintenance tags:&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-130"><a id="__codelineno-18-130" name="__codelineno-18-130" href="#__codelineno-18-130"></a>
</span><span id="__span-18-131"><a id="__codelineno-18-131" name="__codelineno-18-131" href="#__codelineno-18-131"></a><span class="c"># Group untagged VMs by subscription for easier reading</span>
</span><span id="__span-18-132"><a id="__codelineno-18-132" name="__codelineno-18-132" href="#__codelineno-18-132"></a><span class="nv">$untaggedBySubscription</span> <span class="p">=</span> <span class="nv">$untaggedVMs</span> <span class="p">|</span> <span class="nb">Group-Object</span> <span class="n">Subscription</span>
</span><span id="__span-18-133"><a id="__codelineno-18-133" name="__codelineno-18-133" href="#__codelineno-18-133"></a>
</span><span id="__span-18-134"><a id="__codelineno-18-134" name="__codelineno-18-134" href="#__codelineno-18-134"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$group</span> <span class="k">in</span> <span class="nv">$untaggedBySubscription</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Name</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-18-135"><a id="__codelineno-18-135" name="__codelineno-18-135" href="#__codelineno-18-135"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">� Subscription: </span><span class="p">$(</span><span class="nv">$group</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2"> (</span><span class="p">$(</span><span class="nv">$group</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> untagged VMs)&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Magenta</span>
</span><span id="__span-18-136"><a id="__codelineno-18-136" name="__codelineno-18-136" href="#__codelineno-18-136"></a>
</span><span id="__span-18-137"><a id="__codelineno-18-137" name="__codelineno-18-137" href="#__codelineno-18-137"></a>    <span class="nv">$group</span><span class="p">.</span><span class="nb">Group </span><span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Name</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-18-138"><a id="__codelineno-18-138" name="__codelineno-18-138" href="#__codelineno-18-138"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;  • </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-18-139"><a id="__codelineno-18-139" name="__codelineno-18-139" href="#__codelineno-18-139"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;    Resource Group: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">ResourceGroup</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-18-140"><a id="__codelineno-18-140" name="__codelineno-18-140" href="#__codelineno-18-140"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;    Location: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Location</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-18-141"><a id="__codelineno-18-141" name="__codelineno-18-141" href="#__codelineno-18-141"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;    OS Type: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">OsType</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-18-142"><a id="__codelineno-18-142" name="__codelineno-18-142" href="#__codelineno-18-142"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;    VM Size: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">VmSize</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-18-143"><a id="__codelineno-18-143" name="__codelineno-18-143" href="#__codelineno-18-143"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;    Power State: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">PowerState</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-18-144"><a id="__codelineno-18-144" name="__codelineno-18-144" href="#__codelineno-18-144"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Tags</span> <span class="o">-ne</span> <span class="s2">&quot;No tags&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-18-145"><a id="__codelineno-18-145" name="__codelineno-18-145" href="#__codelineno-18-145"></a>            <span class="nb">Write-Host</span> <span class="s2">&quot;    Existing Tags: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Tags</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">DarkGray</span>
</span><span id="__span-18-146"><a id="__codelineno-18-146" name="__codelineno-18-146" href="#__codelineno-18-146"></a>        <span class="p">}</span>
</span><span id="__span-18-147"><a id="__codelineno-18-147" name="__codelineno-18-147" href="#__codelineno-18-147"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-18-148"><a id="__codelineno-18-148" name="__codelineno-18-148" href="#__codelineno-18-148"></a>    <span class="p">}</span>
</span><span id="__span-18-149"><a id="__codelineno-18-149" name="__codelineno-18-149" href="#__codelineno-18-149"></a><span class="p">}</span>
</span><span id="__span-18-150"><a id="__codelineno-18-150" name="__codelineno-18-150" href="#__codelineno-18-150"></a>
</span><span id="__span-18-151"><a id="__codelineno-18-151" name="__codelineno-18-151" href="#__codelineno-18-151"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== ANALYSIS BY VM CHARACTERISTICS ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-18-152"><a id="__codelineno-18-152" name="__codelineno-18-152" href="#__codelineno-18-152"></a>
</span><span id="__span-18-153"><a id="__codelineno-18-153" name="__codelineno-18-153" href="#__codelineno-18-153"></a><span class="c"># Analyze by OS Type</span>
</span><span id="__span-18-154"><a id="__codelineno-18-154" name="__codelineno-18-154" href="#__codelineno-18-154"></a><span class="nv">$untaggedByOS</span> <span class="p">=</span> <span class="nv">$untaggedVMs</span> <span class="p">|</span> <span class="nb">Group-Object</span> <span class="n">OsType</span>
</span><span id="__span-18-155"><a id="__codelineno-18-155" name="__codelineno-18-155" href="#__codelineno-18-155"></a><span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">� Untagged VMs by OS Type:&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-156"><a id="__codelineno-18-156" name="__codelineno-18-156" href="#__codelineno-18-156"></a><span class="nv">$untaggedByOS</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Name</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-18-157"><a id="__codelineno-18-157" name="__codelineno-18-157" href="#__codelineno-18-157"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;  </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2">: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> VMs&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-158"><a id="__codelineno-18-158" name="__codelineno-18-158" href="#__codelineno-18-158"></a><span class="p">}</span>
</span><span id="__span-18-159"><a id="__codelineno-18-159" name="__codelineno-18-159" href="#__codelineno-18-159"></a>
</span><span id="__span-18-160"><a id="__codelineno-18-160" name="__codelineno-18-160" href="#__codelineno-18-160"></a><span class="c"># Analyze by Location</span>
</span><span id="__span-18-161"><a id="__codelineno-18-161" name="__codelineno-18-161" href="#__codelineno-18-161"></a><span class="nv">$untaggedByLocation</span> <span class="p">=</span> <span class="nv">$untaggedVMs</span> <span class="p">|</span> <span class="nb">Group-Object</span> <span class="n">Location</span>
</span><span id="__span-18-162"><a id="__codelineno-18-162" name="__codelineno-18-162" href="#__codelineno-18-162"></a><span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">� Untagged VMs by Location:&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-163"><a id="__codelineno-18-163" name="__codelineno-18-163" href="#__codelineno-18-163"></a><span class="nv">$untaggedByLocation</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Count</span> <span class="n">-Descending</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-18-164"><a id="__codelineno-18-164" name="__codelineno-18-164" href="#__codelineno-18-164"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;  </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2">: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> VMs&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-165"><a id="__codelineno-18-165" name="__codelineno-18-165" href="#__codelineno-18-165"></a><span class="p">}</span>
</span><span id="__span-18-166"><a id="__codelineno-18-166" name="__codelineno-18-166" href="#__codelineno-18-166"></a>
</span><span id="__span-18-167"><a id="__codelineno-18-167" name="__codelineno-18-167" href="#__codelineno-18-167"></a><span class="c"># Analyze by VM Size (to understand workload types)</span>
</span><span id="__span-18-168"><a id="__codelineno-18-168" name="__codelineno-18-168" href="#__codelineno-18-168"></a><span class="nv">$untaggedBySize</span> <span class="p">=</span> <span class="nv">$untaggedVMs</span> <span class="p">|</span> <span class="nb">Group-Object</span> <span class="n">VmSize</span>
</span><span id="__span-18-169"><a id="__codelineno-18-169" name="__codelineno-18-169" href="#__codelineno-18-169"></a><span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">� Untagged VMs by Size:&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-170"><a id="__codelineno-18-170" name="__codelineno-18-170" href="#__codelineno-18-170"></a><span class="nv">$untaggedBySize</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Count</span> <span class="n">-Descending</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-First</span> <span class="n">10</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-18-171"><a id="__codelineno-18-171" name="__codelineno-18-171" href="#__codelineno-18-171"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;  </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2">: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> VMs&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-172"><a id="__codelineno-18-172" name="__codelineno-18-172" href="#__codelineno-18-172"></a><span class="p">}</span>
</span><span id="__span-18-173"><a id="__codelineno-18-173" name="__codelineno-18-173" href="#__codelineno-18-173"></a>
</span><span id="__span-18-174"><a id="__codelineno-18-174" name="__codelineno-18-174" href="#__codelineno-18-174"></a><span class="c"># Analyze by Resource Group (might indicate application/workload groupings)</span>
</span><span id="__span-18-175"><a id="__codelineno-18-175" name="__codelineno-18-175" href="#__codelineno-18-175"></a><span class="nv">$untaggedByRG</span> <span class="p">=</span> <span class="nv">$untaggedVMs</span> <span class="p">|</span> <span class="nb">Group-Object</span> <span class="n">ResourceGroup</span>
</span><span id="__span-18-176"><a id="__codelineno-18-176" name="__codelineno-18-176" href="#__codelineno-18-176"></a><span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">� Untagged VMs by Resource Group (Top 10):&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-177"><a id="__codelineno-18-177" name="__codelineno-18-177" href="#__codelineno-18-177"></a><span class="nv">$untaggedByRG</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Count</span> <span class="n">-Descending</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-First</span> <span class="n">10</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-18-178"><a id="__codelineno-18-178" name="__codelineno-18-178" href="#__codelineno-18-178"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;  </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2">: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> VMs&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-179"><a id="__codelineno-18-179" name="__codelineno-18-179" href="#__codelineno-18-179"></a><span class="p">}</span>
</span><span id="__span-18-180"><a id="__codelineno-18-180" name="__codelineno-18-180" href="#__codelineno-18-180"></a>
</span><span id="__span-18-181"><a id="__codelineno-18-181" name="__codelineno-18-181" href="#__codelineno-18-181"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-18-182"><a id="__codelineno-18-182" name="__codelineno-18-182" href="#__codelineno-18-182"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== POWER STATE ANALYSIS ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-18-183"><a id="__codelineno-18-183" name="__codelineno-18-183" href="#__codelineno-18-183"></a><span class="nv">$powerStates</span> <span class="p">=</span> <span class="nv">$untaggedVMs</span> <span class="p">|</span> <span class="nb">Group-Object</span> <span class="n">PowerState</span>
</span><span id="__span-18-184"><a id="__codelineno-18-184" name="__codelineno-18-184" href="#__codelineno-18-184"></a><span class="nv">$powerStates</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Count</span> <span class="n">-Descending</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-18-185"><a id="__codelineno-18-185" name="__codelineno-18-185" href="#__codelineno-18-185"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2">: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> VMs&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-186"><a id="__codelineno-18-186" name="__codelineno-18-186" href="#__codelineno-18-186"></a><span class="p">}</span>
</span><span id="__span-18-187"><a id="__codelineno-18-187" name="__codelineno-18-187" href="#__codelineno-18-187"></a>
</span><span id="__span-18-188"><a id="__codelineno-18-188" name="__codelineno-18-188" href="#__codelineno-18-188"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-18-189"><a id="__codelineno-18-189" name="__codelineno-18-189" href="#__codelineno-18-189"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== EXPORT OPTIONS ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-18-190"><a id="__codelineno-18-190" name="__codelineno-18-190" href="#__codelineno-18-190"></a><span class="nb">Write-Host</span> <span class="s2">&quot;You can export this data for further analysis:&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-191"><a id="__codelineno-18-191" name="__codelineno-18-191" href="#__codelineno-18-191"></a>
</span><span id="__span-18-192"><a id="__codelineno-18-192" name="__codelineno-18-192" href="#__codelineno-18-192"></a><span class="c"># Export to CSV option</span>
</span><span id="__span-18-193"><a id="__codelineno-18-193" name="__codelineno-18-193" href="#__codelineno-18-193"></a><span class="nv">$timestamp</span> <span class="p">=</span> <span class="nb">Get-Date</span> <span class="n">-Format</span> <span class="s2">&quot;yyyyMMdd-HHmm&quot;</span>
</span><span id="__span-18-194"><a id="__codelineno-18-194" name="__codelineno-18-194" href="#__codelineno-18-194"></a><span class="nv">$csvPath</span> <span class="p">=</span> <span class="s2">&quot;D:\UntaggedVMs-$timestamp.csv&quot;</span>
</span><span id="__span-18-195"><a id="__codelineno-18-195" name="__codelineno-18-195" href="#__codelineno-18-195"></a>
</span><span id="__span-18-196"><a id="__codelineno-18-196" name="__codelineno-18-196" href="#__codelineno-18-196"></a><span class="k">try</span> <span class="p">{</span>
</span><span id="__span-18-197"><a id="__codelineno-18-197" name="__codelineno-18-197" href="#__codelineno-18-197"></a>    <span class="nv">$untaggedVMs</span> <span class="p">|</span> <span class="nb">Export-Csv</span> <span class="n">-Path</span> <span class="nv">$csvPath</span> <span class="n">-NoTypeInformation</span>
</span><span id="__span-18-198"><a id="__codelineno-18-198" name="__codelineno-18-198" href="#__codelineno-18-198"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;✓ Exported untagged VMs to: $csvPath&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-18-199"><a id="__codelineno-18-199" name="__codelineno-18-199" href="#__codelineno-18-199"></a><span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-18-200"><a id="__codelineno-18-200" name="__codelineno-18-200" href="#__codelineno-18-200"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;✗ Failed to export CSV: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-18-201"><a id="__codelineno-18-201" name="__codelineno-18-201" href="#__codelineno-18-201"></a><span class="p">}</span>
</span><span id="__span-18-202"><a id="__codelineno-18-202" name="__codelineno-18-202" href="#__codelineno-18-202"></a>
</span><span id="__span-18-203"><a id="__codelineno-18-203" name="__codelineno-18-203" href="#__codelineno-18-203"></a><span class="c"># Show simple list for easy copying</span>
</span><span id="__span-18-204"><a id="__codelineno-18-204" name="__codelineno-18-204" href="#__codelineno-18-204"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-18-205"><a id="__codelineno-18-205" name="__codelineno-18-205" href="#__codelineno-18-205"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== SIMPLE VM NAME LIST (for copy/paste) ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-18-206"><a id="__codelineno-18-206" name="__codelineno-18-206" href="#__codelineno-18-206"></a><span class="nb">Write-Host</span> <span class="s2">&quot;VM Names:&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-207"><a id="__codelineno-18-207" name="__codelineno-18-207" href="#__codelineno-18-207"></a><span class="nv">$untaggedVMs</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Name</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span> <span class="nb">Write-Host</span> <span class="s2">&quot;  </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span> <span class="p">}</span>
</span><span id="__span-18-208"><a id="__codelineno-18-208" name="__codelineno-18-208" href="#__codelineno-18-208"></a>
</span><span id="__span-18-209"><a id="__codelineno-18-209" name="__codelineno-18-209" href="#__codelineno-18-209"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-18-210"><a id="__codelineno-18-210" name="__codelineno-18-210" href="#__codelineno-18-210"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== NEXT STEPS RECOMMENDATIONS ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-18-211"><a id="__codelineno-18-211" name="__codelineno-18-211" href="#__codelineno-18-211"></a><span class="nb">Write-Host</span> <span class="s2">&quot;1. Review the untagged VMs list above&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-212"><a id="__codelineno-18-212" name="__codelineno-18-212" href="#__codelineno-18-212"></a><span class="nb">Write-Host</span> <span class="s2">&quot;2. Investigate why these VMs were not in the original patching schedule&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-213"><a id="__codelineno-18-213" name="__codelineno-18-213" href="#__codelineno-18-213"></a><span class="nb">Write-Host</span> <span class="s2">&quot;3. Determine appropriate maintenance windows for these VMs&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-214"><a id="__codelineno-18-214" name="__codelineno-18-214" href="#__codelineno-18-214"></a><span class="nb">Write-Host</span> <span class="s2">&quot;4. Consider grouping by:&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-215"><a id="__codelineno-18-215" name="__codelineno-18-215" href="#__codelineno-18-215"></a><span class="nb">Write-Host</span> <span class="s2">&quot;   • Application/workload (Resource Group analysis)&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-18-216"><a id="__codelineno-18-216" name="__codelineno-18-216" href="#__codelineno-18-216"></a><span class="nb">Write-Host</span> <span class="s2">&quot;   • Environment (naming patterns, tags)&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-18-217"><a id="__codelineno-18-217" name="__codelineno-18-217" href="#__codelineno-18-217"></a><span class="nb">Write-Host</span> <span class="s2">&quot;   • Business criticality&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-18-218"><a id="__codelineno-18-218" name="__codelineno-18-218" href="#__codelineno-18-218"></a><span class="nb">Write-Host</span> <span class="s2">&quot;   • Maintenance window preferences&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-18-219"><a id="__codelineno-18-219" name="__codelineno-18-219" href="#__codelineno-18-219"></a><span class="nb">Write-Host</span> <span class="s2">&quot;5. Run the tagging script to assign maintenance windows&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-220"><a id="__codelineno-18-220" name="__codelineno-18-220" href="#__codelineno-18-220"></a>
</span><span id="__span-18-221"><a id="__codelineno-18-221" name="__codelineno-18-221" href="#__codelineno-18-221"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-18-222"><a id="__codelineno-18-222" name="__codelineno-18-222" href="#__codelineno-18-222"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== AZURE RESOURCE GRAPH QUERY ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-18-223"><a id="__codelineno-18-223" name="__codelineno-18-223" href="#__codelineno-18-223"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Use this query in Azure Resource Graph Explorer to verify results:&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-18-224"><a id="__codelineno-18-224" name="__codelineno-18-224" href="#__codelineno-18-224"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-18-225"><a id="__codelineno-18-225" name="__codelineno-18-225" href="#__codelineno-18-225"></a><span class="nb">Write-Host</span> <span class="sh">@&quot;</span>
</span><span id="__span-18-226"><a id="__codelineno-18-226" name="__codelineno-18-226" href="#__codelineno-18-226"></a><span class="sh">Resources</span>
</span><span id="__span-18-227"><a id="__codelineno-18-227" name="__codelineno-18-227" href="#__codelineno-18-227"></a><span class="sh">| where type == &quot;microsoft.compute/virtualmachines&quot;</span>
</span><span id="__span-18-228"><a id="__codelineno-18-228" name="__codelineno-18-228" href="#__codelineno-18-228"></a><span class="sh">| where tags.PatchWindow == &quot;&quot; or isempty(tags.PatchWindow) or isnull(tags.PatchWindow)</span>
</span><span id="__span-18-229"><a id="__codelineno-18-229" name="__codelineno-18-229" href="#__codelineno-18-229"></a><span class="sh">| project name, resourceGroup, subscriptionId, location, </span>
</span><span id="__span-18-230"><a id="__codelineno-18-230" name="__codelineno-18-230" href="#__codelineno-18-230"></a><span class="sh">          osType = properties.storageProfile.osDisk.osType,</span>
</span><span id="__span-18-231"><a id="__codelineno-18-231" name="__codelineno-18-231" href="#__codelineno-18-231"></a><span class="sh">          vmSize = properties.hardwareProfile.vmSize,</span>
</span><span id="__span-18-232"><a id="__codelineno-18-232" name="__codelineno-18-232" href="#__codelineno-18-232"></a><span class="sh">          powerState = properties.extended.instanceView.powerState.displayStatus,</span>
</span><span id="__span-18-233"><a id="__codelineno-18-233" name="__codelineno-18-233" href="#__codelineno-18-233"></a><span class="sh">          tags</span>
</span><span id="__span-18-234"><a id="__codelineno-18-234" name="__codelineno-18-234" href="#__codelineno-18-234"></a><span class="sh">| sort by name asc</span>
</span><span id="__span-18-235"><a id="__codelineno-18-235" name="__codelineno-18-235" href="#__codelineno-18-235"></a><span class="sh">&quot;@</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-18-236"><a id="__codelineno-18-236" name="__codelineno-18-236" href="#__codelineno-18-236"></a>
</span><span id="__span-18-237"><a id="__codelineno-18-237" name="__codelineno-18-237" href="#__codelineno-18-237"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-18-238"><a id="__codelineno-18-238" name="__codelineno-18-238" href="#__codelineno-18-238"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Script completed at </span><span class="p">$(</span><span class="nb">Get-Date</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-18-239"><a id="__codelineno-18-239" name="__codelineno-18-239" href="#__codelineno-18-239"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Total runtime: </span><span class="p">$((</span><span class="nb">Get-Date</span><span class="p">)</span> <span class="p">-</span> <span class="nv">$scriptStart</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span></code></pre></div>

</details>

<p><strong>Discovery results:</strong></p>
<ul>
<li><strong>35 VMs</strong> from the original MSP schedule (our planned list)</li>
<li><strong>12 additional VMs</strong> not in the MSP schedule (the "stragglers")</li>
<li><strong>Total: 90 VMs</strong> needing Update Manager tags</li>
</ul>
<blockquote>
<p><strong>Key insight:</strong> The MSP wasn't managing everything. Several dev/test VMs and a few production systems were missing from their schedule.</p>
</blockquote>
<hr />
<h3 id="step-6-bulk-tag-all-vms-with-patch-windows"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#step-6-bulk-tag-all-vms-with-patch-windows">✍️ Step 6 – Bulk Tag All VMs with Patch Windows</a></h3>
<p>Now for the main event: tagging all VMs with their maintenance windows. This includes both our planned VMs and the newly discovered ones.</p>
<h4 id="main-vm-tagging-planned-schedule"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#main-vm-tagging-planned-schedule">🎯 Main VM Tagging (Planned Schedule)</a></h4>
<p>Each tag serves a specific purpose:</p>
<ul>
<li><code>PatchWindow</code> — The key tag used by dynamic scopes to assign VMs to maintenance configurations</li>
<li><code>Owner</code> — For accountability and filtering</li>
<li><code>Updates</code> — Identifies VMs managed by Azure Update Manager</li>
</ul>
<details>
<summary>Click to expand: Multi-Subscription Azure Update Manager VM Tagging (Sample Script)</summary>

<div class="language-powershell highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c"># Multi-Subscription Azure Update Manager VM Tagging Script</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="c"># This script discovers VMs across multiple subscriptions and tags them appropriately</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== Multi-Subscription Azure Update Manager - VM Tagging Script ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="c"># Function to safely tag a VM</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="k">function</span> <span class="nb">Set-VMMaintenanceTags</span> <span class="p">{</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>        <span class="no">[string]</span><span class="nv">$VMName</span><span class="p">,</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>        <span class="no">[string]</span><span class="nv">$ResourceGroupName</span><span class="p">,</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>        <span class="no">[string]</span><span class="nv">$SubscriptionId</span><span class="p">,</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>        <span class="no">[hashtable]</span><span class="nv">$Tags</span><span class="p">,</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>        <span class="no">[string]</span><span class="nv">$MaintenanceWindow</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>    <span class="p">)</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>        <span class="c"># Set context to the VM&#39;s subscription</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>        <span class="nv">$null</span> <span class="p">=</span> <span class="nb">Set-AzContext</span> <span class="n">-SubscriptionId</span> <span class="nv">$SubscriptionId</span> <span class="n">-ErrorAction</span> <span class="n">Stop</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;  Processing: $VMName...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>        <span class="c"># Get the VM and update tags</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>        <span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-AzVM</span> <span class="n">-ResourceGroupName</span> <span class="nv">$ResourceGroupName</span> <span class="n">-Name</span> <span class="nv">$VMName</span> <span class="n">-ErrorAction</span> <span class="n">Stop</span>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$vm</span><span class="p">.</span><span class="n">Tags</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>            <span class="nv">$Tags</span><span class="p">.</span><span class="n">Keys</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span> <span class="nv">$vm</span><span class="p">.</span><span class="n">Tags</span><span class="p">[</span><span class="nv">$_</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$Tags</span><span class="p">[</span><span class="nv">$_</span><span class="p">]</span> <span class="p">}</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a>            <span class="nv">$vm</span><span class="p">.</span><span class="n">Tags</span> <span class="p">=</span> <span class="nv">$Tags</span>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a>        <span class="p">}</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a>        <span class="nv">$null</span> <span class="p">=</span> <span class="nb">Update-AzVM</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-ResourceGroupName</span> <span class="nv">$ResourceGroupName</span> <span class="n">-Tag</span> <span class="nv">$vm</span><span class="p">.</span><span class="n">Tags</span> <span class="n">-ErrorAction</span> <span class="n">Stop</span>
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;  ✓ Successfully tagged $VMName for $MaintenanceWindow maintenance&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a>
</span><span id="__span-19-34"><a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a>        <span class="k">return</span> <span class="nv">$true</span>
</span><span id="__span-19-35"><a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a>    <span class="p">}</span>
</span><span id="__span-19-36"><a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a>    <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-19-37"><a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;  ✗ Failed to tag $VMName`: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-19-38"><a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a>        <span class="k">return</span> <span class="nv">$false</span>
</span><span id="__span-19-39"><a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a>    <span class="p">}</span>
</span><span id="__span-19-40"><a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a><span class="p">}</span>
</span><span id="__span-19-41"><a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a>
</span><span id="__span-19-42"><a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a><span class="c"># Define all target VMs organized by maintenance window</span>
</span><span id="__span-19-43"><a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a><span class="nv">$maintenanceGroups</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-44"><a id="__codelineno-19-44" name="__codelineno-19-44" href="#__codelineno-19-44"></a>    <span class="s2">&quot;Monday&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-45"><a id="__codelineno-19-45" name="__codelineno-19-45" href="#__codelineno-19-45"></a>        <span class="s2">&quot;VMs&quot;</span> <span class="p">=</span> <span class="p">@(</span><span class="s2">&quot;WEB-PROD-01&quot;</span><span class="p">,</span> <span class="s2">&quot;DB-PROD-01&quot;</span><span class="p">,</span> <span class="s2">&quot;APP-PROD-01&quot;</span><span class="p">,</span> <span class="s2">&quot;FILE-PROD-01&quot;</span><span class="p">,</span> <span class="s2">&quot;DC-PROD-01&quot;</span><span class="p">)</span>
</span><span id="__span-19-46"><a id="__codelineno-19-46" name="__codelineno-19-46" href="#__codelineno-19-46"></a>        <span class="s2">&quot;Tags&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-47"><a id="__codelineno-19-47" name="__codelineno-19-47" href="#__codelineno-19-47"></a>            <span class="s2">&quot;Owner&quot;</span> <span class="p">=</span> <span class="s2">&quot;Contoso&quot;</span>
</span><span id="__span-19-48"><a id="__codelineno-19-48" name="__codelineno-19-48" href="#__codelineno-19-48"></a>            <span class="s2">&quot;Updates&quot;</span> <span class="p">=</span> <span class="s2">&quot;Azure Update Manager&quot;</span>
</span><span id="__span-19-49"><a id="__codelineno-19-49" name="__codelineno-19-49" href="#__codelineno-19-49"></a>            <span class="s2">&quot;PatchWindow&quot;</span> <span class="p">=</span> <span class="s2">&quot;mon&quot;</span>
</span><span id="__span-19-50"><a id="__codelineno-19-50" name="__codelineno-19-50" href="#__codelineno-19-50"></a>        <span class="p">}</span>
</span><span id="__span-19-51"><a id="__codelineno-19-51" name="__codelineno-19-51" href="#__codelineno-19-51"></a>    <span class="p">}</span>
</span><span id="__span-19-52"><a id="__codelineno-19-52" name="__codelineno-19-52" href="#__codelineno-19-52"></a>    <span class="s2">&quot;Tuesday&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-53"><a id="__codelineno-19-53" name="__codelineno-19-53" href="#__codelineno-19-53"></a>        <span class="s2">&quot;VMs&quot;</span> <span class="p">=</span> <span class="p">@(</span><span class="s2">&quot;WEB-PROD-02&quot;</span><span class="p">,</span> <span class="s2">&quot;DB-PROD-02&quot;</span><span class="p">,</span> <span class="s2">&quot;APP-PROD-02&quot;</span><span class="p">,</span> <span class="s2">&quot;FILE-PROD-02&quot;</span><span class="p">,</span> <span class="s2">&quot;DC-PROD-02&quot;</span><span class="p">)</span>
</span><span id="__span-19-54"><a id="__codelineno-19-54" name="__codelineno-19-54" href="#__codelineno-19-54"></a>        <span class="s2">&quot;Tags&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-55"><a id="__codelineno-19-55" name="__codelineno-19-55" href="#__codelineno-19-55"></a>            <span class="s2">&quot;Owner&quot;</span> <span class="p">=</span> <span class="s2">&quot;Contoso&quot;</span>
</span><span id="__span-19-56"><a id="__codelineno-19-56" name="__codelineno-19-56" href="#__codelineno-19-56"></a>            <span class="s2">&quot;Updates&quot;</span> <span class="p">=</span> <span class="s2">&quot;Azure Update Manager&quot;</span>
</span><span id="__span-19-57"><a id="__codelineno-19-57" name="__codelineno-19-57" href="#__codelineno-19-57"></a>            <span class="s2">&quot;PatchWindow&quot;</span> <span class="p">=</span> <span class="s2">&quot;tue&quot;</span>
</span><span id="__span-19-58"><a id="__codelineno-19-58" name="__codelineno-19-58" href="#__codelineno-19-58"></a>        <span class="p">}</span>
</span><span id="__span-19-59"><a id="__codelineno-19-59" name="__codelineno-19-59" href="#__codelineno-19-59"></a>    <span class="p">}</span>
</span><span id="__span-19-60"><a id="__codelineno-19-60" name="__codelineno-19-60" href="#__codelineno-19-60"></a>    <span class="s2">&quot;Wednesday&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-61"><a id="__codelineno-19-61" name="__codelineno-19-61" href="#__codelineno-19-61"></a>        <span class="s2">&quot;VMs&quot;</span> <span class="p">=</span> <span class="p">@(</span><span class="s2">&quot;WEB-PROD-03&quot;</span><span class="p">,</span> <span class="s2">&quot;DB-PROD-03&quot;</span><span class="p">,</span> <span class="s2">&quot;APP-PROD-03&quot;</span><span class="p">,</span> <span class="s2">&quot;FILE-PROD-03&quot;</span><span class="p">,</span> <span class="s2">&quot;DC-PROD-03&quot;</span><span class="p">)</span>
</span><span id="__span-19-62"><a id="__codelineno-19-62" name="__codelineno-19-62" href="#__codelineno-19-62"></a>        <span class="s2">&quot;Tags&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-63"><a id="__codelineno-19-63" name="__codelineno-19-63" href="#__codelineno-19-63"></a>            <span class="s2">&quot;Owner&quot;</span> <span class="p">=</span> <span class="s2">&quot;Contoso&quot;</span>
</span><span id="__span-19-64"><a id="__codelineno-19-64" name="__codelineno-19-64" href="#__codelineno-19-64"></a>            <span class="s2">&quot;Updates&quot;</span> <span class="p">=</span> <span class="s2">&quot;Azure Update Manager&quot;</span>
</span><span id="__span-19-65"><a id="__codelineno-19-65" name="__codelineno-19-65" href="#__codelineno-19-65"></a>            <span class="s2">&quot;PatchWindow&quot;</span> <span class="p">=</span> <span class="s2">&quot;wed&quot;</span>
</span><span id="__span-19-66"><a id="__codelineno-19-66" name="__codelineno-19-66" href="#__codelineno-19-66"></a>        <span class="p">}</span>
</span><span id="__span-19-67"><a id="__codelineno-19-67" name="__codelineno-19-67" href="#__codelineno-19-67"></a>    <span class="p">}</span>
</span><span id="__span-19-68"><a id="__codelineno-19-68" name="__codelineno-19-68" href="#__codelineno-19-68"></a>    <span class="s2">&quot;Thursday&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-69"><a id="__codelineno-19-69" name="__codelineno-19-69" href="#__codelineno-19-69"></a>        <span class="s2">&quot;VMs&quot;</span> <span class="p">=</span> <span class="p">@(</span><span class="s2">&quot;WEB-PROD-04&quot;</span><span class="p">,</span> <span class="s2">&quot;DB-PROD-04&quot;</span><span class="p">,</span> <span class="s2">&quot;APP-PROD-04&quot;</span><span class="p">,</span> <span class="s2">&quot;FILE-PROD-04&quot;</span><span class="p">,</span> <span class="s2">&quot;PRINT-PROD-01&quot;</span><span class="p">)</span>
</span><span id="__span-19-70"><a id="__codelineno-19-70" name="__codelineno-19-70" href="#__codelineno-19-70"></a>        <span class="s2">&quot;Tags&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-71"><a id="__codelineno-19-71" name="__codelineno-19-71" href="#__codelineno-19-71"></a>            <span class="s2">&quot;Owner&quot;</span> <span class="p">=</span> <span class="s2">&quot;Contoso&quot;</span>
</span><span id="__span-19-72"><a id="__codelineno-19-72" name="__codelineno-19-72" href="#__codelineno-19-72"></a>            <span class="s2">&quot;Updates&quot;</span> <span class="p">=</span> <span class="s2">&quot;Azure Update Manager&quot;</span>
</span><span id="__span-19-73"><a id="__codelineno-19-73" name="__codelineno-19-73" href="#__codelineno-19-73"></a>            <span class="s2">&quot;PatchWindow&quot;</span> <span class="p">=</span> <span class="s2">&quot;thu&quot;</span>
</span><span id="__span-19-74"><a id="__codelineno-19-74" name="__codelineno-19-74" href="#__codelineno-19-74"></a>        <span class="p">}</span>
</span><span id="__span-19-75"><a id="__codelineno-19-75" name="__codelineno-19-75" href="#__codelineno-19-75"></a>    <span class="p">}</span>
</span><span id="__span-19-76"><a id="__codelineno-19-76" name="__codelineno-19-76" href="#__codelineno-19-76"></a>    <span class="s2">&quot;Friday&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-77"><a id="__codelineno-19-77" name="__codelineno-19-77" href="#__codelineno-19-77"></a>        <span class="s2">&quot;VMs&quot;</span> <span class="p">=</span> <span class="p">@(</span><span class="s2">&quot;WEB-PROD-05&quot;</span><span class="p">,</span> <span class="s2">&quot;DB-PROD-05&quot;</span><span class="p">,</span> <span class="s2">&quot;APP-PROD-05&quot;</span><span class="p">,</span> <span class="s2">&quot;FILE-PROD-05&quot;</span><span class="p">,</span> <span class="s2">&quot;MONITOR-PROD-01&quot;</span><span class="p">)</span>
</span><span id="__span-19-78"><a id="__codelineno-19-78" name="__codelineno-19-78" href="#__codelineno-19-78"></a>        <span class="s2">&quot;Tags&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-79"><a id="__codelineno-19-79" name="__codelineno-19-79" href="#__codelineno-19-79"></a>            <span class="s2">&quot;Owner&quot;</span> <span class="p">=</span> <span class="s2">&quot;Contoso&quot;</span>
</span><span id="__span-19-80"><a id="__codelineno-19-80" name="__codelineno-19-80" href="#__codelineno-19-80"></a>            <span class="s2">&quot;Updates&quot;</span> <span class="p">=</span> <span class="s2">&quot;Azure Update Manager&quot;</span>
</span><span id="__span-19-81"><a id="__codelineno-19-81" name="__codelineno-19-81" href="#__codelineno-19-81"></a>            <span class="s2">&quot;PatchWindow&quot;</span> <span class="p">=</span> <span class="s2">&quot;fri&quot;</span>
</span><span id="__span-19-82"><a id="__codelineno-19-82" name="__codelineno-19-82" href="#__codelineno-19-82"></a>        <span class="p">}</span>
</span><span id="__span-19-83"><a id="__codelineno-19-83" name="__codelineno-19-83" href="#__codelineno-19-83"></a>    <span class="p">}</span>
</span><span id="__span-19-84"><a id="__codelineno-19-84" name="__codelineno-19-84" href="#__codelineno-19-84"></a>    <span class="s2">&quot;Saturday&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-85"><a id="__codelineno-19-85" name="__codelineno-19-85" href="#__codelineno-19-85"></a>        <span class="s2">&quot;VMs&quot;</span> <span class="p">=</span> <span class="p">@(</span><span class="s2">&quot;WEB-DEV-01&quot;</span><span class="p">,</span> <span class="s2">&quot;DB-DEV-01&quot;</span><span class="p">,</span> <span class="s2">&quot;APP-DEV-01&quot;</span><span class="p">,</span> <span class="s2">&quot;TEST-SERVER-01&quot;</span><span class="p">,</span> <span class="s2">&quot;SANDBOX-01&quot;</span><span class="p">)</span>
</span><span id="__span-19-86"><a id="__codelineno-19-86" name="__codelineno-19-86" href="#__codelineno-19-86"></a>        <span class="s2">&quot;Tags&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-87"><a id="__codelineno-19-87" name="__codelineno-19-87" href="#__codelineno-19-87"></a>            <span class="s2">&quot;Owner&quot;</span> <span class="p">=</span> <span class="s2">&quot;Contoso&quot;</span>
</span><span id="__span-19-88"><a id="__codelineno-19-88" name="__codelineno-19-88" href="#__codelineno-19-88"></a>            <span class="s2">&quot;Updates&quot;</span> <span class="p">=</span> <span class="s2">&quot;Azure Update Manager&quot;</span>
</span><span id="__span-19-89"><a id="__codelineno-19-89" name="__codelineno-19-89" href="#__codelineno-19-89"></a>            <span class="s2">&quot;PatchWindow&quot;</span> <span class="p">=</span> <span class="s2">&quot;sat-09&quot;</span>
</span><span id="__span-19-90"><a id="__codelineno-19-90" name="__codelineno-19-90" href="#__codelineno-19-90"></a>        <span class="p">}</span>
</span><span id="__span-19-91"><a id="__codelineno-19-91" name="__codelineno-19-91" href="#__codelineno-19-91"></a>    <span class="p">}</span>
</span><span id="__span-19-92"><a id="__codelineno-19-92" name="__codelineno-19-92" href="#__codelineno-19-92"></a>    <span class="s2">&quot;Sunday&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-93"><a id="__codelineno-19-93" name="__codelineno-19-93" href="#__codelineno-19-93"></a>        <span class="s2">&quot;VMs&quot;</span> <span class="p">=</span> <span class="p">@(</span><span class="s2">&quot;WEB-UAT-01&quot;</span><span class="p">,</span> <span class="s2">&quot;DB-UAT-01&quot;</span><span class="p">,</span> <span class="s2">&quot;APP-UAT-01&quot;</span><span class="p">,</span> <span class="s2">&quot;BACKUP-PROD-01&quot;</span><span class="p">,</span> <span class="s2">&quot;MGMT-PROD-01&quot;</span><span class="p">)</span>
</span><span id="__span-19-94"><a id="__codelineno-19-94" name="__codelineno-19-94" href="#__codelineno-19-94"></a>        <span class="s2">&quot;Tags&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-95"><a id="__codelineno-19-95" name="__codelineno-19-95" href="#__codelineno-19-95"></a>            <span class="s2">&quot;Owner&quot;</span> <span class="p">=</span> <span class="s2">&quot;Contoso&quot;</span>
</span><span id="__span-19-96"><a id="__codelineno-19-96" name="__codelineno-19-96" href="#__codelineno-19-96"></a>            <span class="s2">&quot;Updates&quot;</span> <span class="p">=</span> <span class="s2">&quot;Azure Update Manager&quot;</span>
</span><span id="__span-19-97"><a id="__codelineno-19-97" name="__codelineno-19-97" href="#__codelineno-19-97"></a>            <span class="s2">&quot;PatchWindow&quot;</span> <span class="p">=</span> <span class="s2">&quot;sun&quot;</span>
</span><span id="__span-19-98"><a id="__codelineno-19-98" name="__codelineno-19-98" href="#__codelineno-19-98"></a>        <span class="p">}</span>
</span><span id="__span-19-99"><a id="__codelineno-19-99" name="__codelineno-19-99" href="#__codelineno-19-99"></a>    <span class="p">}</span>
</span><span id="__span-19-100"><a id="__codelineno-19-100" name="__codelineno-19-100" href="#__codelineno-19-100"></a><span class="p">}</span>
</span><span id="__span-19-101"><a id="__codelineno-19-101" name="__codelineno-19-101" href="#__codelineno-19-101"></a>
</span><span id="__span-19-102"><a id="__codelineno-19-102" name="__codelineno-19-102" href="#__codelineno-19-102"></a><span class="c"># Function to discover VMs across all subscriptions</span>
</span><span id="__span-19-103"><a id="__codelineno-19-103" name="__codelineno-19-103" href="#__codelineno-19-103"></a><span class="k">function</span> <span class="nb">Find-VMsAcrossSubscriptions</span> <span class="p">{</span>
</span><span id="__span-19-104"><a id="__codelineno-19-104" name="__codelineno-19-104" href="#__codelineno-19-104"></a>    <span class="k">param</span><span class="p">(</span><span class="no">[array]</span><span class="nv">$TargetVMNames</span><span class="p">)</span>
</span><span id="__span-19-105"><a id="__codelineno-19-105" name="__codelineno-19-105" href="#__codelineno-19-105"></a>
</span><span id="__span-19-106"><a id="__codelineno-19-106" name="__codelineno-19-106" href="#__codelineno-19-106"></a>    <span class="nv">$subscriptions</span> <span class="p">=</span> <span class="nb">Get-AzSubscription</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">State</span> <span class="o">-eq</span> <span class="s2">&quot;Enabled&quot;</span> <span class="p">}</span>
</span><span id="__span-19-107"><a id="__codelineno-19-107" name="__codelineno-19-107" href="#__codelineno-19-107"></a>    <span class="nv">$vmInventory</span> <span class="p">=</span> <span class="p">@{}</span>
</span><span id="__span-19-108"><a id="__codelineno-19-108" name="__codelineno-19-108" href="#__codelineno-19-108"></a>
</span><span id="__span-19-109"><a id="__codelineno-19-109" name="__codelineno-19-109" href="#__codelineno-19-109"></a>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$subscription</span> <span class="k">in</span> <span class="nv">$subscriptions</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-19-110"><a id="__codelineno-19-110" name="__codelineno-19-110" href="#__codelineno-19-110"></a>        <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-19-111"><a id="__codelineno-19-111" name="__codelineno-19-111" href="#__codelineno-19-111"></a>            <span class="nv">$null</span> <span class="p">=</span> <span class="nb">Set-AzContext</span> <span class="n">-SubscriptionId</span> <span class="nv">$subscription</span><span class="p">.</span><span class="n">Id</span> <span class="n">-ErrorAction</span> <span class="n">Stop</span>
</span><span id="__span-19-112"><a id="__codelineno-19-112" name="__codelineno-19-112" href="#__codelineno-19-112"></a>            <span class="nv">$vms</span> <span class="p">=</span> <span class="nb">Get-AzVM</span> <span class="n">-ErrorAction</span> <span class="k">Continue</span>
</span><span id="__span-19-113"><a id="__codelineno-19-113" name="__codelineno-19-113" href="#__codelineno-19-113"></a>
</span><span id="__span-19-114"><a id="__codelineno-19-114" name="__codelineno-19-114" href="#__codelineno-19-114"></a>            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$vm</span> <span class="k">in</span> <span class="nv">$vms</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-19-115"><a id="__codelineno-19-115" name="__codelineno-19-115" href="#__codelineno-19-115"></a>                <span class="k">if</span> <span class="p">(</span><span class="nv">$vm</span><span class="p">.</span><span class="n">Name</span> <span class="n">-in</span> <span class="nv">$TargetVMNames</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-19-116"><a id="__codelineno-19-116" name="__codelineno-19-116" href="#__codelineno-19-116"></a>                    <span class="nv">$vmInventory</span><span class="p">[</span><span class="nv">$vm</span><span class="p">.</span><span class="n">Name</span><span class="p">]</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-19-117"><a id="__codelineno-19-117" name="__codelineno-19-117" href="#__codelineno-19-117"></a>                        <span class="n">Name</span> <span class="p">=</span> <span class="nv">$vm</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-19-118"><a id="__codelineno-19-118" name="__codelineno-19-118" href="#__codelineno-19-118"></a>                        <span class="n">ResourceGroupName</span> <span class="p">=</span> <span class="nv">$vm</span><span class="p">.</span><span class="n">ResourceGroupName</span>
</span><span id="__span-19-119"><a id="__codelineno-19-119" name="__codelineno-19-119" href="#__codelineno-19-119"></a>                        <span class="n">SubscriptionId</span> <span class="p">=</span> <span class="nv">$subscription</span><span class="p">.</span><span class="n">Id</span>
</span><span id="__span-19-120"><a id="__codelineno-19-120" name="__codelineno-19-120" href="#__codelineno-19-120"></a>                        <span class="n">SubscriptionName</span> <span class="p">=</span> <span class="nv">$subscription</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-19-121"><a id="__codelineno-19-121" name="__codelineno-19-121" href="#__codelineno-19-121"></a>                        <span class="n">Location</span> <span class="p">=</span> <span class="nv">$vm</span><span class="p">.</span><span class="n">Location</span>
</span><span id="__span-19-122"><a id="__codelineno-19-122" name="__codelineno-19-122" href="#__codelineno-19-122"></a>                    <span class="p">}</span>
</span><span id="__span-19-123"><a id="__codelineno-19-123" name="__codelineno-19-123" href="#__codelineno-19-123"></a>                <span class="p">}</span>
</span><span id="__span-19-124"><a id="__codelineno-19-124" name="__codelineno-19-124" href="#__codelineno-19-124"></a>            <span class="p">}</span>
</span><span id="__span-19-125"><a id="__codelineno-19-125" name="__codelineno-19-125" href="#__codelineno-19-125"></a>        <span class="p">}</span>
</span><span id="__span-19-126"><a id="__codelineno-19-126" name="__codelineno-19-126" href="#__codelineno-19-126"></a>        <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-19-127"><a id="__codelineno-19-127" name="__codelineno-19-127" href="#__codelineno-19-127"></a>            <span class="nb">Write-Host</span> <span class="s2">&quot;Error scanning subscription </span><span class="p">$(</span><span class="nv">$subscription</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2">: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-19-128"><a id="__codelineno-19-128" name="__codelineno-19-128" href="#__codelineno-19-128"></a>        <span class="p">}</span>
</span><span id="__span-19-129"><a id="__codelineno-19-129" name="__codelineno-19-129" href="#__codelineno-19-129"></a>    <span class="p">}</span>
</span><span id="__span-19-130"><a id="__codelineno-19-130" name="__codelineno-19-130" href="#__codelineno-19-130"></a>
</span><span id="__span-19-131"><a id="__codelineno-19-131" name="__codelineno-19-131" href="#__codelineno-19-131"></a>    <span class="k">return</span> <span class="nv">$vmInventory</span>
</span><span id="__span-19-132"><a id="__codelineno-19-132" name="__codelineno-19-132" href="#__codelineno-19-132"></a><span class="p">}</span>
</span><span id="__span-19-133"><a id="__codelineno-19-133" name="__codelineno-19-133" href="#__codelineno-19-133"></a>
</span><span id="__span-19-134"><a id="__codelineno-19-134" name="__codelineno-19-134" href="#__codelineno-19-134"></a><span class="c"># Get all unique VM names and discover their locations</span>
</span><span id="__span-19-135"><a id="__codelineno-19-135" name="__codelineno-19-135" href="#__codelineno-19-135"></a><span class="nv">$allTargetVMs</span> <span class="p">=</span> <span class="p">@()</span>
</span><span id="__span-19-136"><a id="__codelineno-19-136" name="__codelineno-19-136" href="#__codelineno-19-136"></a><span class="nv">$maintenanceGroups</span><span class="p">.</span><span class="n">Values</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span> <span class="nv">$allTargetVMs</span> <span class="p">+=</span> <span class="nv">$_</span><span class="p">.</span><span class="n">VMs</span> <span class="p">}</span>
</span><span id="__span-19-137"><a id="__codelineno-19-137" name="__codelineno-19-137" href="#__codelineno-19-137"></a><span class="nv">$allTargetVMs</span> <span class="p">=</span> <span class="nv">$allTargetVMs</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">-Unique</span>
</span><span id="__span-19-138"><a id="__codelineno-19-138" name="__codelineno-19-138" href="#__codelineno-19-138"></a>
</span><span id="__span-19-139"><a id="__codelineno-19-139" name="__codelineno-19-139" href="#__codelineno-19-139"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Discovering locations for </span><span class="p">$(</span><span class="nv">$allTargetVMs</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> target VMs...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-19-140"><a id="__codelineno-19-140" name="__codelineno-19-140" href="#__codelineno-19-140"></a><span class="nv">$vmInventory</span> <span class="p">=</span> <span class="nb">Find-VMsAcrossSubscriptions</span> <span class="n">-TargetVMNames</span> <span class="nv">$allTargetVMs</span>
</span><span id="__span-19-141"><a id="__codelineno-19-141" name="__codelineno-19-141" href="#__codelineno-19-141"></a>
</span><span id="__span-19-142"><a id="__codelineno-19-142" name="__codelineno-19-142" href="#__codelineno-19-142"></a><span class="c"># Process each maintenance window</span>
</span><span id="__span-19-143"><a id="__codelineno-19-143" name="__codelineno-19-143" href="#__codelineno-19-143"></a><span class="nv">$totalSuccess</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-19-144"><a id="__codelineno-19-144" name="__codelineno-19-144" href="#__codelineno-19-144"></a><span class="nv">$totalFailed</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-19-145"><a id="__codelineno-19-145" name="__codelineno-19-145" href="#__codelineno-19-145"></a>
</span><span id="__span-19-146"><a id="__codelineno-19-146" name="__codelineno-19-146" href="#__codelineno-19-146"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$windowName</span> <span class="k">in</span> <span class="nv">$maintenanceGroups</span><span class="p">.</span><span class="n">Keys</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-19-147"><a id="__codelineno-19-147" name="__codelineno-19-147" href="#__codelineno-19-147"></a>    <span class="nv">$group</span> <span class="p">=</span> <span class="nv">$maintenanceGroups</span><span class="p">[</span><span class="nv">$windowName</span><span class="p">]</span>
</span><span id="__span-19-148"><a id="__codelineno-19-148" name="__codelineno-19-148" href="#__codelineno-19-148"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">=== $windowName MAINTENANCE WINDOW ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Magenta</span>
</span><span id="__span-19-149"><a id="__codelineno-19-149" name="__codelineno-19-149" href="#__codelineno-19-149"></a>
</span><span id="__span-19-150"><a id="__codelineno-19-150" name="__codelineno-19-150" href="#__codelineno-19-150"></a>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$vmName</span> <span class="k">in</span> <span class="nv">$group</span><span class="p">.</span><span class="n">VMs</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-19-151"><a id="__codelineno-19-151" name="__codelineno-19-151" href="#__codelineno-19-151"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$vmInventory</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="nv">$vmName</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-19-152"><a id="__codelineno-19-152" name="__codelineno-19-152" href="#__codelineno-19-152"></a>            <span class="nv">$vmInfo</span> <span class="p">=</span> <span class="nv">$vmInventory</span><span class="p">[</span><span class="nv">$vmName</span><span class="p">]</span>
</span><span id="__span-19-153"><a id="__codelineno-19-153" name="__codelineno-19-153" href="#__codelineno-19-153"></a>            <span class="nv">$result</span> <span class="p">=</span> <span class="nb">Set-VMMaintenanceTags</span> <span class="n">-VMName</span> <span class="nv">$vmInfo</span><span class="p">.</span><span class="n">Name</span> <span class="n">-ResourceGroupName</span> <span class="nv">$vmInfo</span><span class="p">.</span><span class="n">ResourceGroupName</span> <span class="n">-SubscriptionId</span> <span class="nv">$vmInfo</span><span class="p">.</span><span class="n">SubscriptionId</span> <span class="n">-Tags</span> <span class="nv">$group</span><span class="p">.</span><span class="n">Tags</span> <span class="n">-MaintenanceWindow</span> <span class="nv">$windowName</span>
</span><span id="__span-19-154"><a id="__codelineno-19-154" name="__codelineno-19-154" href="#__codelineno-19-154"></a>            <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$totalSuccess</span><span class="p">++</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nv">$totalFailed</span><span class="p">++</span> <span class="p">}</span>
</span><span id="__span-19-155"><a id="__codelineno-19-155" name="__codelineno-19-155" href="#__codelineno-19-155"></a>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-19-156"><a id="__codelineno-19-156" name="__codelineno-19-156" href="#__codelineno-19-156"></a>            <span class="nb">Write-Host</span> <span class="s2">&quot;  ⚠️ VM not found: $vmName&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-19-157"><a id="__codelineno-19-157" name="__codelineno-19-157" href="#__codelineno-19-157"></a>            <span class="nv">$totalFailed</span><span class="p">++</span>
</span><span id="__span-19-158"><a id="__codelineno-19-158" name="__codelineno-19-158" href="#__codelineno-19-158"></a>        <span class="p">}</span>
</span><span id="__span-19-159"><a id="__codelineno-19-159" name="__codelineno-19-159" href="#__codelineno-19-159"></a>    <span class="p">}</span>
</span><span id="__span-19-160"><a id="__codelineno-19-160" name="__codelineno-19-160" href="#__codelineno-19-160"></a><span class="p">}</span>
</span><span id="__span-19-161"><a id="__codelineno-19-161" name="__codelineno-19-161" href="#__codelineno-19-161"></a>
</span><span id="__span-19-162"><a id="__codelineno-19-162" name="__codelineno-19-162" href="#__codelineno-19-162"></a><span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">=== TAGGING SUMMARY ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-19-163"><a id="__codelineno-19-163" name="__codelineno-19-163" href="#__codelineno-19-163"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Successfully tagged: $totalSuccess VMs&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-19-164"><a id="__codelineno-19-164" name="__codelineno-19-164" href="#__codelineno-19-164"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Failed to tag: $totalFailed VMs&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span></code></pre></div>

</details>

<h4 id="handle-the-stragglers"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#handle-the-stragglers">🧹 Handle the Stragglers</a></h4>
<p>For the 12 VMs not in the original MSP schedule, I used intelligent assignment based on their function:</p>
<details>
<summary>Click to expand: Tagging Script for Remaining Untagged VMs (Sample Script)</summary>

<div class="language-powershell highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c"># Intelligent VM Tagging Script for Remaining Untagged VMs</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="c"># This script analyzes and tags the remaining VMs based on workload patterns and load balancing</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="nv">$scriptStart</span> <span class="p">=</span> <span class="nb">Get-Date</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== Intelligent VM Tagging for Remaining VMs ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Analyzing and tagging 26 untagged VMs with optimal maintenance window distribution...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="c"># Function to safely tag a VM across subscriptions</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="k">function</span> <span class="nb">Set-VMMaintenanceTags</span> <span class="p">{</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>    <span class="k">param</span><span class="p">(</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>        <span class="no">[string]</span><span class="nv">$VMName</span><span class="p">,</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>        <span class="no">[string]</span><span class="nv">$ResourceGroupName</span><span class="p">,</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>        <span class="no">[string]</span><span class="nv">$SubscriptionId</span><span class="p">,</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>        <span class="no">[hashtable]</span><span class="nv">$Tags</span><span class="p">,</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>        <span class="no">[string]</span><span class="nv">$MaintenanceWindow</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>    <span class="p">)</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>        <span class="c"># Set context to the VM&#39;s subscription</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>        <span class="nv">$currentContext</span> <span class="p">=</span> <span class="nb">Get-AzContext</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$currentContext</span><span class="p">.</span><span class="n">Subscription</span><span class="p">.</span><span class="n">Id</span> <span class="o">-ne</span> <span class="nv">$SubscriptionId</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a>            <span class="nv">$null</span> <span class="p">=</span> <span class="nb">Set-AzContext</span> <span class="n">-SubscriptionId</span> <span class="nv">$SubscriptionId</span> <span class="n">-ErrorAction</span> <span class="n">Stop</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>        <span class="p">}</span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;  Processing: $VMName...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>        <span class="c"># Get the VM</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a>        <span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-AzVM</span> <span class="n">-ResourceGroupName</span> <span class="nv">$ResourceGroupName</span> <span class="n">-Name</span> <span class="nv">$VMName</span> <span class="n">-ErrorAction</span> <span class="n">Stop</span>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a>        <span class="c"># Add maintenance tags to existing tags (preserve existing tags)</span>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$vm</span><span class="p">.</span><span class="n">Tags</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a>            <span class="nv">$Tags</span><span class="p">.</span><span class="n">Keys</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>                <span class="nv">$vm</span><span class="p">.</span><span class="n">Tags</span><span class="p">[</span><span class="nv">$_</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$Tags</span><span class="p">[</span><span class="nv">$_</span><span class="p">]</span>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a>            <span class="p">}</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a>            <span class="nv">$vm</span><span class="p">.</span><span class="n">Tags</span> <span class="p">=</span> <span class="nv">$Tags</span>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a>        <span class="p">}</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a>
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a>        <span class="c"># Update the VM tags</span>
</span><span id="__span-20-42"><a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a>        <span class="nv">$null</span> <span class="p">=</span> <span class="nb">Update-AzVM</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-ResourceGroupName</span> <span class="nv">$ResourceGroupName</span> <span class="n">-Tag</span> <span class="nv">$vm</span><span class="p">.</span><span class="n">Tags</span> <span class="n">-ErrorAction</span> <span class="n">Stop</span>
</span><span id="__span-20-43"><a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;  ✓ Successfully tagged $VMName for $MaintenanceWindow maintenance&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-20-44"><a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a>
</span><span id="__span-20-45"><a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a>        <span class="k">return</span> <span class="nv">$true</span>
</span><span id="__span-20-46"><a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a>    <span class="p">}</span>
</span><span id="__span-20-47"><a id="__codelineno-20-47" name="__codelineno-20-47" href="#__codelineno-20-47"></a>    <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-20-48"><a id="__codelineno-20-48" name="__codelineno-20-48" href="#__codelineno-20-48"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;  ✗ Failed to tag $VMName`: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-20-49"><a id="__codelineno-20-49" name="__codelineno-20-49" href="#__codelineno-20-49"></a>        <span class="k">return</span> <span class="nv">$false</span>
</span><span id="__span-20-50"><a id="__codelineno-20-50" name="__codelineno-20-50" href="#__codelineno-20-50"></a>    <span class="p">}</span>
</span><span id="__span-20-51"><a id="__codelineno-20-51" name="__codelineno-20-51" href="#__codelineno-20-51"></a><span class="p">}</span>
</span><span id="__span-20-52"><a id="__codelineno-20-52" name="__codelineno-20-52" href="#__codelineno-20-52"></a>
</span><span id="__span-20-53"><a id="__codelineno-20-53" name="__codelineno-20-53" href="#__codelineno-20-53"></a><span class="c"># Define current maintenance window loads (after existing 59 VMs)</span>
</span><span id="__span-20-54"><a id="__codelineno-20-54" name="__codelineno-20-54" href="#__codelineno-20-54"></a><span class="nv">$currentLoad</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-20-55"><a id="__codelineno-20-55" name="__codelineno-20-55" href="#__codelineno-20-55"></a>    <span class="s2">&quot;Monday&quot;</span> <span class="p">=</span> <span class="n">7</span>
</span><span id="__span-20-56"><a id="__codelineno-20-56" name="__codelineno-20-56" href="#__codelineno-20-56"></a>    <span class="s2">&quot;Tuesday&quot;</span> <span class="p">=</span> <span class="n">7</span> 
</span><span id="__span-20-57"><a id="__codelineno-20-57" name="__codelineno-20-57" href="#__codelineno-20-57"></a>    <span class="s2">&quot;Wednesday&quot;</span> <span class="p">=</span> <span class="n">10</span>
</span><span id="__span-20-58"><a id="__codelineno-20-58" name="__codelineno-20-58" href="#__codelineno-20-58"></a>    <span class="s2">&quot;Thursday&quot;</span> <span class="p">=</span> <span class="n">6</span>
</span><span id="__span-20-59"><a id="__codelineno-20-59" name="__codelineno-20-59" href="#__codelineno-20-59"></a>    <span class="s2">&quot;Friday&quot;</span> <span class="p">=</span> <span class="n">6</span>
</span><span id="__span-20-60"><a id="__codelineno-20-60" name="__codelineno-20-60" href="#__codelineno-20-60"></a>    <span class="s2">&quot;Saturday&quot;</span> <span class="p">=</span> <span class="n">17</span>  <span class="c"># Dev/Test at 09:00</span>
</span><span id="__span-20-61"><a id="__codelineno-20-61" name="__codelineno-20-61" href="#__codelineno-20-61"></a>    <span class="s2">&quot;Sunday&quot;</span> <span class="p">=</span> <span class="n">6</span>
</span><span id="__span-20-62"><a id="__codelineno-20-62" name="__codelineno-20-62" href="#__codelineno-20-62"></a><span class="p">}</span>
</span><span id="__span-20-63"><a id="__codelineno-20-63" name="__codelineno-20-63" href="#__codelineno-20-63"></a>
</span><span id="__span-20-64"><a id="__codelineno-20-64" name="__codelineno-20-64" href="#__codelineno-20-64"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== CURRENT MAINTENANCE WINDOW LOAD ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-20-65"><a id="__codelineno-20-65" name="__codelineno-20-65" href="#__codelineno-20-65"></a><span class="nv">$currentLoad</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">()</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Name</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-20-66"><a id="__codelineno-20-66" name="__codelineno-20-66" href="#__codelineno-20-66"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Key</span><span class="p">)</span><span class="s2">: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span><span class="s2"> VMs&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-20-67"><a id="__codelineno-20-67" name="__codelineno-20-67" href="#__codelineno-20-67"></a><span class="p">}</span>
</span><span id="__span-20-68"><a id="__codelineno-20-68" name="__codelineno-20-68" href="#__codelineno-20-68"></a>
</span><span id="__span-20-69"><a id="__codelineno-20-69" name="__codelineno-20-69" href="#__codelineno-20-69"></a><span class="c"># Initialize counters for new assignments</span>
</span><span id="__span-20-70"><a id="__codelineno-20-70" name="__codelineno-20-70" href="#__codelineno-20-70"></a><span class="nv">$newAssignments</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-20-71"><a id="__codelineno-20-71" name="__codelineno-20-71" href="#__codelineno-20-71"></a>    <span class="s2">&quot;Monday&quot;</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-20-72"><a id="__codelineno-20-72" name="__codelineno-20-72" href="#__codelineno-20-72"></a>    <span class="s2">&quot;Tuesday&quot;</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-20-73"><a id="__codelineno-20-73" name="__codelineno-20-73" href="#__codelineno-20-73"></a>    <span class="s2">&quot;Wednesday&quot;</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-20-74"><a id="__codelineno-20-74" name="__codelineno-20-74" href="#__codelineno-20-74"></a>    <span class="s2">&quot;Thursday&quot;</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-20-75"><a id="__codelineno-20-75" name="__codelineno-20-75" href="#__codelineno-20-75"></a>    <span class="s2">&quot;Friday&quot;</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-20-76"><a id="__codelineno-20-76" name="__codelineno-20-76" href="#__codelineno-20-76"></a>    <span class="s2">&quot;Saturday&quot;</span> <span class="p">=</span> <span class="n">0</span>  <span class="c"># Will use sat-09 for dev/test</span>
</span><span id="__span-20-77"><a id="__codelineno-20-77" name="__codelineno-20-77" href="#__codelineno-20-77"></a>    <span class="s2">&quot;Sunday&quot;</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-20-78"><a id="__codelineno-20-78" name="__codelineno-20-78" href="#__codelineno-20-78"></a><span class="p">}</span>
</span><span id="__span-20-79"><a id="__codelineno-20-79" name="__codelineno-20-79" href="#__codelineno-20-79"></a>
</span><span id="__span-20-80"><a id="__codelineno-20-80" name="__codelineno-20-80" href="#__codelineno-20-80"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-20-81"><a id="__codelineno-20-81" name="__codelineno-20-81" href="#__codelineno-20-81"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== INTELLIGENT VM GROUPING AND ASSIGNMENT ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-20-82"><a id="__codelineno-20-82" name="__codelineno-20-82" href="#__codelineno-20-82"></a>
</span><span id="__span-20-83"><a id="__codelineno-20-83" name="__codelineno-20-83" href="#__codelineno-20-83"></a><span class="c"># Define VM groups with intelligent maintenance window assignments</span>
</span><span id="__span-20-84"><a id="__codelineno-20-84" name="__codelineno-20-84" href="#__codelineno-20-84"></a><span class="nv">$vmGroups</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-20-85"><a id="__codelineno-20-85" name="__codelineno-20-85" href="#__codelineno-20-85"></a>
</span><span id="__span-20-86"><a id="__codelineno-20-86" name="__codelineno-20-86" href="#__codelineno-20-86"></a>    <span class="c"># CRITICAL PRODUCTION SYSTEMS - Spread across different days</span>
</span><span id="__span-20-87"><a id="__codelineno-20-87" name="__codelineno-20-87" href="#__codelineno-20-87"></a>    <span class="s2">&quot;Critical Infrastructure&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-20-88"><a id="__codelineno-20-88" name="__codelineno-20-88" href="#__codelineno-20-88"></a>        <span class="s2">&quot;VMs&quot;</span> <span class="p">=</span> <span class="p">@(</span>
</span><span id="__span-20-89"><a id="__codelineno-20-89" name="__codelineno-20-89" href="#__codelineno-20-89"></a>            <span class="p">@{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;DC-PROD-01&quot;</span><span class="p">;</span> <span class="n">RG</span> <span class="p">=</span> <span class="s2">&quot;rg-infrastructure&quot;</span><span class="p">;</span> <span class="n">Sub</span> <span class="p">=</span> <span class="s2">&quot;Production&quot;</span><span class="p">;</span> <span class="n">Window</span> <span class="p">=</span> <span class="s2">&quot;Sunday&quot;</span><span class="p">;</span> <span class="n">Reason</span> <span class="p">=</span> <span class="s2">&quot;Domain Controller - critical infrastructure&quot;</span> <span class="p">},</span>
</span><span id="__span-20-90"><a id="__codelineno-20-90" name="__codelineno-20-90" href="#__codelineno-20-90"></a>            <span class="p">@{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;DC-PROD-02&quot;</span><span class="p">;</span> <span class="n">RG</span> <span class="p">=</span> <span class="s2">&quot;rg-infrastructure&quot;</span><span class="p">;</span> <span class="n">Sub</span> <span class="p">=</span> <span class="s2">&quot;Production&quot;</span><span class="p">;</span> <span class="n">Window</span> <span class="p">=</span> <span class="s2">&quot;Monday&quot;</span><span class="p">;</span> <span class="n">Reason</span> <span class="p">=</span> <span class="s2">&quot;Domain Controller - spread from other DCs&quot;</span> <span class="p">},</span>
</span><span id="__span-20-91"><a id="__codelineno-20-91" name="__codelineno-20-91" href="#__codelineno-20-91"></a>            <span class="p">@{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;BACKUP-PROD-01&quot;</span><span class="p">;</span> <span class="n">RG</span> <span class="p">=</span> <span class="s2">&quot;rg-backup&quot;</span><span class="p">;</span> <span class="n">Sub</span> <span class="p">=</span> <span class="s2">&quot;Production&quot;</span><span class="p">;</span> <span class="n">Window</span> <span class="p">=</span> <span class="s2">&quot;Tuesday&quot;</span><span class="p">;</span> <span class="n">Reason</span> <span class="p">=</span> <span class="s2">&quot;Backup Server - spread across week&quot;</span> <span class="p">}</span>
</span><span id="__span-20-92"><a id="__codelineno-20-92" name="__codelineno-20-92" href="#__codelineno-20-92"></a>        <span class="p">)</span>
</span><span id="__span-20-93"><a id="__codelineno-20-93" name="__codelineno-20-93" href="#__codelineno-20-93"></a>    <span class="p">}</span>
</span><span id="__span-20-94"><a id="__codelineno-20-94" name="__codelineno-20-94" href="#__codelineno-20-94"></a>
</span><span id="__span-20-95"><a id="__codelineno-20-95" name="__codelineno-20-95" href="#__codelineno-20-95"></a>    <span class="c"># PRODUCTION BUSINESS APPLICATIONS - Spread for business continuity</span>
</span><span id="__span-20-96"><a id="__codelineno-20-96" name="__codelineno-20-96" href="#__codelineno-20-96"></a>    <span class="s2">&quot;Production Applications&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-20-97"><a id="__codelineno-20-97" name="__codelineno-20-97" href="#__codelineno-20-97"></a>        <span class="s2">&quot;VMs&quot;</span> <span class="p">=</span> <span class="p">@(</span>
</span><span id="__span-20-98"><a id="__codelineno-20-98" name="__codelineno-20-98" href="#__codelineno-20-98"></a>            <span class="p">@{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;WEB-PROD-01&quot;</span><span class="p">;</span> <span class="n">RG</span> <span class="p">=</span> <span class="s2">&quot;rg-web-production&quot;</span><span class="p">;</span> <span class="n">Sub</span> <span class="p">=</span> <span class="s2">&quot;Production&quot;</span><span class="p">;</span> <span class="n">Window</span> <span class="p">=</span> <span class="s2">&quot;Monday&quot;</span><span class="p">;</span> <span class="n">Reason</span> <span class="p">=</span> <span class="s2">&quot;Web Server - Monday for week start&quot;</span> <span class="p">},</span>
</span><span id="__span-20-99"><a id="__codelineno-20-99" name="__codelineno-20-99" href="#__codelineno-20-99"></a>            <span class="p">@{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;DB-PROD-01&quot;</span><span class="p">;</span> <span class="n">RG</span> <span class="p">=</span> <span class="s2">&quot;rg-database-production&quot;</span><span class="p">;</span> <span class="n">Sub</span> <span class="p">=</span> <span class="s2">&quot;Production&quot;</span><span class="p">;</span> <span class="n">Window</span> <span class="p">=</span> <span class="s2">&quot;Tuesday&quot;</span><span class="p">;</span> <span class="n">Reason</span> <span class="p">=</span> <span class="s2">&quot;Database Server - Tuesday&quot;</span> <span class="p">},</span>
</span><span id="__span-20-100"><a id="__codelineno-20-100" name="__codelineno-20-100" href="#__codelineno-20-100"></a>            <span class="p">@{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;APP-PROD-01&quot;</span><span class="p">;</span> <span class="n">RG</span> <span class="p">=</span> <span class="s2">&quot;rg-app-production&quot;</span><span class="p">;</span> <span class="n">Sub</span> <span class="p">=</span> <span class="s2">&quot;Production&quot;</span><span class="p">;</span> <span class="n">Window</span> <span class="p">=</span> <span class="s2">&quot;Wednesday&quot;</span><span class="p">;</span> <span class="n">Reason</span> <span class="p">=</span> <span class="s2">&quot;Application Server - mid-week&quot;</span> <span class="p">}</span>
</span><span id="__span-20-101"><a id="__codelineno-20-101" name="__codelineno-20-101" href="#__codelineno-20-101"></a>        <span class="p">)</span>
</span><span id="__span-20-102"><a id="__codelineno-20-102" name="__codelineno-20-102" href="#__codelineno-20-102"></a>    <span class="p">}</span>
</span><span id="__span-20-103"><a id="__codelineno-20-103" name="__codelineno-20-103" href="#__codelineno-20-103"></a>
</span><span id="__span-20-104"><a id="__codelineno-20-104" name="__codelineno-20-104" href="#__codelineno-20-104"></a>    <span class="c"># DEV/TEST SYSTEMS - Saturday morning maintenance (like existing dev/test)</span>
</span><span id="__span-20-105"><a id="__codelineno-20-105" name="__codelineno-20-105" href="#__codelineno-20-105"></a>    <span class="s2">&quot;Development Systems&quot;</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-20-106"><a id="__codelineno-20-106" name="__codelineno-20-106" href="#__codelineno-20-106"></a>        <span class="s2">&quot;VMs&quot;</span> <span class="p">=</span> <span class="p">@(</span>
</span><span id="__span-20-107"><a id="__codelineno-20-107" name="__codelineno-20-107" href="#__codelineno-20-107"></a>            <span class="p">@{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;WEB-DEV-01&quot;</span><span class="p">;</span> <span class="n">RG</span> <span class="p">=</span> <span class="s2">&quot;rg-web-development&quot;</span><span class="p">;</span> <span class="n">Sub</span> <span class="p">=</span> <span class="s2">&quot;Development&quot;</span><span class="p">;</span> <span class="n">Window</span> <span class="p">=</span> <span class="s2">&quot;Saturday&quot;</span><span class="p">;</span> <span class="n">Reason</span> <span class="p">=</span> <span class="s2">&quot;Web Dev - join existing dev/test window&quot;</span> <span class="p">},</span>
</span><span id="__span-20-108"><a id="__codelineno-20-108" name="__codelineno-20-108" href="#__codelineno-20-108"></a>            <span class="p">@{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;DB-DEV-01&quot;</span><span class="p">;</span> <span class="n">RG</span> <span class="p">=</span> <span class="s2">&quot;rg-database-development&quot;</span><span class="p">;</span> <span class="n">Sub</span> <span class="p">=</span> <span class="s2">&quot;Development&quot;</span><span class="p">;</span> <span class="n">Window</span> <span class="p">=</span> <span class="s2">&quot;Saturday&quot;</span><span class="p">;</span> <span class="n">Reason</span> <span class="p">=</span> <span class="s2">&quot;Database Dev - join existing dev/test window&quot;</span> <span class="p">},</span>
</span><span id="__span-20-109"><a id="__codelineno-20-109" name="__codelineno-20-109" href="#__codelineno-20-109"></a>            <span class="p">@{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s2">&quot;TEST-SERVER-01&quot;</span><span class="p">;</span> <span class="n">RG</span> <span class="p">=</span> <span class="s2">&quot;rg-testing&quot;</span><span class="p">;</span> <span class="n">Sub</span> <span class="p">=</span> <span class="s2">&quot;Development&quot;</span><span class="p">;</span> <span class="n">Window</span> <span class="p">=</span> <span class="s2">&quot;Saturday&quot;</span><span class="p">;</span> <span class="n">Reason</span> <span class="p">=</span> <span class="s2">&quot;Test Server - join existing dev/test window&quot;</span> <span class="p">}</span>
</span><span id="__span-20-110"><a id="__codelineno-20-110" name="__codelineno-20-110" href="#__codelineno-20-110"></a>            <span class="c"># ... additional dev/test VMs</span>
</span><span id="__span-20-111"><a id="__codelineno-20-111" name="__codelineno-20-111" href="#__codelineno-20-111"></a>        <span class="p">)</span>
</span><span id="__span-20-112"><a id="__codelineno-20-112" name="__codelineno-20-112" href="#__codelineno-20-112"></a>    <span class="p">}</span>
</span><span id="__span-20-113"><a id="__codelineno-20-113" name="__codelineno-20-113" href="#__codelineno-20-113"></a><span class="p">}</span>
</span><span id="__span-20-114"><a id="__codelineno-20-114" name="__codelineno-20-114" href="#__codelineno-20-114"></a>
</span><span id="__span-20-115"><a id="__codelineno-20-115" name="__codelineno-20-115" href="#__codelineno-20-115"></a><span class="c"># Initialize counters</span>
</span><span id="__span-20-116"><a id="__codelineno-20-116" name="__codelineno-20-116" href="#__codelineno-20-116"></a><span class="nv">$totalProcessed</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-20-117"><a id="__codelineno-20-117" name="__codelineno-20-117" href="#__codelineno-20-117"></a><span class="nv">$totalSuccess</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-20-118"><a id="__codelineno-20-118" name="__codelineno-20-118" href="#__codelineno-20-118"></a><span class="nv">$totalFailed</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-20-119"><a id="__codelineno-20-119" name="__codelineno-20-119" href="#__codelineno-20-119"></a>
</span><span id="__span-20-120"><a id="__codelineno-20-120" name="__codelineno-20-120" href="#__codelineno-20-120"></a><span class="c"># Process each group</span>
</span><span id="__span-20-121"><a id="__codelineno-20-121" name="__codelineno-20-121" href="#__codelineno-20-121"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$groupName</span> <span class="k">in</span> <span class="nv">$vmGroups</span><span class="p">.</span><span class="n">Keys</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-20-122"><a id="__codelineno-20-122" name="__codelineno-20-122" href="#__codelineno-20-122"></a>    <span class="nv">$group</span> <span class="p">=</span> <span class="nv">$vmGroups</span><span class="p">[</span><span class="nv">$groupName</span><span class="p">]</span>
</span><span id="__span-20-123"><a id="__codelineno-20-123" name="__codelineno-20-123" href="#__codelineno-20-123"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">=== $groupName ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Magenta</span>
</span><span id="__span-20-124"><a id="__codelineno-20-124" name="__codelineno-20-124" href="#__codelineno-20-124"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;Processing </span><span class="p">$(</span><span class="nv">$group</span><span class="p">.</span><span class="n">VMs</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span><span class="s2"> VMs in this group&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-20-125"><a id="__codelineno-20-125" name="__codelineno-20-125" href="#__codelineno-20-125"></a>
</span><span id="__span-20-126"><a id="__codelineno-20-126" name="__codelineno-20-126" href="#__codelineno-20-126"></a>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$vmInfo</span> <span class="k">in</span> <span class="nv">$group</span><span class="p">.</span><span class="n">VMs</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-20-127"><a id="__codelineno-20-127" name="__codelineno-20-127" href="#__codelineno-20-127"></a>        <span class="nv">$window</span> <span class="p">=</span> <span class="nv">$vmInfo</span><span class="p">.</span><span class="n">Window</span>
</span><span id="__span-20-128"><a id="__codelineno-20-128" name="__codelineno-20-128" href="#__codelineno-20-128"></a>        <span class="nv">$vmName</span> <span class="p">=</span> <span class="nv">$vmInfo</span><span class="p">.</span><span class="n">Name</span>
</span><span id="__span-20-129"><a id="__codelineno-20-129" name="__codelineno-20-129" href="#__codelineno-20-129"></a>
</span><span id="__span-20-130"><a id="__codelineno-20-130" name="__codelineno-20-130" href="#__codelineno-20-130"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">�️ $vmName → $window maintenance window&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-20-131"><a id="__codelineno-20-131" name="__codelineno-20-131" href="#__codelineno-20-131"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;   Reason: </span><span class="p">$(</span><span class="nv">$vmInfo</span><span class="p">.</span><span class="n">Reason</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-20-132"><a id="__codelineno-20-132" name="__codelineno-20-132" href="#__codelineno-20-132"></a>
</span><span id="__span-20-133"><a id="__codelineno-20-133" name="__codelineno-20-133" href="#__codelineno-20-133"></a>        <span class="c"># Determine subscription ID from name</span>
</span><span id="__span-20-134"><a id="__codelineno-20-134" name="__codelineno-20-134" href="#__codelineno-20-134"></a>        <span class="nv">$subscriptionId</span> <span class="p">=</span> <span class="k">switch</span> <span class="p">(</span><span class="nv">$vmInfo</span><span class="p">.</span><span class="n">Sub</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-20-135"><a id="__codelineno-20-135" name="__codelineno-20-135" href="#__codelineno-20-135"></a>            <span class="s2">&quot;Production&quot;</span> <span class="p">{</span> <span class="p">(</span><span class="nb">Get-AzSubscription</span> <span class="n">-SubscriptionName</span> <span class="s2">&quot;Production&quot;</span><span class="p">).</span><span class="n">Id</span> <span class="p">}</span>
</span><span id="__span-20-136"><a id="__codelineno-20-136" name="__codelineno-20-136" href="#__codelineno-20-136"></a>            <span class="s2">&quot;DevTest&quot;</span> <span class="p">{</span> <span class="p">(</span><span class="nb">Get-AzSubscription</span> <span class="n">-SubscriptionName</span> <span class="s2">&quot;DevTest&quot;</span><span class="p">).</span><span class="n">Id</span> <span class="p">}</span>
</span><span id="__span-20-137"><a id="__codelineno-20-137" name="__codelineno-20-137" href="#__codelineno-20-137"></a>            <span class="s2">&quot;Identity&quot;</span> <span class="p">{</span> <span class="p">(</span><span class="nb">Get-AzSubscription</span> <span class="n">-SubscriptionName</span> <span class="s2">&quot;Identity&quot;</span><span class="p">).</span><span class="n">Id</span> <span class="p">}</span>
</span><span id="__span-20-138"><a id="__codelineno-20-138" name="__codelineno-20-138" href="#__codelineno-20-138"></a>            <span class="s2">&quot;DMZ&quot;</span> <span class="p">{</span> <span class="p">(</span><span class="nb">Get-AzSubscription</span> <span class="n">-SubscriptionName</span> <span class="s2">&quot;DMZ&quot;</span><span class="p">).</span><span class="n">Id</span> <span class="p">}</span>
</span><span id="__span-20-139"><a id="__codelineno-20-139" name="__codelineno-20-139" href="#__codelineno-20-139"></a>        <span class="p">}</span>
</span><span id="__span-20-140"><a id="__codelineno-20-140" name="__codelineno-20-140" href="#__codelineno-20-140"></a>
</span><span id="__span-20-141"><a id="__codelineno-20-141" name="__codelineno-20-141" href="#__codelineno-20-141"></a>        <span class="c"># Create appropriate tags based on maintenance window</span>
</span><span id="__span-20-142"><a id="__codelineno-20-142" name="__codelineno-20-142" href="#__codelineno-20-142"></a>        <span class="nv">$tags</span> <span class="p">=</span> <span class="p">@{</span>
</span><span id="__span-20-143"><a id="__codelineno-20-143" name="__codelineno-20-143" href="#__codelineno-20-143"></a>            <span class="s2">&quot;Owner&quot;</span> <span class="p">=</span> <span class="s2">&quot;Contoso&quot;</span>
</span><span id="__span-20-144"><a id="__codelineno-20-144" name="__codelineno-20-144" href="#__codelineno-20-144"></a>            <span class="s2">&quot;Updates&quot;</span> <span class="p">=</span> <span class="s2">&quot;Azure Update Manager&quot;</span>
</span><span id="__span-20-145"><a id="__codelineno-20-145" name="__codelineno-20-145" href="#__codelineno-20-145"></a>        <span class="p">}</span>
</span><span id="__span-20-146"><a id="__codelineno-20-146" name="__codelineno-20-146" href="#__codelineno-20-146"></a>
</span><span id="__span-20-147"><a id="__codelineno-20-147" name="__codelineno-20-147" href="#__codelineno-20-147"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$window</span> <span class="o">-eq</span> <span class="s2">&quot;Saturday&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-20-148"><a id="__codelineno-20-148" name="__codelineno-20-148" href="#__codelineno-20-148"></a>            <span class="nv">$tags</span><span class="p">[</span><span class="s2">&quot;PatchWindow&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s2">&quot;sat-09&quot;</span>  <span class="c"># Saturday 09:00 for dev/test</span>
</span><span id="__span-20-149"><a id="__codelineno-20-149" name="__codelineno-20-149" href="#__codelineno-20-149"></a>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-20-150"><a id="__codelineno-20-150" name="__codelineno-20-150" href="#__codelineno-20-150"></a>            <span class="nv">$tags</span><span class="p">[</span><span class="s2">&quot;PatchWindow&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$window</span><span class="p">.</span><span class="n">ToLower</span><span class="p">().</span><span class="n">Substring</span><span class="p">(</span><span class="n">0</span><span class="p">,</span><span class="n">3</span><span class="p">)</span>  <span class="c"># mon, tue, wed, etc.</span>
</span><span id="__span-20-151"><a id="__codelineno-20-151" name="__codelineno-20-151" href="#__codelineno-20-151"></a>        <span class="p">}</span>
</span><span id="__span-20-152"><a id="__codelineno-20-152" name="__codelineno-20-152" href="#__codelineno-20-152"></a>
</span><span id="__span-20-153"><a id="__codelineno-20-153" name="__codelineno-20-153" href="#__codelineno-20-153"></a>        <span class="nv">$result</span> <span class="p">=</span> <span class="nb">Set-VMMaintenanceTags</span> <span class="n">-VMName</span> <span class="nv">$vmInfo</span><span class="p">.</span><span class="n">Name</span> <span class="n">-ResourceGroupName</span> <span class="nv">$vmInfo</span><span class="p">.</span><span class="n">RG</span> <span class="n">-SubscriptionId</span> <span class="nv">$subscriptionId</span> <span class="n">-Tags</span> <span class="nv">$tags</span> <span class="n">-MaintenanceWindow</span> <span class="nv">$window</span>
</span><span id="__span-20-154"><a id="__codelineno-20-154" name="__codelineno-20-154" href="#__codelineno-20-154"></a>
</span><span id="__span-20-155"><a id="__codelineno-20-155" name="__codelineno-20-155" href="#__codelineno-20-155"></a>        <span class="nv">$totalProcessed</span><span class="p">++</span>
</span><span id="__span-20-156"><a id="__codelineno-20-156" name="__codelineno-20-156" href="#__codelineno-20-156"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="p">{</span> 
</span><span id="__span-20-157"><a id="__codelineno-20-157" name="__codelineno-20-157" href="#__codelineno-20-157"></a>            <span class="nv">$totalSuccess</span><span class="p">++</span>
</span><span id="__span-20-158"><a id="__codelineno-20-158" name="__codelineno-20-158" href="#__codelineno-20-158"></a>            <span class="nv">$newAssignments</span><span class="p">[</span><span class="nv">$window</span><span class="p">]++</span>
</span><span id="__span-20-159"><a id="__codelineno-20-159" name="__codelineno-20-159" href="#__codelineno-20-159"></a>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> 
</span><span id="__span-20-160"><a id="__codelineno-20-160" name="__codelineno-20-160" href="#__codelineno-20-160"></a>            <span class="nv">$totalFailed</span><span class="p">++</span> 
</span><span id="__span-20-161"><a id="__codelineno-20-161" name="__codelineno-20-161" href="#__codelineno-20-161"></a>        <span class="p">}</span>
</span><span id="__span-20-162"><a id="__codelineno-20-162" name="__codelineno-20-162" href="#__codelineno-20-162"></a>    <span class="p">}</span>
</span><span id="__span-20-163"><a id="__codelineno-20-163" name="__codelineno-20-163" href="#__codelineno-20-163"></a><span class="p">}</span>
</span><span id="__span-20-164"><a id="__codelineno-20-164" name="__codelineno-20-164" href="#__codelineno-20-164"></a>
</span><span id="__span-20-165"><a id="__codelineno-20-165" name="__codelineno-20-165" href="#__codelineno-20-165"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-20-166"><a id="__codelineno-20-166" name="__codelineno-20-166" href="#__codelineno-20-166"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== TAGGING SUMMARY ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-20-167"><a id="__codelineno-20-167" name="__codelineno-20-167" href="#__codelineno-20-167"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Total VMs processed: $totalProcessed&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-20-168"><a id="__codelineno-20-168" name="__codelineno-20-168" href="#__codelineno-20-168"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Successfully tagged: $totalSuccess&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-20-169"><a id="__codelineno-20-169" name="__codelineno-20-169" href="#__codelineno-20-169"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Failed to tag: $totalFailed&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Red</span>
</span><span id="__span-20-170"><a id="__codelineno-20-170" name="__codelineno-20-170" href="#__codelineno-20-170"></a>
</span><span id="__span-20-171"><a id="__codelineno-20-171" name="__codelineno-20-171" href="#__codelineno-20-171"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-20-172"><a id="__codelineno-20-172" name="__codelineno-20-172" href="#__codelineno-20-172"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== NEW MAINTENANCE WINDOW DISTRIBUTION ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-20-173"><a id="__codelineno-20-173" name="__codelineno-20-173" href="#__codelineno-20-173"></a><span class="nb">Write-Host</span> <span class="s2">&quot;VMs added to each maintenance window:&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-20-174"><a id="__codelineno-20-174" name="__codelineno-20-174" href="#__codelineno-20-174"></a>
</span><span id="__span-20-175"><a id="__codelineno-20-175" name="__codelineno-20-175" href="#__codelineno-20-175"></a><span class="nv">$newAssignments</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">()</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Name</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-20-176"><a id="__codelineno-20-176" name="__codelineno-20-176" href="#__codelineno-20-176"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Value</span> <span class="o">-gt</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-20-177"><a id="__codelineno-20-177" name="__codelineno-20-177" href="#__codelineno-20-177"></a>        <span class="nv">$newTotal</span> <span class="p">=</span> <span class="nv">$currentLoad</span><span class="p">[</span><span class="nv">$_</span><span class="p">.</span><span class="n">Key</span><span class="p">]</span> <span class="p">+</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Value</span>
</span><span id="__span-20-178"><a id="__codelineno-20-178" name="__codelineno-20-178" href="#__codelineno-20-178"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Key</span><span class="p">)</span><span class="s2">: +</span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span><span class="s2"> VMs (total: $newTotal VMs)&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-20-179"><a id="__codelineno-20-179" name="__codelineno-20-179" href="#__codelineno-20-179"></a>    <span class="p">}</span>
</span><span id="__span-20-180"><a id="__codelineno-20-180" name="__codelineno-20-180" href="#__codelineno-20-180"></a><span class="p">}</span>
</span><span id="__span-20-181"><a id="__codelineno-20-181" name="__codelineno-20-181" href="#__codelineno-20-181"></a>
</span><span id="__span-20-182"><a id="__codelineno-20-182" name="__codelineno-20-182" href="#__codelineno-20-182"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-20-183"><a id="__codelineno-20-183" name="__codelineno-20-183" href="#__codelineno-20-183"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== FINAL MAINTENANCE WINDOW LOAD ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-20-184"><a id="__codelineno-20-184" name="__codelineno-20-184" href="#__codelineno-20-184"></a><span class="nv">$finalLoad</span> <span class="p">=</span> <span class="p">@{}</span>
</span><span id="__span-20-185"><a id="__codelineno-20-185" name="__codelineno-20-185" href="#__codelineno-20-185"></a><span class="nv">$currentLoad</span><span class="p">.</span><span class="n">Keys</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-20-186"><a id="__codelineno-20-186" name="__codelineno-20-186" href="#__codelineno-20-186"></a>    <span class="nv">$finalLoad</span><span class="p">[</span><span class="nv">$_</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$currentLoad</span><span class="p">[</span><span class="nv">$_</span><span class="p">]</span> <span class="p">+</span> <span class="nv">$newAssignments</span><span class="p">[</span><span class="nv">$_</span><span class="p">]</span>
</span><span id="__span-20-187"><a id="__codelineno-20-187" name="__codelineno-20-187" href="#__codelineno-20-187"></a><span class="p">}</span>
</span><span id="__span-20-188"><a id="__codelineno-20-188" name="__codelineno-20-188" href="#__codelineno-20-188"></a>
</span><span id="__span-20-189"><a id="__codelineno-20-189" name="__codelineno-20-189" href="#__codelineno-20-189"></a><span class="nv">$finalLoad</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">()</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Name</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-20-190"><a id="__codelineno-20-190" name="__codelineno-20-190" href="#__codelineno-20-190"></a>    <span class="nv">$status</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Value</span> <span class="o">-le</span> <span class="n">8</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;Green&quot;</span> <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Value</span> <span class="o">-le</span> <span class="n">12</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;Yellow&quot;</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="s2">&quot;Red&quot;</span> <span class="p">}</span>
</span><span id="__span-20-191"><a id="__codelineno-20-191" name="__codelineno-20-191" href="#__codelineno-20-191"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Key</span><span class="p">)</span><span class="s2">: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span><span class="s2"> VMs&quot;</span> <span class="n">-ForegroundColor</span> <span class="nv">$status</span>
</span><span id="__span-20-192"><a id="__codelineno-20-192" name="__codelineno-20-192" href="#__codelineno-20-192"></a><span class="p">}</span>
</span><span id="__span-20-193"><a id="__codelineno-20-193" name="__codelineno-20-193" href="#__codelineno-20-193"></a>
</span><span id="__span-20-194"><a id="__codelineno-20-194" name="__codelineno-20-194" href="#__codelineno-20-194"></a><span class="nv">$grandTotal</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$finalLoad</span><span class="p">.</span><span class="n">Values</span> <span class="p">|</span> <span class="nb">Measure-Object</span> <span class="n">-Sum</span><span class="p">).</span><span class="n">Sum</span>
</span><span id="__span-20-195"><a id="__codelineno-20-195" name="__codelineno-20-195" href="#__codelineno-20-195"></a><span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">Grand Total: $grandTotal VMs across all maintenance windows&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-20-196"><a id="__codelineno-20-196" name="__codelineno-20-196" href="#__codelineno-20-196"></a>
</span><span id="__span-20-197"><a id="__codelineno-20-197" name="__codelineno-20-197" href="#__codelineno-20-197"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-20-198"><a id="__codelineno-20-198" name="__codelineno-20-198" href="#__codelineno-20-198"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== BUSINESS LOGIC APPLIED ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-20-199"><a id="__codelineno-20-199" name="__codelineno-20-199" href="#__codelineno-20-199"></a><span class="nb">Write-Host</span> <span class="s2">&quot;✅ Critical systems spread across different days for resilience&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-20-200"><a id="__codelineno-20-200" name="__codelineno-20-200" href="#__codelineno-20-200"></a><span class="nb">Write-Host</span> <span class="s2">&quot;✅ Domain Controllers distributed to avoid single points of failure&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-20-201"><a id="__codelineno-20-201" name="__codelineno-20-201" href="#__codelineno-20-201"></a><span class="nb">Write-Host</span> <span class="s2">&quot;✅ Dev/Test systems consolidated to Saturday morning (existing pattern)&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-20-202"><a id="__codelineno-20-202" name="__codelineno-20-202" href="#__codelineno-20-202"></a><span class="nb">Write-Host</span> <span class="s2">&quot;✅ Production workstations spread to minimize user impact&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-20-203"><a id="__codelineno-20-203" name="__codelineno-20-203" href="#__codelineno-20-203"></a><span class="nb">Write-Host</span> <span class="s2">&quot;✅ Business applications distributed for operational continuity&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-20-204"><a id="__codelineno-20-204" name="__codelineno-20-204" href="#__codelineno-20-204"></a><span class="nb">Write-Host</span> <span class="s2">&quot;✅ Load balancing maintained across the week&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-20-205"><a id="__codelineno-20-205" name="__codelineno-20-205" href="#__codelineno-20-205"></a>
</span><span id="__span-20-206"><a id="__codelineno-20-206" name="__codelineno-20-206" href="#__codelineno-20-206"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-20-207"><a id="__codelineno-20-207" name="__codelineno-20-207" href="#__codelineno-20-207"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== VERIFICATION STEPS ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-20-208"><a id="__codelineno-20-208" name="__codelineno-20-208" href="#__codelineno-20-208"></a><span class="nb">Write-Host</span> <span class="s2">&quot;1. Verify tags in Azure Portal across all subscriptions&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-20-209"><a id="__codelineno-20-209" name="__codelineno-20-209" href="#__codelineno-20-209"></a><span class="nb">Write-Host</span> <span class="s2">&quot;2. Check that critical systems are on different days&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-20-210"><a id="__codelineno-20-210" name="__codelineno-20-210" href="#__codelineno-20-210"></a><span class="nb">Write-Host</span> <span class="s2">&quot;3. Confirm dev/test systems are in Saturday morning window&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-20-211"><a id="__codelineno-20-211" name="__codelineno-20-211" href="#__codelineno-20-211"></a><span class="nb">Write-Host</span> <span class="s2">&quot;4. Review production systems distribution&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-20-212"><a id="__codelineno-20-212" name="__codelineno-20-212" href="#__codelineno-20-212"></a>
</span><span id="__span-20-213"><a id="__codelineno-20-213" name="__codelineno-20-213" href="#__codelineno-20-213"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-20-214"><a id="__codelineno-20-214" name="__codelineno-20-214" href="#__codelineno-20-214"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== AZURE RESOURCE GRAPH VERIFICATION QUERY ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-20-215"><a id="__codelineno-20-215" name="__codelineno-20-215" href="#__codelineno-20-215"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Use this query to verify all VMs are now tagged:&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-20-216"><a id="__codelineno-20-216" name="__codelineno-20-216" href="#__codelineno-20-216"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-20-217"><a id="__codelineno-20-217" name="__codelineno-20-217" href="#__codelineno-20-217"></a><span class="nb">Write-Host</span> <span class="sh">@&quot;</span>
</span><span id="__span-20-218"><a id="__codelineno-20-218" name="__codelineno-20-218" href="#__codelineno-20-218"></a><span class="sh">Resources</span>
</span><span id="__span-20-219"><a id="__codelineno-20-219" name="__codelineno-20-219" href="#__codelineno-20-219"></a><span class="sh">| where type == &quot;microsoft.compute/virtualmachines&quot;</span>
</span><span id="__span-20-220"><a id="__codelineno-20-220" name="__codelineno-20-220" href="#__codelineno-20-220"></a><span class="sh">| where tags.Updates == &quot;Azure Update Manager&quot;</span>
</span><span id="__span-20-221"><a id="__codelineno-20-221" name="__codelineno-20-221" href="#__codelineno-20-221"></a><span class="sh">| project name, resourceGroup, subscriptionId, </span>
</span><span id="__span-20-222"><a id="__codelineno-20-222" name="__codelineno-20-222" href="#__codelineno-20-222"></a><span class="sh">          patchWindow = tags.PatchWindow,</span>
</span><span id="__span-20-223"><a id="__codelineno-20-223" name="__codelineno-20-223" href="#__codelineno-20-223"></a><span class="sh">          owner = tags.Owner,</span>
</span><span id="__span-20-224"><a id="__codelineno-20-224" name="__codelineno-20-224" href="#__codelineno-20-224"></a><span class="sh">          updates = tags.Updates</span>
</span><span id="__span-20-225"><a id="__codelineno-20-225" name="__codelineno-20-225" href="#__codelineno-20-225"></a><span class="sh">| sort by patchWindow, name</span>
</span><span id="__span-20-226"><a id="__codelineno-20-226" name="__codelineno-20-226" href="#__codelineno-20-226"></a><span class="sh">| summarize count() by patchWindow</span>
</span><span id="__span-20-227"><a id="__codelineno-20-227" name="__codelineno-20-227" href="#__codelineno-20-227"></a><span class="sh">&quot;@</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span><span id="__span-20-228"><a id="__codelineno-20-228" name="__codelineno-20-228" href="#__codelineno-20-228"></a>
</span><span id="__span-20-229"><a id="__codelineno-20-229" name="__codelineno-20-229" href="#__codelineno-20-229"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$totalFailed</span> <span class="o">-eq</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-20-230"><a id="__codelineno-20-230" name="__codelineno-20-230" href="#__codelineno-20-230"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-20-231"><a id="__codelineno-20-231" name="__codelineno-20-231" href="#__codelineno-20-231"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;� ALL VMs SUCCESSFULLY TAGGED WITH INTELLIGENT DISTRIBUTION! �&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-20-232"><a id="__codelineno-20-232" name="__codelineno-20-232" href="#__codelineno-20-232"></a><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-20-233"><a id="__codelineno-20-233" name="__codelineno-20-233" href="#__codelineno-20-233"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-20-234"><a id="__codelineno-20-234" name="__codelineno-20-234" href="#__codelineno-20-234"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;⚠️ Some VMs failed to tag. Please review errors above.&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Yellow</span>
</span><span id="__span-20-235"><a id="__codelineno-20-235" name="__codelineno-20-235" href="#__codelineno-20-235"></a><span class="p">}</span>
</span><span id="__span-20-236"><a id="__codelineno-20-236" name="__codelineno-20-236" href="#__codelineno-20-236"></a>
</span><span id="__span-20-237"><a id="__codelineno-20-237" name="__codelineno-20-237" href="#__codelineno-20-237"></a><span class="nb">Write-Host</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-20-238"><a id="__codelineno-20-238" name="__codelineno-20-238" href="#__codelineno-20-238"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Script completed at </span><span class="p">$(</span><span class="nb">Get-Date</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-20-239"><a id="__codelineno-20-239" name="__codelineno-20-239" href="#__codelineno-20-239"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Total runtime: </span><span class="p">$((</span><span class="nb">Get-Date</span><span class="p">)</span> <span class="p">-</span> <span class="nv">$scriptStart</span><span class="p">)</span><span class="s2">&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Gray</span>
</span></code></pre></div>

</details>

<blockquote>
<p><strong>Key insight:</strong> I grouped VMs by function and criticality, not just by convenience. Domain controllers got spread across different days, dev/test systems joined the existing Saturday morning window, and production applications were distributed for business continuity.</p>
</blockquote>
<hr />
<h3 id="step-7-configure-azure-policy-prerequisites"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#step-7-configure-azure-policy-prerequisites">🧰 Step 7 – Configure Azure Policy Prerequisites</a></h3>
<p>Here's where things get interesting. Update Manager is built on compliance — but your VMs won't show up in dynamic scopes unless they meet certain prerequisites. Enter Azure Policy to save the day.</p>
<p>You'll need two specific built-in policies assigned at the subscription (or management group) level:</p>
<h4 id="policy-1-set-prerequisites-for-scheduling-recurring-updates-on-azure-virtual-machines"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#policy-1-set-prerequisites-for-scheduling-recurring-updates-on-azure-virtual-machines">✅ Policy 1: <code>Set prerequisites for scheduling recurring updates on Azure virtual machines</code></a></h4>
<p><strong>What it does:</strong> This policy ensures your VMs have the necessary configurations to participate in Azure Update Manager. It automatically:</p>
<ul>
<li>Installs the Azure Update Manager extension on Windows VMs</li>
<li>Registers required resource providers</li>
<li>Configures the VM to report its update compliance status</li>
<li>Sets the patch orchestration mode appropriately</li>
</ul>
<blockquote>
<p><strong>Why this matters:</strong> Without this policy, VMs won't appear in Update Manager scopes even if they're tagged correctly. The policy handles all the "plumbing" automatically.</p>
</blockquote>
<p><strong>Assignment scope:</strong> Apply this at subscription or management group level to catch all VMs.</p>
<h4 id="policy-2-configure-periodic-checking-for-missing-system-updates-on-azure-virtual-machines"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#policy-2-configure-periodic-checking-for-missing-system-updates-on-azure-virtual-machines">✅ Policy 2: <code>Configure periodic checking for missing system updates on Azure virtual machines</code></a></h4>
<p><strong>What it does:</strong> This is your compliance engine. It configures VMs to:</p>
<ul>
<li>Regularly scan for available updates (but not install them automatically)</li>
<li>Report update status back to Azure Update Manager</li>
<li>Enable the compliance dashboard views in the portal</li>
<li>Provide the data needed for maintenance configuration targeting</li>
</ul>
<blockquote>
<p><strong>Why this matters:</strong> This policy turns on the "update awareness" for your VMs. Without it, Azure Update Manager has no visibility into what patches are needed.</p>
</blockquote>
<p><strong>Assignment scope:</strong> Same as above — subscription or management group level.</p>
<h4 id="assigning-the-policies"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#assigning-the-policies">🎯 Assigning the Policies</a></h4>
<p><strong>Step-by-step in Azure Portal:</strong></p>
<ol>
<li><strong>Navigate to Azure Policy</strong></li>
<li>
<p>Azure Portal → Search "Policy" → Select "Policy"</p>
</li>
<li>
<p><strong>Find the First Policy</strong></p>
</li>
<li>Left menu: <strong>Definitions</strong></li>
<li>Search: <code>Set prerequisites for scheduling recurring updates</code></li>
<li>
<p>Click on the policy title</p>
</li>
<li>
<p><strong>Assign the Policy</strong></p>
</li>
<li>Click <strong>Assign</strong> button</li>
<li><strong>Scope:</strong> Select your subscription(s)</li>
<li><strong>Basics:</strong> Leave policy name as default</li>
<li><strong>Parameters:</strong> Leave as default</li>
<li><strong>Remediation:</strong> ✅ Check "Create remediation task"</li>
<li>
<p><strong>Review + create</strong></p>
</li>
<li>
<p><strong>Repeat for Second Policy</strong></p>
</li>
<li>Search: <code>Configure periodic checking for missing system updates</code></li>
<li>Follow same assignment process</li>
</ol>
<blockquote>
<p>⚠️ <strong>Important:</strong> Policy compliance can take 30+ minutes to evaluate and apply. Perfect time for that brew I mentioned earlier.</p>
</blockquote>
<h4 id="monitoring-compliance"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#monitoring-compliance">🔍 Monitoring Compliance</a></h4>
<p>Once assigned, you can track compliance in <strong>Azure Policy &gt; Compliance</strong>. Look for:</p>
<ul>
<li>Non-compliant VMs that need the extension installed</li>
<li>VMs that aren't reporting update status properly</li>
<li>Any policy assignment errors that need investigation</li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/azure/update-manager/prerequsite-for-schedule-patching">Learn more about Azure Policy for Update Management</a></p>
<hr />
<h3 id="step-8-create-dynamic-scopes-in-update-manager"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#step-8-create-dynamic-scopes-in-update-manager">🧪 Step 8 – Create Dynamic Scopes in Update Manager</a></h3>
<p>This is where it all comes together — and where the magic happens.</p>
<p>Dynamic scopes use those <code>PatchWindow</code> tags to assign VMs to the correct patch config automatically. No more manual VM assignment, no more "did we remember to add the new server?" conversations.</p>
<h4 id="the-portal-dance"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#the-portal-dance">🎯 The Portal Dance</a></h4>
<p>Unfortunately, as of writing, dynamic scopes can only be configured through the Azure portal — no PowerShell or ARM template support yet.</p>
<blockquote>
<p><strong>Why portal only?</strong> Dynamic scopes are still in preview, and Microsoft hasn't released the PowerShell cmdlets or ARM template schemas yet. This means you can't fully automate the deployment, but the functionality itself works perfectly.</p>
</blockquote>
<p>Here's the step-by-step:</p>
<ol>
<li><strong>Navigate to Azure Update Manager</strong></li>
<li>
<p>Portal → All Services → Azure Update Manager</p>
</li>
<li>
<p><strong>Access Maintenance Configurations</strong></p>
</li>
<li>Go to <strong>Maintenance Configurations (Preview)</strong></li>
<li>
<p>Select one of your configs (e.g., <code>contoso-maintenance-config-vms-mon</code>)</p>
</li>
<li>
<p><strong>Create Dynamic Scope</strong></p>
</li>
<li>Click <strong>Dynamic Scopes</strong> → <strong>Add</strong></li>
<li><strong>Name:</strong> <code>DynamicScope-Monday-VMs</code></li>
<li>
<p><strong>Description:</strong> <code>Auto-assign Windows VMs tagged for Monday maintenance</code></p>
</li>
<li>
<p><strong>Configure Scope Settings</strong></p>
</li>
<li><strong>Subscription:</strong> Select your subscription(s)</li>
<li><strong>Resource Type:</strong> <code>Microsoft.Compute/virtualMachines</code></li>
<li>
<p><strong>OS Type:</strong> <code>Windows</code> (create separate scopes for Linux if needed)</p>
</li>
<li>
<p><strong>Set Tag Filters</strong></p>
</li>
<li><strong>Tag Name:</strong> <code>PatchWindow</code></li>
<li><strong>Tag Value:</strong> <code>mon</code> (must match your maintenance config naming)</li>
<li>
<p><strong>Additional filters</strong> (optional):</p>
<ul>
<li><code>Owner</code> = <code>Contoso</code></li>
<li><code>Updates</code> = <code>Azure Update Manager</code></li>
</ul>
</li>
<li>
<p><strong>Review and Create</strong></p>
</li>
<li>Verify the filter logic</li>
<li>Click <strong>Create</strong></li>
</ol>
<h4 id="repeat-for-all-days"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#repeat-for-all-days">🔄 Repeat for All Days</a></h4>
<p>You'll need to create dynamic scopes for each maintenance configuration:</p>
<table>
<thead>
<tr>
<th>Maintenance Config</th>
<th>Dynamic Scope Name</th>
<th>Tag Filter</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>contoso-maintenance-config-vms-mon</code></td>
<td><code>DynamicScope-Monday-VMs</code></td>
<td><code>PatchWindow = mon</code></td>
</tr>
<tr>
<td><code>contoso-maintenance-config-vms-tue</code></td>
<td><code>DynamicScope-Tuesday-VMs</code></td>
<td><code>PatchWindow = tue</code></td>
</tr>
<tr>
<td><code>contoso-maintenance-config-vms-wed</code></td>
<td><code>DynamicScope-Wednesday-VMs</code></td>
<td><code>PatchWindow = wed</code></td>
</tr>
<tr>
<td><code>contoso-maintenance-config-vms-thu</code></td>
<td><code>DynamicScope-Thursday-VMs</code></td>
<td><code>PatchWindow = thu</code></td>
</tr>
<tr>
<td><code>contoso-maintenance-config-vms-fri</code></td>
<td><code>DynamicScope-Friday-VMs</code></td>
<td><code>PatchWindow = fri</code></td>
</tr>
<tr>
<td><code>contoso-maintenance-config-vms-sat</code></td>
<td><code>DynamicScope-Saturday-VMs</code></td>
<td><code>PatchWindow = sat-09</code></td>
</tr>
<tr>
<td><code>contoso-maintenance-config-vms-sun</code></td>
<td><code>DynamicScope-Sunday-VMs</code></td>
<td><code>PatchWindow = sun</code></td>
</tr>
</tbody>
</table>
<h4 id="verify-dynamic-scope-assignment"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#verify-dynamic-scope-assignment">🔍 Verify Dynamic Scope Assignment</a></h4>
<p>Once created, you can verify the scopes are working:</p>
<ol>
<li><strong>In the Maintenance Configuration:</strong></li>
<li>Go to <strong>Dynamic Scopes</strong></li>
<li>Check <strong>Resources</strong> tab to see matched VMs</li>
<li>Verify expected VM count matches your tagging</li>
<li>
<p><strong>Wait time:</strong> Allow 15-30 minutes for newly tagged VMs to appear</p>
</li>
<li>
<p><strong>What success looks like:</strong></p>
</li>
<li>Monday scope shows 5 VMs (WEB-PROD-01, DB-PROD-01, etc.)</li>
<li>Saturday scope shows 5 VMs (WEB-DEV-01, DB-DEV-01, etc.)</li>
<li>
<p>No VMs showing? Check tag case sensitivity and filters</p>
</li>
<li>
<p><strong>In Azure Resource Graph:</strong></p>
</li>
</ol>
<div class="language-kusto highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">MaintenanceResources</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.maintenance/configurationassignments&quot;</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">vmName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tostring</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">resourceId</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">)[</span><span class="mi">8</span><span class="p">])</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">configName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tostring</span><span class="p">(</span><span class="n">properties</span><span class="err">.</span><span class="n">maintenanceConfigurationId</span><span class="p">)</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">vmName</span><span class="p">,</span><span class="w"> </span><span class="n">configName</span><span class="p">,</span><span class="w"> </span><span class="n">resourceGroup</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">configName</span><span class="p">,</span><span class="w"> </span><span class="n">vmName</span>
</span></code></pre></div>
<ol>
<li><strong>Troubleshoot empty scopes:</strong></li>
<li>Verify subscription selection includes all your VMs</li>
<li>Check tag spelling: <code>PatchWindow</code> (case sensitive)</li>
<li>Confirm resource type filter: <code>Microsoft.Compute/virtualMachines</code></li>
<li>Wait longer - it can take up to 30 minutes</li>
</ol>
<h4 id="common-gotchas"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#common-gotchas">⚠️ Common Gotchas</a></h4>
<p><strong>Tag Case Sensitivity:</strong> Dynamic scopes are case-sensitive. <code>mon</code> ≠ <code>Mon</code> ≠ <code>MON</code></p>
<p><strong>Subscription Scope:</strong> Ensure you've selected all relevant subscriptions in the scope configuration.</p>
<p><strong>Resource Type Filter:</strong> Don't forget to set the resource type filter — without it, you'll match storage accounts, networking, etc.</p>
<p><strong>Timing:</strong> It can take 15-30 minutes for newly tagged VMs to appear in dynamic scopes.</p>
<p><a href="https://learn.microsoft.com/en-us/azure/update-manager/dynamic-scope">Dynamic scope configuration docs</a></p>
<hr />
<h3 id="step-9-test-verify-the-moment-of-truth"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#step-9-test-verify-the-moment-of-truth">🚀 Step 9 – Test &amp; Verify (The Moment of Truth)</a></h3>
<p>The acid test: does it actually patch stuff properly?</p>
<h4 id="proof-of-concept-test"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#proof-of-concept-test">🎪 Proof of Concept Test</a></h4>
<p>I started conservatively — scoped <code>contoso-maintenance-config-vms-sun</code> to a few non-critical VMs and let it run overnight on Sunday.</p>
<p><strong>Monday morning verification:</strong></p>
<ul>
<li>✔️ <strong>Patch compliance dashboard:</strong> All green ticks</li>
<li>✔️ <strong>Reboot timing:</strong> Machines restarted within their 4-hour window (21:00-01:00)</li>
<li>✔️ <strong>Update logs:</strong> Activity logs showed expected patching behavior</li>
<li>✔️ <strong>Business impact:</strong> Zero helpdesk tickets on Monday morning</li>
</ul>
<h4 id="full-rollout-verification"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#full-rollout-verification">📊 Full Rollout Verification</a></h4>
<p>Once confident with the Sunday test, I enabled all remaining dynamic scopes and monitored the week:</p>
<p><strong>Key metrics tracked:</strong></p>
<ul>
<li>Patch compliance percentage across all VMs</li>
<li>Failed patch installations (and root causes)</li>
<li>Reboot timing adherence</li>
<li>Business hours impact (spoiler: zero)</li>
</ul>
<h4 id="monitoring-validation-tools"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#monitoring-validation-tools">🔍 Monitoring &amp; Validation Tools</a></h4>
<p><strong>Azure Update Manager Dashboard:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>Azure Portal → Update Manager → Overview
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>- Patch compliance summary
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>- Recent patch installations
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>- Failed installations with details
</span></code></pre></div>
<p><strong>Azure Resource Graph Queries:</strong></p>
<div class="language-kusto highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c">// Verify all VMs have maintenance tags</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">Resources</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.compute/virtualmachines&quot;</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">tags</span><span class="err">.</span><span class="n">Updates</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;Azure Update Manager&quot;</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">resourceGroup</span><span class="p">,</span><span class="w"> </span><span class="n">subscriptionId</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">          </span><span class="n">patchWindow</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="err">.</span><span class="n">PatchWindow</span><span class="p">,</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">          </span><span class="n">owner</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tags</span><span class="err">.</span><span class="n">Owner</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">patchWindow</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">patchWindow</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="c">// Check maintenance configuration assignments</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="n">MaintenanceResources</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;microsoft.maintenance/configurationassignments&quot;</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">vmName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tostring</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">resourceId</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">)[</span><span class="mi">8</span><span class="p">])</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="p">|</span><span class="w"> </span><span class="k">extend</span><span class="w"> </span><span class="n">configName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tostring</span><span class="p">(</span><span class="n">properties</span><span class="err">.</span><span class="n">maintenanceConfigurationId</span><span class="p">)</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">vmName</span><span class="p">,</span><span class="w"> </span><span class="n">configName</span><span class="p">,</span><span class="w"> </span><span class="n">subscriptionId</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="p">|</span><span class="w"> </span><span class="k">summarize</span><span class="w"> </span><span class="n">VMCount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">count</span><span class="p">()</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">configName</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">configName</span>
</span></code></pre></div>
<p><strong>PowerShell Verification:</strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c"># Quick check of maintenance configuration status</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="nb">Get-AzMaintenanceConfiguration</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;rg-maintenance-uksouth-001&quot;</span> <span class="p">|</span> 
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>    <span class="nb">Select-Object</span> <span class="n">Name</span><span class="p">,</span> <span class="n">MaintenanceScope</span><span class="p">,</span> <span class="n">RecurEvery</span> <span class="p">|</span> 
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    <span class="nb">Format-Table</span> <span class="n">-AutoSize</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="c"># Verify VM tag distribution</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="nv">$subscriptions</span> <span class="p">=</span> <span class="nb">Get-AzSubscription</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">State</span> <span class="o">-eq</span> <span class="s2">&quot;Enabled&quot;</span> <span class="p">}</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="nv">$tagSummary</span> <span class="p">=</span> <span class="p">@{}</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$sub</span> <span class="k">in</span> <span class="nv">$subscriptions</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>    <span class="nb">Set-AzContext</span> <span class="n">-SubscriptionId</span> <span class="nv">$sub</span><span class="p">.</span><span class="n">Id</span> <span class="p">|</span> <span class="nb">Out-Null</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>    <span class="nv">$vms</span> <span class="p">=</span> <span class="nb">Get-AzVM</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Tags</span><span class="p">.</span><span class="n">PatchWindow</span> <span class="p">}</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$vm</span> <span class="k">in</span> <span class="nv">$vms</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>        <span class="nv">$window</span> <span class="p">=</span> <span class="nv">$vm</span><span class="p">.</span><span class="n">Tags</span><span class="p">.</span><span class="n">PatchWindow</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>        <span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="nv">$tagSummary</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="nv">$window</span><span class="p">))</span> <span class="p">{</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>            <span class="nv">$tagSummary</span><span class="p">[</span><span class="nv">$window</span><span class="p">]</span> <span class="p">=</span> <span class="n">0</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>        <span class="p">}</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>        <span class="nv">$tagSummary</span><span class="p">[</span><span class="nv">$window</span><span class="p">]++</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>    <span class="p">}</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="p">}</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a><span class="nb">Write-Host</span> <span class="s2">&quot;=== VM DISTRIBUTION BY PATCH WINDOW ===&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="nv">$tagSummary</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">()</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Name</span> <span class="p">|</span> <span class="k">ForEach</span><span class="n">-Object</span> <span class="p">{</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Key</span><span class="p">)</span><span class="s2">: </span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span><span class="s2"> VMs&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">White</span>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="success-metrics"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#success-metrics">📈 Success Metrics</a></h4>
<p>After two full weeks of operation:</p>
<ul>
<li><strong>Better control:</strong> Direct management of patch schedules and policies  </li>
<li><strong>Increased visibility:</strong> Real-time compliance dashboards vs. periodic reports</li>
<li><strong>Reduced complexity:</strong> Native Azure tooling vs. third-party solutions</li>
</ul>
<p><a href="https://learn.microsoft.com/en-us/azure/update-manager/monitor-updates">Monitor updates in Azure Update Manager</a></p>
<hr />
<h3 id="final-thoughts-tips"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#final-thoughts-tips">📃 Final Thoughts &amp; Tips</a></h3>
<p>✅ <strong>Cost-neutral</strong> — No more third-party patch agents
✅ <strong>Policy-driven</strong> — Enforced consistency with Azure Policy
✅ <strong>Easily auditable</strong> — Tag-based scoping is clean and visible
✅ <strong>Scalable</strong> — New VMs auto-join patch schedules via tagging</p>
<h4 id="troubleshooting-guide-common-issues"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#troubleshooting-guide-common-issues">⚠️ Troubleshooting Guide &amp; Common Issues</a></h4>
<p>Here's what I learned the hard way, so you don't have to:</p>
<table>
<thead>
<tr>
<th><strong>Symptom</strong></th>
<th><strong>Possible Cause</strong></th>
<th><strong>Fix</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>VM not showing in dynamic scope</td>
<td>Tag typo or case mismatch</td>
<td>Verify <code>PatchWindow</code> tag exactly matches config name</td>
</tr>
<tr>
<td>Maintenance config creation fails</td>
<td>Invalid duration format</td>
<td>Use ISO 8601 format: <code>"03:00"</code> not <code>"3 hours"</code></td>
</tr>
<tr>
<td>VM skipped during patching</td>
<td>Policy prerequisites not met</td>
<td>Check Azure Policy compliance dashboard</td>
</tr>
<tr>
<td>No updates applied despite schedule</td>
<td>VM needs pending reboot</td>
<td>Clear previous reboots, check update history</td>
</tr>
<tr>
<td>Dynamic scope shows zero VMs</td>
<td>Wrong subscription scope</td>
<td>Verify subscription selection in scope config</td>
</tr>
<tr>
<td>Extension installation failed</td>
<td>Insufficient permissions</td>
<td>Ensure VM contributor rights and resource provider registration</td>
</tr>
<tr>
<td>Policy compliance stuck at 0%</td>
<td>Assignment scope too narrow</td>
<td>Check policy is assigned at subscription level</td>
</tr>
<tr>
<td>VMs appear/disappear from scope</td>
<td>Tag inconsistency</td>
<td>Run tag verification script across all subscriptions</td>
</tr>
</tbody>
</table>
<h4 id="advanced-troubleshooting-commands"><a class="toclink" href="../../bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/#advanced-troubleshooting-commands">🔧 Advanced Troubleshooting Commands</a></h4>
<p><strong>Check VM Update Readiness:</strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c"># Verify VM has required extensions and configuration</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="nv">$vmName</span> <span class="p">=</span> <span class="s2">&quot;your-vm-name&quot;</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="nv">$rgName</span> <span class="p">=</span> <span class="s2">&quot;your-resource-group&quot;</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-AzVM</span> <span class="n">-Name</span> <span class="nv">$vmName</span> <span class="n">-ResourceGroupName</span> <span class="nv">$rgName</span> <span class="n">-Status</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="nv">$vm</span><span class="p">.</span><span class="n">Extensions</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Name</span> <span class="o">-like</span> <span class="s2">&quot;*Update*&quot;</span> <span class="o">-or</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Name</span> <span class="o">-like</span> <span class="s2">&quot;*Maintenance*&quot;</span> <span class="p">}</span>
</span></code></pre></div>
<p><strong>Validate Maintenance Configuration:</strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c"># Test maintenance configuration is properly formed</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="nv">$config</span> <span class="p">=</span> <span class="nb">Get-AzMaintenanceConfiguration</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;rg-maintenance-uksouth-001&quot;</span> <span class="n">-Name</span> <span class="s2">&quot;contoso-maintenance-config-vms-mon&quot;</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Config Name: </span><span class="p">$(</span><span class="nv">$config</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span><span class="s2">&quot;</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Recurrence: </span><span class="p">$(</span><span class="nv">$config</span><span class="p">.</span><span class="n">RecurEvery</span><span class="p">)</span><span class="s2">&quot;</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Duration: </span><span class="p">$(</span><span class="nv">$config</span><span class="p">.</span><span class="n">Duration</span><span class="p">)</span><span class="s2">&quot;</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Start Time: </span><span class="p">$(</span><span class="nv">$config</span><span class="p">.</span><span class="n">StartDateTime</span><span class="p">)</span><span class="s2">&quot;</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="nb">Write-Host</span> <span class="s2">&quot;Timezone: </span><span class="p">$(</span><span class="nv">$config</span><span class="p">.</span><span class="n">TimeZone</span><span class="p">)</span><span class="s2">&quot;</span>
</span></code></pre></div>
<p><strong>Policy Compliance Deep Dive:</strong></p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c"># Check specific VMs for policy compliance</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="nv">$policyName</span> <span class="p">=</span> <span class="s2">&quot;Set prerequisites for scheduling recurring updates on Azure virtual machines&quot;</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="nv">$assignments</span> <span class="p">=</span> <span class="nb">Get-AzPolicyAssignment</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Properties</span><span class="p">.</span><span class="n">DisplayName</span> <span class="o">-eq</span> <span class="nv">$policyName</span> <span class="p">}</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$assignment</span> <span class="k">in</span> <span class="nv">$assignments</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>    <span class="nb">Get-AzPolicyState</span> <span class="n">-PolicyAssignmentId</span> <span class="nv">$assignment</span><span class="p">.</span><span class="n">PolicyAssignmentId</span> <span class="p">|</span> 
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>        <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="n">ComplianceState</span> <span class="o">-eq</span> <span class="s2">&quot;NonCompliant&quot;</span> <span class="p">}</span> <span class="p">|</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>        <span class="nb">Select-Object</span> <span class="n">ResourceId</span><span class="p">,</span> <span class="n">ComplianceState</span><span class="p">,</span> <span class="p">@{</span><span class="n">Name</span><span class="p">=</span><span class="s2">&quot;Reason&quot;</span><span class="p">;</span><span class="n">Expression</span><span class="p">={</span><span class="nv">$_</span><span class="p">.</span><span class="n">PolicyEvaluationDetails</span><span class="p">.</span><span class="n">EvaluatedExpressions</span><span class="p">.</span><span class="n">ExpressionValue</span><span class="p">}}</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<p><em>As always, comments and suggestions welcome over on GitHub or LinkedIn. If you've migrated patching in a different way, I'd love to hear how you approached it.</em></p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Bringing%20Patch%20Management%20In-House%3A%20Migrating%20from%20MSP%20to%20Azure%20Update%20Manager%0A&amp;url=https://blog.pollockweb.com/blog/bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/bringing-patch-management-in-house-migrating-from-msp-to-azure-update-manager/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-05-08 00:00:00+00:00">May 8, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/azure/" class="md-meta__link">Azure</a>, 
              <a href="../../category/bcdr/" class="md-meta__link">BCDR</a>, 
              <a href="../../category/cloud-architecture/" class="md-meta__link">Cloud Architecture</a></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="azure-bcdr-review-turning-inherited-cloud-infrastructure-into-a-resilient-recovery-strategy"><a class="toclink" href="../../azure-bcdr-review--turning-inherited-cloud-infrastructure-into-a-resilient-recovery-strategy/">⚙️ Azure BCDR Review – Turning Inherited Cloud Infrastructure into a Resilient Recovery Strategy</a></h2>
<p>When we inherited our Azure estate from a previous MSP, some of the key technical components were already in place — ASR was configured for a number of workloads, and backups had been partially implemented across the environment.</p>
<p>What we didn’t inherit was a documented or validated BCDR strategy.</p>
<p>There were no formal recovery plans defined in ASR, no clear failover sequences, and no evidence that a regional outage scenario had ever been modelled or tested. The building blocks were there — but there was no framework tying them together into a usable or supportable recovery posture.</p>
<p>This post shares how I approached the challenge of assessing and strengthening our Azure BCDR readiness. It's not about starting from scratch — it's about applying structure, logic, and realism to an environment that had the right intentions but lacked operational clarity.</p>
<p>Whether you're stepping into a similar setup or planning your first formal DR review, I hope this provides a practical and relatable blueprint.</p>
<hr />
<h3 id="where-we-started-technical-foundations-operational-gaps"><a class="toclink" href="../../azure-bcdr-review--turning-inherited-cloud-infrastructure-into-a-resilient-recovery-strategy/#where-we-started-technical-foundations-operational-gaps">🎯 Where We Started: Technical Foundations, Operational Gaps</a></h3>
<p>We weren’t starting from zero — but we weren’t in a position to confidently recover the environment either.</p>
<p><strong>What we found:</strong></p>
<ul>
<li>🟢 ASR replication was partially implemented  </li>
<li>🟡 VM backups were present but inconsistent  </li>
<li>❌ No Recovery Plans existed in ASR  </li>
<li>❌ No test failovers had ever been performed  </li>
<li>⚠️ No documented RTO/RPO targets  </li>
<li>❓ DNS and Private Endpoints weren’t accounted for in DR  </li>
<li>🔒 Networking had not been reviewed for failover scenarios  </li>
<li>🚫 No capacity reservations had been made</li>
</ul>
<p>This review was the first step in understanding whether our DR setup could work in practice — not just in theory.</p>
<hr />
<h3 id="1-workload-protection-whats-covered-whats-not"><a class="toclink" href="../../azure-bcdr-review--turning-inherited-cloud-infrastructure-into-a-resilient-recovery-strategy/#1-workload-protection-whats-covered-whats-not">🛡️ 1️⃣ Workload Protection: What’s Covered, What’s Not</a></h3>
<p>Some workloads were actively replicated via ASR. Others were only backed up. Some had both, a few had neither. There was no documented logic to explain why.</p>
<p>Workload protection appeared to be driven by convenience or historical context — not by business impact or recovery priority.</p>
<p>What we needed was a structured tiering model:</p>
<ul>
<li>🧠 Which workloads are mission-critical?</li>
<li>⏱️ Which ones can tolerate extended recovery times?</li>
<li>📊 What RTOs and RPOs are actually achievable?</li>
</ul>
<p>This became the foundation for everything else.</p>
<hr />
<h3 id="2-the-missing-operational-layer"><a class="toclink" href="../../azure-bcdr-review--turning-inherited-cloud-infrastructure-into-a-resilient-recovery-strategy/#2-the-missing-operational-layer">🧩 2️⃣ The Missing Operational Layer</a></h3>
<p>We had technical coverage — but no operational recovery strategy.</p>
<p>There were no Recovery Plans in ASR. No sequencing, no post-failover validation, and no scripts or automation.</p>
<p>In the absence of structure, recovery would be entirely manual — relying on individual knowledge, assumptions, and good luck during a critical event.</p>
<p>Codifying dependencies, failover order, and recovery steps became a priority.</p>
<hr />
<h3 id="3-dns-identity-and-private-endpoint-blind-spots"><a class="toclink" href="../../azure-bcdr-review--turning-inherited-cloud-infrastructure-into-a-resilient-recovery-strategy/#3-dns-identity-and-private-endpoint-blind-spots">🌐 3️⃣ DNS, Identity and Private Endpoint Blind Spots</a></h3>
<p>DNS and authentication are easy to overlook — until they break.</p>
<p>Our name resolution relied on internal DNS via AD-integrated zones, with no failover logic for internal record switching. No private DNS zones were in place.</p>
<p>Private Endpoints were widely used, but all existed in the primary region. In a DR scenario, they would become unreachable.</p>
<p>Identity was regionally redundant, but untested and not AZ-aware.</p>
<p>We needed to promote DNS, identity, and PE routing to first-class DR concerns.</p>
<hr />
<h3 id="4-storage-and-data-access-risk"><a class="toclink" href="../../azure-bcdr-review--turning-inherited-cloud-infrastructure-into-a-resilient-recovery-strategy/#4-storage-and-data-access-risk">💾 4️⃣ Storage and Data Access Risk</a></h3>
<p>Azure Storage backed a range of services — from SFTP and app data to file shares and diagnostics.</p>
<p>Replication strategies varied (LRS, RA-GRS, ZRS) with no consistent logic or documentation. Critical storage accounts weren’t aligned with workload tiering.</p>
<p>Some workloads used Azure Files and Azure File Sync, but without defined mount procedures or recovery checks.</p>
<p>In short: compute could come back, but data availability wasn’t assured.</p>
<hr />
<h3 id="5-the-networking-piece-and-why-it-matters-more-than-people-think"><a class="toclink" href="../../azure-bcdr-review--turning-inherited-cloud-infrastructure-into-a-resilient-recovery-strategy/#5-the-networking-piece-and-why-it-matters-more-than-people-think">🔌 5️⃣ The Networking Piece (And Why It Matters More Than People Think)</a></h3>
<p>NSGs, UDRs, custom routing, and SD-WAN all played a part in how traffic flowed.</p>
<p>But in DR, assumptions break quickly.</p>
<p>There was no documentation of network flow in the DR region, and no validation of inter-VM or service-to-service reachability post-failover.</p>
<p>Some services — like App Gateways, Internal Load Balancers, and Private Endpoints — were region-bound and would require re-deployment or manual intervention.</p>
<p>Networking wasn’t the background layer — it was core to recoverability.</p>
<hr />
<h3 id="6-capacity-risk-when-dr-isnt-guaranteed"><a class="toclink" href="../../azure-bcdr-review--turning-inherited-cloud-infrastructure-into-a-resilient-recovery-strategy/#6-capacity-risk-when-dr-isnt-guaranteed">📦 6️⃣ Capacity Risk: When DR Isn’t Guaranteed</a></h3>
<p>VM replication is only half the story. The other half is whether those VMs can actually start during a DR event.</p>
<p>Azure doesn’t guarantee regional capacity unless you've pre-purchased it.</p>
<p>In our case, <strong>no capacity reservations</strong> had been made. That meant no assurance that our Tier 0 or Tier 1 workloads could even boot if demand spiked during a region-wide outage.</p>
<p>This is a quiet but critical risk — and one worth addressing early.</p>
<hr />
<h3 id="conclusion-from-discovery-to-direction"><a class="toclink" href="../../azure-bcdr-review--turning-inherited-cloud-infrastructure-into-a-resilient-recovery-strategy/#conclusion-from-discovery-to-direction">✅ Conclusion: From Discovery to Direction</a></h3>
<p>This review wasn’t about proving whether DR was in place — it was about understanding whether it would actually work.</p>
<p>The tooling was present. The protection was partial. The process was missing.</p>
<p>By mapping out what was covered, where the gaps were, and how recovery would actually unfold, we created a baseline that gave us clarity and control.</p>
<hr />
<h3 id="coming-next-documenting-the-plan"><a class="toclink" href="../../azure-bcdr-review--turning-inherited-cloud-infrastructure-into-a-resilient-recovery-strategy/#coming-next-documenting-the-plan">📘 Coming Next: Documenting the Plan</a></h3>
<p>In the next post, I’ll walk through how I formalised the review into a structured BCDR posture document — including:</p>
<ul>
<li>🧱 Mapping workloads by tier and impact  </li>
<li>⏳ Defining current vs target RTO/RPO  </li>
<li>🛠️ Highlighting gaps in automation, DNS, storage, and capacity  </li>
<li>🧭 Building a recovery plan roadmap  </li>
<li>⚖️ Framing cost vs risk for stakeholder alignment  </li>
</ul>
<p>If you're facing a similar situation — whether you're inheriting someone else's cloud estate or building DR into a growing environment — I hope this series helps bring structure to the complexity.</p>
<p>Let me know if you'd find it useful to share templates or walkthroughs in the next post.</p>
<hr />
<p><a class="md-button" href="https://x.com/intent/tweet?text=Azure%20BCDR%20Review%20%E2%80%93%20Turning%20Inherited%20Cloud%20Infrastructure%20into%20a%20Resilient%20Recovery%20Strategy%0A&amp;url=https://blog.pollockweb.com/blog/azure-bcdr-review--turning-inherited-cloud-infrastructure-into-a-resilient-recovery-strategy/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/azure-bcdr-review--turning-inherited-cloud-infrastructure-into-a-resilient-recovery-strategy/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-05-08 00:00:00+00:00">May 8, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/azure/" class="md-meta__link">Azure</a>, 
              <a href="../../category/bcdr/" class="md-meta__link">BCDR</a>, 
              <a href="../../category/cloud-architecture/" class="md-meta__link">Cloud Architecture</a></li>
        
        
          
          <li class="md-meta__item">
            
              5 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="azure-bcdr-how-i-turned-a-dr-review-into-a-strategic-recovery-plan"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/">🧾 Azure BCDR – How I Turned a DR Review into a Strategic Recovery Plan</a></h2>
<p>In <a href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#">Part 1</a> of this series, I shared how we reviewed our Azure BCDR posture after inheriting a partially implemented cloud estate. The findings were clear: while the right tools were in place, the operational side of disaster recovery hadn’t been addressed.</p>
<p>There were no test failovers, no documented Recovery Plans, no automation, and several blind spots in DNS, storage, and private access.</p>
<p>This post outlines how I took that review and turned it into a practical recovery strategy — one that we could share internally, align with our CTO, and use as a foundation for further work with our support partner.</p>
<p>To provide context, our estate is deployed primarily in the <strong>UK South</strong> Azure region, with <strong>UK West</strong> serving as the designated DR target region.</p>
<p>It’s not a template — it’s a repeatable, real-world approach to structuring a BCDR plan when you’re starting from inherited infrastructure, not a clean slate.</p>
<hr />
<h3 id="1-why-documenting-the-plan-matters"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#1-why-documenting-the-plan-matters">🧭 1. Why Documenting the Plan Matters</a></h3>
<p>Most cloud teams can identify issues. Fewer take the time to formalise the findings in a way that supports action and alignment.</p>
<p>Documenting our BCDR posture gave us three things:</p>
<ul>
<li>🧠 Clarity — a shared understanding of what’s protected and what isn’t  </li>
<li>🔦 Visibility — a way to surface risk and prioritise fixes  </li>
<li>🎯 Direction — a set of realistic, cost-aware next steps  </li>
</ul>
<p>We weren’t trying to solve every problem at once. The goal was to define a usable plan we could act on, iterate, and eventually test — all while making sure that effort was focused on the right areas.</p>
<hr />
<h3 id="2-starting-the-document"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#2-starting-the-document">🧱 2. Starting the Document</a></h3>
<p>I structured the document to speak to both <strong>technical stakeholders</strong> and <strong>senior leadership</strong>. It needed to balance operational context with strategic risk.</p>
<h4 id="core-sections-included"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#core-sections-included">✍️ Core sections included</a></h4>
<ul>
<li><strong>Executive Summary</strong> – what the document is, why it matters  </li>
<li><strong>Maturity Snapshot</strong> – a simple traffic-light view of current vs target posture  </li>
<li><strong>Workload Overview</strong> – what’s in scope and what’s protected  </li>
<li><strong>Recovery Objectives</strong> – realistic RPO/RTO targets by tier  </li>
<li><strong>Gaps and Risks</strong> – the areas most likely to cause DR failure  </li>
<li><strong>Recommendations</strong> – prioritised, actionable, and cost-aware  </li>
<li><strong>Next Steps</strong> – what we can handle internally, and what goes to the MSP</li>
</ul>
<p>Each section followed the same principle: clear, honest, and focused on action. No fluff, no overstatements — just a straightforward review of where we stood and what needed doing.</p>
<hr />
<h3 id="3-defining-the-current-state"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#3-defining-the-current-state">🧩 3. Defining the Current State</a></h3>
<p>Before we could plan improvements, we had to document what actually existed. This wasn’t about assumptions — it was about capturing the <strong>real configuration and coverage</strong> in Azure.</p>
<h4 id="workload-inventory"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#workload-inventory">🗂️ Workload Inventory</a></h4>
<p>We started by categorising all VMs and services:</p>
<ul>
<li>Domain controllers</li>
<li>Application servers (web/API/backend)</li>
<li>SQL Managed Instances</li>
<li>Infrastructure services (file, render, schedulers)</li>
<li>Management and monitoring VMs</li>
</ul>
<p>Each workload was mapped by <strong>criticality</strong> and <strong>recovery priority</strong> — not just by type.</p>
<h4 id="protection-levels"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#protection-levels">🛡️ Protection Levels</a></h4>
<p>For each workload, we recorded:</p>
<ul>
<li>✅ Whether it was protected by ASR</li>
<li>🔁 Whether it was backed up only</li>
<li>🚫 Whether it had no protection (with justification)</li>
</ul>
<p>We also reviewed the <strong>geographic layout</strong> — e.g. which services were replicated into UK West, and which existed only in UK South.</p>
<h4 id="supporting-services"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#supporting-services">🧠 Supporting Services</a></h4>
<p>Beyond the VMs, we looked at:</p>
<ul>
<li>Identity services (AD, domain controllers, replication health)</li>
<li>DNS architecture (AD-integrated zones, private DNS zones)</li>
<li>Private Endpoints and their region-specific availability</li>
<li>Storage account replication types (LRS, RA-GRS, ZRS)</li>
<li>Network security and routing configurations in DR</li>
</ul>
<p>The aim wasn’t to build a full asset inventory — just to gather enough visibility to start making risk-based decisions about what mattered, and what was missing.</p>
<hr />
<h3 id="4-setting-recovery-objectives"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#4-setting-recovery-objectives">⏱️ 4. Setting Recovery Objectives</a></h3>
<p>Once the current state was mapped, the next step was to define what “recovery” should actually look like — in terms that could be communicated, challenged, and agreed.</p>
<p>We focused on two key metrics:</p>
<ul>
<li><strong>RTO</strong> (Recovery Time Objective): How long can this system be offline before we see significant operational impact?</li>
<li><strong>RPO</strong> (Recovery Point Objective): How much data loss is acceptable in a worst-case failover?</li>
</ul>
<p>These weren’t guessed or copied from a template. We worked with realistic assumptions based on our tooling, team capability, and criticality of the services.</p>
<h4 id="tiered-recovery-model"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#tiered-recovery-model">📊 Tiered Recovery Model</a></h4>
<p>Each workload was assigned to one of four tiers:</p>
<table>
<thead>
<tr>
<th>Tier</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tier 0</td>
<td>Core infrastructure (identity, DNS, routing)</td>
</tr>
<tr>
<td>Tier 1</td>
<td>Mission-critical production workloads</td>
</tr>
<tr>
<td>Tier 2</td>
<td>Important, but not time-sensitive services</td>
</tr>
<tr>
<td>SQL MI</td>
<td>Treated separately due to its PaaS nature</td>
</tr>
</tbody>
</table>
<p>We then applied RTO and RPO targets based on what we could achieve today vs what we aim to reach with improvements.</p>
<h4 id="heatmap-example"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#heatmap-example">🔥 Heatmap Example</a></h4>
<table>
<thead>
<tr>
<th>Workload Tier</th>
<th>RPO (Current)</th>
<th>RTO (Current)</th>
<th>RPO (Optimised)</th>
<th>RTO (Optimised)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tier 0 – Identity</td>
<td>5 min</td>
<td>60 min</td>
<td>5 min</td>
<td>30 min</td>
</tr>
<tr>
<td>Tier 1 – Prod</td>
<td>5 min</td>
<td>360 min</td>
<td>5 min</td>
<td>60 min</td>
</tr>
<tr>
<td>Tier 2 – Non-Crit</td>
<td>1440 min</td>
<td>1440 min</td>
<td>60 min</td>
<td>240 min</td>
</tr>
<tr>
<td>SQL MI</td>
<td>0 min</td>
<td>60 min</td>
<td>0 min</td>
<td>30 min</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="5-highlighting-gaps-and-risks"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#5-highlighting-gaps-and-risks">🚧 5. Highlighting Gaps and Risks</a></h3>
<p>With recovery objectives defined, the gaps became much easier to identify — and to prioritise.</p>
<p>We weren’t trying to protect everything equally. The goal was to focus attention on the areas that introduced the <strong>highest risk to recovery</strong> if left unresolved.</p>
<h4 id="what-we-flagged"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#what-we-flagged">⚠️ What We Flagged</a></h4>
<ul>
<li>❌ No test failovers had ever been performed  </li>
<li>❌ No Recovery Plans existed  </li>
<li>🌐 Public-facing infrastructure only existed in one region  </li>
<li>🔒 Private Endpoints lacked DR equivalents  </li>
<li>🧭 DNS failover was manual or undefined  </li>
<li>💾 Storage accounts had inconsistent replication logic  </li>
<li>🚫 No capacity reservations existed for critical VM SKUs  </li>
</ul>
<p>Each gap was documented with its impact, priority, and remediation options.</p>
<hr />
<h3 id="6-strategic-recommendations"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#6-strategic-recommendations">🛠️ 6. Strategic Recommendations</a></h3>
<p>We split our recommendations into what we could handle internally, and what would require input from our MSP or further investment.</p>
<h4 id="internal-actions"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#internal-actions">📌 Internal Actions</a></h4>
<ul>
<li>Build and test Recovery Plans for Tier 0 and Tier 1 workloads  </li>
<li>Improve DNS failover scripting  </li>
<li>Review VM tags to reflect criticality and protection state  </li>
<li>Create sequencing logic for application groups  </li>
<li>Align NSGs and UDRs in DR with production  </li>
</ul>
<h4 id="msp-led-or-partner-support"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#msp-led-or-partner-support">🤝 MSP-Led or Partner Support</a></h4>
<ul>
<li>Duplicate App Gateways / ILBs in UK West  </li>
<li>Implement Private DNS Zones  </li>
<li>Review and implement capacity reservations  </li>
<li>Test runbook-driven recovery automation  </li>
<li>Conduct structured test failovers across service groups  </li>
</ul>
<hr />
<h3 id="7-making-it-actionable"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#7-making-it-actionable">📅 7. Making It Actionable</a></h3>
<p>A plan needs ownership and timelines. We assigned tasks by role and defined short-, medium-, and long-term priorities using a simple planning table.</p>
<p>We treat the BCDR document as a <strong>living artefact</strong> — updated quarterly, tied to change control, and used to guide internal work and partner collaboration.</p>
<hr />
<h3 id="8-closing-reflections"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#8-closing-reflections">🔚 8. Closing Reflections</a></h3>
<p>The original goal wasn’t to build a perfect DR solution — it was to understand where we stood, make recovery realistic, and document a plan that would hold up when we needed it most.</p>
<p>We inherited a functional technical foundation — but needed to formalise and validate it as part of a resilient DR posture.</p>
<p>By documenting the estate, defining recovery objectives, and identifying where the real risks were, we turned a passive DR posture into something we could act on. We gave stakeholders clarity. We gave the support partner direction. And we gave ourselves a roadmap.</p>
<hr />
<h3 id="whats-next"><a class="toclink" href="../../azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/#whats-next">🔜 What’s Next</a></h3>
<p>In the next part of this series, I’ll walk through how we executed the plan:</p>
<ul>
<li>Building and testing our first Recovery Plan  </li>
<li>Improving ASR coverage and validation  </li>
<li>Running our first failover drill  </li>
<li>Reviewing results and updating the heatmap  </li>
</ul>
<hr />
<p>If you're stepping into an inherited cloud environment or starting your first structured DR review, I hope this gives you a practical view of what’s involved — and what’s achievable without overcomplicating the process.</p>
<p>Let me know if you'd like to see templates or report structures from this process in a future post.</p>
<hr />
<p><a class="md-button" href="https://x.com/intent/tweet?text=Azure%20BCDR%20%E2%80%93%20How%20I%20Turned%20a%20DR%20Review%20into%20a%20Strategic%20Recovery%20Plan%0A&amp;url=https://blog.pollockweb.com/blog/azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/azure-bcdr--how-i-turned-a-dr-review-into-a-strategic-recovery-plan/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-04-22 00:00:00+00:00">April 22, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/azure/" class="md-meta__link">Azure</a>, 
              <a href="../../category/automation/" class="md-meta__link">Automation</a>, 
              <a href="../../category/finops/" class="md-meta__link">FinOps</a>, 
              <a href="../../category/powershell/" class="md-meta__link">PowerShell</a></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks"><a class="toclink" href="../../saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/">💰 Saving Azure Costs with Scheduled VM Start/Stop using Custom Azure Automation Runbooks</a></h2>
<p>As part of my ongoing commitment to FinOps practices, I've implemented several strategies to embed cost-efficiency into the way we manage cloud infrastructure. One proven tactic is scheduling virtual machines to shut down during idle periods, avoiding unnecessary spend.</p>
<p>In this post, I’ll share how I’ve built out <strong>custom Azure Automation jobs</strong> to schedule VM start and stop operations. Rather than relying on Microsoft’s pre-packaged solution, I’ve developed a <strong>streamlined, purpose-built PowerShell implementation</strong> that provides maximum flexibility, transparency, and control.</p>
<hr />
<h3 id="why-i-chose-custom-runbooks-over-the-prebuilt-solution"><a class="toclink" href="../../saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/#why-i-chose-custom-runbooks-over-the-prebuilt-solution">✍️ Why I Chose Custom Runbooks Over the Prebuilt Solution</a></h3>
<p>Microsoft provides a ready-made “Start/Stop VMs during off-hours” solution via the Automation gallery. While functional, it’s:</p>
<ul>
<li>A bit over-engineered for simple needs,</li>
<li>Relatively opaque under the hood, and</li>
<li>Not ideal for environments where control and transparency are priorities.</li>
</ul>
<p>My custom jobs:</p>
<ul>
<li>Use native PowerShell modules within Azure Automation,</li>
<li>Are scoped to exactly the VMs I want via <strong>tags</strong>,</li>
<li>Provide clean logging and alerting, and</li>
<li>Keep things simple, predictable, and auditable.</li>
</ul>
<hr />
<h3 id="step-1-set-up-the-azure-automation-account"><a class="toclink" href="../../saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/#step-1-set-up-the-azure-automation-account">🛠️ Step 1: Set Up the Azure Automation Account</a></h3>
<blockquote>
<p>🔗 <a href="https://learn.microsoft.com/en-us/azure/automation/automation-create-standalone-account">Official docs: Create and manage an Azure Automation Account</a></p>
</blockquote>
<ol>
<li>Go to the <strong>Azure Portal</strong> and search for <strong>Automation Accounts</strong>.</li>
<li>Click <strong>+ Create</strong>.</li>
<li>Fill out the basics:</li>
<li><strong>Name</strong>: e.g. <code>vm-scheduler</code></li>
<li><strong>Resource Group</strong>: Create new or select existing</li>
<li><strong>Region</strong>: Preferably where your VMs are located</li>
<li>Enable <strong>System-Assigned Managed Identity</strong></li>
<li>Once created, go to the Automation Account and ensure the following modules are imported using the <strong>Modules</strong> blade in the Azure Portal:</li>
<li><code>Az.Accounts</code></li>
<li><code>Az.Compute</code></li>
</ol>
<blockquote>
<p>✅ Tip: These modules can be added from the gallery in just a few clicks via the UI—no scripting required.</p>
<p>💡 Prefer scripting? You can also install them using PowerShell:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">Az</span><span class="p">.</span><span class="n">Accounts</span> <span class="n">-Force</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nb">Install-Module</span> <span class="n">-Name</span> <span class="n">Az</span><span class="p">.</span><span class="n">Compute</span> <span class="n">-Force</span>
</span></code></pre></div>
</blockquote>
<ol>
<li>Assign the <strong>Virtual Machine Contributor</strong> role to the Automation Account's managed identity at the resource group or subscription level.</li>
</ol>
<h4 id="cli-or-powershell-alternatives"><a class="toclink" href="../../saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/#cli-or-powershell-alternatives">⚙️ CLI or PowerShell alternatives</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># Azure CLI example to create the automation account</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>az<span class="w"> </span>automation<span class="w"> </span>account<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span>--name<span class="w"> </span>vm-scheduler<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span>--resource-group<span class="w"> </span>MyResourceGroup<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span>--location<span class="w"> </span>uksouth<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">  </span>--assign-identity
</span></code></pre></div>
<hr />
<h3 id="step-2-add-vm-tags-for-scheduling"><a class="toclink" href="../../saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/#step-2-add-vm-tags-for-scheduling">📅 Step 2: Add VM Tags for Scheduling</a></h3>
<p>Apply consistent tags to any VM you want the runbooks to manage.</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AutoStartStop</code></td>
<td><code>devserver</code></td>
</tr>
</tbody>
</table>
<p>You can use the Azure Portal or PowerShell to apply these tags.</p>
<h4 id="tag-vms-via-powershell"><a class="toclink" href="../../saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/#tag-vms-via-powershell">⚙️ Tag VMs via PowerShell</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nv">$vm</span> <span class="p">=</span> <span class="nb">Get-AzVM</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;MyRG&quot;</span> <span class="n">-Name</span> <span class="s2">&quot;myVM&quot;</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nv">$vm</span><span class="p">.</span><span class="n">Tags</span><span class="p">[</span><span class="s2">&quot;AutoStartStop&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s2">&quot;devserver&quot;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nb">Update-AzVM</span> <span class="n">-VM</span> <span class="nv">$vm</span> <span class="n">-ResourceGroupName</span> <span class="s2">&quot;MyRG&quot;</span>
</span></code></pre></div>
<hr />
<h3 id="step-3-create-the-runbooks"><a class="toclink" href="../../saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/#step-3-create-the-runbooks">📂 Step 3: Create the Runbooks</a></h3>
<blockquote>
<p>🔗 <a href="https://learn.microsoft.com/en-us/azure/automation/automation-runbook-create">Official docs: Create a runbook in Azure Automation</a></p>
</blockquote>
<h4 id="create-a-new-runbook"><a class="toclink" href="../../saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/#create-a-new-runbook">▶️ Create a New Runbook</a></h4>
<ol>
<li>In your Automation Account, go to <strong>Process Automation</strong> &gt; <strong>Runbooks</strong>.</li>
<li>Click <strong>+ Create a runbook</strong>.</li>
<li>Name it something like <code>Stop-TaggedVMs</code>.</li>
<li>Choose <strong>PowerShell</strong> as the type.</li>
<li>Paste in the code below (repeat this process for the start runbook later).</li>
</ol>
<h4 id="runbook-code-auto-stop-based-on-tags"><a class="toclink" href="../../saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/#runbook-code-auto-stop-based-on-tags">🔹 Runbook Code: Auto-Stop Based on Tags</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">Param</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="p">(</span>    
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$false</span><span class="p">)][</span><span class="n">ValidateNotNullOrEmpty</span><span class="p">()]</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="no">[String]</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="nv">$AzureVMName</span> <span class="p">=</span> <span class="s2">&quot;All&quot;</span><span class="p">,</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="p">[</span><span class="k">Parameter</span><span class="p">(</span><span class="k">Mandatory</span><span class="p">=</span><span class="nv">$true</span><span class="p">)][</span><span class="n">ValidateNotNullOrEmpty</span><span class="p">()]</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    <span class="no">[String]</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    <span class="nv">$AzureSubscriptionID</span> <span class="p">=</span> <span class="s2">&quot;&lt;your-subscription-id&gt;&quot;</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="p">)</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="k">try</span> <span class="p">{</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>    <span class="s2">&quot;Logging in to Azure...&quot;</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>    <span class="c"># Authenticate using the system-assigned managed identity of the Automation Account</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>    <span class="nb">Connect-AzAccount</span> <span class="n">-Identity</span> <span class="n">-AccountId</span> <span class="s2">&quot;&lt;managed-identity-client-id&gt;&quot;</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>    <span class="nb">Write-Error</span> <span class="n">-Message</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>    <span class="k">throw</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Exception</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="p">}</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="nv">$TagName</span>  <span class="p">=</span> <span class="s2">&quot;AutoStartStop&quot;</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="nv">$TagValue</span> <span class="p">=</span> <span class="s2">&quot;devserver&quot;</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a><span class="nb">Set-AzContext</span> <span class="n">-Subscription</span> <span class="nv">$AzureSubscriptionID</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$AzureVMName</span> <span class="o">-ne</span> <span class="s2">&quot;All&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>    <span class="nv">$VMs</span> <span class="p">=</span> <span class="nb">Get-AzResource</span> <span class="n">-TagName</span> <span class="nv">$TagName</span> <span class="n">-TagValue</span> <span class="nv">$TagValue</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>        <span class="nv">$_</span><span class="p">.</span><span class="n">ResourceType</span> <span class="o">-like</span> <span class="s1">&#39;Microsoft.Compute/virtualMachines&#39;</span> <span class="o">-and</span> <span class="nv">$_</span><span class="p">.</span><span class="n">Name</span> <span class="o">-like</span> <span class="nv">$AzureVMName</span>
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>    <span class="p">}</span>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>    <span class="nv">$VMs</span> <span class="p">=</span> <span class="nb">Get-AzResource</span> <span class="n">-TagName</span> <span class="nv">$TagName</span> <span class="n">-TagValue</span> <span class="nv">$TagValue</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>        <span class="nv">$_</span><span class="p">.</span><span class="n">ResourceType</span> <span class="o">-like</span> <span class="s1">&#39;Microsoft.Compute/virtualMachines&#39;</span>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>    <span class="p">}</span>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="p">}</span>
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>
</span><span id="__span-7-36"><a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$VM</span> <span class="k">in</span> <span class="nv">$VMs</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-7-37"><a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a>    <span class="nb">Stop-AzVM</span> <span class="n">-ResourceGroupName</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">ResourceGroupName</span> <span class="n">-Name</span> <span class="nv">$VM</span><span class="p">.</span><span class="n">Name</span> <span class="n">-Verbose</span> <span class="n">-Force</span>
</span><span id="__span-7-38"><a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>🔗 <a href="https://learn.microsoft.com/en-us/powershell/module/az.accounts/connect-azaccount">Docs: Connect-AzAccount with Managed Identity</a></p>
</blockquote>
<h4 id="create-the-start-runbook"><a class="toclink" href="../../saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/#create-the-start-runbook">🔹 Create the Start Runbook</a></h4>
<p>Duplicate the above, replacing <code>Stop-AzVM</code> with <code>Start-AzVM</code>.</p>
<blockquote>
<p>🔗 <a href="https://learn.microsoft.com/en-us/powershell/module/az.compute/start-azvm">Docs: Start-AzVM</a></p>
</blockquote>
<hr />
<h3 id="step-4-create-and-link-schedules"><a class="toclink" href="../../saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/#step-4-create-and-link-schedules">⏰ Step 4: Create and Link Schedules</a></h3>
<blockquote>
<p>🔗 <a href="https://learn.microsoft.com/en-us/azure/automation/automation-schedules">Docs: Create schedules in Azure Automation</a></p>
</blockquote>
<ol>
<li>Go to the Automation Account &gt; <strong>Schedules</strong> &gt; <strong>+ Add a schedule</strong>.</li>
<li>Create two schedules:</li>
<li><code>DailyStartWeekdays</code> — Recurs every weekday at 07:30</li>
<li><code>DailyStopWeekdays</code> — Recurs every weekday at 18:30</li>
<li>Go to each runbook &gt; <strong>Link to schedule</strong> &gt; Choose the matching schedule.</li>
</ol>
<blockquote>
<p>📊 You can get creative here: separate schedules for dev vs UAT, or different times for different departments.</p>
</blockquote>
<hr />
<h3 id="testing-your-runbooks"><a class="toclink" href="../../saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/#testing-your-runbooks">🧪 Testing Your Runbooks</a></h3>
<p>You can test each runbook directly in the portal:</p>
<ul>
<li>Open the runbook</li>
<li>Click <strong>Edit</strong> &gt; <strong>Test Pane</strong></li>
<li>Provide test parameters if needed</li>
<li>Click <strong>Start</strong> and monitor output</li>
</ul>
<p>This is also a good time to validate:</p>
<ul>
<li>The identity has permission</li>
<li>The tags are applied correctly</li>
<li>The VMs are in a stopped or running state as expected</li>
</ul>
<hr />
<h3 id="the-results"><a class="toclink" href="../../saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/#the-results">📊 The Results</a></h3>
<p>Even this lightweight automation has produced major savings in our environment. Non-prod VMs are now automatically turned off outside office hours, resulting in monthly compute savings of up to <strong>60%</strong> without sacrificing availability during working hours.</p>
<hr />
<h3 id="ideas-for-further-enhancement"><a class="toclink" href="../../saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/#ideas-for-further-enhancement">🧠 Ideas for Further Enhancement</a></h3>
<ul>
<li>Pull tag values from a central config (e.g. Key Vault or Storage Table)</li>
<li>Add logic to check for active RDP sessions or Azure Monitor heartbeats</li>
<li>Alert via email or Teams on job success/failure</li>
<li>Track savings over time and visualize them</li>
</ul>
<hr />
<h3 id="final-thoughts"><a class="toclink" href="../../saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/#final-thoughts">💭 Final Thoughts</a></h3>
<p>If you’re looking for a practical, immediate way to implement FinOps principles in Azure, VM scheduling is a great place to start. With minimal setup and maximum flexibility, custom runbooks give you control without the complexity of the canned solutions.</p>
<p>Have you built something similar or extended this idea further? I’d love to hear about it—drop me a comment or reach out on LinkedIn.</p>
<p>Stay tuned for more FinOps tips coming soon!</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Saving%20Azure%20Costs%20with%20Scheduled%20VM%20Start/Stop%20using%20Custom%20Azure%20Automation%20Runbooks%0A&amp;url=https://blog.pollockweb.com/blog/saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/saving-azure-costs-with-scheduled-vm-startstop-using-custom-azure-automation-runbooks/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-31 00:00:00+00:00">March 31, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/windows/" class="md-meta__link">Windows</a>, 
              <a href="../../category/automation/" class="md-meta__link">Automation</a>, 
              <a href="../../category/group-policy/" class="md-meta__link">Group Policy</a>, 
              <a href="../../category/time-settings/" class="md-meta__link">Time Settings</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks"><a class="toclink" href="../../enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks/">⌚Enforcing Time Zone and DST Compliance on Windows Servers Using GPO and Scheduled Tasks</a></h2>
<hr />
<h3 id="why-this-matters"><a class="toclink" href="../../enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks/#why-this-matters">🛠️ Why This Matters</a></h3>
<p>Time zone misconfigurations — especially those affecting Daylight Saving Time (DST) — can cause:</p>
<ul>
<li>Scheduled tasks to run early or late</li>
<li>Timestamp mismatches in logs</li>
<li>Errors in time-sensitive integrations</li>
</ul>
<p>Windows doesn’t always honour DST automatically, particularly in <strong>Azure VMs</strong>, <strong>automated deployments</strong>, or <strong>custom images</strong>.</p>
<hr />
<h3 id="whats-changed-in-2025"><a class="toclink" href="../../enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks/#whats-changed-in-2025">🔁 What’s Changed in 2025?</a></h3>
<p>As of <strong>April 2025</strong>, we revised our approach to enforce time zone compliance in a cleaner, more manageable way:</p>
<ul>
<li>🧹 <strong>Removed all registry-based enforcement</strong> from existing GPOs</li>
<li>⚙️ <strong>Executed a one-time PowerShell script</strong> to correct servers incorrectly set to <code>UTC</code> (excluding domain controllers)</li>
<li>⏲️ <strong>Updated the GPO</strong> to use a <strong>Scheduled Task</strong> that sets the correct time zone at startup (<code>GMT Standard Time</code>)</li>
</ul>
<hr />
<h3 id="audit-process-time-zone-and-ntp-source-check"><a class="toclink" href="../../enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks/#audit-process-time-zone-and-ntp-source-check">📋 Audit Process: Time Zone and NTP Source Check</a></h3>
<p>Before remediation, an audit was performed across the server estate to confirm the current time zone and time sync source for each host.</p>
<h4 id="time-zone-audit-script"><a class="toclink" href="../../enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks/#time-zone-audit-script">🔎 Time Zone Audit Script</a></h4>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c"># Set your target OU</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nv">$OU</span> <span class="p">=</span> <span class="s2">&quot;OU=Servers,DC=yourdomain,DC=local&quot;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="c"># Prompt for credentials once</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="nv">$cred</span> <span class="p">=</span> <span class="nb">Get-Credential</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="c"># Optional: output to file</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="nv">$OutputCsv</span> <span class="p">=</span> <span class="s2">&quot;C:\Temp\TimeZoneAudit.csv&quot;</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="nv">$results</span> <span class="p">=</span> <span class="p">@()</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="c"># Get all enabled computer objects in the OU</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="nv">$servers</span> <span class="p">=</span> <span class="nb">Get-ADComputer</span> <span class="n">-Filter</span> <span class="p">{</span><span class="n">Enabled</span> <span class="o">-eq</span> <span class="nv">$true</span><span class="p">}</span> <span class="n">-SearchBase</span> <span class="nv">$OU</span> <span class="n">-Properties</span> <span class="n">Name</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-ExpandProperty</span> <span class="n">Name</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$server</span> <span class="k">in</span> <span class="nv">$servers</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">Connecting to $server...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>        <span class="nv">$tzInfo</span> <span class="p">=</span> <span class="nb">Invoke-Command</span> <span class="n">-ComputerName</span> <span class="nv">$server</span> <span class="n">-Credential</span> <span class="nv">$cred</span> <span class="n">-ScriptBlock</span> <span class="p">{</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>            <span class="nv">$tz</span> <span class="p">=</span> <span class="nb">Get-TimeZone</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>            <span class="nv">$source</span> <span class="p">=</span> <span class="p">(</span><span class="n">w32tm</span> <span class="p">/</span><span class="n">query</span> <span class="p">/</span><span class="n">source</span><span class="p">)</span> <span class="n">-join</span> <span class="s1">&#39;&#39;</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>            <span class="nv">$status</span> <span class="p">=</span> <span class="p">(</span><span class="n">w32tm</span> <span class="p">/</span><span class="n">query</span> <span class="p">/</span><span class="n">status</span> <span class="p">|</span> <span class="nb">Out-String</span><span class="p">).</span><span class="n">Trim</span><span class="p">()</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>            <span class="no">[PSCustomObject]</span><span class="p">@{</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>                <span class="n">ComputerName</span>     <span class="p">=</span> <span class="nv">$env:COMPUTERNAME</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>                <span class="n">TimeZoneId</span>       <span class="p">=</span> <span class="nv">$tz</span><span class="p">.</span><span class="n">Id</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>                <span class="n">TimeZoneDisplay</span>  <span class="p">=</span> <span class="nv">$tz</span><span class="p">.</span><span class="n">DisplayName</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>                <span class="n">CurrentTime</span>      <span class="p">=</span> <span class="p">(</span><span class="nb">Get-Date</span><span class="p">).</span><span class="n">ToString</span><span class="p">(</span><span class="s2">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="p">)</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>                <span class="n">TimeSource</span>       <span class="p">=</span> <span class="nv">$source</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>                <span class="n">SyncStatus</span>       <span class="p">=</span> <span class="nv">$status</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>            <span class="p">}</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>        <span class="p">}</span> <span class="n">-ErrorAction</span> <span class="n">Stop</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>        <span class="nv">$results</span> <span class="p">+=</span> <span class="nv">$tzInfo</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>    <span class="p">}</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>    <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>        <span class="nb">Write-Warning</span> <span class="s2">&quot;Failed to connect to ${server}: $_&quot;</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>        <span class="nv">$results</span> <span class="p">+=</span> <span class="no">[PSCustomObject]</span><span class="p">@{</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>            <span class="n">ComputerName</span>     <span class="p">=</span> <span class="nv">$server</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>            <span class="n">TimeZoneId</span>       <span class="p">=</span> <span class="s2">&quot;ERROR&quot;</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>            <span class="n">TimeZoneDisplay</span>  <span class="p">=</span> <span class="s2">&quot;ERROR&quot;</span>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a>            <span class="n">CurrentTime</span>      <span class="p">=</span> <span class="s2">&quot;N/A&quot;</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a>            <span class="n">TimeSource</span>       <span class="p">=</span> <span class="s2">&quot;N/A&quot;</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a>            <span class="n">SyncStatus</span>       <span class="p">=</span> <span class="s2">&quot;N/A&quot;</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a>        <span class="p">}</span>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a>    <span class="p">}</span>
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a><span class="p">}</span>
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a>
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a><span class="c"># Output results</span>
</span><span id="__span-5-47"><a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a><span class="nv">$results</span> <span class="p">|</span> <span class="nb">Format-Table</span> <span class="n">-AutoSize</span>
</span><span id="__span-5-48"><a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a>
</span><span id="__span-5-49"><a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a><span class="c"># Save to CSV</span>
</span><span id="__span-5-50"><a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a><span class="nv">$results</span> <span class="p">|</span> <span class="nb">Export-Csv</span> <span class="n">-NoTypeInformation</span> <span class="n">-Path</span> <span class="nv">$OutputCsv</span>
</span><span id="__span-5-51"><a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a><span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">Audit complete. Results saved to $OutputCsv&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span></code></pre></div>
<hr />
<h3 id="gpo-based-scheduled-task-preferred-solution"><a class="toclink" href="../../enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks/#gpo-based-scheduled-task-preferred-solution">🧰 GPO-Based Scheduled Task (Preferred Solution)</a></h3>
<p>Instead of relying on registry modifications, we now use a <strong>Scheduled Task deployed via Group Policy</strong>.</p>
<h4 id="task-overview"><a class="toclink" href="../../enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks/#task-overview">✅ Task Overview</a></h4>
<ul>
<li><strong>Trigger:</strong> At Startup</li>
<li><strong>Action:</strong> Run <code>powershell.exe</code></li>
<li><strong>Arguments:</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>-Command<span class="w"> </span><span class="s2">&quot;Set-TimeZone -Id &#39;GMT Standard Time&#39;&quot;</span>
</span></code></pre></div>
<blockquote>
<p>💡 The GPO targets all domain-joined servers. Servers in isolated environments (e.g. DMZ) or not joined to the domain are excluded.</p>
</blockquote>
<hr />
<h4 id="scheduled-task-screenshots"><a class="toclink" href="../../enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks/#scheduled-task-screenshots">📸 Scheduled Task Screenshots</a></h4>
<p><img alt="GPO Task Properties - General Tab" src="../../server-posts/fix-dst-settings/scheduled-task-gpo.png" /><br />
<em>Fig 1: Scheduled Task created via GPO Preferences</em></p>
<p><img alt="Scheduled Task Action Details" src="../../server-posts/fix-dst-settings/scheduled-task.png" /><br />
<em>Fig 2: PowerShell command configuring the time zone</em></p>
<hr />
<h3 id="one-off-remediation-script-setting-the-time-zone"><a class="toclink" href="../../enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks/#one-off-remediation-script-setting-the-time-zone">🛠️ One-Off Remediation Script: Setting the Time Zone</a></h3>
<p>For servers identified as incorrect in the audit, the following script was used to apply the fix:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c"># List of servers to correct (e.g., from your audit results)</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nv">$servers</span> <span class="p">=</span> <span class="p">@(</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="s2">&quot;server1&quot;</span><span class="p">,</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="s2">&quot;server2&quot;</span><span class="p">,</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="s2">&quot;server3&quot;</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="p">)</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="c"># Prompt for credentials if needed</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="nv">$cred</span> <span class="p">=</span> <span class="nb">Get-Credential</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$server</span> <span class="k">in</span> <span class="nv">$servers</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;Setting time zone on $server...&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Cyan</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>    <span class="k">try</span> <span class="p">{</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>        <span class="nb">Invoke-Command</span> <span class="n">-ComputerName</span> <span class="nv">$server</span> <span class="n">-Credential</span> <span class="nv">$cred</span> <span class="n">-ScriptBlock</span> <span class="p">{</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>            <span class="nb">Set-TimeZone</span> <span class="n">-Id</span> <span class="s2">&quot;GMT Standard Time&quot;</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>        <span class="p">}</span> <span class="n">-ErrorAction</span> <span class="n">Stop</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>        <span class="nb">Write-Host</span> <span class="s2">&quot;✔ $server: Time zone set to GMT Standard Time&quot;</span> <span class="n">-ForegroundColor</span> <span class="n">Green</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>    <span class="p">}</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>    <span class="k">catch</span> <span class="p">{</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>        <span class="nb">Write-Warning</span> <span class="s2">&quot;✖ Failed to set time zone on ${server}: $_&quot;</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>    <span class="p">}</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h3 id="how-to-verify-time-zone-dst-compliance"><a class="toclink" href="../../enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks/#how-to-verify-time-zone-dst-compliance">🔍 How to Verify Time Zone + DST Compliance</a></h3>
<p>Use these PowerShell commands to verify:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nb">Get-TimeZone</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="p">(</span><span class="nb">Get-TimeZone</span><span class="p">).</span><span class="n">SupportsDaylightSavingTime</span>
</span></code></pre></div>
<p>And for registry inspection (read-only):</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nb">Get-ItemProperty</span> <span class="s2">&quot;HKLM:\SYSTEM\CurrentControlSet\Control\TimeZoneInformation&quot;</span> <span class="p">|</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>  <span class="nb">Select-Object</span> <span class="n">TimeZoneKeyName</span><span class="p">,</span> <span class="n">DisableAutoDaylightTimeSet</span><span class="p">,</span> <span class="n">DynamicDaylightTimeDisabled</span>
</span></code></pre></div>
<p>Expected values:</p>
<ul>
<li><code>TimeZoneKeyName</code>: <code>"GMT Standard Time"</code></li>
<li><code>DisableAutoDaylightTimeSet</code>: <code>0</code></li>
<li><code>DynamicDaylightTimeDisabled</code>: <code>0</code></li>
</ul>
<hr />
<h3 id="summary"><a class="toclink" href="../../enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks/#summary">🧼 Summary</a></h3>
<p>To ensure consistent time zone configuration and DST compliance:</p>
<ul>
<li>Use a <strong>GPO-based Scheduled Task</strong> to set <code>GMT Standard Time</code> at startup</li>
<li>Run a <strong>one-time audit and remediation</strong> script to fix legacy misconfigurations</li>
<li>Avoid registry edits — they’re no longer required</li>
<li>Validate using <code>Get-TimeZone</code> and confirm time sync via <code>w32tm</code></li>
</ul>
<hr />
<h3 id="next-steps"><a class="toclink" href="../../enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks/#next-steps">📘 Next Steps</a></h3>
<ul>
<li>[ ] Extend to Azure Arc or Intune-managed servers  </li>
<li>[ ] Monitor for changes in Windows DST behaviour in future builds  </li>
<li>[ ] Automate reporting to maintain compliance across environments</li>
</ul>
<hr />
<h3 id="final-thoughts"><a class="toclink" href="../../enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks/#final-thoughts">🧠 Final Thoughts</a></h3>
<p>This GPO+script approach delivers a clean, scalable way to enforce time zone standards and DST logic — without relying on brittle registry changes.</p>
<p>Let me know if you'd like help adapting this for cloud-native or hybrid environments!</p>
<hr />
<p><a class="md-button" href="https://x.com/intent/tweet?text=Enforcing%20Time%20Zone%20and%20DST%20Compliance%20on%20Windows%20Servers%20Using%20GPO%20and%20Scheduled%20Tasks%0A&amp;url=https://blog.pollockweb.com/blog/enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/enforcing-time-zone-and-dst-compliance-on-windows-servers-using-gpo-and-scheduled-tasks/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/110421070?s=400&v=4" alt="Matthew Pollock">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-03-31 00:00:00+00:00">March 31, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../category/windows/" class="md-meta__link">Windows</a>, 
              <a href="../../category/powershell/" class="md-meta__link">PowerShell</a>, 
              <a href="../../category/automation/" class="md-meta__link">Automation</a>, 
              <a href="../../category/regional-settings/" class="md-meta__link">Regional Settings</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="configuring-uk-regional-settings-on-windows-servers-with-powershell"><a class="toclink" href="../../configuring-uk-regional-settings-on-windows-servers-with-powershell/">⏲️ Configuring UK Regional Settings on Windows Servers with PowerShell</a></h2>
<p>When building out cloud-hosted or automated deployments of Windows Servers, especially for UK-based organisations, it’s easy to overlook <strong>regional settings</strong>. But these seemingly small configurations — like date/time formats, currency symbols, or keyboard layouts — can have a big impact on usability, application compatibility, and user experience.</p>
<p>In this post, I’ll show how I automate this using a simple PowerShell script that sets all relevant UK regional settings in one go.</p>
<hr />
<h3 id="why-regional-settings-matter"><a class="toclink" href="../../configuring-uk-regional-settings-on-windows-servers-with-powershell/#why-regional-settings-matter">🔍 Why Regional Settings Matter</a></h3>
<p>Out-of-the-box, Windows often defaults to <strong>en-US</strong> settings:</p>
<ul>
<li>Date format becomes <code>MM/DD/YYYY</code></li>
<li>Decimal separators switch to <code>.</code> instead of <code>,</code></li>
<li>Currency symbols use <code>$</code></li>
<li>Time zones default to US-based settings</li>
<li>Keyboard layout defaults to US (which can be infuriating!)</li>
</ul>
<p>For UK-based organisations, this can:</p>
<ul>
<li>Cause confusion in logs or spreadsheets</li>
<li>Break date parsing in scripts or apps expecting <code>DD/MM/YYYY</code></li>
<li>Result in the wrong characters being typed (e.g., <code>@</code> vs <code>"</code>)</li>
<li>Require manual fixing after deployment</li>
</ul>
<p>Automating this ensures <strong>consistency across environments</strong>, saves time, and avoids annoying regional mismatches.</p>
<hr />
<h3 id="script-overview"><a class="toclink" href="../../configuring-uk-regional-settings-on-windows-servers-with-powershell/#script-overview">🔧 Script Overview</a></h3>
<p>I created a PowerShell script that:</p>
<ul>
<li>Sets the system locale and input methods</li>
<li>Configures UK date/time formats</li>
<li>Applies the British English language pack (if needed)</li>
<li>Sets the time zone to GMT Standard Time (London)</li>
</ul>
<p>The script can be run manually, included in provisioning pipelines, or dropped into automation tools like Task Scheduler or cloud-init processes.</p>
<hr />
<h3 id="prerequisites"><a class="toclink" href="../../configuring-uk-regional-settings-on-windows-servers-with-powershell/#prerequisites">✅ Prerequisites</a></h3>
<p>To run this script, you should have:</p>
<ul>
<li>Administrator privileges</li>
<li>PowerShell 5.1+ (default on most supported Windows Server versions)</li>
<li>Optional: Internet access (if language pack needs to be added)</li>
</ul>
<hr />
<h3 id="the-script-set-ukregionalsettingsps1"><a class="toclink" href="../../configuring-uk-regional-settings-on-windows-servers-with-powershell/#the-script-set-ukregionalsettingsps1">🔹 The Script: <code>Set-UKRegionalSettings.ps1</code></a></h3>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c"># Set system locale and formats to English (United Kingdom)</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nb">Set-WinSystemLocale</span> <span class="n">-SystemLocale</span> <span class="n">en-GB</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nb">Set-WinUserLanguageList</span> <span class="n">-LanguageList</span> <span class="n">en-GB</span> <span class="n">-Force</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="nb">Set-Culture</span> <span class="n">en-GB</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="nb">Set-WinHomeLocation</span> <span class="n">-GeoId</span> <span class="n">242</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="nb">Set-TimeZone</span> <span class="n">-Id</span> <span class="s2">&quot;GMT Standard Time&quot;</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="c"># Optional reboot prompt</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="nb">Write-Host</span> <span class="s2">&quot;UK regional settings applied. A reboot is recommended for all changes to take effect.&quot;</span>
</span></code></pre></div>
<hr />
<h3 id="how-to-use-it"><a class="toclink" href="../../configuring-uk-regional-settings-on-windows-servers-with-powershell/#how-to-use-it">🚀 How to Use It</a></h3>
<h4 id="option-1-manual-execution"><a class="toclink" href="../../configuring-uk-regional-settings-on-windows-servers-with-powershell/#option-1-manual-execution">✈️ Option 1: Manual Execution</a></h4>
<ol>
<li>Open <strong>PowerShell as Administrator</strong></li>
<li>Run the script:</li>
</ol>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">.\</span><span class="nb">Set-UKRegionalSettings</span><span class="p">.</span><span class="n">ps1</span>
</span></code></pre></div>
<hr />
<h4 id="option-2-include-in-build-pipeline-or-image"><a class="toclink" href="../../configuring-uk-regional-settings-on-windows-servers-with-powershell/#option-2-include-in-build-pipeline-or-image">🔢 Option 2: Include in Build Pipeline or Image</a></h4>
<p>For Azure VMs or cloud images, consider running this as part of your deployment process via:</p>
<ul>
<li><strong>Custom Script Extension</strong> in ARM/Bicep</li>
<li><strong>cloud-init</strong> or <strong>Terraform provisioners</strong></li>
<li><strong>Group Policy Startup Script</strong></li>
</ul>
<hr />
<h3 id="quick-tips"><a class="toclink" href="../../configuring-uk-regional-settings-on-windows-servers-with-powershell/#quick-tips">⚡ Quick Tips</a></h3>
<ul>
<li>Reboot after running to ensure all settings apply across UI and system processes.</li>
<li>For non-UK keyboards (like US physical hardware), you may also want to explicitly set <code>InputLocale</code>.</li>
<li>Want to validate the settings? Use:</li>
</ul>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nb">Get-WinSystemLocale</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nb">Get-Culture</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="nb">Get-WinUserLanguageList</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="nb">Get-TimeZone</span>
</span></code></pre></div>
<hr />
<h3 id="registry-verification-per-user-and-default-settings"><a class="toclink" href="../../configuring-uk-regional-settings-on-windows-servers-with-powershell/#registry-verification-per-user-and-default-settings">📂 Registry Verification: Per-User and Default Settings</a></h3>
<p><img alt="Registry Editor Screenshot" src="../../server-posts/regional-settings/registry-editor.png" /></p>
<p>If you're troubleshooting or validating the configuration for specific users, regional settings are stored in the <strong>Windows Registry</strong> under:</p>
<h4 id="for-each-user-profile"><a class="toclink" href="../../configuring-uk-regional-settings-on-windows-servers-with-powershell/#for-each-user-profile">👤 For Each User Profile</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>HKEY_USERS\&lt;SID&gt;\Control Panel\International
</span></code></pre></div>
<p>You can find the user SIDs by looking under <code>HKEY_USERS</code> or using:</p>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nb">Get-ChildItem</span> <span class="n">Registry</span><span class="p">::</span><span class="n">HKEY_USERS</span>
</span></code></pre></div>
<h4 id="for-new-users-default-profile"><a class="toclink" href="../../configuring-uk-regional-settings-on-windows-servers-with-powershell/#for-new-users-default-profile">🧵 For New Users (Default Profile)</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>HKEY_USERS\.DEFAULT\Control Panel\International
</span></code></pre></div>
<p>This determines what settings new user profiles inherit on first logon.</p>
<p>You can script changes here if needed, but always test carefully to avoid corrupting profile defaults.</p>
<hr />
<h3 id="final-thoughts"><a class="toclink" href="../../configuring-uk-regional-settings-on-windows-servers-with-powershell/#final-thoughts">🌟 Final Thoughts</a></h3>
<p>Small tweaks like regional settings might seem minor, but they go a long way in making your Windows Server environments feel localised and ready for your users.</p>
<p>Automating them early in your build pipeline means one less thing to worry about during post-deployment configuration.</p>
<p>Let me know if you want a version of this that handles <strong>multi-user scenarios</strong> or works across <strong>multiple OS versions</strong>!</p>
<p><a class="md-button" href="https://x.com/intent/tweet?text=Configuring%20UK%20Regional%20Settings%20on%20Windows%20Servers%20with%20PowerShell%0A&amp;url=https://blog.pollockweb.com/blog/configuring-uk-regional-settings-on-windows-servers-with-powershell/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></span></a>
<a class="md-button" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.pollockweb.com/blog/configuring-uk-regional-settings-on-windows-servers-with-powershell/">Share on <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.101 23.691v-7.98H6.627v-3.667h2.474v-1.58c0-4.085 1.848-5.978 5.858-5.978.401 0 .955.042 1.468.103a9 9 0 0 1 1.141.195v3.325a9 9 0 0 0-.653-.036 27 27 0 0 0-.733-.009c-.707 0-1.259.096-1.675.309a1.7 1.7 0 0 0-.679.622c-.258.42-.374.995-.374 1.752v1.297h3.919l-.386 2.103-.287 1.564h-3.246v8.245C19.396 23.238 24 18.179 24 12.044c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.628 3.874 10.35 9.101 11.647"/></svg></span></a></p>
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  <span class="md-pagination__current">1</span> <a class="md-pagination__link" href="page/2/">2</a> <a class="md-pagination__link" href="page/3/">3</a>
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        
  <div class="custom-footer">
    <div class="custom-footer-left">
      <p>Copyright &copy; 2025 Matthew Pollock</p>
    </div>
    <div class="custom-footer-right">
      <a href="https://github.com/cloudlabmp" target="_blank" title="GitHub">
        <i class="fab fa-github"></i>
      </a>
      <a href="https://linkedin.com/in/matthew-pollock-76831920/" target="_blank" title="LinkedIn">
        <i class="fab fa-linkedin"></i>
      </a>
      <a href="https://profile.pollockweb.com" target="_blank" title="profile.pollockweb.com">
        <i class="fas fa-globe"></i>
      </a>
      <a href="https://blog.pollockweb.com/feed_rss_created.xml" target="_blank" title="RSS Feed">
        <i class="fa-solid fa-rss"></i>
      </a>
    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.indexes", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "content.code.select", "content.code.copy", "announce.dismiss"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>